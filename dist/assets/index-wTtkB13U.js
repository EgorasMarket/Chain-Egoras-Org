var x6=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var T1e=x6((Ja,es)=>{function b6(e,t){for(var i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const s=Object.getOwnPropertyDescriptor(r,a);s&&Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function i(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=i(a);fetch(a.href,s)}})();function w6(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function _6(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var i=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(i,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}),i}var dR={exports:{}},a1={},pR={exports:{}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dm=Symbol.for("react.element"),S6=Symbol.for("react.portal"),A6=Symbol.for("react.fragment"),E6=Symbol.for("react.strict_mode"),C6=Symbol.for("react.profiler"),M6=Symbol.for("react.provider"),T6=Symbol.for("react.context"),P6=Symbol.for("react.forward_ref"),D6=Symbol.for("react.suspense"),O6=Symbol.for("react.memo"),I6=Symbol.for("react.lazy"),hM=Symbol.iterator;function R6(e){return e===null||typeof e!="object"?null:(e=hM&&e[hM]||e["@@iterator"],typeof e=="function"?e:null)}var fR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mR=Object.assign,gR={};function Hd(e,t,i){this.props=e,this.context=t,this.refs=gR,this.updater=i||fR}Hd.prototype.isReactComponent={};Hd.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Hd.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function vR(){}vR.prototype=Hd.prototype;function lA(e,t,i){this.props=e,this.context=t,this.refs=gR,this.updater=i||fR}var cA=lA.prototype=new vR;cA.constructor=lA;mR(cA,Hd.prototype);cA.isPureReactComponent=!0;var uM=Array.isArray,yR=Object.prototype.hasOwnProperty,hA={current:null},xR={key:!0,ref:!0,__self:!0,__source:!0};function bR(e,t,i){var r,a={},s=null,n=null;if(t!=null)for(r in t.ref!==void 0&&(n=t.ref),t.key!==void 0&&(s=""+t.key),t)yR.call(t,r)&&!xR.hasOwnProperty(r)&&(a[r]=t[r]);var o=arguments.length-2;if(o===1)a.children=i;else if(1<o){for(var l=Array(o),c=0;c<o;c++)l[c]=arguments[c+2];a.children=l}if(e&&e.defaultProps)for(r in o=e.defaultProps,o)a[r]===void 0&&(a[r]=o[r]);return{$$typeof:Dm,type:e,key:s,ref:n,props:a,_owner:hA.current}}function L6(e,t){return{$$typeof:Dm,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function uA(e){return typeof e=="object"&&e!==null&&e.$$typeof===Dm}function k6(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return t[i]})}var dM=/\/+/g;function ux(e,t){return typeof e=="object"&&e!==null&&e.key!=null?k6(""+e.key):t.toString(36)}function Wv(e,t,i,r,a){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var n=!1;if(e===null)n=!0;else switch(s){case"string":case"number":n=!0;break;case"object":switch(e.$$typeof){case Dm:case S6:n=!0}}if(n)return n=e,a=a(n),e=r===""?"."+ux(n,0):r,uM(a)?(i="",e!=null&&(i=e.replace(dM,"$&/")+"/"),Wv(a,t,i,"",function(c){return c})):a!=null&&(uA(a)&&(a=L6(a,i+(!a.key||n&&n.key===a.key?"":(""+a.key).replace(dM,"$&/")+"/")+e)),t.push(a)),1;if(n=0,r=r===""?".":r+":",uM(e))for(var o=0;o<e.length;o++){s=e[o];var l=r+ux(s,o);n+=Wv(s,t,i,l,a)}else if(l=R6(e),typeof l=="function")for(e=l.call(e),o=0;!(s=e.next()).done;)s=s.value,l=r+ux(s,o++),n+=Wv(s,t,i,l,a);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return n}function rg(e,t,i){if(e==null)return e;var r=[],a=0;return Wv(e,r,"","",function(s){return t.call(i,s,a++)}),r}function z6(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var _a={current:null},qv={transition:null},N6={ReactCurrentDispatcher:_a,ReactCurrentBatchConfig:qv,ReactCurrentOwner:hA};It.Children={map:rg,forEach:function(e,t,i){rg(e,function(){t.apply(this,arguments)},i)},count:function(e){var t=0;return rg(e,function(){t++}),t},toArray:function(e){return rg(e,function(t){return t})||[]},only:function(e){if(!uA(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};It.Component=Hd;It.Fragment=A6;It.Profiler=C6;It.PureComponent=lA;It.StrictMode=E6;It.Suspense=D6;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N6;It.cloneElement=function(e,t,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=mR({},e.props),a=e.key,s=e.ref,n=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,n=hA.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)yR.call(t,l)&&!xR.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&o!==void 0?o[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=i;else if(1<l){o=Array(l);for(var c=0;c<l;c++)o[c]=arguments[c+2];r.children=o}return{$$typeof:Dm,type:e.type,key:a,ref:s,props:r,_owner:n}};It.createContext=function(e){return e={$$typeof:T6,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:M6,_context:e},e.Consumer=e};It.createElement=bR;It.createFactory=function(e){var t=bR.bind(null,e);return t.type=e,t};It.createRef=function(){return{current:null}};It.forwardRef=function(e){return{$$typeof:P6,render:e}};It.isValidElement=uA;It.lazy=function(e){return{$$typeof:I6,_payload:{_status:-1,_result:e},_init:z6}};It.memo=function(e,t){return{$$typeof:O6,type:e,compare:t===void 0?null:t}};It.startTransition=function(e){var t=qv.transition;qv.transition={};try{e()}finally{qv.transition=t}};It.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};It.useCallback=function(e,t){return _a.current.useCallback(e,t)};It.useContext=function(e){return _a.current.useContext(e)};It.useDebugValue=function(){};It.useDeferredValue=function(e){return _a.current.useDeferredValue(e)};It.useEffect=function(e,t){return _a.current.useEffect(e,t)};It.useId=function(){return _a.current.useId()};It.useImperativeHandle=function(e,t,i){return _a.current.useImperativeHandle(e,t,i)};It.useInsertionEffect=function(e,t){return _a.current.useInsertionEffect(e,t)};It.useLayoutEffect=function(e,t){return _a.current.useLayoutEffect(e,t)};It.useMemo=function(e,t){return _a.current.useMemo(e,t)};It.useReducer=function(e,t,i){return _a.current.useReducer(e,t,i)};It.useRef=function(e){return _a.current.useRef(e)};It.useState=function(e){return _a.current.useState(e)};It.useSyncExternalStore=function(e,t,i){return _a.current.useSyncExternalStore(e,t,i)};It.useTransition=function(){return _a.current.useTransition()};It.version="18.2.0";pR.exports=It;var xe=pR.exports;const zc=w6(xe),w0=b6({__proto__:null,default:zc},[xe]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B6=xe,j6=Symbol.for("react.element"),F6=Symbol.for("react.fragment"),U6=Object.prototype.hasOwnProperty,V6=B6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G6={key:!0,ref:!0,__self:!0,__source:!0};function wR(e,t,i){var r,a={},s=null,n=null;i!==void 0&&(s=""+i),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(n=t.ref);for(r in t)U6.call(t,r)&&!G6.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:j6,type:e,key:s,ref:n,props:a,_owner:V6.current}}a1.Fragment=F6;a1.jsx=wR;a1.jsxs=wR;dR.exports=a1;var b=dR.exports,Qw={},_R={exports:{}},ss={},SR={exports:{}},AR={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(L,X){var G=L.length;L.push(X);e:for(;0<G;){var U=G-1>>>1,H=L[U];if(0<a(H,X))L[U]=X,L[G]=H,G=U;else break e}}function i(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var X=L[0],G=L.pop();if(G!==X){L[0]=G;e:for(var U=0,H=L.length,$=H>>>1;U<$;){var Y=2*(U+1)-1,J=L[Y],Z=Y+1,ne=L[Z];if(0>a(J,G))Z<H&&0>a(ne,J)?(L[U]=ne,L[Z]=G,U=Z):(L[U]=J,L[Y]=G,U=Y);else if(Z<H&&0>a(ne,G))L[U]=ne,L[Z]=G,U=Z;else break e}}return X}function a(L,X){var G=L.sortIndex-X.sortIndex;return G!==0?G:L.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var n=Date,o=n.now();e.unstable_now=function(){return n.now()-o}}var l=[],c=[],u=1,h=null,d=3,p=!1,f=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(L){for(var X=i(c);X!==null;){if(X.callback===null)r(c);else if(X.startTime<=L)r(c),X.sortIndex=X.expirationTime,t(l,X);else break;X=i(c)}}function w(L){if(m=!1,x(L),!f)if(i(l)!==null)f=!0,q(S);else{var X=i(c);X!==null&&F(w,X.startTime-L)}}function S(L,X){f=!1,m&&(m=!1,v(E),E=-1),p=!0;var G=d;try{for(x(X),h=i(l);h!==null&&(!(h.expirationTime>X)||L&&!T());){var U=h.callback;if(typeof U=="function"){h.callback=null,d=h.priorityLevel;var H=U(h.expirationTime<=X);X=e.unstable_now(),typeof H=="function"?h.callback=H:h===i(l)&&r(l),x(X)}else r(l);h=i(l)}if(h!==null)var $=!0;else{var Y=i(c);Y!==null&&F(w,Y.startTime-X),$=!1}return $}finally{h=null,d=G,p=!1}}var _=!1,A=null,E=-1,M=5,C=-1;function T(){return!(e.unstable_now()-C<M)}function D(){if(A!==null){var L=e.unstable_now();C=L;var X=!0;try{X=A(!0,L)}finally{X?I():(_=!1,A=null)}}else _=!1}var I;if(typeof y=="function")I=function(){y(D)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,B=O.port2;O.port1.onmessage=D,I=function(){B.postMessage(null)}}else I=function(){g(D,0)};function q(L){A=L,_||(_=!0,I())}function F(L,X){E=g(function(){L(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(L){L.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,q(S))},e.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<L?Math.floor(1e3/L):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(L){switch(d){case 1:case 2:case 3:var X=3;break;default:X=d}var G=d;d=X;try{return L()}finally{d=G}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(L,X){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var G=d;d=L;try{return X()}finally{d=G}},e.unstable_scheduleCallback=function(L,X,G){var U=e.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?U+G:U):G=U,L){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=G+H,L={id:u++,callback:X,priorityLevel:L,startTime:G,expirationTime:H,sortIndex:-1},G>U?(L.sortIndex=G,t(c,L),i(l)===null&&L===i(c)&&(m?(v(E),E=-1):m=!0,F(w,G-U))):(L.sortIndex=H,t(l,L),f||p||(f=!0,q(S))),L},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(L){var X=d;return function(){var G=d;d=X;try{return L.apply(this,arguments)}finally{d=G}}}})(AR);SR.exports=AR;var H6=SR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ER=xe,rs=H6;function Te(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var CR=new Set,Ff={};function bh(e,t){xd(e,t),xd(e+"Capture",t)}function xd(e,t){for(Ff[e]=t,e=0;e<t.length;e++)CR.add(t[e])}var qo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zw=Object.prototype.hasOwnProperty,W6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pM={},fM={};function q6(e){return Zw.call(fM,e)?!0:Zw.call(pM,e)?!1:W6.test(e)?fM[e]=!0:(pM[e]=!0,!1)}function X6(e,t,i,r){if(i!==null&&i.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Y6(e,t,i,r){if(t===null||typeof t>"u"||X6(e,t,i,r))return!0;if(r)return!1;if(i!==null)switch(i.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Sa(e,t,i,r,a,s,n){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=n}var Gr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Gr[e]=new Sa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Gr[t]=new Sa(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Gr[e]=new Sa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Gr[e]=new Sa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Gr[e]=new Sa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Gr[e]=new Sa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Gr[e]=new Sa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Gr[e]=new Sa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Gr[e]=new Sa(e,5,!1,e.toLowerCase(),null,!1,!1)});var dA=/[\-:]([a-z])/g;function pA(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(dA,pA);Gr[t]=new Sa(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(dA,pA);Gr[t]=new Sa(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(dA,pA);Gr[t]=new Sa(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Gr[e]=new Sa(e,1,!1,e.toLowerCase(),null,!1,!1)});Gr.xlinkHref=new Sa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Gr[e]=new Sa(e,1,!1,e.toLowerCase(),null,!0,!0)});function fA(e,t,i,r){var a=Gr.hasOwnProperty(t)?Gr[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Y6(t,i,a,r)&&(i=null),r||a===null?q6(t)&&(i===null?e.removeAttribute(t):e.setAttribute(t,""+i)):a.mustUseProperty?e[a.propertyName]=i===null?a.type===3?!1:"":i:(t=a.attributeName,r=a.attributeNamespace,i===null?e.removeAttribute(t):(a=a.type,i=a===3||a===4&&i===!0?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}var tl=ER.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ag=Symbol.for("react.element"),Mu=Symbol.for("react.portal"),Tu=Symbol.for("react.fragment"),mA=Symbol.for("react.strict_mode"),Kw=Symbol.for("react.profiler"),MR=Symbol.for("react.provider"),TR=Symbol.for("react.context"),gA=Symbol.for("react.forward_ref"),$w=Symbol.for("react.suspense"),Jw=Symbol.for("react.suspense_list"),vA=Symbol.for("react.memo"),Sl=Symbol.for("react.lazy"),PR=Symbol.for("react.offscreen"),mM=Symbol.iterator;function pp(e){return e===null||typeof e!="object"?null:(e=mM&&e[mM]||e["@@iterator"],typeof e=="function"?e:null)}var Ei=Object.assign,dx;function tf(e){if(dx===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);dx=t&&t[1]||""}return`
`+dx+e}var px=!1;function fx(e,t){if(!e||px)return"";px=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var a=c.stack.split(`
`),s=r.stack.split(`
`),n=a.length-1,o=s.length-1;1<=n&&0<=o&&a[n]!==s[o];)o--;for(;1<=n&&0<=o;n--,o--)if(a[n]!==s[o]){if(n!==1||o!==1)do if(n--,o--,0>o||a[n]!==s[o]){var l=`
`+a[n].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=n&&0<=o);break}}}finally{px=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?tf(e):""}function Q6(e){switch(e.tag){case 5:return tf(e.type);case 16:return tf("Lazy");case 13:return tf("Suspense");case 19:return tf("SuspenseList");case 0:case 2:case 15:return e=fx(e.type,!1),e;case 11:return e=fx(e.type.render,!1),e;case 1:return e=fx(e.type,!0),e;default:return""}}function e_(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Tu:return"Fragment";case Mu:return"Portal";case Kw:return"Profiler";case mA:return"StrictMode";case $w:return"Suspense";case Jw:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case TR:return(e.displayName||"Context")+".Consumer";case MR:return(e._context.displayName||"Context")+".Provider";case gA:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case vA:return t=e.displayName||null,t!==null?t:e_(e.type)||"Memo";case Sl:t=e._payload,e=e._init;try{return e_(e(t))}catch{}}return null}function Z6(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return e_(t);case 8:return t===mA?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ac(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function DR(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function K6(e){var t=DR(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var a=i.get,s=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(n){r=""+n,s.call(this,n)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(n){r=""+n},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function sg(e){e._valueTracker||(e._valueTracker=K6(e))}function OR(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=DR(e)?e.checked?"true":"false":e.value),e=r,e!==i?(t.setValue(e),!0):!1}function _0(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function t_(e,t){var i=t.checked;return Ei({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function gM(e,t){var i=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;i=ac(t.value!=null?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function IR(e,t){t=t.checked,t!=null&&fA(e,"checked",t,!1)}function i_(e,t){IR(e,t);var i=ac(t.value),r=t.type;if(i!=null)r==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?r_(e,t.type,i):t.hasOwnProperty("defaultValue")&&r_(e,t.type,ac(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function vM(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function r_(e,t,i){(t!=="number"||_0(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var rf=Array.isArray;function Xu(e,t,i,r){if(e=e.options,t){t={};for(var a=0;a<i.length;a++)t["$"+i[a]]=!0;for(i=0;i<e.length;i++)a=t.hasOwnProperty("$"+e[i].value),e[i].selected!==a&&(e[i].selected=a),a&&r&&(e[i].defaultSelected=!0)}else{for(i=""+ac(i),t=null,a=0;a<e.length;a++){if(e[a].value===i){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function a_(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Te(91));return Ei({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function yM(e,t){var i=t.value;if(i==null){if(i=t.children,t=t.defaultValue,i!=null){if(t!=null)throw Error(Te(92));if(rf(i)){if(1<i.length)throw Error(Te(93));i=i[0]}t=i}t==null&&(t=""),i=t}e._wrapperState={initialValue:ac(i)}}function RR(e,t){var i=ac(t.value),r=ac(t.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),t.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),r!=null&&(e.defaultValue=""+r)}function xM(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function LR(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function s_(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?LR(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var ng,kR=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,i,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,i,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(ng=ng||document.createElement("div"),ng.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ng.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Uf(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=t;return}}e.textContent=t}var gf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$6=["Webkit","ms","Moz","O"];Object.keys(gf).forEach(function(e){$6.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),gf[t]=gf[e]})});function zR(e,t,i){return t==null||typeof t=="boolean"||t===""?"":i||typeof t!="number"||t===0||gf.hasOwnProperty(e)&&gf[e]?(""+t).trim():t+"px"}function NR(e,t){e=e.style;for(var i in t)if(t.hasOwnProperty(i)){var r=i.indexOf("--")===0,a=zR(i,t[i],r);i==="float"&&(i="cssFloat"),r?e.setProperty(i,a):e[i]=a}}var J6=Ei({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function n_(e,t){if(t){if(J6[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Te(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Te(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Te(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Te(62))}}function o_(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var l_=null;function yA(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var c_=null,Yu=null,Qu=null;function bM(e){if(e=Rm(e)){if(typeof c_!="function")throw Error(Te(280));var t=e.stateNode;t&&(t=c1(t),c_(e.stateNode,e.type,t))}}function BR(e){Yu?Qu?Qu.push(e):Qu=[e]:Yu=e}function jR(){if(Yu){var e=Yu,t=Qu;if(Qu=Yu=null,bM(e),t)for(e=0;e<t.length;e++)bM(t[e])}}function FR(e,t){return e(t)}function UR(){}var mx=!1;function VR(e,t,i){if(mx)return e(t,i);mx=!0;try{return FR(e,t,i)}finally{mx=!1,(Yu!==null||Qu!==null)&&(UR(),jR())}}function Vf(e,t){var i=e.stateNode;if(i===null)return null;var r=c1(i);if(r===null)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(Te(231,t,typeof i));return i}var h_=!1;if(qo)try{var fp={};Object.defineProperty(fp,"passive",{get:function(){h_=!0}}),window.addEventListener("test",fp,fp),window.removeEventListener("test",fp,fp)}catch{h_=!1}function eF(e,t,i,r,a,s,n,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(u){this.onError(u)}}var vf=!1,S0=null,A0=!1,u_=null,tF={onError:function(e){vf=!0,S0=e}};function iF(e,t,i,r,a,s,n,o,l){vf=!1,S0=null,eF.apply(tF,arguments)}function rF(e,t,i,r,a,s,n,o,l){if(iF.apply(this,arguments),vf){if(vf){var c=S0;vf=!1,S0=null}else throw Error(Te(198));A0||(A0=!0,u_=c)}}function wh(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function GR(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function wM(e){if(wh(e)!==e)throw Error(Te(188))}function aF(e){var t=e.alternate;if(!t){if(t=wh(e),t===null)throw Error(Te(188));return t!==e?null:e}for(var i=e,r=t;;){var a=i.return;if(a===null)break;var s=a.alternate;if(s===null){if(r=a.return,r!==null){i=r;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===i)return wM(a),e;if(s===r)return wM(a),t;s=s.sibling}throw Error(Te(188))}if(i.return!==r.return)i=a,r=s;else{for(var n=!1,o=a.child;o;){if(o===i){n=!0,i=a,r=s;break}if(o===r){n=!0,r=a,i=s;break}o=o.sibling}if(!n){for(o=s.child;o;){if(o===i){n=!0,i=s,r=a;break}if(o===r){n=!0,r=s,i=a;break}o=o.sibling}if(!n)throw Error(Te(189))}}if(i.alternate!==r)throw Error(Te(190))}if(i.tag!==3)throw Error(Te(188));return i.stateNode.current===i?e:t}function HR(e){return e=aF(e),e!==null?WR(e):null}function WR(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=WR(e);if(t!==null)return t;e=e.sibling}return null}var qR=rs.unstable_scheduleCallback,_M=rs.unstable_cancelCallback,sF=rs.unstable_shouldYield,nF=rs.unstable_requestPaint,Fi=rs.unstable_now,oF=rs.unstable_getCurrentPriorityLevel,xA=rs.unstable_ImmediatePriority,XR=rs.unstable_UserBlockingPriority,E0=rs.unstable_NormalPriority,lF=rs.unstable_LowPriority,YR=rs.unstable_IdlePriority,s1=null,Hn=null;function cF(e){if(Hn&&typeof Hn.onCommitFiberRoot=="function")try{Hn.onCommitFiberRoot(s1,e,void 0,(e.current.flags&128)===128)}catch{}}var tn=Math.clz32?Math.clz32:dF,hF=Math.log,uF=Math.LN2;function dF(e){return e>>>=0,e===0?32:31-(hF(e)/uF|0)|0}var og=64,lg=4194304;function af(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function C0(e,t){var i=e.pendingLanes;if(i===0)return 0;var r=0,a=e.suspendedLanes,s=e.pingedLanes,n=i&268435455;if(n!==0){var o=n&~a;o!==0?r=af(o):(s&=n,s!==0&&(r=af(s)))}else n=i&~a,n!==0?r=af(n):s!==0&&(r=af(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,s=t&-t,a>=s||a===16&&(s&4194240)!==0))return t;if(r&4&&(r|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)i=31-tn(t),a=1<<i,r|=e[i],t&=~a;return r}function pF(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fF(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var n=31-tn(s),o=1<<n,l=a[n];l===-1?(!(o&i)||o&r)&&(a[n]=pF(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}function d_(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function QR(){var e=og;return og<<=1,!(og&4194240)&&(og=64),e}function gx(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Om(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-tn(t),e[t]=i}function mF(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var a=31-tn(i),s=1<<a;t[a]=0,r[a]=-1,e[a]=-1,i&=~s}}function bA(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-tn(i),a=1<<r;a&t|e[r]&t&&(e[r]|=t),i&=~a}}var ei=0;function ZR(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var KR,wA,$R,JR,eL,p_=!1,cg=[],ql=null,Xl=null,Yl=null,Gf=new Map,Hf=new Map,Cl=[],gF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function SM(e,t){switch(e){case"focusin":case"focusout":ql=null;break;case"dragenter":case"dragleave":Xl=null;break;case"mouseover":case"mouseout":Yl=null;break;case"pointerover":case"pointerout":Gf.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hf.delete(t.pointerId)}}function mp(e,t,i,r,a,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:s,targetContainers:[a]},t!==null&&(t=Rm(t),t!==null&&wA(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function vF(e,t,i,r,a){switch(t){case"focusin":return ql=mp(ql,e,t,i,r,a),!0;case"dragenter":return Xl=mp(Xl,e,t,i,r,a),!0;case"mouseover":return Yl=mp(Yl,e,t,i,r,a),!0;case"pointerover":var s=a.pointerId;return Gf.set(s,mp(Gf.get(s)||null,e,t,i,r,a)),!0;case"gotpointercapture":return s=a.pointerId,Hf.set(s,mp(Hf.get(s)||null,e,t,i,r,a)),!0}return!1}function tL(e){var t=Nc(e.target);if(t!==null){var i=wh(t);if(i!==null){if(t=i.tag,t===13){if(t=GR(i),t!==null){e.blockedOn=t,eL(e.priority,function(){$R(i)});return}}else if(t===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xv(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var i=f_(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var r=new i.constructor(i.type,i);l_=r,i.target.dispatchEvent(r),l_=null}else return t=Rm(i),t!==null&&wA(t),e.blockedOn=i,!1;t.shift()}return!0}function AM(e,t,i){Xv(e)&&i.delete(t)}function yF(){p_=!1,ql!==null&&Xv(ql)&&(ql=null),Xl!==null&&Xv(Xl)&&(Xl=null),Yl!==null&&Xv(Yl)&&(Yl=null),Gf.forEach(AM),Hf.forEach(AM)}function gp(e,t){e.blockedOn===t&&(e.blockedOn=null,p_||(p_=!0,rs.unstable_scheduleCallback(rs.unstable_NormalPriority,yF)))}function Wf(e){function t(a){return gp(a,e)}if(0<cg.length){gp(cg[0],e);for(var i=1;i<cg.length;i++){var r=cg[i];r.blockedOn===e&&(r.blockedOn=null)}}for(ql!==null&&gp(ql,e),Xl!==null&&gp(Xl,e),Yl!==null&&gp(Yl,e),Gf.forEach(t),Hf.forEach(t),i=0;i<Cl.length;i++)r=Cl[i],r.blockedOn===e&&(r.blockedOn=null);for(;0<Cl.length&&(i=Cl[0],i.blockedOn===null);)tL(i),i.blockedOn===null&&Cl.shift()}var Zu=tl.ReactCurrentBatchConfig,M0=!0;function xF(e,t,i,r){var a=ei,s=Zu.transition;Zu.transition=null;try{ei=1,_A(e,t,i,r)}finally{ei=a,Zu.transition=s}}function bF(e,t,i,r){var a=ei,s=Zu.transition;Zu.transition=null;try{ei=4,_A(e,t,i,r)}finally{ei=a,Zu.transition=s}}function _A(e,t,i,r){if(M0){var a=f_(e,t,i,r);if(a===null)Cx(e,t,r,T0,i),SM(e,r);else if(vF(a,e,t,i,r))r.stopPropagation();else if(SM(e,r),t&4&&-1<gF.indexOf(e)){for(;a!==null;){var s=Rm(a);if(s!==null&&KR(s),s=f_(e,t,i,r),s===null&&Cx(e,t,r,T0,i),s===a)break;a=s}a!==null&&r.stopPropagation()}else Cx(e,t,r,null,i)}}var T0=null;function f_(e,t,i,r){if(T0=null,e=yA(r),e=Nc(e),e!==null)if(t=wh(e),t===null)e=null;else if(i=t.tag,i===13){if(e=GR(t),e!==null)return e;e=null}else if(i===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return T0=e,null}function iL(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(oF()){case xA:return 1;case XR:return 4;case E0:case lF:return 16;case YR:return 536870912;default:return 16}default:return 16}}var Rl=null,SA=null,Yv=null;function rL(){if(Yv)return Yv;var e,t=SA,i=t.length,r,a="value"in Rl?Rl.value:Rl.textContent,s=a.length;for(e=0;e<i&&t[e]===a[e];e++);var n=i-e;for(r=1;r<=n&&t[i-r]===a[s-r];r++);return Yv=a.slice(e,1<r?1-r:void 0)}function Qv(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function hg(){return!0}function EM(){return!1}function ns(e){function t(i,r,a,s,n){this._reactName=i,this._targetInst=a,this.type=r,this.nativeEvent=s,this.target=n,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(i=e[o],this[o]=i?i(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?hg:EM,this.isPropagationStopped=EM,this}return Ei(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=hg)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=hg)},persist:function(){},isPersistent:hg}),t}var Wd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},AA=ns(Wd),Im=Ei({},Wd,{view:0,detail:0}),wF=ns(Im),vx,yx,vp,n1=Ei({},Im,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:EA,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==vp&&(vp&&e.type==="mousemove"?(vx=e.screenX-vp.screenX,yx=e.screenY-vp.screenY):yx=vx=0,vp=e),vx)},movementY:function(e){return"movementY"in e?e.movementY:yx}}),CM=ns(n1),_F=Ei({},n1,{dataTransfer:0}),SF=ns(_F),AF=Ei({},Im,{relatedTarget:0}),xx=ns(AF),EF=Ei({},Wd,{animationName:0,elapsedTime:0,pseudoElement:0}),CF=ns(EF),MF=Ei({},Wd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),TF=ns(MF),PF=Ei({},Wd,{data:0}),MM=ns(PF),DF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},OF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},IF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function RF(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=IF[e])?!!t[e]:!1}function EA(){return RF}var LF=Ei({},Im,{key:function(e){if(e.key){var t=DF[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Qv(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?OF[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:EA,charCode:function(e){return e.type==="keypress"?Qv(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Qv(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),kF=ns(LF),zF=Ei({},n1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),TM=ns(zF),NF=Ei({},Im,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:EA}),BF=ns(NF),jF=Ei({},Wd,{propertyName:0,elapsedTime:0,pseudoElement:0}),FF=ns(jF),UF=Ei({},n1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),VF=ns(UF),GF=[9,13,27,32],CA=qo&&"CompositionEvent"in window,yf=null;qo&&"documentMode"in document&&(yf=document.documentMode);var HF=qo&&"TextEvent"in window&&!yf,aL=qo&&(!CA||yf&&8<yf&&11>=yf),PM=" ",DM=!1;function sL(e,t){switch(e){case"keyup":return GF.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nL(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Pu=!1;function WF(e,t){switch(e){case"compositionend":return nL(t);case"keypress":return t.which!==32?null:(DM=!0,PM);case"textInput":return e=t.data,e===PM&&DM?null:e;default:return null}}function qF(e,t){if(Pu)return e==="compositionend"||!CA&&sL(e,t)?(e=rL(),Yv=SA=Rl=null,Pu=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return aL&&t.locale!=="ko"?null:t.data;default:return null}}var XF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function OM(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!XF[e.type]:t==="textarea"}function oL(e,t,i,r){BR(r),t=P0(t,"onChange"),0<t.length&&(i=new AA("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var xf=null,qf=null;function YF(e){yL(e,0)}function o1(e){var t=Iu(e);if(OR(t))return e}function QF(e,t){if(e==="change")return t}var lL=!1;if(qo){var bx;if(qo){var wx="oninput"in document;if(!wx){var IM=document.createElement("div");IM.setAttribute("oninput","return;"),wx=typeof IM.oninput=="function"}bx=wx}else bx=!1;lL=bx&&(!document.documentMode||9<document.documentMode)}function RM(){xf&&(xf.detachEvent("onpropertychange",cL),qf=xf=null)}function cL(e){if(e.propertyName==="value"&&o1(qf)){var t=[];oL(t,qf,e,yA(e)),VR(YF,t)}}function ZF(e,t,i){e==="focusin"?(RM(),xf=t,qf=i,xf.attachEvent("onpropertychange",cL)):e==="focusout"&&RM()}function KF(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return o1(qf)}function $F(e,t){if(e==="click")return o1(t)}function JF(e,t){if(e==="input"||e==="change")return o1(t)}function eU(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var nn=typeof Object.is=="function"?Object.is:eU;function Xf(e,t){if(nn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var a=i[r];if(!Zw.call(t,a)||!nn(e[a],t[a]))return!1}return!0}function LM(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function kM(e,t){var i=LM(e);e=0;for(var r;i;){if(i.nodeType===3){if(r=e+i.textContent.length,e<=t&&r>=t)return{node:i,offset:t-e};e=r}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=LM(i)}}function hL(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?hL(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function uL(){for(var e=window,t=_0();t instanceof e.HTMLIFrameElement;){try{var i=typeof t.contentWindow.location.href=="string"}catch{i=!1}if(i)e=t.contentWindow;else break;t=_0(e.document)}return t}function MA(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function tU(e){var t=uL(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&hL(i.ownerDocument.documentElement,i)){if(r!==null&&MA(i)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if(e=(t=i.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=i.textContent.length,s=Math.min(r.start,a);r=r.end===void 0?s:Math.min(r.end,a),!e.extend&&s>r&&(a=r,r=s,s=a),a=kM(i,s);var n=kM(i,r);a&&n&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==n.node||e.focusOffset!==n.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(n.node,n.offset)):(t.setEnd(n.node,n.offset),e.addRange(t)))}}for(t=[],e=i;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<t.length;i++)e=t[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var iU=qo&&"documentMode"in document&&11>=document.documentMode,Du=null,m_=null,bf=null,g_=!1;function zM(e,t,i){var r=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;g_||Du==null||Du!==_0(r)||(r=Du,"selectionStart"in r&&MA(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),bf&&Xf(bf,r)||(bf=r,r=P0(m_,"onSelect"),0<r.length&&(t=new AA("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=Du)))}function ug(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var Ou={animationend:ug("Animation","AnimationEnd"),animationiteration:ug("Animation","AnimationIteration"),animationstart:ug("Animation","AnimationStart"),transitionend:ug("Transition","TransitionEnd")},_x={},dL={};qo&&(dL=document.createElement("div").style,"AnimationEvent"in window||(delete Ou.animationend.animation,delete Ou.animationiteration.animation,delete Ou.animationstart.animation),"TransitionEvent"in window||delete Ou.transitionend.transition);function l1(e){if(_x[e])return _x[e];if(!Ou[e])return e;var t=Ou[e],i;for(i in t)if(t.hasOwnProperty(i)&&i in dL)return _x[e]=t[i];return e}var pL=l1("animationend"),fL=l1("animationiteration"),mL=l1("animationstart"),gL=l1("transitionend"),vL=new Map,NM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cc(e,t){vL.set(e,t),bh(t,[e])}for(var Sx=0;Sx<NM.length;Sx++){var Ax=NM[Sx],rU=Ax.toLowerCase(),aU=Ax[0].toUpperCase()+Ax.slice(1);cc(rU,"on"+aU)}cc(pL,"onAnimationEnd");cc(fL,"onAnimationIteration");cc(mL,"onAnimationStart");cc("dblclick","onDoubleClick");cc("focusin","onFocus");cc("focusout","onBlur");cc(gL,"onTransitionEnd");xd("onMouseEnter",["mouseout","mouseover"]);xd("onMouseLeave",["mouseout","mouseover"]);xd("onPointerEnter",["pointerout","pointerover"]);xd("onPointerLeave",["pointerout","pointerover"]);bh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bh("onBeforeInput",["compositionend","keypress","textInput","paste"]);bh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sU=new Set("cancel close invalid load scroll toggle".split(" ").concat(sf));function BM(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,rF(r,t,void 0,e),e.currentTarget=null}function yL(e,t){t=(t&4)!==0;for(var i=0;i<e.length;i++){var r=e[i],a=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var n=r.length-1;0<=n;n--){var o=r[n],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&a.isPropagationStopped())break e;BM(a,o,c),s=l}else for(n=0;n<r.length;n++){if(o=r[n],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&a.isPropagationStopped())break e;BM(a,o,c),s=l}}}if(A0)throw e=u_,A0=!1,u_=null,e}function ui(e,t){var i=t[w_];i===void 0&&(i=t[w_]=new Set);var r=e+"__bubble";i.has(r)||(xL(t,e,2,!1),i.add(r))}function Ex(e,t,i){var r=0;t&&(r|=4),xL(i,e,r,t)}var dg="_reactListening"+Math.random().toString(36).slice(2);function Yf(e){if(!e[dg]){e[dg]=!0,CR.forEach(function(i){i!=="selectionchange"&&(sU.has(i)||Ex(i,!1,e),Ex(i,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[dg]||(t[dg]=!0,Ex("selectionchange",!1,t))}}function xL(e,t,i,r){switch(iL(t)){case 1:var a=xF;break;case 4:a=bF;break;default:a=_A}i=a.bind(null,t,i,e),a=void 0,!h_||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,i,{capture:!0,passive:a}):e.addEventListener(t,i,!0):a!==void 0?e.addEventListener(t,i,{passive:a}):e.addEventListener(t,i,!1)}function Cx(e,t,i,r,a){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var n=r.tag;if(n===3||n===4){var o=r.stateNode.containerInfo;if(o===a||o.nodeType===8&&o.parentNode===a)break;if(n===4)for(n=r.return;n!==null;){var l=n.tag;if((l===3||l===4)&&(l=n.stateNode.containerInfo,l===a||l.nodeType===8&&l.parentNode===a))return;n=n.return}for(;o!==null;){if(n=Nc(o),n===null)return;if(l=n.tag,l===5||l===6){r=s=n;continue e}o=o.parentNode}}r=r.return}VR(function(){var c=s,u=yA(i),h=[];e:{var d=vL.get(e);if(d!==void 0){var p=AA,f=e;switch(e){case"keypress":if(Qv(i)===0)break e;case"keydown":case"keyup":p=kF;break;case"focusin":f="focus",p=xx;break;case"focusout":f="blur",p=xx;break;case"beforeblur":case"afterblur":p=xx;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=CM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=SF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=BF;break;case pL:case fL:case mL:p=CF;break;case gL:p=FF;break;case"scroll":p=wF;break;case"wheel":p=VF;break;case"copy":case"cut":case"paste":p=TF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=TM}var m=(t&4)!==0,g=!m&&e==="scroll",v=m?d!==null?d+"Capture":null:d;m=[];for(var y=c,x;y!==null;){x=y;var w=x.stateNode;if(x.tag===5&&w!==null&&(x=w,v!==null&&(w=Vf(y,v),w!=null&&m.push(Qf(y,w,x)))),g)break;y=y.return}0<m.length&&(d=new p(d,f,null,i,u),h.push({event:d,listeners:m}))}}if(!(t&7)){e:{if(d=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",d&&i!==l_&&(f=i.relatedTarget||i.fromElement)&&(Nc(f)||f[Xo]))break e;if((p||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,p?(f=i.relatedTarget||i.toElement,p=c,f=f?Nc(f):null,f!==null&&(g=wh(f),f!==g||f.tag!==5&&f.tag!==6)&&(f=null)):(p=null,f=c),p!==f)){if(m=CM,w="onMouseLeave",v="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(m=TM,w="onPointerLeave",v="onPointerEnter",y="pointer"),g=p==null?d:Iu(p),x=f==null?d:Iu(f),d=new m(w,y+"leave",p,i,u),d.target=g,d.relatedTarget=x,w=null,Nc(u)===c&&(m=new m(v,y+"enter",f,i,u),m.target=x,m.relatedTarget=g,w=m),g=w,p&&f)t:{for(m=p,v=f,y=0,x=m;x;x=Oh(x))y++;for(x=0,w=v;w;w=Oh(w))x++;for(;0<y-x;)m=Oh(m),y--;for(;0<x-y;)v=Oh(v),x--;for(;y--;){if(m===v||v!==null&&m===v.alternate)break t;m=Oh(m),v=Oh(v)}m=null}else m=null;p!==null&&jM(h,d,p,m,!1),f!==null&&g!==null&&jM(h,g,f,m,!0)}}e:{if(d=c?Iu(c):window,p=d.nodeName&&d.nodeName.toLowerCase(),p==="select"||p==="input"&&d.type==="file")var S=QF;else if(OM(d))if(lL)S=JF;else{S=KF;var _=ZF}else(p=d.nodeName)&&p.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(S=$F);if(S&&(S=S(e,c))){oL(h,S,i,u);break e}_&&_(e,d,c),e==="focusout"&&(_=d._wrapperState)&&_.controlled&&d.type==="number"&&r_(d,"number",d.value)}switch(_=c?Iu(c):window,e){case"focusin":(OM(_)||_.contentEditable==="true")&&(Du=_,m_=c,bf=null);break;case"focusout":bf=m_=Du=null;break;case"mousedown":g_=!0;break;case"contextmenu":case"mouseup":case"dragend":g_=!1,zM(h,i,u);break;case"selectionchange":if(iU)break;case"keydown":case"keyup":zM(h,i,u)}var A;if(CA)e:{switch(e){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Pu?sL(e,i)&&(E="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(E="onCompositionStart");E&&(aL&&i.locale!=="ko"&&(Pu||E!=="onCompositionStart"?E==="onCompositionEnd"&&Pu&&(A=rL()):(Rl=u,SA="value"in Rl?Rl.value:Rl.textContent,Pu=!0)),_=P0(c,E),0<_.length&&(E=new MM(E,e,null,i,u),h.push({event:E,listeners:_}),A?E.data=A:(A=nL(i),A!==null&&(E.data=A)))),(A=HF?WF(e,i):qF(e,i))&&(c=P0(c,"onBeforeInput"),0<c.length&&(u=new MM("onBeforeInput","beforeinput",null,i,u),h.push({event:u,listeners:c}),u.data=A))}yL(h,t)})}function Qf(e,t,i){return{instance:e,listener:t,currentTarget:i}}function P0(e,t){for(var i=t+"Capture",r=[];e!==null;){var a=e,s=a.stateNode;a.tag===5&&s!==null&&(a=s,s=Vf(e,i),s!=null&&r.unshift(Qf(e,s,a)),s=Vf(e,t),s!=null&&r.push(Qf(e,s,a))),e=e.return}return r}function Oh(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function jM(e,t,i,r,a){for(var s=t._reactName,n=[];i!==null&&i!==r;){var o=i,l=o.alternate,c=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&c!==null&&(o=c,a?(l=Vf(i,s),l!=null&&n.unshift(Qf(i,l,o))):a||(l=Vf(i,s),l!=null&&n.push(Qf(i,l,o)))),i=i.return}n.length!==0&&e.push({event:t,listeners:n})}var nU=/\r\n?/g,oU=/\u0000|\uFFFD/g;function FM(e){return(typeof e=="string"?e:""+e).replace(nU,`
`).replace(oU,"")}function pg(e,t,i){if(t=FM(t),FM(e)!==t&&i)throw Error(Te(425))}function D0(){}var v_=null,y_=null;function x_(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var b_=typeof setTimeout=="function"?setTimeout:void 0,lU=typeof clearTimeout=="function"?clearTimeout:void 0,UM=typeof Promise=="function"?Promise:void 0,cU=typeof queueMicrotask=="function"?queueMicrotask:typeof UM<"u"?function(e){return UM.resolve(null).then(e).catch(hU)}:b_;function hU(e){setTimeout(function(){throw e})}function Mx(e,t){var i=t,r=0;do{var a=i.nextSibling;if(e.removeChild(i),a&&a.nodeType===8)if(i=a.data,i==="/$"){if(r===0){e.removeChild(a),Wf(t);return}r--}else i!=="$"&&i!=="$?"&&i!=="$!"||r++;i=a}while(i);Wf(t)}function Ql(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function VM(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(t===0)return e;t--}else i==="/$"&&t++}e=e.previousSibling}return null}var qd=Math.random().toString(36).slice(2),Nn="__reactFiber$"+qd,Zf="__reactProps$"+qd,Xo="__reactContainer$"+qd,w_="__reactEvents$"+qd,uU="__reactListeners$"+qd,dU="__reactHandles$"+qd;function Nc(e){var t=e[Nn];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Xo]||i[Nn]){if(i=t.alternate,t.child!==null||i!==null&&i.child!==null)for(e=VM(e);e!==null;){if(i=e[Nn])return i;e=VM(e)}return t}e=i,i=e.parentNode}return null}function Rm(e){return e=e[Nn]||e[Xo],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Iu(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Te(33))}function c1(e){return e[Zf]||null}var __=[],Ru=-1;function hc(e){return{current:e}}function fi(e){0>Ru||(e.current=__[Ru],__[Ru]=null,Ru--)}function hi(e,t){Ru++,__[Ru]=e.current,e.current=t}var sc={},sa=hc(sc),Na=hc(!1),nh=sc;function bd(e,t){var i=e.type.contextTypes;if(!i)return sc;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},s;for(s in i)a[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ba(e){return e=e.childContextTypes,e!=null}function O0(){fi(Na),fi(sa)}function GM(e,t,i){if(sa.current!==sc)throw Error(Te(168));hi(sa,t),hi(Na,i)}function bL(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return i;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(Te(108,Z6(e)||"Unknown",a));return Ei({},i,r)}function I0(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||sc,nh=sa.current,hi(sa,e),hi(Na,Na.current),!0}function HM(e,t,i){var r=e.stateNode;if(!r)throw Error(Te(169));i?(e=bL(e,t,nh),r.__reactInternalMemoizedMergedChildContext=e,fi(Na),fi(sa),hi(sa,e)):fi(Na),hi(Na,i)}var To=null,h1=!1,Tx=!1;function wL(e){To===null?To=[e]:To.push(e)}function pU(e){h1=!0,wL(e)}function uc(){if(!Tx&&To!==null){Tx=!0;var e=0,t=ei;try{var i=To;for(ei=1;e<i.length;e++){var r=i[e];do r=r(!0);while(r!==null)}To=null,h1=!1}catch(a){throw To!==null&&(To=To.slice(e+1)),qR(xA,uc),a}finally{ei=t,Tx=!1}}return null}var Lu=[],ku=0,R0=null,L0=0,xs=[],bs=0,oh=null,ko=1,zo="";function Ac(e,t){Lu[ku++]=L0,Lu[ku++]=R0,R0=e,L0=t}function _L(e,t,i){xs[bs++]=ko,xs[bs++]=zo,xs[bs++]=oh,oh=e;var r=ko;e=zo;var a=32-tn(r)-1;r&=~(1<<a),i+=1;var s=32-tn(t)+a;if(30<s){var n=a-a%5;s=(r&(1<<n)-1).toString(32),r>>=n,a-=n,ko=1<<32-tn(t)+a|i<<a|r,zo=s+e}else ko=1<<s|i<<a|r,zo=e}function TA(e){e.return!==null&&(Ac(e,1),_L(e,1,0))}function PA(e){for(;e===R0;)R0=Lu[--ku],Lu[ku]=null,L0=Lu[--ku],Lu[ku]=null;for(;e===oh;)oh=xs[--bs],xs[bs]=null,zo=xs[--bs],xs[bs]=null,ko=xs[--bs],xs[bs]=null}var ts=null,Za=null,gi=!1,Ys=null;function SL(e,t){var i=Ss(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function WM(e,t){switch(e.tag){case 5:var i=e.type;return t=t.nodeType!==1||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ts=e,Za=Ql(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ts=e,Za=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(i=oh!==null?{id:ko,overflow:zo}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Ss(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,ts=e,Za=null,!0):!1;default:return!1}}function S_(e){return(e.mode&1)!==0&&(e.flags&128)===0}function A_(e){if(gi){var t=Za;if(t){var i=t;if(!WM(e,t)){if(S_(e))throw Error(Te(418));t=Ql(i.nextSibling);var r=ts;t&&WM(e,t)?SL(r,i):(e.flags=e.flags&-4097|2,gi=!1,ts=e)}}else{if(S_(e))throw Error(Te(418));e.flags=e.flags&-4097|2,gi=!1,ts=e}}}function qM(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ts=e}function fg(e){if(e!==ts)return!1;if(!gi)return qM(e),gi=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!x_(e.type,e.memoizedProps)),t&&(t=Za)){if(S_(e))throw AL(),Error(Te(418));for(;t;)SL(e,t),t=Ql(t.nextSibling)}if(qM(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Te(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(t===0){Za=Ql(e.nextSibling);break e}t--}else i!=="$"&&i!=="$!"&&i!=="$?"||t++}e=e.nextSibling}Za=null}}else Za=ts?Ql(e.stateNode.nextSibling):null;return!0}function AL(){for(var e=Za;e;)e=Ql(e.nextSibling)}function wd(){Za=ts=null,gi=!1}function DA(e){Ys===null?Ys=[e]:Ys.push(e)}var fU=tl.ReactCurrentBatchConfig;function qs(e,t){if(e&&e.defaultProps){t=Ei({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}var k0=hc(null),z0=null,zu=null,OA=null;function IA(){OA=zu=z0=null}function RA(e){var t=k0.current;fi(k0),e._currentValue=t}function E_(e,t,i){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Ku(e,t){z0=e,OA=zu=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ra=!0),e.firstContext=null)}function Ps(e){var t=e._currentValue;if(OA!==e)if(e={context:e,memoizedValue:t,next:null},zu===null){if(z0===null)throw Error(Te(308));zu=e,z0.dependencies={lanes:0,firstContext:e}}else zu=zu.next=e;return t}var Bc=null;function LA(e){Bc===null?Bc=[e]:Bc.push(e)}function EL(e,t,i,r){var a=t.interleaved;return a===null?(i.next=i,LA(t)):(i.next=a.next,a.next=i),t.interleaved=i,Yo(e,r)}function Yo(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}var Al=!1;function kA(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CL(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Uo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Zl(e,t,i){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Bt&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Yo(e,i)}return a=r.interleaved,a===null?(t.next=t,LA(r)):(t.next=a.next,a.next=t),r.interleaved=t,Yo(e,i)}function Zv(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,bA(e,i)}}function XM(e,t){var i=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,i===r)){var a=null,s=null;if(i=i.firstBaseUpdate,i!==null){do{var n={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};s===null?a=s=n:s=s.next=n,i=i.next}while(i!==null);s===null?a=s=t:s=s.next=t}else a=s=t;i={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function N0(e,t,i,r){var a=e.updateQueue;Al=!1;var s=a.firstBaseUpdate,n=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var l=o,c=l.next;l.next=null,n===null?s=c:n.next=c,n=l;var u=e.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==n&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=a.baseState;n=0,u=c=l=null,o=s;do{var d=o.lane,p=o.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(d=t,p=i,m.tag){case 1:if(f=m.payload,typeof f=="function"){h=f.call(p,h,d);break e}h=f;break e;case 3:f.flags=f.flags&-65537|128;case 0:if(f=m.payload,d=typeof f=="function"?f.call(p,h,d):f,d==null)break e;h=Ei({},h,d);break e;case 2:Al=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,d=a.effects,d===null?a.effects=[o]:d.push(o))}else p={eventTime:p,lane:d,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=p,l=h):u=u.next=p,n|=d;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;d=o,o=d.next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}while(!0);if(u===null&&(l=h),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,t=a.shared.interleaved,t!==null){a=t;do n|=a.lane,a=a.next;while(a!==t)}else s===null&&(a.shared.lanes=0);ch|=n,e.lanes=n,e.memoizedState=h}}function YM(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=i,typeof a!="function")throw Error(Te(191,a));a.call(r)}}}var ML=new ER.Component().refs;function C_(e,t,i,r){t=e.memoizedState,i=i(r,t),i=i==null?t:Ei({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var u1={isMounted:function(e){return(e=e._reactInternals)?wh(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=ya(),a=$l(e),s=Uo(r,a);s.payload=t,i!=null&&(s.callback=i),t=Zl(e,s,a),t!==null&&(rn(t,e,a,r),Zv(t,e,a))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=ya(),a=$l(e),s=Uo(r,a);s.tag=1,s.payload=t,i!=null&&(s.callback=i),t=Zl(e,s,a),t!==null&&(rn(t,e,a,r),Zv(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ya(),r=$l(e),a=Uo(i,r);a.tag=2,t!=null&&(a.callback=t),t=Zl(e,a,r),t!==null&&(rn(t,e,r,i),Zv(t,e,r))}};function QM(e,t,i,r,a,s,n){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,n):t.prototype&&t.prototype.isPureReactComponent?!Xf(i,r)||!Xf(a,s):!0}function TL(e,t,i){var r=!1,a=sc,s=t.contextType;return typeof s=="object"&&s!==null?s=Ps(s):(a=Ba(t)?nh:sa.current,r=t.contextTypes,s=(r=r!=null)?bd(e,a):sc),t=new t(i,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=u1,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=s),t}function ZM(e,t,i,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&u1.enqueueReplaceState(t,t.state,null)}function M_(e,t,i,r){var a=e.stateNode;a.props=i,a.state=e.memoizedState,a.refs=ML,kA(e);var s=t.contextType;typeof s=="object"&&s!==null?a.context=Ps(s):(s=Ba(t)?nh:sa.current,a.context=bd(e,s)),a.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(C_(e,t,s,i),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&u1.enqueueReplaceState(a,a.state,null),N0(e,i,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function yp(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(Te(309));var r=i.stateNode}if(!r)throw Error(Te(147,e));var a=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(n){var o=a.refs;o===ML&&(o=a.refs={}),n===null?delete o[s]:o[s]=n},t._stringRef=s,t)}if(typeof e!="string")throw Error(Te(284));if(!i._owner)throw Error(Te(290,e))}return e}function mg(e,t){throw e=Object.prototype.toString.call(t),Error(Te(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function KM(e){var t=e._init;return t(e._payload)}function PL(e){function t(v,y){if(e){var x=v.deletions;x===null?(v.deletions=[y],v.flags|=16):x.push(y)}}function i(v,y){if(!e)return null;for(;y!==null;)t(v,y),y=y.sibling;return null}function r(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function a(v,y){return v=Jl(v,y),v.index=0,v.sibling=null,v}function s(v,y,x){return v.index=x,e?(x=v.alternate,x!==null?(x=x.index,x<y?(v.flags|=2,y):x):(v.flags|=2,y)):(v.flags|=1048576,y)}function n(v){return e&&v.alternate===null&&(v.flags|=2),v}function o(v,y,x,w){return y===null||y.tag!==6?(y=kx(x,v.mode,w),y.return=v,y):(y=a(y,x),y.return=v,y)}function l(v,y,x,w){var S=x.type;return S===Tu?u(v,y,x.props.children,w,x.key):y!==null&&(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Sl&&KM(S)===y.type)?(w=a(y,x.props),w.ref=yp(v,y,x),w.return=v,w):(w=i0(x.type,x.key,x.props,null,v.mode,w),w.ref=yp(v,y,x),w.return=v,w)}function c(v,y,x,w){return y===null||y.tag!==4||y.stateNode.containerInfo!==x.containerInfo||y.stateNode.implementation!==x.implementation?(y=zx(x,v.mode,w),y.return=v,y):(y=a(y,x.children||[]),y.return=v,y)}function u(v,y,x,w,S){return y===null||y.tag!==7?(y=Kc(x,v.mode,w,S),y.return=v,y):(y=a(y,x),y.return=v,y)}function h(v,y,x){if(typeof y=="string"&&y!==""||typeof y=="number")return y=kx(""+y,v.mode,x),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ag:return x=i0(y.type,y.key,y.props,null,v.mode,x),x.ref=yp(v,null,y),x.return=v,x;case Mu:return y=zx(y,v.mode,x),y.return=v,y;case Sl:var w=y._init;return h(v,w(y._payload),x)}if(rf(y)||pp(y))return y=Kc(y,v.mode,x,null),y.return=v,y;mg(v,y)}return null}function d(v,y,x,w){var S=y!==null?y.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return S!==null?null:o(v,y,""+x,w);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ag:return x.key===S?l(v,y,x,w):null;case Mu:return x.key===S?c(v,y,x,w):null;case Sl:return S=x._init,d(v,y,S(x._payload),w)}if(rf(x)||pp(x))return S!==null?null:u(v,y,x,w,null);mg(v,x)}return null}function p(v,y,x,w,S){if(typeof w=="string"&&w!==""||typeof w=="number")return v=v.get(x)||null,o(y,v,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ag:return v=v.get(w.key===null?x:w.key)||null,l(y,v,w,S);case Mu:return v=v.get(w.key===null?x:w.key)||null,c(y,v,w,S);case Sl:var _=w._init;return p(v,y,x,_(w._payload),S)}if(rf(w)||pp(w))return v=v.get(x)||null,u(y,v,w,S,null);mg(y,w)}return null}function f(v,y,x,w){for(var S=null,_=null,A=y,E=y=0,M=null;A!==null&&E<x.length;E++){A.index>E?(M=A,A=null):M=A.sibling;var C=d(v,A,x[E],w);if(C===null){A===null&&(A=M);break}e&&A&&C.alternate===null&&t(v,A),y=s(C,y,E),_===null?S=C:_.sibling=C,_=C,A=M}if(E===x.length)return i(v,A),gi&&Ac(v,E),S;if(A===null){for(;E<x.length;E++)A=h(v,x[E],w),A!==null&&(y=s(A,y,E),_===null?S=A:_.sibling=A,_=A);return gi&&Ac(v,E),S}for(A=r(v,A);E<x.length;E++)M=p(A,v,E,x[E],w),M!==null&&(e&&M.alternate!==null&&A.delete(M.key===null?E:M.key),y=s(M,y,E),_===null?S=M:_.sibling=M,_=M);return e&&A.forEach(function(T){return t(v,T)}),gi&&Ac(v,E),S}function m(v,y,x,w){var S=pp(x);if(typeof S!="function")throw Error(Te(150));if(x=S.call(x),x==null)throw Error(Te(151));for(var _=S=null,A=y,E=y=0,M=null,C=x.next();A!==null&&!C.done;E++,C=x.next()){A.index>E?(M=A,A=null):M=A.sibling;var T=d(v,A,C.value,w);if(T===null){A===null&&(A=M);break}e&&A&&T.alternate===null&&t(v,A),y=s(T,y,E),_===null?S=T:_.sibling=T,_=T,A=M}if(C.done)return i(v,A),gi&&Ac(v,E),S;if(A===null){for(;!C.done;E++,C=x.next())C=h(v,C.value,w),C!==null&&(y=s(C,y,E),_===null?S=C:_.sibling=C,_=C);return gi&&Ac(v,E),S}for(A=r(v,A);!C.done;E++,C=x.next())C=p(A,v,E,C.value,w),C!==null&&(e&&C.alternate!==null&&A.delete(C.key===null?E:C.key),y=s(C,y,E),_===null?S=C:_.sibling=C,_=C);return e&&A.forEach(function(D){return t(v,D)}),gi&&Ac(v,E),S}function g(v,y,x,w){if(typeof x=="object"&&x!==null&&x.type===Tu&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case ag:e:{for(var S=x.key,_=y;_!==null;){if(_.key===S){if(S=x.type,S===Tu){if(_.tag===7){i(v,_.sibling),y=a(_,x.props.children),y.return=v,v=y;break e}}else if(_.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Sl&&KM(S)===_.type){i(v,_.sibling),y=a(_,x.props),y.ref=yp(v,_,x),y.return=v,v=y;break e}i(v,_);break}else t(v,_);_=_.sibling}x.type===Tu?(y=Kc(x.props.children,v.mode,w,x.key),y.return=v,v=y):(w=i0(x.type,x.key,x.props,null,v.mode,w),w.ref=yp(v,y,x),w.return=v,v=w)}return n(v);case Mu:e:{for(_=x.key;y!==null;){if(y.key===_)if(y.tag===4&&y.stateNode.containerInfo===x.containerInfo&&y.stateNode.implementation===x.implementation){i(v,y.sibling),y=a(y,x.children||[]),y.return=v,v=y;break e}else{i(v,y);break}else t(v,y);y=y.sibling}y=zx(x,v.mode,w),y.return=v,v=y}return n(v);case Sl:return _=x._init,g(v,y,_(x._payload),w)}if(rf(x))return f(v,y,x,w);if(pp(x))return m(v,y,x,w);mg(v,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,y!==null&&y.tag===6?(i(v,y.sibling),y=a(y,x),y.return=v,v=y):(i(v,y),y=kx(x,v.mode,w),y.return=v,v=y),n(v)):i(v,y)}return g}var _d=PL(!0),DL=PL(!1),Lm={},Wn=hc(Lm),Kf=hc(Lm),$f=hc(Lm);function jc(e){if(e===Lm)throw Error(Te(174));return e}function zA(e,t){switch(hi($f,t),hi(Kf,e),hi(Wn,Lm),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:s_(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=s_(t,e)}fi(Wn),hi(Wn,t)}function Sd(){fi(Wn),fi(Kf),fi($f)}function OL(e){jc($f.current);var t=jc(Wn.current),i=s_(t,e.type);t!==i&&(hi(Kf,e),hi(Wn,i))}function NA(e){Kf.current===e&&(fi(Wn),fi(Kf))}var bi=hc(0);function B0(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Px=[];function BA(){for(var e=0;e<Px.length;e++)Px[e]._workInProgressVersionPrimary=null;Px.length=0}var Kv=tl.ReactCurrentDispatcher,Dx=tl.ReactCurrentBatchConfig,lh=0,_i=null,cr=null,wr=null,j0=!1,wf=!1,Jf=0,mU=0;function qr(){throw Error(Te(321))}function jA(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!nn(e[i],t[i]))return!1;return!0}function FA(e,t,i,r,a,s){if(lh=s,_i=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Kv.current=e===null||e.memoizedState===null?xU:bU,e=i(r,a),wf){s=0;do{if(wf=!1,Jf=0,25<=s)throw Error(Te(301));s+=1,wr=cr=null,t.updateQueue=null,Kv.current=wU,e=i(r,a)}while(wf)}if(Kv.current=F0,t=cr!==null&&cr.next!==null,lh=0,wr=cr=_i=null,j0=!1,t)throw Error(Te(300));return e}function UA(){var e=Jf!==0;return Jf=0,e}function Dn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wr===null?_i.memoizedState=wr=e:wr=wr.next=e,wr}function Ds(){if(cr===null){var e=_i.alternate;e=e!==null?e.memoizedState:null}else e=cr.next;var t=wr===null?_i.memoizedState:wr.next;if(t!==null)wr=t,cr=e;else{if(e===null)throw Error(Te(310));cr=e,e={memoizedState:cr.memoizedState,baseState:cr.baseState,baseQueue:cr.baseQueue,queue:cr.queue,next:null},wr===null?_i.memoizedState=wr=e:wr=wr.next=e}return wr}function em(e,t){return typeof t=="function"?t(e):t}function Ox(e){var t=Ds(),i=t.queue;if(i===null)throw Error(Te(311));i.lastRenderedReducer=e;var r=cr,a=r.baseQueue,s=i.pending;if(s!==null){if(a!==null){var n=a.next;a.next=s.next,s.next=n}r.baseQueue=a=s,i.pending=null}if(a!==null){s=a.next,r=r.baseState;var o=n=null,l=null,c=s;do{var u=c.lane;if((lh&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(o=l=h,n=r):l=l.next=h,_i.lanes|=u,ch|=u}c=c.next}while(c!==null&&c!==s);l===null?n=r:l.next=o,nn(r,t.memoizedState)||(Ra=!0),t.memoizedState=r,t.baseState=n,t.baseQueue=l,i.lastRenderedState=r}if(e=i.interleaved,e!==null){a=e;do s=a.lane,_i.lanes|=s,ch|=s,a=a.next;while(a!==e)}else a===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function Ix(e){var t=Ds(),i=t.queue;if(i===null)throw Error(Te(311));i.lastRenderedReducer=e;var r=i.dispatch,a=i.pending,s=t.memoizedState;if(a!==null){i.pending=null;var n=a=a.next;do s=e(s,n.action),n=n.next;while(n!==a);nn(s,t.memoizedState)||(Ra=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),i.lastRenderedState=s}return[s,r]}function IL(){}function RL(e,t){var i=_i,r=Ds(),a=t(),s=!nn(r.memoizedState,a);if(s&&(r.memoizedState=a,Ra=!0),r=r.queue,VA(zL.bind(null,i,r,e),[e]),r.getSnapshot!==t||s||wr!==null&&wr.memoizedState.tag&1){if(i.flags|=2048,tm(9,kL.bind(null,i,r,a,t),void 0,null),Mr===null)throw Error(Te(349));lh&30||LL(i,t,a)}return a}function LL(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=_i.updateQueue,t===null?(t={lastEffect:null,stores:null},_i.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function kL(e,t,i,r){t.value=i,t.getSnapshot=r,NL(t)&&BL(e)}function zL(e,t,i){return i(function(){NL(t)&&BL(e)})}function NL(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!nn(e,i)}catch{return!0}}function BL(e){var t=Yo(e,1);t!==null&&rn(t,e,1,-1)}function $M(e){var t=Dn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:em,lastRenderedState:e},t.queue=e,e=e.dispatch=yU.bind(null,_i,e),[t.memoizedState,e]}function tm(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},t=_i.updateQueue,t===null?(t={lastEffect:null,stores:null},_i.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e)),e}function jL(){return Ds().memoizedState}function $v(e,t,i,r){var a=Dn();_i.flags|=e,a.memoizedState=tm(1|t,i,void 0,r===void 0?null:r)}function d1(e,t,i,r){var a=Ds();r=r===void 0?null:r;var s=void 0;if(cr!==null){var n=cr.memoizedState;if(s=n.destroy,r!==null&&jA(r,n.deps)){a.memoizedState=tm(t,i,s,r);return}}_i.flags|=e,a.memoizedState=tm(1|t,i,s,r)}function JM(e,t){return $v(8390656,8,e,t)}function VA(e,t){return d1(2048,8,e,t)}function FL(e,t){return d1(4,2,e,t)}function UL(e,t){return d1(4,4,e,t)}function VL(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function GL(e,t,i){return i=i!=null?i.concat([e]):null,d1(4,4,VL.bind(null,t,e),i)}function GA(){}function HL(e,t){var i=Ds();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&jA(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function WL(e,t){var i=Ds();t=t===void 0?null:t;var r=i.memoizedState;return r!==null&&t!==null&&jA(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function qL(e,t,i){return lh&21?(nn(i,t)||(i=QR(),_i.lanes|=i,ch|=i,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ra=!0),e.memoizedState=i)}function gU(e,t){var i=ei;ei=i!==0&&4>i?i:4,e(!0);var r=Dx.transition;Dx.transition={};try{e(!1),t()}finally{ei=i,Dx.transition=r}}function XL(){return Ds().memoizedState}function vU(e,t,i){var r=$l(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},YL(e))QL(t,i);else if(i=EL(e,t,i,r),i!==null){var a=ya();rn(i,e,r,a),ZL(i,t,r)}}function yU(e,t,i){var r=$l(e),a={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(YL(e))QL(t,a);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var n=t.lastRenderedState,o=s(n,i);if(a.hasEagerState=!0,a.eagerState=o,nn(o,n)){var l=t.interleaved;l===null?(a.next=a,LA(t)):(a.next=l.next,l.next=a),t.interleaved=a;return}}catch{}finally{}i=EL(e,t,a,r),i!==null&&(a=ya(),rn(i,e,r,a),ZL(i,t,r))}}function YL(e){var t=e.alternate;return e===_i||t!==null&&t===_i}function QL(e,t){wf=j0=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function ZL(e,t,i){if(i&4194240){var r=t.lanes;r&=e.pendingLanes,i|=r,t.lanes=i,bA(e,i)}}var F0={readContext:Ps,useCallback:qr,useContext:qr,useEffect:qr,useImperativeHandle:qr,useInsertionEffect:qr,useLayoutEffect:qr,useMemo:qr,useReducer:qr,useRef:qr,useState:qr,useDebugValue:qr,useDeferredValue:qr,useTransition:qr,useMutableSource:qr,useSyncExternalStore:qr,useId:qr,unstable_isNewReconciler:!1},xU={readContext:Ps,useCallback:function(e,t){return Dn().memoizedState=[e,t===void 0?null:t],e},useContext:Ps,useEffect:JM,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,$v(4194308,4,VL.bind(null,t,e),i)},useLayoutEffect:function(e,t){return $v(4194308,4,e,t)},useInsertionEffect:function(e,t){return $v(4,2,e,t)},useMemo:function(e,t){var i=Dn();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=Dn();return t=i!==void 0?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=vU.bind(null,_i,e),[r.memoizedState,e]},useRef:function(e){var t=Dn();return e={current:e},t.memoizedState=e},useState:$M,useDebugValue:GA,useDeferredValue:function(e){return Dn().memoizedState=e},useTransition:function(){var e=$M(!1),t=e[0];return e=gU.bind(null,e[1]),Dn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=_i,a=Dn();if(gi){if(i===void 0)throw Error(Te(407));i=i()}else{if(i=t(),Mr===null)throw Error(Te(349));lh&30||LL(r,t,i)}a.memoizedState=i;var s={value:i,getSnapshot:t};return a.queue=s,JM(zL.bind(null,r,s,e),[e]),r.flags|=2048,tm(9,kL.bind(null,r,s,i,t),void 0,null),i},useId:function(){var e=Dn(),t=Mr.identifierPrefix;if(gi){var i=zo,r=ko;i=(r&~(1<<32-tn(r)-1)).toString(32)+i,t=":"+t+"R"+i,i=Jf++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=mU++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},bU={readContext:Ps,useCallback:HL,useContext:Ps,useEffect:VA,useImperativeHandle:GL,useInsertionEffect:FL,useLayoutEffect:UL,useMemo:WL,useReducer:Ox,useRef:jL,useState:function(){return Ox(em)},useDebugValue:GA,useDeferredValue:function(e){var t=Ds();return qL(t,cr.memoizedState,e)},useTransition:function(){var e=Ox(em)[0],t=Ds().memoizedState;return[e,t]},useMutableSource:IL,useSyncExternalStore:RL,useId:XL,unstable_isNewReconciler:!1},wU={readContext:Ps,useCallback:HL,useContext:Ps,useEffect:VA,useImperativeHandle:GL,useInsertionEffect:FL,useLayoutEffect:UL,useMemo:WL,useReducer:Ix,useRef:jL,useState:function(){return Ix(em)},useDebugValue:GA,useDeferredValue:function(e){var t=Ds();return cr===null?t.memoizedState=e:qL(t,cr.memoizedState,e)},useTransition:function(){var e=Ix(em)[0],t=Ds().memoizedState;return[e,t]},useMutableSource:IL,useSyncExternalStore:RL,useId:XL,unstable_isNewReconciler:!1};function Ad(e,t){try{var i="",r=t;do i+=Q6(r),r=r.return;while(r);var a=i}catch(s){a=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:a,digest:null}}function Rx(e,t,i){return{value:e,source:null,stack:i??null,digest:t??null}}function T_(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var _U=typeof WeakMap=="function"?WeakMap:Map;function KL(e,t,i){i=Uo(-1,i),i.tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){V0||(V0=!0,B_=r),T_(e,t)},i}function $L(e,t,i){i=Uo(-1,i),i.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;i.payload=function(){return r(a)},i.callback=function(){T_(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(i.callback=function(){T_(e,t),typeof r!="function"&&(Kl===null?Kl=new Set([this]):Kl.add(this));var n=t.stack;this.componentDidCatch(t.value,{componentStack:n!==null?n:""})}),i}function e3(e,t,i){var r=e.pingCache;if(r===null){r=e.pingCache=new _U;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(i)||(a.add(i),e=zU.bind(null,e,t,i),t.then(e,e))}function t3(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function i3(e,t,i,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=Uo(-1,1),t.tag=2,Zl(i,t,1))),i.lanes|=1),e)}var SU=tl.ReactCurrentOwner,Ra=!1;function da(e,t,i,r){t.child=e===null?DL(t,null,i,r):_d(t,e.child,i,r)}function r3(e,t,i,r,a){i=i.render;var s=t.ref;return Ku(t,a),r=FA(e,t,i,r,s,a),i=UA(),e!==null&&!Ra?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Qo(e,t,a)):(gi&&i&&TA(t),t.flags|=1,da(e,t,r,a),t.child)}function a3(e,t,i,r,a){if(e===null){var s=i.type;return typeof s=="function"&&!KA(s)&&s.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=s,JL(e,t,s,r,a)):(e=i0(i.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&a)){var n=s.memoizedProps;if(i=i.compare,i=i!==null?i:Xf,i(n,r)&&e.ref===t.ref)return Qo(e,t,a)}return t.flags|=1,e=Jl(s,r),e.ref=t.ref,e.return=t,t.child=e}function JL(e,t,i,r,a){if(e!==null){var s=e.memoizedProps;if(Xf(s,r)&&e.ref===t.ref)if(Ra=!1,t.pendingProps=r=s,(e.lanes&a)!==0)e.flags&131072&&(Ra=!0);else return t.lanes=e.lanes,Qo(e,t,a)}return P_(e,t,i,r,a)}function ek(e,t,i){var r=t.pendingProps,a=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},hi(Bu,qa),qa|=i;else{if(!(i&1073741824))return e=s!==null?s.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,hi(Bu,qa),qa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:i,hi(Bu,qa),qa|=r}else s!==null?(r=s.baseLanes|i,t.memoizedState=null):r=i,hi(Bu,qa),qa|=r;return da(e,t,a,i),t.child}function tk(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function P_(e,t,i,r,a){var s=Ba(i)?nh:sa.current;return s=bd(t,s),Ku(t,a),i=FA(e,t,i,r,s,a),r=UA(),e!==null&&!Ra?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Qo(e,t,a)):(gi&&r&&TA(t),t.flags|=1,da(e,t,i,a),t.child)}function s3(e,t,i,r,a){if(Ba(i)){var s=!0;I0(t)}else s=!1;if(Ku(t,a),t.stateNode===null)Jv(e,t),TL(t,i,r),M_(t,i,r,a),r=!0;else if(e===null){var n=t.stateNode,o=t.memoizedProps;n.props=o;var l=n.context,c=i.contextType;typeof c=="object"&&c!==null?c=Ps(c):(c=Ba(i)?nh:sa.current,c=bd(t,c));var u=i.getDerivedStateFromProps,h=typeof u=="function"||typeof n.getSnapshotBeforeUpdate=="function";h||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o!==r||l!==c)&&ZM(t,n,r,c),Al=!1;var d=t.memoizedState;n.state=d,N0(t,r,n,a),l=t.memoizedState,o!==r||d!==l||Na.current||Al?(typeof u=="function"&&(C_(t,i,u,r),l=t.memoizedState),(o=Al||QM(t,i,o,r,d,l,c))?(h||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount()),typeof n.componentDidMount=="function"&&(t.flags|=4194308)):(typeof n.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),n.props=r,n.state=l,n.context=c,r=o):(typeof n.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{n=t.stateNode,CL(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:qs(t.type,o),n.props=c,h=t.pendingProps,d=n.context,l=i.contextType,typeof l=="object"&&l!==null?l=Ps(l):(l=Ba(i)?nh:sa.current,l=bd(t,l));var p=i.getDerivedStateFromProps;(u=typeof p=="function"||typeof n.getSnapshotBeforeUpdate=="function")||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o!==h||d!==l)&&ZM(t,n,r,l),Al=!1,d=t.memoizedState,n.state=d,N0(t,r,n,a);var f=t.memoizedState;o!==h||d!==f||Na.current||Al?(typeof p=="function"&&(C_(t,i,p,r),f=t.memoizedState),(c=Al||QM(t,i,c,r,d,f,l)||!1)?(u||typeof n.UNSAFE_componentWillUpdate!="function"&&typeof n.componentWillUpdate!="function"||(typeof n.componentWillUpdate=="function"&&n.componentWillUpdate(r,f,l),typeof n.UNSAFE_componentWillUpdate=="function"&&n.UNSAFE_componentWillUpdate(r,f,l)),typeof n.componentDidUpdate=="function"&&(t.flags|=4),typeof n.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof n.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),n.props=r,n.state=f,n.context=l,r=c):(typeof n.componentDidUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return D_(e,t,i,r,s,a)}function D_(e,t,i,r,a,s){tk(e,t);var n=(t.flags&128)!==0;if(!r&&!n)return a&&HM(t,i,!1),Qo(e,t,s);r=t.stateNode,SU.current=t;var o=n&&typeof i.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&n?(t.child=_d(t,e.child,null,s),t.child=_d(t,null,o,s)):da(e,t,o,s),t.memoizedState=r.state,a&&HM(t,i,!0),t.child}function ik(e){var t=e.stateNode;t.pendingContext?GM(e,t.pendingContext,t.pendingContext!==t.context):t.context&&GM(e,t.context,!1),zA(e,t.containerInfo)}function n3(e,t,i,r,a){return wd(),DA(a),t.flags|=256,da(e,t,i,r),t.child}var O_={dehydrated:null,treeContext:null,retryLane:0};function I_(e){return{baseLanes:e,cachePool:null,transitions:null}}function rk(e,t,i){var r=t.pendingProps,a=bi.current,s=!1,n=(t.flags&128)!==0,o;if((o=n)||(o=e!==null&&e.memoizedState===null?!1:(a&2)!==0),o?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),hi(bi,a&1),e===null)return A_(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(n=r.children,e=r.fallback,s?(r=t.mode,s=t.child,n={mode:"hidden",children:n},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=n):s=m1(n,r,0,null),e=Kc(e,r,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=I_(i),t.memoizedState=O_,e):HA(t,n));if(a=e.memoizedState,a!==null&&(o=a.dehydrated,o!==null))return AU(e,t,n,r,o,a,i);if(s){s=r.fallback,n=t.mode,a=e.child,o=a.sibling;var l={mode:"hidden",children:r.children};return!(n&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=Jl(a,l),r.subtreeFlags=a.subtreeFlags&14680064),o!==null?s=Jl(o,s):(s=Kc(s,n,i,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,n=e.child.memoizedState,n=n===null?I_(i):{baseLanes:n.baseLanes|i,cachePool:null,transitions:n.transitions},s.memoizedState=n,s.childLanes=e.childLanes&~i,t.memoizedState=O_,r}return s=e.child,e=s.sibling,r=Jl(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=i),r.return=t,r.sibling=null,e!==null&&(i=t.deletions,i===null?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function HA(e,t){return t=m1({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function gg(e,t,i,r){return r!==null&&DA(r),_d(t,e.child,null,i),e=HA(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function AU(e,t,i,r,a,s,n){if(i)return t.flags&256?(t.flags&=-257,r=Rx(Error(Te(422))),gg(e,t,n,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,a=t.mode,r=m1({mode:"visible",children:r.children},a,0,null),s=Kc(s,a,n,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&_d(t,e.child,null,n),t.child.memoizedState=I_(n),t.memoizedState=O_,s);if(!(t.mode&1))return gg(e,t,n,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var o=r.dgst;return r=o,s=Error(Te(419)),r=Rx(s,r,void 0),gg(e,t,n,r)}if(o=(n&e.childLanes)!==0,Ra||o){if(r=Mr,r!==null){switch(n&-n){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|n)?0:a,a!==0&&a!==s.retryLane&&(s.retryLane=a,Yo(e,a),rn(r,e,a,-1))}return ZA(),r=Rx(Error(Te(421))),gg(e,t,n,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=NU.bind(null,e),a._reactRetry=t,null):(e=s.treeContext,Za=Ql(a.nextSibling),ts=t,gi=!0,Ys=null,e!==null&&(xs[bs++]=ko,xs[bs++]=zo,xs[bs++]=oh,ko=e.id,zo=e.overflow,oh=t),t=HA(t,r.children),t.flags|=4096,t)}function o3(e,t,i){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),E_(e.return,t,i)}function Lx(e,t,i,r,a){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:a}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=i,s.tailMode=a)}function ak(e,t,i){var r=t.pendingProps,a=r.revealOrder,s=r.tail;if(da(e,t,r.children,i),r=bi.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&o3(e,i,t);else if(e.tag===19)o3(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(hi(bi,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(i=t.child,a=null;i!==null;)e=i.alternate,e!==null&&B0(e)===null&&(a=i),i=i.sibling;i=a,i===null?(a=t.child,t.child=null):(a=i.sibling,i.sibling=null),Lx(t,!1,a,i,s);break;case"backwards":for(i=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&B0(e)===null){t.child=a;break}e=a.sibling,a.sibling=i,i=a,a=e}Lx(t,!0,i,null,s);break;case"together":Lx(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jv(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Qo(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),ch|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Te(153));if(t.child!==null){for(e=t.child,i=Jl(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Jl(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function EU(e,t,i){switch(t.tag){case 3:ik(t),wd();break;case 5:OL(t);break;case 1:Ba(t.type)&&I0(t);break;case 4:zA(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;hi(k0,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(hi(bi,bi.current&1),t.flags|=128,null):i&t.child.childLanes?rk(e,t,i):(hi(bi,bi.current&1),e=Qo(e,t,i),e!==null?e.sibling:null);hi(bi,bi.current&1);break;case 19:if(r=(i&t.childLanes)!==0,e.flags&128){if(r)return ak(e,t,i);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),hi(bi,bi.current),r)break;return null;case 22:case 23:return t.lanes=0,ek(e,t,i)}return Qo(e,t,i)}var sk,R_,nk,ok;sk=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};R_=function(){};nk=function(e,t,i,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,jc(Wn.current);var s=null;switch(i){case"input":a=t_(e,a),r=t_(e,r),s=[];break;case"select":a=Ei({},a,{value:void 0}),r=Ei({},r,{value:void 0}),s=[];break;case"textarea":a=a_(e,a),r=a_(e,r),s=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=D0)}n_(i,r);var n;i=null;for(c in a)if(!r.hasOwnProperty(c)&&a.hasOwnProperty(c)&&a[c]!=null)if(c==="style"){var o=a[c];for(n in o)o.hasOwnProperty(n)&&(i||(i={}),i[n]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ff.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(o=a!=null?a[c]:void 0,r.hasOwnProperty(c)&&l!==o&&(l!=null||o!=null))if(c==="style")if(o){for(n in o)!o.hasOwnProperty(n)||l&&l.hasOwnProperty(n)||(i||(i={}),i[n]="");for(n in l)l.hasOwnProperty(n)&&o[n]!==l[n]&&(i||(i={}),i[n]=l[n])}else i||(s||(s=[]),s.push(c,i)),i=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ff.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ui("scroll",e),s||o===l||(s=[])):(s=s||[]).push(c,l))}i&&(s=s||[]).push("style",i);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};ok=function(e,t,i,r){i!==r&&(t.flags|=4)};function xp(e,t){if(!gi)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Xr(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,r=0;if(t)for(var a=e.child;a!==null;)i|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)i|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function CU(e,t,i){var r=t.pendingProps;switch(PA(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xr(t),null;case 1:return Ba(t.type)&&O0(),Xr(t),null;case 3:return r=t.stateNode,Sd(),fi(Na),fi(sa),BA(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(fg(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ys!==null&&(U_(Ys),Ys=null))),R_(e,t),Xr(t),null;case 5:NA(t);var a=jc($f.current);if(i=t.type,e!==null&&t.stateNode!=null)nk(e,t,i,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Te(166));return Xr(t),null}if(e=jc(Wn.current),fg(t)){r=t.stateNode,i=t.type;var s=t.memoizedProps;switch(r[Nn]=t,r[Zf]=s,e=(t.mode&1)!==0,i){case"dialog":ui("cancel",r),ui("close",r);break;case"iframe":case"object":case"embed":ui("load",r);break;case"video":case"audio":for(a=0;a<sf.length;a++)ui(sf[a],r);break;case"source":ui("error",r);break;case"img":case"image":case"link":ui("error",r),ui("load",r);break;case"details":ui("toggle",r);break;case"input":gM(r,s),ui("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ui("invalid",r);break;case"textarea":yM(r,s),ui("invalid",r)}n_(i,s),a=null;for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];n==="children"?typeof o=="string"?r.textContent!==o&&(s.suppressHydrationWarning!==!0&&pg(r.textContent,o,e),a=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&pg(r.textContent,o,e),a=["children",""+o]):Ff.hasOwnProperty(n)&&o!=null&&n==="onScroll"&&ui("scroll",r)}switch(i){case"input":sg(r),vM(r,s,!0);break;case"textarea":sg(r),xM(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=D0)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{n=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=LR(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=n.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=n.createElement(i,{is:r.is}):(e=n.createElement(i),i==="select"&&(n=e,r.multiple?n.multiple=!0:r.size&&(n.size=r.size))):e=n.createElementNS(e,i),e[Nn]=t,e[Zf]=r,sk(e,t,!1,!1),t.stateNode=e;e:{switch(n=o_(i,r),i){case"dialog":ui("cancel",e),ui("close",e),a=r;break;case"iframe":case"object":case"embed":ui("load",e),a=r;break;case"video":case"audio":for(a=0;a<sf.length;a++)ui(sf[a],e);a=r;break;case"source":ui("error",e),a=r;break;case"img":case"image":case"link":ui("error",e),ui("load",e),a=r;break;case"details":ui("toggle",e),a=r;break;case"input":gM(e,r),a=t_(e,r),ui("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=Ei({},r,{value:void 0}),ui("invalid",e);break;case"textarea":yM(e,r),a=a_(e,r),ui("invalid",e);break;default:a=r}n_(i,a),o=a;for(s in o)if(o.hasOwnProperty(s)){var l=o[s];s==="style"?NR(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&kR(e,l)):s==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&Uf(e,l):typeof l=="number"&&Uf(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Ff.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ui("scroll",e):l!=null&&fA(e,s,l,n))}switch(i){case"input":sg(e),vM(e,r,!1);break;case"textarea":sg(e),xM(e);break;case"option":r.value!=null&&e.setAttribute("value",""+ac(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?Xu(e,!!r.multiple,s,!1):r.defaultValue!=null&&Xu(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=D0)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Xr(t),null;case 6:if(e&&t.stateNode!=null)ok(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Te(166));if(i=jc($f.current),jc(Wn.current),fg(t)){if(r=t.stateNode,i=t.memoizedProps,r[Nn]=t,(s=r.nodeValue!==i)&&(e=ts,e!==null))switch(e.tag){case 3:pg(r.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&pg(r.nodeValue,i,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(i.nodeType===9?i:i.ownerDocument).createTextNode(r),r[Nn]=t,t.stateNode=r}return Xr(t),null;case 13:if(fi(bi),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(gi&&Za!==null&&t.mode&1&&!(t.flags&128))AL(),wd(),t.flags|=98560,s=!1;else if(s=fg(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(Te(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Te(317));s[Nn]=t}else wd(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Xr(t),s=!1}else Ys!==null&&(U_(Ys),Ys=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=i,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||bi.current&1?ur===0&&(ur=3):ZA())),t.updateQueue!==null&&(t.flags|=4),Xr(t),null);case 4:return Sd(),R_(e,t),e===null&&Yf(t.stateNode.containerInfo),Xr(t),null;case 10:return RA(t.type._context),Xr(t),null;case 17:return Ba(t.type)&&O0(),Xr(t),null;case 19:if(fi(bi),s=t.memoizedState,s===null)return Xr(t),null;if(r=(t.flags&128)!==0,n=s.rendering,n===null)if(r)xp(s,!1);else{if(ur!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(n=B0(e),n!==null){for(t.flags|=128,xp(s,!1),r=n.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;i!==null;)s=i,e=r,s.flags&=14680066,n=s.alternate,n===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=n.childLanes,s.lanes=n.lanes,s.child=n.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=n.memoizedProps,s.memoizedState=n.memoizedState,s.updateQueue=n.updateQueue,s.type=n.type,e=n.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return hi(bi,bi.current&1|2),t.child}e=e.sibling}s.tail!==null&&Fi()>Ed&&(t.flags|=128,r=!0,xp(s,!1),t.lanes=4194304)}else{if(!r)if(e=B0(n),e!==null){if(t.flags|=128,r=!0,i=e.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),xp(s,!0),s.tail===null&&s.tailMode==="hidden"&&!n.alternate&&!gi)return Xr(t),null}else 2*Fi()-s.renderingStartTime>Ed&&i!==1073741824&&(t.flags|=128,r=!0,xp(s,!1),t.lanes=4194304);s.isBackwards?(n.sibling=t.child,t.child=n):(i=s.last,i!==null?i.sibling=n:t.child=n,s.last=n)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Fi(),t.sibling=null,i=bi.current,hi(bi,r?i&1|2:i&1),t):(Xr(t),null);case 22:case 23:return QA(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?qa&1073741824&&(Xr(t),t.subtreeFlags&6&&(t.flags|=8192)):Xr(t),null;case 24:return null;case 25:return null}throw Error(Te(156,t.tag))}function MU(e,t){switch(PA(t),t.tag){case 1:return Ba(t.type)&&O0(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Sd(),fi(Na),fi(sa),BA(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return NA(t),null;case 13:if(fi(bi),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Te(340));wd()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return fi(bi),null;case 4:return Sd(),null;case 10:return RA(t.type._context),null;case 22:case 23:return QA(),null;case 24:return null;default:return null}}var vg=!1,$r=!1,TU=typeof WeakSet=="function"?WeakSet:Set,He=null;function Nu(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(r){Oi(e,t,r)}else i.current=null}function L_(e,t,i){try{i()}catch(r){Oi(e,t,r)}}var l3=!1;function PU(e,t){if(v_=M0,e=uL(),MA(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{i=(i=e.ownerDocument)&&i.defaultView||window;var r=i.getSelection&&i.getSelection();if(r&&r.rangeCount!==0){i=r.anchorNode;var a=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{i.nodeType,s.nodeType}catch{i=null;break e}var n=0,o=-1,l=-1,c=0,u=0,h=e,d=null;t:for(;;){for(var p;h!==i||a!==0&&h.nodeType!==3||(o=n+a),h!==s||r!==0&&h.nodeType!==3||(l=n+r),h.nodeType===3&&(n+=h.nodeValue.length),(p=h.firstChild)!==null;)d=h,h=p;for(;;){if(h===e)break t;if(d===i&&++c===a&&(o=n),d===s&&++u===r&&(l=n),(p=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=p}i=o===-1||l===-1?null:{start:o,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(y_={focusedElem:e,selectionRange:i},M0=!1,He=t;He!==null;)if(t=He,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,He=e;else for(;He!==null;){t=He;try{var f=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(f!==null){var m=f.memoizedProps,g=f.memoizedState,v=t.stateNode,y=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:qs(t.type,m),g);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Te(163))}}catch(w){Oi(t,t.return,w)}if(e=t.sibling,e!==null){e.return=t.return,He=e;break}He=t.return}return f=l3,l3=!1,f}function _f(e,t,i){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var s=a.destroy;a.destroy=void 0,s!==void 0&&L_(t,i,s)}a=a.next}while(a!==r)}}function p1(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function k_(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof t=="function"?t(e):t.current=e}}function lk(e){var t=e.alternate;t!==null&&(e.alternate=null,lk(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Nn],delete t[Zf],delete t[w_],delete t[uU],delete t[dU])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ck(e){return e.tag===5||e.tag===3||e.tag===4}function c3(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ck(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function z_(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.nodeType===8?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(i.nodeType===8?(t=i.parentNode,t.insertBefore(e,i)):(t=i,t.appendChild(e)),i=i._reactRootContainer,i!=null||t.onclick!==null||(t.onclick=D0));else if(r!==4&&(e=e.child,e!==null))for(z_(e,t,i),e=e.sibling;e!==null;)z_(e,t,i),e=e.sibling}function N_(e,t,i){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(N_(e,t,i),e=e.sibling;e!==null;)N_(e,t,i),e=e.sibling}var Ir=null,Xs=!1;function nl(e,t,i){for(i=i.child;i!==null;)hk(e,t,i),i=i.sibling}function hk(e,t,i){if(Hn&&typeof Hn.onCommitFiberUnmount=="function")try{Hn.onCommitFiberUnmount(s1,i)}catch{}switch(i.tag){case 5:$r||Nu(i,t);case 6:var r=Ir,a=Xs;Ir=null,nl(e,t,i),Ir=r,Xs=a,Ir!==null&&(Xs?(e=Ir,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):Ir.removeChild(i.stateNode));break;case 18:Ir!==null&&(Xs?(e=Ir,i=i.stateNode,e.nodeType===8?Mx(e.parentNode,i):e.nodeType===1&&Mx(e,i),Wf(e)):Mx(Ir,i.stateNode));break;case 4:r=Ir,a=Xs,Ir=i.stateNode.containerInfo,Xs=!0,nl(e,t,i),Ir=r,Xs=a;break;case 0:case 11:case 14:case 15:if(!$r&&(r=i.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var s=a,n=s.destroy;s=s.tag,n!==void 0&&(s&2||s&4)&&L_(i,t,n),a=a.next}while(a!==r)}nl(e,t,i);break;case 1:if(!$r&&(Nu(i,t),r=i.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(o){Oi(i,t,o)}nl(e,t,i);break;case 21:nl(e,t,i);break;case 22:i.mode&1?($r=(r=$r)||i.memoizedState!==null,nl(e,t,i),$r=r):nl(e,t,i);break;default:nl(e,t,i)}}function h3(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new TU),t.forEach(function(r){var a=BU.bind(null,e,r);i.has(r)||(i.add(r),r.then(a,a))})}}function ks(e,t){var i=t.deletions;if(i!==null)for(var r=0;r<i.length;r++){var a=i[r];try{var s=e,n=t,o=n;e:for(;o!==null;){switch(o.tag){case 5:Ir=o.stateNode,Xs=!1;break e;case 3:Ir=o.stateNode.containerInfo,Xs=!0;break e;case 4:Ir=o.stateNode.containerInfo,Xs=!0;break e}o=o.return}if(Ir===null)throw Error(Te(160));hk(s,n,a),Ir=null,Xs=!1;var l=a.alternate;l!==null&&(l.return=null),a.return=null}catch(c){Oi(a,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)uk(t,e),t=t.sibling}function uk(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ks(t,e),gn(e),r&4){try{_f(3,e,e.return),p1(3,e)}catch(m){Oi(e,e.return,m)}try{_f(5,e,e.return)}catch(m){Oi(e,e.return,m)}}break;case 1:ks(t,e),gn(e),r&512&&i!==null&&Nu(i,i.return);break;case 5:if(ks(t,e),gn(e),r&512&&i!==null&&Nu(i,i.return),e.flags&32){var a=e.stateNode;try{Uf(a,"")}catch(m){Oi(e,e.return,m)}}if(r&4&&(a=e.stateNode,a!=null)){var s=e.memoizedProps,n=i!==null?i.memoizedProps:s,o=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&IR(a,s),o_(o,n);var c=o_(o,s);for(n=0;n<l.length;n+=2){var u=l[n],h=l[n+1];u==="style"?NR(a,h):u==="dangerouslySetInnerHTML"?kR(a,h):u==="children"?Uf(a,h):fA(a,u,h,c)}switch(o){case"input":i_(a,s);break;case"textarea":RR(a,s);break;case"select":var d=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!s.multiple;var p=s.value;p!=null?Xu(a,!!s.multiple,p,!1):d!==!!s.multiple&&(s.defaultValue!=null?Xu(a,!!s.multiple,s.defaultValue,!0):Xu(a,!!s.multiple,s.multiple?[]:"",!1))}a[Zf]=s}catch(m){Oi(e,e.return,m)}}break;case 6:if(ks(t,e),gn(e),r&4){if(e.stateNode===null)throw Error(Te(162));a=e.stateNode,s=e.memoizedProps;try{a.nodeValue=s}catch(m){Oi(e,e.return,m)}}break;case 3:if(ks(t,e),gn(e),r&4&&i!==null&&i.memoizedState.isDehydrated)try{Wf(t.containerInfo)}catch(m){Oi(e,e.return,m)}break;case 4:ks(t,e),gn(e);break;case 13:ks(t,e),gn(e),a=e.child,a.flags&8192&&(s=a.memoizedState!==null,a.stateNode.isHidden=s,!s||a.alternate!==null&&a.alternate.memoizedState!==null||(XA=Fi())),r&4&&h3(e);break;case 22:if(u=i!==null&&i.memoizedState!==null,e.mode&1?($r=(c=$r)||u,ks(t,e),$r=c):ks(t,e),gn(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!u&&e.mode&1)for(He=e,u=e.child;u!==null;){for(h=He=u;He!==null;){switch(d=He,p=d.child,d.tag){case 0:case 11:case 14:case 15:_f(4,d,d.return);break;case 1:Nu(d,d.return);var f=d.stateNode;if(typeof f.componentWillUnmount=="function"){r=d,i=d.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(m){Oi(r,i,m)}}break;case 5:Nu(d,d.return);break;case 22:if(d.memoizedState!==null){d3(h);continue}}p!==null?(p.return=d,He=p):d3(h)}u=u.sibling}e:for(u=null,h=e;;){if(h.tag===5){if(u===null){u=h;try{a=h.stateNode,c?(s=a.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=h.stateNode,l=h.memoizedProps.style,n=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=zR("display",n))}catch(m){Oi(e,e.return,m)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(m){Oi(e,e.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===e)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;h.sibling===null;){if(h.return===null||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ks(t,e),gn(e),r&4&&h3(e);break;case 21:break;default:ks(t,e),gn(e)}}function gn(e){var t=e.flags;if(t&2){try{e:{for(var i=e.return;i!==null;){if(ck(i)){var r=i;break e}i=i.return}throw Error(Te(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Uf(a,""),r.flags&=-33);var s=c3(e);N_(e,s,a);break;case 3:case 4:var n=r.stateNode.containerInfo,o=c3(e);z_(e,o,n);break;default:throw Error(Te(161))}}catch(l){Oi(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function DU(e,t,i){He=e,dk(e)}function dk(e,t,i){for(var r=(e.mode&1)!==0;He!==null;){var a=He,s=a.child;if(a.tag===22&&r){var n=a.memoizedState!==null||vg;if(!n){var o=a.alternate,l=o!==null&&o.memoizedState!==null||$r;o=vg;var c=$r;if(vg=n,($r=l)&&!c)for(He=a;He!==null;)n=He,l=n.child,n.tag===22&&n.memoizedState!==null?p3(a):l!==null?(l.return=n,He=l):p3(a);for(;s!==null;)He=s,dk(s),s=s.sibling;He=a,vg=o,$r=c}u3(e)}else a.subtreeFlags&8772&&s!==null?(s.return=a,He=s):u3(e)}}function u3(e){for(;He!==null;){var t=He;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:$r||p1(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!$r)if(i===null)r.componentDidMount();else{var a=t.elementType===t.type?i.memoizedProps:qs(t.type,i.memoizedProps);r.componentDidUpdate(a,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&YM(t,s,r);break;case 3:var n=t.updateQueue;if(n!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=t.child.stateNode;break;case 1:i=t.child.stateNode}YM(t,n,i)}break;case 5:var o=t.stateNode;if(i===null&&t.flags&4){i=o;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Wf(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Te(163))}$r||t.flags&512&&k_(t)}catch(d){Oi(t,t.return,d)}}if(t===e){He=null;break}if(i=t.sibling,i!==null){i.return=t.return,He=i;break}He=t.return}}function d3(e){for(;He!==null;){var t=He;if(t===e){He=null;break}var i=t.sibling;if(i!==null){i.return=t.return,He=i;break}He=t.return}}function p3(e){for(;He!==null;){var t=He;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{p1(4,t)}catch(l){Oi(t,i,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(l){Oi(t,a,l)}}var s=t.return;try{k_(t)}catch(l){Oi(t,s,l)}break;case 5:var n=t.return;try{k_(t)}catch(l){Oi(t,n,l)}}}catch(l){Oi(t,t.return,l)}if(t===e){He=null;break}var o=t.sibling;if(o!==null){o.return=t.return,He=o;break}He=t.return}}var OU=Math.ceil,U0=tl.ReactCurrentDispatcher,WA=tl.ReactCurrentOwner,Es=tl.ReactCurrentBatchConfig,Bt=0,Mr=null,$i=null,Fr=0,qa=0,Bu=hc(0),ur=0,im=null,ch=0,f1=0,qA=0,Sf=null,Pa=null,XA=0,Ed=1/0,Eo=null,V0=!1,B_=null,Kl=null,yg=!1,Ll=null,G0=0,Af=0,j_=null,e0=-1,t0=0;function ya(){return Bt&6?Fi():e0!==-1?e0:e0=Fi()}function $l(e){return e.mode&1?Bt&2&&Fr!==0?Fr&-Fr:fU.transition!==null?(t0===0&&(t0=QR()),t0):(e=ei,e!==0||(e=window.event,e=e===void 0?16:iL(e.type)),e):1}function rn(e,t,i,r){if(50<Af)throw Af=0,j_=null,Error(Te(185));Om(e,i,r),(!(Bt&2)||e!==Mr)&&(e===Mr&&(!(Bt&2)&&(f1|=i),ur===4&&Ml(e,Fr)),ja(e,r),i===1&&Bt===0&&!(t.mode&1)&&(Ed=Fi()+500,h1&&uc()))}function ja(e,t){var i=e.callbackNode;fF(e,t);var r=C0(e,e===Mr?Fr:0);if(r===0)i!==null&&_M(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(i!=null&&_M(i),t===1)e.tag===0?pU(f3.bind(null,e)):wL(f3.bind(null,e)),cU(function(){!(Bt&6)&&uc()}),i=null;else{switch(ZR(r)){case 1:i=xA;break;case 4:i=XR;break;case 16:i=E0;break;case 536870912:i=YR;break;default:i=E0}i=bk(i,pk.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function pk(e,t){if(e0=-1,t0=0,Bt&6)throw Error(Te(327));var i=e.callbackNode;if($u()&&e.callbackNode!==i)return null;var r=C0(e,e===Mr?Fr:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=H0(e,r);else{t=r;var a=Bt;Bt|=2;var s=mk();(Mr!==e||Fr!==t)&&(Eo=null,Ed=Fi()+500,Zc(e,t));do try{LU();break}catch(o){fk(e,o)}while(!0);IA(),U0.current=s,Bt=a,$i!==null?t=0:(Mr=null,Fr=0,t=ur)}if(t!==0){if(t===2&&(a=d_(e),a!==0&&(r=a,t=F_(e,a))),t===1)throw i=im,Zc(e,0),Ml(e,r),ja(e,Fi()),i;if(t===6)Ml(e,r);else{if(a=e.current.alternate,!(r&30)&&!IU(a)&&(t=H0(e,r),t===2&&(s=d_(e),s!==0&&(r=s,t=F_(e,s))),t===1))throw i=im,Zc(e,0),Ml(e,r),ja(e,Fi()),i;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(Te(345));case 2:Ec(e,Pa,Eo);break;case 3:if(Ml(e,r),(r&130023424)===r&&(t=XA+500-Fi(),10<t)){if(C0(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){ya(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=b_(Ec.bind(null,e,Pa,Eo),t);break}Ec(e,Pa,Eo);break;case 4:if(Ml(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var n=31-tn(r);s=1<<n,n=t[n],n>a&&(a=n),r&=~s}if(r=a,r=Fi()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*OU(r/1960))-r,10<r){e.timeoutHandle=b_(Ec.bind(null,e,Pa,Eo),r);break}Ec(e,Pa,Eo);break;case 5:Ec(e,Pa,Eo);break;default:throw Error(Te(329))}}}return ja(e,Fi()),e.callbackNode===i?pk.bind(null,e):null}function F_(e,t){var i=Sf;return e.current.memoizedState.isDehydrated&&(Zc(e,t).flags|=256),e=H0(e,t),e!==2&&(t=Pa,Pa=i,t!==null&&U_(t)),e}function U_(e){Pa===null?Pa=e:Pa.push.apply(Pa,e)}function IU(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var r=0;r<i.length;r++){var a=i[r],s=a.getSnapshot;a=a.value;try{if(!nn(s(),a))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ml(e,t){for(t&=~qA,t&=~f1,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-tn(t),r=1<<i;e[i]=-1,t&=~r}}function f3(e){if(Bt&6)throw Error(Te(327));$u();var t=C0(e,0);if(!(t&1))return ja(e,Fi()),null;var i=H0(e,t);if(e.tag!==0&&i===2){var r=d_(e);r!==0&&(t=r,i=F_(e,r))}if(i===1)throw i=im,Zc(e,0),Ml(e,t),ja(e,Fi()),i;if(i===6)throw Error(Te(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Ec(e,Pa,Eo),ja(e,Fi()),null}function YA(e,t){var i=Bt;Bt|=1;try{return e(t)}finally{Bt=i,Bt===0&&(Ed=Fi()+500,h1&&uc())}}function hh(e){Ll!==null&&Ll.tag===0&&!(Bt&6)&&$u();var t=Bt;Bt|=1;var i=Es.transition,r=ei;try{if(Es.transition=null,ei=1,e)return e()}finally{ei=r,Es.transition=i,Bt=t,!(Bt&6)&&uc()}}function QA(){qa=Bu.current,fi(Bu)}function Zc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,lU(i)),$i!==null)for(i=$i.return;i!==null;){var r=i;switch(PA(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&O0();break;case 3:Sd(),fi(Na),fi(sa),BA();break;case 5:NA(r);break;case 4:Sd();break;case 13:fi(bi);break;case 19:fi(bi);break;case 10:RA(r.type._context);break;case 22:case 23:QA()}i=i.return}if(Mr=e,$i=e=Jl(e.current,null),Fr=qa=t,ur=0,im=null,qA=f1=ch=0,Pa=Sf=null,Bc!==null){for(t=0;t<Bc.length;t++)if(i=Bc[t],r=i.interleaved,r!==null){i.interleaved=null;var a=r.next,s=i.pending;if(s!==null){var n=s.next;s.next=a,r.next=n}i.pending=r}Bc=null}return e}function fk(e,t){do{var i=$i;try{if(IA(),Kv.current=F0,j0){for(var r=_i.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}j0=!1}if(lh=0,wr=cr=_i=null,wf=!1,Jf=0,WA.current=null,i===null||i.return===null){ur=1,im=t,$i=null;break}e:{var s=e,n=i.return,o=i,l=t;if(t=Fr,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=o,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=t3(n);if(p!==null){p.flags&=-257,i3(p,n,o,s,t),p.mode&1&&e3(s,c,t),t=p,l=c;var f=t.updateQueue;if(f===null){var m=new Set;m.add(l),t.updateQueue=m}else f.add(l);break e}else{if(!(t&1)){e3(s,c,t),ZA();break e}l=Error(Te(426))}}else if(gi&&o.mode&1){var g=t3(n);if(g!==null){!(g.flags&65536)&&(g.flags|=256),i3(g,n,o,s,t),DA(Ad(l,o));break e}}s=l=Ad(l,o),ur!==4&&(ur=2),Sf===null?Sf=[s]:Sf.push(s),s=n;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var v=KL(s,l,t);XM(s,v);break e;case 1:o=l;var y=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Kl===null||!Kl.has(x)))){s.flags|=65536,t&=-t,s.lanes|=t;var w=$L(s,o,t);XM(s,w);break e}}s=s.return}while(s!==null)}vk(i)}catch(S){t=S,$i===i&&i!==null&&($i=i=i.return);continue}break}while(!0)}function mk(){var e=U0.current;return U0.current=F0,e===null?F0:e}function ZA(){(ur===0||ur===3||ur===2)&&(ur=4),Mr===null||!(ch&268435455)&&!(f1&268435455)||Ml(Mr,Fr)}function H0(e,t){var i=Bt;Bt|=2;var r=mk();(Mr!==e||Fr!==t)&&(Eo=null,Zc(e,t));do try{RU();break}catch(a){fk(e,a)}while(!0);if(IA(),Bt=i,U0.current=r,$i!==null)throw Error(Te(261));return Mr=null,Fr=0,ur}function RU(){for(;$i!==null;)gk($i)}function LU(){for(;$i!==null&&!sF();)gk($i)}function gk(e){var t=xk(e.alternate,e,qa);e.memoizedProps=e.pendingProps,t===null?vk(e):$i=t,WA.current=null}function vk(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=MU(i,t),i!==null){i.flags&=32767,$i=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ur=6,$i=null;return}}else if(i=CU(i,t,qa),i!==null){$i=i;return}if(t=t.sibling,t!==null){$i=t;return}$i=t=e}while(t!==null);ur===0&&(ur=5)}function Ec(e,t,i){var r=ei,a=Es.transition;try{Es.transition=null,ei=1,kU(e,t,i,r)}finally{Es.transition=a,ei=r}return null}function kU(e,t,i,r){do $u();while(Ll!==null);if(Bt&6)throw Error(Te(327));i=e.finishedWork;var a=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(Te(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(mF(e,s),e===Mr&&($i=Mr=null,Fr=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||yg||(yg=!0,bk(E0,function(){return $u(),null})),s=(i.flags&15990)!==0,i.subtreeFlags&15990||s){s=Es.transition,Es.transition=null;var n=ei;ei=1;var o=Bt;Bt|=4,WA.current=null,PU(e,i),uk(i,e),tU(y_),M0=!!v_,y_=v_=null,e.current=i,DU(i),nF(),Bt=o,ei=n,Es.transition=s}else e.current=i;if(yg&&(yg=!1,Ll=e,G0=a),s=e.pendingLanes,s===0&&(Kl=null),cF(i.stateNode),ja(e,Fi()),t!==null)for(r=e.onRecoverableError,i=0;i<t.length;i++)a=t[i],r(a.value,{componentStack:a.stack,digest:a.digest});if(V0)throw V0=!1,e=B_,B_=null,e;return G0&1&&e.tag!==0&&$u(),s=e.pendingLanes,s&1?e===j_?Af++:(Af=0,j_=e):Af=0,uc(),null}function $u(){if(Ll!==null){var e=ZR(G0),t=Es.transition,i=ei;try{if(Es.transition=null,ei=16>e?16:e,Ll===null)var r=!1;else{if(e=Ll,Ll=null,G0=0,Bt&6)throw Error(Te(331));var a=Bt;for(Bt|=4,He=e.current;He!==null;){var s=He,n=s.child;if(He.flags&16){var o=s.deletions;if(o!==null){for(var l=0;l<o.length;l++){var c=o[l];for(He=c;He!==null;){var u=He;switch(u.tag){case 0:case 11:case 15:_f(8,u,s)}var h=u.child;if(h!==null)h.return=u,He=h;else for(;He!==null;){u=He;var d=u.sibling,p=u.return;if(lk(u),u===c){He=null;break}if(d!==null){d.return=p,He=d;break}He=p}}}var f=s.alternate;if(f!==null){var m=f.child;if(m!==null){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}He=s}}if(s.subtreeFlags&2064&&n!==null)n.return=s,He=n;else e:for(;He!==null;){if(s=He,s.flags&2048)switch(s.tag){case 0:case 11:case 15:_f(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,He=v;break e}He=s.return}}var y=e.current;for(He=y;He!==null;){n=He;var x=n.child;if(n.subtreeFlags&2064&&x!==null)x.return=n,He=x;else e:for(n=y;He!==null;){if(o=He,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:p1(9,o)}}catch(S){Oi(o,o.return,S)}if(o===n){He=null;break e}var w=o.sibling;if(w!==null){w.return=o.return,He=w;break e}He=o.return}}if(Bt=a,uc(),Hn&&typeof Hn.onPostCommitFiberRoot=="function")try{Hn.onPostCommitFiberRoot(s1,e)}catch{}r=!0}return r}finally{ei=i,Es.transition=t}}return!1}function m3(e,t,i){t=Ad(i,t),t=KL(e,t,1),e=Zl(e,t,1),t=ya(),e!==null&&(Om(e,1,t),ja(e,t))}function Oi(e,t,i){if(e.tag===3)m3(e,e,i);else for(;t!==null;){if(t.tag===3){m3(t,e,i);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Kl===null||!Kl.has(r))){e=Ad(i,e),e=$L(t,e,1),t=Zl(t,e,1),e=ya(),t!==null&&(Om(t,1,e),ja(t,e));break}}t=t.return}}function zU(e,t,i){var r=e.pingCache;r!==null&&r.delete(t),t=ya(),e.pingedLanes|=e.suspendedLanes&i,Mr===e&&(Fr&i)===i&&(ur===4||ur===3&&(Fr&130023424)===Fr&&500>Fi()-XA?Zc(e,0):qA|=i),ja(e,t)}function yk(e,t){t===0&&(e.mode&1?(t=lg,lg<<=1,!(lg&130023424)&&(lg=4194304)):t=1);var i=ya();e=Yo(e,t),e!==null&&(Om(e,t,i),ja(e,i))}function NU(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),yk(e,i)}function BU(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(i=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Te(314))}r!==null&&r.delete(t),yk(e,i)}var xk;xk=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||Na.current)Ra=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Ra=!1,EU(e,t,i);Ra=!!(e.flags&131072)}else Ra=!1,gi&&t.flags&1048576&&_L(t,L0,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Jv(e,t),e=t.pendingProps;var a=bd(t,sa.current);Ku(t,i),a=FA(null,t,r,e,a,i);var s=UA();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ba(r)?(s=!0,I0(t)):s=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,kA(t),a.updater=u1,t.stateNode=a,a._reactInternals=t,M_(t,r,e,i),t=D_(null,t,r,!0,s,i)):(t.tag=0,gi&&s&&TA(t),da(null,t,a,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Jv(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=FU(r),e=qs(r,e),a){case 0:t=P_(null,t,r,e,i);break e;case 1:t=s3(null,t,r,e,i);break e;case 11:t=r3(null,t,r,e,i);break e;case 14:t=a3(null,t,r,qs(r.type,e),i);break e}throw Error(Te(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:qs(r,a),P_(e,t,r,a,i);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:qs(r,a),s3(e,t,r,a,i);case 3:e:{if(ik(t),e===null)throw Error(Te(387));r=t.pendingProps,s=t.memoizedState,a=s.element,CL(e,t),N0(t,r,null,i);var n=t.memoizedState;if(r=n.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:n.cache,pendingSuspenseBoundaries:n.pendingSuspenseBoundaries,transitions:n.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){a=Ad(Error(Te(423)),t),t=n3(e,t,r,i,a);break e}else if(r!==a){a=Ad(Error(Te(424)),t),t=n3(e,t,r,i,a);break e}else for(Za=Ql(t.stateNode.containerInfo.firstChild),ts=t,gi=!0,Ys=null,i=DL(t,null,r,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(wd(),r===a){t=Qo(e,t,i);break e}da(e,t,r,i)}t=t.child}return t;case 5:return OL(t),e===null&&A_(t),r=t.type,a=t.pendingProps,s=e!==null?e.memoizedProps:null,n=a.children,x_(r,a)?n=null:s!==null&&x_(r,s)&&(t.flags|=32),tk(e,t),da(e,t,n,i),t.child;case 6:return e===null&&A_(t),null;case 13:return rk(e,t,i);case 4:return zA(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=_d(t,null,r,i):da(e,t,r,i),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:qs(r,a),r3(e,t,r,a,i);case 7:return da(e,t,t.pendingProps,i),t.child;case 8:return da(e,t,t.pendingProps.children,i),t.child;case 12:return da(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,s=t.memoizedProps,n=a.value,hi(k0,r._currentValue),r._currentValue=n,s!==null)if(nn(s.value,n)){if(s.children===a.children&&!Na.current){t=Qo(e,t,i);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var o=s.dependencies;if(o!==null){n=s.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Uo(-1,i&-i),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=i,l=s.alternate,l!==null&&(l.lanes|=i),E_(s.return,i,t),o.lanes|=i;break}l=l.next}}else if(s.tag===10)n=s.type===t.type?null:s.child;else if(s.tag===18){if(n=s.return,n===null)throw Error(Te(341));n.lanes|=i,o=n.alternate,o!==null&&(o.lanes|=i),E_(n,i,t),n=s.sibling}else n=s.child;if(n!==null)n.return=s;else for(n=s;n!==null;){if(n===t){n=null;break}if(s=n.sibling,s!==null){s.return=n.return,n=s;break}n=n.return}s=n}da(e,t,a.children,i),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ku(t,i),a=Ps(a),r=r(a),t.flags|=1,da(e,t,r,i),t.child;case 14:return r=t.type,a=qs(r,t.pendingProps),a=qs(r.type,a),a3(e,t,r,a,i);case 15:return JL(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:qs(r,a),Jv(e,t),t.tag=1,Ba(r)?(e=!0,I0(t)):e=!1,Ku(t,i),TL(t,r,a),M_(t,r,a,i),D_(null,t,r,!0,e,i);case 19:return ak(e,t,i);case 22:return ek(e,t,i)}throw Error(Te(156,t.tag))};function bk(e,t){return qR(e,t)}function jU(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ss(e,t,i,r){return new jU(e,t,i,r)}function KA(e){return e=e.prototype,!(!e||!e.isReactComponent)}function FU(e){if(typeof e=="function")return KA(e)?1:0;if(e!=null){if(e=e.$$typeof,e===gA)return 11;if(e===vA)return 14}return 2}function Jl(e,t){var i=e.alternate;return i===null?(i=Ss(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function i0(e,t,i,r,a,s){var n=2;if(r=e,typeof e=="function")KA(e)&&(n=1);else if(typeof e=="string")n=5;else e:switch(e){case Tu:return Kc(i.children,a,s,t);case mA:n=8,a|=8;break;case Kw:return e=Ss(12,i,t,a|2),e.elementType=Kw,e.lanes=s,e;case $w:return e=Ss(13,i,t,a),e.elementType=$w,e.lanes=s,e;case Jw:return e=Ss(19,i,t,a),e.elementType=Jw,e.lanes=s,e;case PR:return m1(i,a,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case MR:n=10;break e;case TR:n=9;break e;case gA:n=11;break e;case vA:n=14;break e;case Sl:n=16,r=null;break e}throw Error(Te(130,e==null?e:typeof e,""))}return t=Ss(n,i,t,a),t.elementType=e,t.type=r,t.lanes=s,t}function Kc(e,t,i,r){return e=Ss(7,e,r,t),e.lanes=i,e}function m1(e,t,i,r){return e=Ss(22,e,r,t),e.elementType=PR,e.lanes=i,e.stateNode={isHidden:!1},e}function kx(e,t,i){return e=Ss(6,e,null,t),e.lanes=i,e}function zx(e,t,i){return t=Ss(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function UU(e,t,i,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gx(0),this.expirationTimes=gx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gx(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function $A(e,t,i,r,a,s,n,o,l){return e=new UU(e,t,i,o,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Ss(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},kA(s),e}function VU(e,t,i){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Mu,key:r==null?null:""+r,children:e,containerInfo:t,implementation:i}}function wk(e){if(!e)return sc;e=e._reactInternals;e:{if(wh(e)!==e||e.tag!==1)throw Error(Te(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ba(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Te(171))}if(e.tag===1){var i=e.type;if(Ba(i))return bL(e,i,t)}return t}function _k(e,t,i,r,a,s,n,o,l){return e=$A(i,r,!0,e,a,s,n,o,l),e.context=wk(null),i=e.current,r=ya(),a=$l(i),s=Uo(r,a),s.callback=t??null,Zl(i,s,a),e.current.lanes=a,Om(e,a,r),ja(e,r),e}function g1(e,t,i,r){var a=t.current,s=ya(),n=$l(a);return i=wk(i),t.context===null?t.context=i:t.pendingContext=i,t=Uo(s,n),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=Zl(a,t,n),e!==null&&(rn(e,a,n,s),Zv(e,a,n)),n}function W0(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function g3(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function JA(e,t){g3(e,t),(e=e.alternate)&&g3(e,t)}function GU(){return null}var Sk=typeof reportError=="function"?reportError:function(e){console.error(e)};function eE(e){this._internalRoot=e}v1.prototype.render=eE.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Te(409));g1(e,t,null,null)};v1.prototype.unmount=eE.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;hh(function(){g1(null,e,null,null)}),t[Xo]=null}};function v1(e){this._internalRoot=e}v1.prototype.unstable_scheduleHydration=function(e){if(e){var t=JR();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Cl.length&&t!==0&&t<Cl[i].priority;i++);Cl.splice(i,0,e),i===0&&tL(e)}};function tE(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function y1(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function v3(){}function HU(e,t,i,r,a){if(a){if(typeof r=="function"){var s=r;r=function(){var c=W0(n);s.call(c)}}var n=_k(t,r,e,0,null,!1,!1,"",v3);return e._reactRootContainer=n,e[Xo]=n.current,Yf(e.nodeType===8?e.parentNode:e),hh(),n}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var o=r;r=function(){var c=W0(l);o.call(c)}}var l=$A(e,0,!1,null,null,!1,!1,"",v3);return e._reactRootContainer=l,e[Xo]=l.current,Yf(e.nodeType===8?e.parentNode:e),hh(function(){g1(t,l,i,r)}),l}function x1(e,t,i,r,a){var s=i._reactRootContainer;if(s){var n=s;if(typeof a=="function"){var o=a;a=function(){var l=W0(n);o.call(l)}}g1(t,n,e,a)}else n=HU(i,t,e,a,r);return W0(n)}KR=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=af(t.pendingLanes);i!==0&&(bA(t,i|1),ja(t,Fi()),!(Bt&6)&&(Ed=Fi()+500,uc()))}break;case 13:hh(function(){var r=Yo(e,1);if(r!==null){var a=ya();rn(r,e,1,a)}}),JA(e,1)}};wA=function(e){if(e.tag===13){var t=Yo(e,134217728);if(t!==null){var i=ya();rn(t,e,134217728,i)}JA(e,134217728)}};$R=function(e){if(e.tag===13){var t=$l(e),i=Yo(e,t);if(i!==null){var r=ya();rn(i,e,t,r)}JA(e,t)}};JR=function(){return ei};eL=function(e,t){var i=ei;try{return ei=e,t()}finally{ei=i}};c_=function(e,t,i){switch(t){case"input":if(i_(e,i),t=i.name,i.type==="radio"&&t!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var a=c1(r);if(!a)throw Error(Te(90));OR(r),i_(r,a)}}}break;case"textarea":RR(e,i);break;case"select":t=i.value,t!=null&&Xu(e,!!i.multiple,t,!1)}};FR=YA;UR=hh;var WU={usingClientEntryPoint:!1,Events:[Rm,Iu,c1,BR,jR,YA]},bp={findFiberByHostInstance:Nc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},qU={bundleType:bp.bundleType,version:bp.version,rendererPackageName:bp.rendererPackageName,rendererConfig:bp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:tl.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=HR(e),e===null?null:e.stateNode},findFiberByHostInstance:bp.findFiberByHostInstance||GU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var xg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!xg.isDisabled&&xg.supportsFiber)try{s1=xg.inject(qU),Hn=xg}catch{}}ss.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WU;ss.createPortal=function(e,t){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tE(t))throw Error(Te(200));return VU(e,t,null,i)};ss.createRoot=function(e,t){if(!tE(e))throw Error(Te(299));var i=!1,r="",a=Sk;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=$A(e,1,!1,null,null,i,!1,r,a),e[Xo]=t.current,Yf(e.nodeType===8?e.parentNode:e),new eE(t)};ss.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Te(188)):(e=Object.keys(e).join(","),Error(Te(268,e)));return e=HR(t),e=e===null?null:e.stateNode,e};ss.flushSync=function(e){return hh(e)};ss.hydrate=function(e,t,i){if(!y1(t))throw Error(Te(200));return x1(null,e,t,!0,i)};ss.hydrateRoot=function(e,t,i){if(!tE(e))throw Error(Te(405));var r=i!=null&&i.hydratedSources||null,a=!1,s="",n=Sk;if(i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(s=i.identifierPrefix),i.onRecoverableError!==void 0&&(n=i.onRecoverableError)),t=_k(t,null,e,1,i??null,a,!1,s,n),e[Xo]=t.current,Yf(e),r)for(e=0;e<r.length;e++)i=r[e],a=i._getVersion,a=a(i._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[i,a]:t.mutableSourceEagerHydrationData.push(i,a);return new v1(t)};ss.render=function(e,t,i){if(!y1(t))throw Error(Te(200));return x1(null,e,t,!1,i)};ss.unmountComponentAtNode=function(e){if(!y1(e))throw Error(Te(40));return e._reactRootContainer?(hh(function(){x1(null,null,e,!1,function(){e._reactRootContainer=null,e[Xo]=null})}),!0):!1};ss.unstable_batchedUpdates=YA;ss.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!y1(i))throw Error(Te(200));if(e==null||e._reactInternals===void 0)throw Error(Te(38));return x1(e,t,i,!1,r)};ss.version="18.2.0-next-9e3b772b8-20220608";function Ak(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ak)}catch(e){console.error(e)}}Ak(),_R.exports=ss;var XU=_R.exports,y3=XU;Qw.createRoot=y3.createRoot,Qw.hydrateRoot=y3.hydrateRoot;const YU="modulepreload",QU=function(e){return"/"+e},x3={},Xd=function(t,i,r){let a=Promise.resolve();if(i&&i.length>0){const s=document.getElementsByTagName("link");a=Promise.all(i.map(n=>{if(n=QU(n),n in x3)return;x3[n]=!0;const o=n.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!r)for(let h=s.length-1;h>=0;h--){const d=s[h];if(d.href===n&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${l}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":YU,o||(u.as="script",u.crossOrigin=""),u.href=n,document.head.appendChild(u),o)return new Promise((h,d)=>{u.addEventListener("load",h),u.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${n}`)))})}))}return a.then(()=>t()).catch(s=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=s,window.dispatchEvent(n),!n.defaultPrevented)throw s})};var ZU=Object.create,b1=Object.defineProperty,KU=Object.getOwnPropertyDescriptor,$U=Object.getOwnPropertyNames,JU=Object.getPrototypeOf,e8=Object.prototype.hasOwnProperty,t8=(e,t,i)=>t in e?b1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,Pr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),i8=(e,t)=>{for(var i in t)b1(e,i,{get:t[i],enumerable:!0})},r8=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of $U(t))!e8.call(e,a)&&a!==i&&b1(e,a,{get:()=>t[a],enumerable:!(r=KU(t,a))||r.enumerable});return e},ar=(e,t,i)=>(i=e!=null?ZU(JU(e)):{},r8(t||!e||!e.__esModule?b1(i,"default",{value:e,enumerable:!0}):i,e)),pa=(e,t,i)=>(t8(e,typeof t!="symbol"?t+"":t,i),i),a8=Pr((e,t)=>{(function(i,r){typeof e=="object"?t.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(e,function(){return i.importState=function(a){var s=new i;return s.importState(a),s},i;function i(){return function(a){var s=0,n=0,o=0,l=1;a.length==0&&(a=[+new Date]);var c=r();s=c(" "),n=c(" "),o=c(" ");for(var u=0;u<a.length;u++)s-=c(a[u]),s<0&&(s+=1),n-=c(a[u]),n<0&&(n+=1),o-=c(a[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=n,n=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=a,h.exportState=function(){return[s,n,o,l]},h.importState=function(d){s=+d[0]||0,n=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h}(Array.prototype.slice.call(arguments))}function r(){var a=4022871197,s=function(n){n=n.toString();for(var o=0;o<n.length;o++){a+=n.charCodeAt(o);var l=.02519603282416938*a;a=l>>>0,l-=a,l*=a,a=l>>>0,l-=a,a+=l*4294967296}return(a>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),Ek=Pr((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?r(e):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(e,function(i){i.SVD=function(r,a,s,n,o){if(a=a===void 0||a,s=s===void 0||s,o=1e-64/(n=n||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,p,f,m,g,v,y,x,w=r[0].length,S=r.length;if(S<w)throw new TypeError("Invalid matrix: m < n");for(var _=[],A=[],E=[],M=a==="f"?S:w,C=v=f=0;C<S;C++)A[C]=new Array(M).fill(0);for(C=0;C<w;C++)E[C]=new Array(w).fill(0);var T,D=new Array(w).fill(0);for(C=0;C<S;C++)for(l=0;l<w;l++)A[C][l]=r[C][l];for(C=0;C<w;C++){for(_[C]=f,g=0,u=C+1,l=C;l<S;l++)g+=Math.pow(A[l][C],2);if(g<o)f=0;else for(m=(p=A[C][C])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[C][C]=p-f,l=u;l<w;l++){for(g=0,c=C;c<S;c++)g+=A[c][C]*A[c][l];for(p=g/m,c=C;c<S;c++)A[c][l]=A[c][l]+p*A[c][C]}for(D[C]=f,g=0,l=u;l<w;l++)g+=Math.pow(A[C][l],2);if(g<o)f=0;else{for(m=(p=A[C][C+1])*(f=p<0?Math.sqrt(g):-Math.sqrt(g))-g,A[C][C+1]=p-f,l=u;l<w;l++)_[l]=A[C][l]/m;for(l=u;l<S;l++){for(g=0,c=u;c<w;c++)g+=A[l][c]*A[C][c];for(c=u;c<w;c++)A[l][c]=A[l][c]+g*_[c]}}v<(y=Math.abs(D[C])+Math.abs(_[C]))&&(v=y)}if(s)for(C=w-1;0<=C;C--){if(f!==0){for(m=A[C][C+1]*f,l=u;l<w;l++)E[l][C]=A[C][l]/m;for(l=u;l<w;l++){for(g=0,c=u;c<w;c++)g+=A[C][c]*E[c][l];for(c=u;c<w;c++)E[c][l]=E[c][l]+g*E[c][C]}}for(l=u;l<w;l++)E[C][l]=0,E[l][C]=0;E[C][C]=1,f=_[C],u=C}if(a){if(a==="f")for(C=w;C<S;C++){for(l=w;l<S;l++)A[C][l]=0;A[C][C]=1}for(C=w-1;0<=C;C--){for(u=C+1,f=D[C],l=u;l<M;l++)A[C][l]=0;if(f!==0){for(m=A[C][C]*f,l=u;l<M;l++){for(g=0,c=u;c<S;c++)g+=A[c][C]*A[c][l];for(p=g/m,c=C;c<S;c++)A[c][l]=A[c][l]+p*A[c][C]}for(l=C;l<S;l++)A[l][C]=A[l][C]/f}else for(l=C;l<S;l++)A[l][C]=0;A[C][C]=A[C][C]+1}}for(n*=v,c=w-1;0<=c;c--)for(var I=0;I<50;I++){for(T=!1,u=c;0<=u;u--){if(Math.abs(_[u])<=n){T=!0;break}if(Math.abs(D[u-1])<=n)break}if(!T){for(d=0,h=u-(g=1),C=u;C<c+1&&(p=g*_[C],_[C]=d*_[C],!(Math.abs(p)<=n));C++)if(f=D[C],D[C]=Math.sqrt(p*p+f*f),d=f/(m=D[C]),g=-p/m,a)for(l=0;l<S;l++)y=A[l][h],x=A[l][C],A[l][h]=y*d+x*g,A[l][C]=-y*g+x*d}if(x=D[c],u===c){if(x<0&&(D[c]=-x,s))for(l=0;l<w;l++)E[l][c]=-E[l][c];break}for(v=D[u],p=(((y=D[c-1])-x)*(y+x)+((f=_[c-1])-(m=_[c]))*(f+m))/(2*m*y),f=Math.sqrt(p*p+1),p=((v-x)*(v+x)+m*(y/(p<0?p-f:p+f)-m))/v,C=u+(g=d=1);C<c+1;C++){if(f=_[C],y=D[C],m=g*f,f*=d,x=Math.sqrt(p*p+m*m),p=v*(d=p/(_[C-1]=x))+f*(g=m/x),f=-v*g+f*d,m=y*g,y*=d,s)for(l=0;l<w;l++)v=E[l][C-1],x=E[l][C],E[l][C-1]=v*d+x*g,E[l][C]=-v*g+x*d;if(x=Math.sqrt(p*p+m*m),p=(d=p/(D[C-1]=x))*f+(g=m/x)*y,v=-g*f+d*y,a)for(l=0;l<S;l++)y=A[l][C-1],x=A[l][C],A[l][C-1]=y*d+x*g,A[l][C]=-y*g+x*d}_[u]=0,_[c]=p,D[c]=v}for(C=0;C<w;C++)D[C]<n&&(D[C]=0);return{u:A,q:D,v:E}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),s8=Pr((e,t)=>{(function(i,r){typeof e=="object"&&typeof t<"u"?t.exports=r():typeof define=="function"&&define.amd?define(r):(i=i||self,i.TinyQueue=r())})(e,function(){var i=function(a,s){if(a===void 0&&(a=[]),s===void 0&&(s=r),this.data=a,this.length=this.data.length,this.compare=s,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};i.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},i.prototype.pop=function(){if(this.length!==0){var a=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),a}},i.prototype.peek=function(){return this.data[0]},i.prototype._up=function(a){for(var s=this,n=s.data,o=s.compare,l=n[a];a>0;){var c=a-1>>1,u=n[c];if(o(l,u)>=0)break;n[a]=u,a=c}n[a]=l},i.prototype._down=function(a){for(var s=this,n=s.data,o=s.compare,l=this.length>>1,c=n[a];a<l;){var u=(a<<1)+1,h=n[u],d=u+1;if(d<this.length&&o(n[d],h)<0&&(u=d,h=n[d]),o(h,c)>=0)break;n[a]=h,a=u}n[a]=c};function r(a,s){return a<s?-1:a>s?1:0}return i})}),n8=Pr((e,t)=>{var i=s8();i.default&&(i=i.default),t.exports=r,t.exports.default=r;function r(c,u,h){u=u||1;for(var d,p,f,m,g=0;g<c[0].length;g++){var v=c[0][g];(!g||v[0]<d)&&(d=v[0]),(!g||v[1]<p)&&(p=v[1]),(!g||v[0]>f)&&(f=v[0]),(!g||v[1]>m)&&(m=v[1])}var y=f-d,x=m-p,w=Math.min(y,x),S=w/2;if(w===0){var _=[d,p];return _.distance=0,_}for(var A=new i(void 0,a),E=d;E<f;E+=w)for(var M=p;M<m;M+=w)A.push(new s(E+S,M+S,S,c));var C=o(c),T=new s(d+y/2,p+x/2,0,c);T.d>C.d&&(C=T);for(var D=A.length;A.length;){var I=A.pop();I.d>C.d&&(C=I,h&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,D)),!(I.max-C.d<=u)&&(S=I.h/2,A.push(new s(I.x-S,I.y-S,S,c)),A.push(new s(I.x+S,I.y-S,S,c)),A.push(new s(I.x-S,I.y+S,S,c)),A.push(new s(I.x+S,I.y+S,S,c)),D+=4)}h&&(console.log("num probes: "+D),console.log("best distance: "+C.d));var O=[C.x,C.y];return O.distance=C.d,O}function a(c,u){return u.max-c.max}function s(c,u,h,d){this.x=c,this.y=u,this.h=h,this.d=n(c,u,d),this.max=this.d+this.h*Math.SQRT2}function n(c,u,h){for(var d=!1,p=1/0,f=0;f<h.length;f++)for(var m=h[f],g=0,v=m.length,y=v-1;g<v;y=g++){var x=m[g],w=m[y];x[1]>u!=w[1]>u&&c<(w[0]-x[0])*(u-x[1])/(w[1]-x[1])+x[0]&&(d=!d),p=Math.min(p,l(c,u,x,w))}return p===0?0:(d?1:-1)*Math.sqrt(p)}function o(c){for(var u=0,h=0,d=0,p=c[0],f=0,m=p.length,g=m-1;f<m;g=f++){var v=p[f],y=p[g],x=v[0]*y[1]-y[0]*v[1];h+=(v[0]+y[0])*x,d+=(v[1]+y[1])*x,u+=x*3}return u===0?new s(p[0][0],p[0][1],0,c):new s(h/u,d/u,0,c)}function l(c,u,h,d){var p=h[0],f=h[1],m=d[0]-p,g=d[1]-f;if(m!==0||g!==0){var v=((c-p)*m+(u-f)*g)/(m*m+g*g);v>1?(p=d[0],f=d[1]):v>0&&(p+=m*v,f+=g*v)}return m=c-p,g=u-f,m*m+g*g}}),o8=Pr((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var a=Number(r);return isNaN(a)?a:a<0?Math.ceil(a):Math.floor(a)}t.exports=e.default}),l8=Pr((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;function i(r){var a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),r.getTime()-a.getTime()}t.exports=e.default}),c8=Pr(e=>{(function(){var t=function(){this.init()};t.prototype={init:function(){var h=this||i;return h._counter=1e3,h._html5AudioPool=[],h.html5PoolSize=10,h._codecs={},h._howls=[],h._muted=!1,h._volume=1,h._canPlayEvent="canplaythrough",h._navigator=typeof window<"u"&&window.navigator?window.navigator:null,h.masterGain=null,h.noAudio=!1,h.usingWebAudio=!0,h.autoSuspend=!0,h.ctx=null,h.autoUnlock=!0,h._setup(),h},volume:function(h){var d=this||i;if(h=parseFloat(h),d.ctx||u(),typeof h<"u"&&h>=0&&h<=1){if(d._volume=h,d._muted)return d;d.usingWebAudio&&d.masterGain.gain.setValueAtTime(h,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=d._howls[p]._soundById(f[m]);g&&g._node&&(g._node.volume=g._volume*h)}return d}return d._volume},mute:function(h){var d=this||i;d.ctx||u(),d._muted=h,d.usingWebAudio&&d.masterGain.gain.setValueAtTime(h?0:d._volume,i.ctx.currentTime);for(var p=0;p<d._howls.length;p++)if(!d._howls[p]._webAudio)for(var f=d._howls[p]._getSoundIds(),m=0;m<f.length;m++){var g=d._howls[p]._soundById(f[m]);g&&g._node&&(g._node.muted=h?!0:g._muted)}return d},stop:function(){for(var h=this||i,d=0;d<h._howls.length;d++)h._howls[d].stop();return h},unload:function(){for(var h=this||i,d=h._howls.length-1;d>=0;d--)h._howls[d].unload();return h.usingWebAudio&&h.ctx&&typeof h.ctx.close<"u"&&(h.ctx.close(),h.ctx=null,u()),h},codecs:function(h){return(this||i)._codecs[h.replace(/^x-/,"")]},_setup:function(){var h=this||i;if(h.state=h.ctx&&h.ctx.state||"suspended",h._autoSuspend(),!h.usingWebAudio)if(typeof Audio<"u")try{var d=new Audio;typeof d.oncanplaythrough>"u"&&(h._canPlayEvent="canplay")}catch{h.noAudio=!0}else h.noAudio=!0;try{var d=new Audio;d.muted&&(h.noAudio=!0)}catch{}return h.noAudio||h._setupCodecs(),h},_setupCodecs:function(){var h=this||i,d=null;try{d=typeof Audio<"u"?new Audio:null}catch{return h}if(!d||typeof d.canPlayType!="function")return h;var p=d.canPlayType("audio/mpeg;").replace(/^no$/,""),f=h._navigator?h._navigator.userAgent:"",m=f.match(/OPR\/([0-6].)/g),g=m&&parseInt(m[0].split("/")[1],10)<33,v=f.indexOf("Safari")!==-1&&f.indexOf("Chrome")===-1,y=f.match(/Version\/(.*?) /),x=v&&y&&parseInt(y[1],10)<15;return h._codecs={mp3:!!(!g&&(p||d.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!p,opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(d.canPlayType('audio/wav; codecs="1"')||d.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!d.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!d.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(d.canPlayType("audio/x-m4b;")||d.canPlayType("audio/m4b;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(d.canPlayType("audio/x-mp4;")||d.canPlayType("audio/mp4;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!x&&d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!d.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(d.canPlayType("audio/x-flac;")||d.canPlayType("audio/flac;")).replace(/^no$/,"")},h},_unlockAudio:function(){var h=this||i;if(!(h._audioUnlocked||!h.ctx)){h._audioUnlocked=!1,h.autoUnlock=!1,!h._mobileUnloaded&&h.ctx.sampleRate!==44100&&(h._mobileUnloaded=!0,h.unload()),h._scratchBuffer=h.ctx.createBuffer(1,1,22050);var d=function(p){for(;h._html5AudioPool.length<h.html5PoolSize;)try{var f=new Audio;f._unlocked=!0,h._releaseHtml5Audio(f)}catch{h.noAudio=!0;break}for(var m=0;m<h._howls.length;m++)if(!h._howls[m]._webAudio)for(var g=h._howls[m]._getSoundIds(),v=0;v<g.length;v++){var y=h._howls[m]._soundById(g[v]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}h._autoResume();var x=h.ctx.createBufferSource();x.buffer=h._scratchBuffer,x.connect(h.ctx.destination),typeof x.start>"u"?x.noteOn(0):x.start(0),typeof h.ctx.resume=="function"&&h.ctx.resume(),x.onended=function(){x.disconnect(0),h._audioUnlocked=!0,document.removeEventListener("touchstart",d,!0),document.removeEventListener("touchend",d,!0),document.removeEventListener("click",d,!0),document.removeEventListener("keydown",d,!0);for(var w=0;w<h._howls.length;w++)h._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",d,!0),document.addEventListener("touchend",d,!0),document.addEventListener("click",d,!0),document.addEventListener("keydown",d,!0),h}},_obtainHtml5Audio:function(){var h=this||i;if(h._html5AudioPool.length)return h._html5AudioPool.pop();var d=new Audio().play();return d&&typeof Promise<"u"&&(d instanceof Promise||typeof d.then=="function")&&d.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(h){var d=this||i;return h._unlocked&&d._html5AudioPool.push(h),d},_autoSuspend:function(){var h=this;if(!(!h.autoSuspend||!h.ctx||typeof h.ctx.suspend>"u"||!i.usingWebAudio)){for(var d=0;d<h._howls.length;d++)if(h._howls[d]._webAudio){for(var p=0;p<h._howls[d]._sounds.length;p++)if(!h._howls[d]._sounds[p]._paused)return h}return h._suspendTimer&&clearTimeout(h._suspendTimer),h._suspendTimer=setTimeout(function(){if(h.autoSuspend){h._suspendTimer=null,h.state="suspending";var f=function(){h.state="suspended",h._resumeAfterSuspend&&(delete h._resumeAfterSuspend,h._autoResume())};h.ctx.suspend().then(f,f)}},3e4),h}},_autoResume:function(){var h=this;if(!(!h.ctx||typeof h.ctx.resume>"u"||!i.usingWebAudio))return h.state==="running"&&h.ctx.state!=="interrupted"&&h._suspendTimer?(clearTimeout(h._suspendTimer),h._suspendTimer=null):h.state==="suspended"||h.state==="running"&&h.ctx.state==="interrupted"?(h.ctx.resume().then(function(){h.state="running";for(var d=0;d<h._howls.length;d++)h._howls[d]._emit("resume")}),h._suspendTimer&&(clearTimeout(h._suspendTimer),h._suspendTimer=null)):h.state==="suspending"&&(h._resumeAfterSuspend=!0),h}};var i=new t,r=function(h){var d=this;if(!h.src||h.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}d.init(h)};r.prototype={init:function(h){var d=this;return i.ctx||u(),d._autoplay=h.autoplay||!1,d._format=typeof h.format!="string"?h.format:[h.format],d._html5=h.html5||!1,d._muted=h.mute||!1,d._loop=h.loop||!1,d._pool=h.pool||5,d._preload=typeof h.preload=="boolean"||h.preload==="metadata"?h.preload:!0,d._rate=h.rate||1,d._sprite=h.sprite||{},d._src=typeof h.src!="string"?h.src:[h.src],d._volume=h.volume!==void 0?h.volume:1,d._xhr={method:h.xhr&&h.xhr.method?h.xhr.method:"GET",headers:h.xhr&&h.xhr.headers?h.xhr.headers:null,withCredentials:h.xhr&&h.xhr.withCredentials?h.xhr.withCredentials:!1},d._duration=0,d._state="unloaded",d._sounds=[],d._endTimers={},d._queue=[],d._playLock=!1,d._onend=h.onend?[{fn:h.onend}]:[],d._onfade=h.onfade?[{fn:h.onfade}]:[],d._onload=h.onload?[{fn:h.onload}]:[],d._onloaderror=h.onloaderror?[{fn:h.onloaderror}]:[],d._onplayerror=h.onplayerror?[{fn:h.onplayerror}]:[],d._onpause=h.onpause?[{fn:h.onpause}]:[],d._onplay=h.onplay?[{fn:h.onplay}]:[],d._onstop=h.onstop?[{fn:h.onstop}]:[],d._onmute=h.onmute?[{fn:h.onmute}]:[],d._onvolume=h.onvolume?[{fn:h.onvolume}]:[],d._onrate=h.onrate?[{fn:h.onrate}]:[],d._onseek=h.onseek?[{fn:h.onseek}]:[],d._onunlock=h.onunlock?[{fn:h.onunlock}]:[],d._onresume=[],d._webAudio=i.usingWebAudio&&!d._html5,typeof i.ctx<"u"&&i.ctx&&i.autoUnlock&&i._unlockAudio(),i._howls.push(d),d._autoplay&&d._queue.push({event:"play",action:function(){d.play()}}),d._preload&&d._preload!=="none"&&d.load(),d},load:function(){var h=this,d=null;if(i.noAudio){h._emit("loaderror",null,"No audio support.");return}typeof h._src=="string"&&(h._src=[h._src]);for(var p=0;p<h._src.length;p++){var f,m;if(h._format&&h._format[p])f=h._format[p];else{if(m=h._src[p],typeof m!="string"){h._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}f=/^data:audio\/([^;,]+);/i.exec(m),f||(f=/\.([^.]+)$/.exec(m.split("?",1)[0])),f&&(f=f[1].toLowerCase())}if(f||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),f&&i.codecs(f)){d=h._src[p];break}}if(!d){h._emit("loaderror",null,"No codec support for selected audio sources.");return}return h._src=d,h._state="loading",window.location.protocol==="https:"&&d.slice(0,5)==="http:"&&(h._html5=!0,h._webAudio=!1),new a(h),h._webAudio&&n(h),h},play:function(h,d){var p=this,f=null;if(typeof h=="number")f=h,h=null;else{if(typeof h=="string"&&p._state==="loaded"&&!p._sprite[h])return null;if(typeof h>"u"&&(h="__default",!p._playLock)){for(var m=0,g=0;g<p._sounds.length;g++)p._sounds[g]._paused&&!p._sounds[g]._ended&&(m++,f=p._sounds[g]._id);m===1?h=null:f=null}}var v=f?p._soundById(f):p._inactiveSound();if(!v)return null;if(f&&!h&&(h=v._sprite||"__default"),p._state!=="loaded"){v._sprite=h,v._ended=!1;var y=v._id;return p._queue.push({event:"play",action:function(){p.play(y)}}),y}if(f&&!v._paused)return d||p._loadQueue("play"),v._id;p._webAudio&&i._autoResume();var x=Math.max(0,v._seek>0?v._seek:p._sprite[h][0]/1e3),w=Math.max(0,(p._sprite[h][0]+p._sprite[h][1])/1e3-x),S=w*1e3/Math.abs(v._rate),_=p._sprite[h][0]/1e3,A=(p._sprite[h][0]+p._sprite[h][1])/1e3;v._sprite=h,v._ended=!1;var E=function(){v._paused=!1,v._seek=x,v._start=_,v._stop=A,v._loop=!!(v._loop||p._sprite[h][2])};if(x>=A){p._ended(v);return}var M=v._node;if(p._webAudio){var C=function(){p._playLock=!1,E(),p._refreshBuffer(v);var O=v._muted||p._muted?0:v._volume;M.gain.setValueAtTime(O,i.ctx.currentTime),v._playStart=i.ctx.currentTime,typeof M.bufferSource.start>"u"?v._loop?M.bufferSource.noteGrainOn(0,x,86400):M.bufferSource.noteGrainOn(0,x,w):v._loop?M.bufferSource.start(0,x,86400):M.bufferSource.start(0,x,w),S!==1/0&&(p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),S)),d||setTimeout(function(){p._emit("play",v._id),p._loadQueue()},0)};i.state==="running"&&i.ctx.state!=="interrupted"?C():(p._playLock=!0,p.once("resume",C),p._clearTimer(v._id))}else{var T=function(){M.currentTime=x,M.muted=v._muted||p._muted||i._muted||M.muted,M.volume=v._volume*i.volume(),M.playbackRate=v._rate;try{var O=M.play();if(O&&typeof Promise<"u"&&(O instanceof Promise||typeof O.then=="function")?(p._playLock=!0,E(),O.then(function(){p._playLock=!1,M._unlocked=!0,d?p._loadQueue():p._emit("play",v._id)}).catch(function(){p._playLock=!1,p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):d||(p._playLock=!1,E(),p._emit("play",v._id)),M.playbackRate=v._rate,M.paused){p._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}h!=="__default"||v._loop?p._endTimers[v._id]=setTimeout(p._ended.bind(p,v),S):(p._endTimers[v._id]=function(){p._ended(v),M.removeEventListener("ended",p._endTimers[v._id],!1)},M.addEventListener("ended",p._endTimers[v._id],!1))}catch(B){p._emit("playerror",v._id,B)}};M.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(M.src=p._src,M.load());var D=window&&window.ejecta||!M.readyState&&i._navigator.isCocoonJS;if(M.readyState>=3||D)T();else{p._playLock=!0,p._state="loading";var I=function(){p._state="loaded",T(),M.removeEventListener(i._canPlayEvent,I,!1)};M.addEventListener(i._canPlayEvent,I,!1),p._clearTimer(v._id)}}return v._id},pause:function(h){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"pause",action:function(){d.pause(h)}}),d;for(var p=d._getSoundIds(h),f=0;f<p.length;f++){d._clearTimer(p[f]);var m=d._soundById(p[f]);if(m&&!m._paused&&(m._seek=d.seek(p[f]),m._rateSeek=0,m._paused=!0,d._stopFade(p[f]),m._node))if(d._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),d._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||d._emit("pause",m?m._id:null)}return d},stop:function(h,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"stop",action:function(){p.stop(h)}}),p;for(var f=p._getSoundIds(h),m=0;m<f.length;m++){p._clearTimer(f[m]);var g=p._soundById(f[m]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,p._stopFade(f[m]),g._node&&(p._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),p._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&p._clearSound(g._node))),d||p._emit("stop",g._id))}return p},mute:function(h,d){var p=this;if(p._state!=="loaded"||p._playLock)return p._queue.push({event:"mute",action:function(){p.mute(h,d)}}),p;if(typeof d>"u")if(typeof h=="boolean")p._muted=h;else return p._muted;for(var f=p._getSoundIds(d),m=0;m<f.length;m++){var g=p._soundById(f[m]);g&&(g._muted=h,g._interval&&p._stopFade(g._id),p._webAudio&&g._node?g._node.gain.setValueAtTime(h?0:g._volume,i.ctx.currentTime):g._node&&(g._node.muted=i._muted?!0:h),p._emit("mute",g._id))}return p},volume:function(){var h=this,d=arguments,p,f;if(d.length===0)return h._volume;if(d.length===1||d.length===2&&typeof d[1]>"u"){var m=h._getSoundIds(),g=m.indexOf(d[0]);g>=0?f=parseInt(d[0],10):p=parseFloat(d[0])}else d.length>=2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));var v;if(typeof p<"u"&&p>=0&&p<=1){if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"volume",action:function(){h.volume.apply(h,d)}}),h;typeof f>"u"&&(h._volume=p),f=h._getSoundIds(f);for(var y=0;y<f.length;y++)v=h._soundById(f[y]),v&&(v._volume=p,d[2]||h._stopFade(f[y]),h._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(p,i.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=p*i.volume()),h._emit("volume",v._id))}else return v=f?h._soundById(f):h._sounds[0],v?v._volume:0;return h},fade:function(h,d,p,f){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(h,d,p,f)}}),m;h=Math.min(Math.max(0,parseFloat(h)),1),d=Math.min(Math.max(0,parseFloat(d)),1),p=parseFloat(p),m.volume(h,f);for(var g=m._getSoundIds(f),v=0;v<g.length;v++){var y=m._soundById(g[v]);if(y){if(f||m._stopFade(g[v]),m._webAudio&&!y._muted){var x=i.ctx.currentTime,w=x+p/1e3;y._volume=h,y._node.gain.setValueAtTime(h,x),y._node.gain.linearRampToValueAtTime(d,w)}m._startFadeInterval(y,h,d,p,g[v],typeof f>"u")}}return m},_startFadeInterval:function(h,d,p,f,m,g){var v=this,y=d,x=p-d,w=Math.abs(x/.01),S=Math.max(4,w>0?f/w:f),_=Date.now();h._fadeTo=p,h._interval=setInterval(function(){var A=(Date.now()-_)/f;_=Date.now(),y+=x*A,y=Math.round(y*100)/100,x<0?y=Math.max(p,y):y=Math.min(p,y),v._webAudio?h._volume=y:v.volume(y,h._id,!0),g&&(v._volume=y),(p<d&&y<=p||p>d&&y>=p)&&(clearInterval(h._interval),h._interval=null,h._fadeTo=null,v.volume(p,h._id),v._emit("fade",h._id))},S)},_stopFade:function(h){var d=this,p=d._soundById(h);return p&&p._interval&&(d._webAudio&&p._node.gain.cancelScheduledValues(i.ctx.currentTime),clearInterval(p._interval),p._interval=null,d.volume(p._fadeTo,h),p._fadeTo=null,d._emit("fade",h)),d},loop:function(){var h=this,d=arguments,p,f,m;if(d.length===0)return h._loop;if(d.length===1)if(typeof d[0]=="boolean")p=d[0],h._loop=p;else return m=h._soundById(parseInt(d[0],10)),m?m._loop:!1;else d.length===2&&(p=d[0],f=parseInt(d[1],10));for(var g=h._getSoundIds(f),v=0;v<g.length;v++)m=h._soundById(g[v]),m&&(m._loop=p,h._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=p,p&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,h.playing(g[v])&&(h.pause(g[v],!0),h.play(g[v],!0)))));return h},rate:function(){var h=this,d=arguments,p,f;if(d.length===0)f=h._sounds[0]._id;else if(d.length===1){var m=h._getSoundIds(),g=m.indexOf(d[0]);g>=0?f=parseInt(d[0],10):p=parseFloat(d[0])}else d.length===2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));var v;if(typeof p=="number"){if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"rate",action:function(){h.rate.apply(h,d)}}),h;typeof f>"u"&&(h._rate=p),f=h._getSoundIds(f);for(var y=0;y<f.length;y++)if(v=h._soundById(f[y]),v){h.playing(f[y])&&(v._rateSeek=h.seek(f[y]),v._playStart=h._webAudio?i.ctx.currentTime:v._playStart),v._rate=p,h._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(p,i.ctx.currentTime):v._node&&(v._node.playbackRate=p);var x=h.seek(f[y]),w=(h._sprite[v._sprite][0]+h._sprite[v._sprite][1])/1e3-x,S=w*1e3/Math.abs(v._rate);(h._endTimers[f[y]]||!v._paused)&&(h._clearTimer(f[y]),h._endTimers[f[y]]=setTimeout(h._ended.bind(h,v),S)),h._emit("rate",v._id)}}else return v=h._soundById(f),v?v._rate:h._rate;return h},seek:function(){var h=this,d=arguments,p,f;if(d.length===0)h._sounds.length&&(f=h._sounds[0]._id);else if(d.length===1){var m=h._getSoundIds(),g=m.indexOf(d[0]);g>=0?f=parseInt(d[0],10):h._sounds.length&&(f=h._sounds[0]._id,p=parseFloat(d[0]))}else d.length===2&&(p=parseFloat(d[0]),f=parseInt(d[1],10));if(typeof f>"u")return 0;if(typeof p=="number"&&(h._state!=="loaded"||h._playLock))return h._queue.push({event:"seek",action:function(){h.seek.apply(h,d)}}),h;var v=h._soundById(f);if(v)if(typeof p=="number"&&p>=0){var y=h.playing(f);y&&h.pause(f,!0),v._seek=p,v._ended=!1,h._clearTimer(f),!h._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=p);var x=function(){y&&h.play(f,!0),h._emit("seek",f)};if(y&&!h._webAudio){var w=function(){h._playLock?setTimeout(w,0):x()};setTimeout(w,0)}else x()}else if(h._webAudio){var S=h.playing(f)?i.ctx.currentTime-v._playStart:0,_=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(_+S*Math.abs(v._rate))}else return v._node.currentTime;return h},playing:function(h){var d=this;if(typeof h=="number"){var p=d._soundById(h);return p?!p._paused:!1}for(var f=0;f<d._sounds.length;f++)if(!d._sounds[f]._paused)return!0;return!1},duration:function(h){var d=this,p=d._duration,f=d._soundById(h);return f&&(p=d._sprite[f._sprite][1]/1e3),p},state:function(){return this._state},unload:function(){for(var h=this,d=h._sounds,p=0;p<d.length;p++)d[p]._paused||h.stop(d[p]._id),h._webAudio||(h._clearSound(d[p]._node),d[p]._node.removeEventListener("error",d[p]._errorFn,!1),d[p]._node.removeEventListener(i._canPlayEvent,d[p]._loadFn,!1),d[p]._node.removeEventListener("ended",d[p]._endFn,!1),i._releaseHtml5Audio(d[p]._node)),delete d[p]._node,h._clearTimer(d[p]._id);var f=i._howls.indexOf(h);f>=0&&i._howls.splice(f,1);var m=!0;for(p=0;p<i._howls.length;p++)if(i._howls[p]._src===h._src||h._src.indexOf(i._howls[p]._src)>=0){m=!1;break}return s&&m&&delete s[h._src],i.noAudio=!1,h._state="unloaded",h._sounds=[],h=null,null},on:function(h,d,p,f){var m=this,g=m["_on"+h];return typeof d=="function"&&g.push(f?{id:p,fn:d,once:f}:{id:p,fn:d}),m},off:function(h,d,p){var f=this,m=f["_on"+h],g=0;if(typeof d=="number"&&(p=d,d=null),d||p)for(g=0;g<m.length;g++){var v=p===m[g].id;if(d===m[g].fn&&v||!d&&v){m.splice(g,1);break}}else if(h)f["_on"+h]=[];else{var y=Object.keys(f);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(f[y[g]])&&(f[y[g]]=[])}return f},once:function(h,d,p){var f=this;return f.on(h,d,p,1),f},_emit:function(h,d,p){for(var f=this,m=f["_on"+h],g=m.length-1;g>=0;g--)(!m[g].id||m[g].id===d||h==="load")&&(setTimeout((function(v){v.call(this,d,p)}).bind(f,m[g].fn),0),m[g].once&&f.off(h,m[g].fn,m[g].id));return f._loadQueue(h),f},_loadQueue:function(h){var d=this;if(d._queue.length>0){var p=d._queue[0];p.event===h&&(d._queue.shift(),d._loadQueue()),h||p.action()}return d},_ended:function(h){var d=this,p=h._sprite;if(!d._webAudio&&h._node&&!h._node.paused&&!h._node.ended&&h._node.currentTime<h._stop)return setTimeout(d._ended.bind(d,h),100),d;var f=!!(h._loop||d._sprite[p][2]);if(d._emit("end",h._id),!d._webAudio&&f&&d.stop(h._id,!0).play(h._id),d._webAudio&&f){d._emit("play",h._id),h._seek=h._start||0,h._rateSeek=0,h._playStart=i.ctx.currentTime;var m=(h._stop-h._start)*1e3/Math.abs(h._rate);d._endTimers[h._id]=setTimeout(d._ended.bind(d,h),m)}return d._webAudio&&!f&&(h._paused=!0,h._ended=!0,h._seek=h._start||0,h._rateSeek=0,d._clearTimer(h._id),d._cleanBuffer(h._node),i._autoSuspend()),!d._webAudio&&!f&&d.stop(h._id,!0),d},_clearTimer:function(h){var d=this;if(d._endTimers[h]){if(typeof d._endTimers[h]!="function")clearTimeout(d._endTimers[h]);else{var p=d._soundById(h);p&&p._node&&p._node.removeEventListener("ended",d._endTimers[h],!1)}delete d._endTimers[h]}return d},_soundById:function(h){for(var d=this,p=0;p<d._sounds.length;p++)if(h===d._sounds[p]._id)return d._sounds[p];return null},_inactiveSound:function(){var h=this;h._drain();for(var d=0;d<h._sounds.length;d++)if(h._sounds[d]._ended)return h._sounds[d].reset();return new a(h)},_drain:function(){var h=this,d=h._pool,p=0,f=0;if(!(h._sounds.length<d)){for(f=0;f<h._sounds.length;f++)h._sounds[f]._ended&&p++;for(f=h._sounds.length-1;f>=0;f--){if(p<=d)return;h._sounds[f]._ended&&(h._webAudio&&h._sounds[f]._node&&h._sounds[f]._node.disconnect(0),h._sounds.splice(f,1),p--)}}},_getSoundIds:function(h){var d=this;if(typeof h>"u"){for(var p=[],f=0;f<d._sounds.length;f++)p.push(d._sounds[f]._id);return p}else return[h]},_refreshBuffer:function(h){var d=this;return h._node.bufferSource=i.ctx.createBufferSource(),h._node.bufferSource.buffer=s[d._src],h._panner?h._node.bufferSource.connect(h._panner):h._node.bufferSource.connect(h._node),h._node.bufferSource.loop=h._loop,h._loop&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop||0),h._node.bufferSource.playbackRate.setValueAtTime(h._rate,i.ctx.currentTime),d},_cleanBuffer:function(h){var d=this,p=i._navigator&&i._navigator.vendor.indexOf("Apple")>=0;if(i._scratchBuffer&&h.bufferSource&&(h.bufferSource.onended=null,h.bufferSource.disconnect(0),p))try{h.bufferSource.buffer=i._scratchBuffer}catch{}return h.bufferSource=null,d},_clearSound:function(h){var d=/MSIE |Trident\//.test(i._navigator&&i._navigator.userAgent);d||(h.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(h){this._parent=h,this.init()};a.prototype={init:function(){var h=this,d=h._parent;return h._muted=d._muted,h._loop=d._loop,h._volume=d._volume,h._rate=d._rate,h._seek=0,h._paused=!0,h._ended=!0,h._sprite="__default",h._id=++i._counter,d._sounds.push(h),h.create(),h},create:function(){var h=this,d=h._parent,p=i._muted||h._muted||h._parent._muted?0:h._volume;return d._webAudio?(h._node=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),h._node.gain.setValueAtTime(p,i.ctx.currentTime),h._node.paused=!0,h._node.connect(i.masterGain)):i.noAudio||(h._node=i._obtainHtml5Audio(),h._errorFn=h._errorListener.bind(h),h._node.addEventListener("error",h._errorFn,!1),h._loadFn=h._loadListener.bind(h),h._node.addEventListener(i._canPlayEvent,h._loadFn,!1),h._endFn=h._endListener.bind(h),h._node.addEventListener("ended",h._endFn,!1),h._node.src=d._src,h._node.preload=d._preload===!0?"auto":d._preload,h._node.volume=p*i.volume(),h._node.load()),h},reset:function(){var h=this,d=h._parent;return h._muted=d._muted,h._loop=d._loop,h._volume=d._volume,h._rate=d._rate,h._seek=0,h._rateSeek=0,h._paused=!0,h._ended=!0,h._sprite="__default",h._id=++i._counter,h},_errorListener:function(){var h=this;h._parent._emit("loaderror",h._id,h._node.error?h._node.error.code:0),h._node.removeEventListener("error",h._errorFn,!1)},_loadListener:function(){var h=this,d=h._parent;d._duration=Math.ceil(h._node.duration*10)/10,Object.keys(d._sprite).length===0&&(d._sprite={__default:[0,d._duration*1e3]}),d._state!=="loaded"&&(d._state="loaded",d._emit("load"),d._loadQueue()),h._node.removeEventListener(i._canPlayEvent,h._loadFn,!1)},_endListener:function(){var h=this,d=h._parent;d._duration===1/0&&(d._duration=Math.ceil(h._node.duration*10)/10,d._sprite.__default[1]===1/0&&(d._sprite.__default[1]=d._duration*1e3),d._ended(h)),h._node.removeEventListener("ended",h._endFn,!1)}};var s={},n=function(h){var d=h._src;if(s[d]){h._duration=s[d].duration,c(h);return}if(/^data:[^;]+;base64,/.test(d)){for(var p=atob(d.split(",")[1]),f=new Uint8Array(p.length),m=0;m<p.length;++m)f[m]=p.charCodeAt(m);l(f.buffer,h)}else{var g=new XMLHttpRequest;g.open(h._xhr.method,d,!0),g.withCredentials=h._xhr.withCredentials,g.responseType="arraybuffer",h._xhr.headers&&Object.keys(h._xhr.headers).forEach(function(v){g.setRequestHeader(v,h._xhr.headers[v])}),g.onload=function(){var v=(g.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){h._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}l(g.response,h)},g.onerror=function(){h._webAudio&&(h._html5=!0,h._webAudio=!1,h._sounds=[],delete s[d],h.load())},o(g)}},o=function(h){try{h.send()}catch{h.onerror()}},l=function(h,d){var p=function(){d._emit("loaderror",null,"Decoding audio data failed.")},f=function(m){m&&d._sounds.length>0?(s[d._src]=m,c(d,m)):p()};typeof Promise<"u"&&i.ctx.decodeAudioData.length===1?i.ctx.decodeAudioData(h).then(f).catch(p):i.ctx.decodeAudioData(h,f,p)},c=function(h,d){d&&!h._duration&&(h._duration=d.duration),Object.keys(h._sprite).length===0&&(h._sprite={__default:[0,h._duration*1e3]}),h._state!=="loaded"&&(h._state="loaded",h._emit("load"),h._loadQueue())},u=function(){if(i.usingWebAudio){try{typeof AudioContext<"u"?i.ctx=new AudioContext:typeof webkitAudioContext<"u"?i.ctx=new webkitAudioContext:i.usingWebAudio=!1}catch{i.usingWebAudio=!1}i.ctx||(i.usingWebAudio=!1);var h=/iP(hone|od|ad)/.test(i._navigator&&i._navigator.platform),d=i._navigator&&i._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),p=d?parseInt(d[1],10):null;if(h&&p&&p<9){var f=/safari/.test(i._navigator&&i._navigator.userAgent.toLowerCase());i._navigator&&!f&&(i.usingWebAudio=!1)}i.usingWebAudio&&(i.masterGain=typeof i.ctx.createGain>"u"?i.ctx.createGainNode():i.ctx.createGain(),i.masterGain.gain.setValueAtTime(i._muted?0:i._volume,i.ctx.currentTime),i.masterGain.connect(i.ctx.destination)),i._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:i,Howl:r}}),typeof e<"u"&&(e.Howler=i,e.Howl=r),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=i,global.Howl=r,global.Sound=a):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=i,window.Howl=r,window.Sound=a)})(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(i){var r=this;if(!r.ctx||!r.ctx.listener)return r;for(var a=r._howls.length-1;a>=0;a--)r._howls[a].stereo(i);return r},HowlerGlobal.prototype.pos=function(i,r,a){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(r=typeof r!="number"?s._pos[1]:r,a=typeof a!="number"?s._pos[2]:a,typeof i=="number")s._pos=[i,r,a],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(i,r,a,s,n,o){var l=this;if(!l.ctx||!l.ctx.listener)return l;var c=l._orientation;if(r=typeof r!="number"?c[1]:r,a=typeof a!="number"?c[2]:a,s=typeof s!="number"?c[3]:s,n=typeof n!="number"?c[4]:n,o=typeof o!="number"?c[5]:o,typeof i=="number")l._orientation=[i,r,a,s,n,o],typeof l.ctx.listener.forwardX<"u"?(l.ctx.listener.forwardX.setTargetAtTime(i,Howler.ctx.currentTime,.1),l.ctx.listener.forwardY.setTargetAtTime(r,Howler.ctx.currentTime,.1),l.ctx.listener.forwardZ.setTargetAtTime(a,Howler.ctx.currentTime,.1),l.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),l.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),l.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):l.ctx.listener.setOrientation(i,r,a,s,n,o);else return c;return l},Howl.prototype.init=function(i){return function(r){var a=this;return a._orientation=r.orientation||[1,0,0],a._stereo=r.stereo||null,a._pos=r.pos||null,a._pannerAttr={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:360,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:360,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:0,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:"inverse",maxDistance:typeof r.maxDistance<"u"?r.maxDistance:1e4,panningModel:typeof r.panningModel<"u"?r.panningModel:"HRTF",refDistance:typeof r.refDistance<"u"?r.refDistance:1,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:1},a._onstereo=r.onstereo?[{fn:r.onstereo}]:[],a._onpos=r.onpos?[{fn:r.onpos}]:[],a._onorientation=r.onorientation?[{fn:r.onorientation}]:[],i.call(this,r)}}(Howl.prototype.init),Howl.prototype.stereo=function(i,r){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"stereo",action:function(){a.stereo(i,r)}}),a;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof r>"u")if(typeof i=="number")a._stereo=i,a._pos=[i,0,0];else return a._stereo;for(var n=a._getSoundIds(r),o=0;o<n.length;o++){var l=a._soundById(n[o]);if(l)if(typeof i=="number")l._stereo=i,l._pos=[i,0,0],l._node&&(l._pannerAttr.panningModel="equalpower",(!l._panner||!l._panner.pan)&&t(l,s),s==="spatial"?typeof l._panner.positionX<"u"?(l._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):l._panner.setPosition(i,0,0):l._panner.pan.setValueAtTime(i,Howler.ctx.currentTime)),a._emit("stereo",l._id);else return l._stereo}return a},Howl.prototype.pos=function(i,r,a,s){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"pos",action:function(){n.pos(i,r,a,s)}}),n;if(r=typeof r!="number"?0:r,a=typeof a!="number"?-.5:a,typeof s>"u")if(typeof i=="number")n._pos=[i,r,a];else return n._pos;for(var o=n._getSoundIds(s),l=0;l<o.length;l++){var c=n._soundById(o[l]);if(c)if(typeof i=="number")c._pos=[i,r,a],c._node&&((!c._panner||c._panner.pan)&&t(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(a,Howler.ctx.currentTime)):c._panner.setPosition(i,r,a)),n._emit("pos",c._id);else return c._pos}return n},Howl.prototype.orientation=function(i,r,a,s){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"orientation",action:function(){n.orientation(i,r,a,s)}}),n;if(r=typeof r!="number"?n._orientation[1]:r,a=typeof a!="number"?n._orientation[2]:a,typeof s>"u")if(typeof i=="number")n._orientation=[i,r,a];else return n._orientation;for(var o=n._getSoundIds(s),l=0;l<o.length;l++){var c=n._soundById(o[l]);if(c)if(typeof i=="number")c._orientation=[i,r,a],c._node&&(c._panner||(c._pos||(c._pos=n._pos||[0,0,-.5]),t(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(i,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(r,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(a,Howler.ctx.currentTime)):c._panner.setOrientation(i,r,a)),n._emit("orientation",c._id);else return c._orientation}return n},Howl.prototype.pannerAttr=function(){var i=this,r=arguments,a,s,n;if(!i._webAudio)return i;if(r.length===0)return i._pannerAttr;if(r.length===1)if(typeof r[0]=="object")a=r[0],typeof s>"u"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),i._pannerAttr={coneInnerAngle:typeof a.pannerAttr.coneInnerAngle<"u"?a.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:typeof a.pannerAttr.coneOuterAngle<"u"?a.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:typeof a.pannerAttr.coneOuterGain<"u"?a.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:typeof a.pannerAttr.distanceModel<"u"?a.pannerAttr.distanceModel:i._distanceModel,maxDistance:typeof a.pannerAttr.maxDistance<"u"?a.pannerAttr.maxDistance:i._maxDistance,refDistance:typeof a.pannerAttr.refDistance<"u"?a.pannerAttr.refDistance:i._refDistance,rolloffFactor:typeof a.pannerAttr.rolloffFactor<"u"?a.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:typeof a.pannerAttr.panningModel<"u"?a.pannerAttr.panningModel:i._panningModel});else return n=i._soundById(parseInt(r[0],10)),n?n._pannerAttr:i._pannerAttr;else r.length===2&&(a=r[0],s=parseInt(r[1],10));for(var o=i._getSoundIds(s),l=0;l<o.length;l++)if(n=i._soundById(o[l]),n){var c=n._pannerAttr;c={coneInnerAngle:typeof a.coneInnerAngle<"u"?a.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof a.coneOuterAngle<"u"?a.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof a.coneOuterGain<"u"?a.coneOuterGain:c.coneOuterGain,distanceModel:typeof a.distanceModel<"u"?a.distanceModel:c.distanceModel,maxDistance:typeof a.maxDistance<"u"?a.maxDistance:c.maxDistance,refDistance:typeof a.refDistance<"u"?a.refDistance:c.refDistance,rolloffFactor:typeof a.rolloffFactor<"u"?a.rolloffFactor:c.rolloffFactor,panningModel:typeof a.panningModel<"u"?a.panningModel:c.panningModel};var u=n._panner;u?(u.coneInnerAngle=c.coneInnerAngle,u.coneOuterAngle=c.coneOuterAngle,u.coneOuterGain=c.coneOuterGain,u.distanceModel=c.distanceModel,u.maxDistance=c.maxDistance,u.refDistance=c.refDistance,u.rolloffFactor=c.rolloffFactor,u.panningModel=c.panningModel):(n._pos||(n._pos=i._pos||[0,0,-.5]),t(n,"spatial"))}return i},Sound.prototype.init=function(i){return function(){var r=this,a=r._parent;r._orientation=a._orientation,r._stereo=a._stereo,r._pos=a._pos,r._pannerAttr=a._pannerAttr,i.call(this),r._stereo?a.stereo(r._stereo):r._pos&&a.pos(r._pos[0],r._pos[1],r._pos[2],r._id)}}(Sound.prototype.init),Sound.prototype.reset=function(i){return function(){var r=this,a=r._parent;return r._orientation=a._orientation,r._stereo=a._stereo,r._pos=a._pos,r._pannerAttr=a._pannerAttr,r._stereo?a.stereo(r._stereo):r._pos?a.pos(r._pos[0],r._pos[1],r._pos[2],r._id):r._panner&&(r._panner.disconnect(0),r._panner=void 0,a._refreshBuffer(r)),i.call(this)}}(Sound.prototype.reset);var t=function(i,r){r=r||"spatial",r==="spatial"?(i._panner=Howler.ctx.createPanner(),i._panner.coneInnerAngle=i._pannerAttr.coneInnerAngle,i._panner.coneOuterAngle=i._pannerAttr.coneOuterAngle,i._panner.coneOuterGain=i._pannerAttr.coneOuterGain,i._panner.distanceModel=i._pannerAttr.distanceModel,i._panner.maxDistance=i._pannerAttr.maxDistance,i._panner.refDistance=i._pannerAttr.refDistance,i._panner.rolloffFactor=i._pannerAttr.rolloffFactor,i._panner.panningModel=i._pannerAttr.panningModel,typeof i._panner.positionX<"u"?(i._panner.positionX.setValueAtTime(i._pos[0],Howler.ctx.currentTime),i._panner.positionY.setValueAtTime(i._pos[1],Howler.ctx.currentTime),i._panner.positionZ.setValueAtTime(i._pos[2],Howler.ctx.currentTime)):i._panner.setPosition(i._pos[0],i._pos[1],i._pos[2]),typeof i._panner.orientationX<"u"?(i._panner.orientationX.setValueAtTime(i._orientation[0],Howler.ctx.currentTime),i._panner.orientationY.setValueAtTime(i._orientation[1],Howler.ctx.currentTime),i._panner.orientationZ.setValueAtTime(i._orientation[2],Howler.ctx.currentTime)):i._panner.setOrientation(i._orientation[0],i._orientation[1],i._orientation[2])):(i._panner=Howler.ctx.createStereoPanner(),i._panner.pan.setValueAtTime(i._stereo,Howler.ctx.currentTime)),i._panner.connect(i._node),i._paused||i._parent.pause(i._id,!0).play(i._id,!0)}}()}),h8=Pr((e,t)=>{function i(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function r(s,n,o,l){this.message=s,this.expected=n,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,n){var o={literal:function(f){return'"'+c(f.text)+'"'},class:function(f){var m="",g;for(g=0;g<f.parts.length;g++)m+=f.parts[g]instanceof Array?u(f.parts[g][0])+"-"+u(f.parts[g][1]):u(f.parts[g]);return"["+(f.inverted?"^":"")+m+"]"},any:function(f){return"any character"},end:function(f){return"end of input"},other:function(f){return f.description}};function l(f){return f.charCodeAt(0).toString(16).toUpperCase()}function c(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+l(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+l(m)})}function u(f){return f.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+l(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+l(m)})}function h(f){return o[f.type](f)}function d(f){var m=new Array(f.length),g,v;for(g=0;g<f.length;g++)m[g]=h(f[g]);if(m.sort(),m.length>0){for(g=1,v=1;g<m.length;g++)m[g-1]!==m[g]&&(m[v]=m[g],v++);m.length=v}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function p(f){return f?'"'+c(f)+'"':"end of input"}return"Expected "+d(s)+" but "+p(n)+" found."};function a(s,n){n=n!==void 0?n:{};var o={},l={svg_path:vi},c=vi,u=function(R){if(!R)return[];for(var z=[],K=0;K<R.length;K++)z=z.concat.apply(z,R[K]);var j=z[0];return j&&j.code=="m"&&(delete j.relative,j.code="M"),z},h=function(R,z){return oo(R,z)},d=/^[Mm]/,p=ze(["M","m"],!1,!1),f=function(R,z,K){var j=mn(R,[z]);return K&&(j=j.concat(mn(R=="M"?"L":"l",K[1]))),j},m=/^[Zz]/,g=ze(["Z","z"],!1,!1),v=function(){return mn("Z")},y=/^[Ll]/,x=ze(["L","l"],!1,!1),w=function(R,z){return mn(R,z)},S=/^[Hh]/,_=ze(["H","h"],!1,!1),A=function(R,z){return mn(R,z.map(function(K){return{x:K}}))},E=/^[Vv]/,M=ze(["V","v"],!1,!1),C=function(R,z){return mn(R,z.map(function(K){return{y:K}}))},T=/^[Cc]/,D=ze(["C","c"],!1,!1),I=function(R,z,K){return{x1:R.x,y1:R.y,x2:z.x,y2:z.y,x:K.x,y:K.y}},O=/^[Ss]/,B=ze(["S","s"],!1,!1),q=function(R,z){return{x2:R.x,y2:R.y,x:z.x,y:z.y}},F=/^[Qq]/,L=ze(["Q","q"],!1,!1),X=function(R,z){return{x1:R.x,y1:R.y,x:z.x,y:z.y}},G=/^[Tt]/,U=ze(["T","t"],!1,!1),H=/^[Aa]/,$=ze(["A","a"],!1,!1),Y=function(R,z,K,j,te,Ee){return{rx:R,ry:z,xAxisRotation:K,largeArc:j,sweep:te,x:Ee.x,y:Ee.y}},J=function(R,z){return{x:R,y:z}},Z=function(R){return R*1},ne=function(R){return R.join("")*1},re=/^[01]/,ie=ze(["0","1"],!1,!1),le=function(R){return R=="1"},ue=function(){return""},fe=",",be=We(",",!1),ke=function(R){return R.join("")},Ce=".",Ve=We(".",!1),je=/^[eE]/,Pe=ze(["e","E"],!1,!1),Me=/^[+\-]/,Ze=ze(["+","-"],!1,!1),qe=/^[0-9]/,W=ze([["0","9"]],!1,!1),N=function(R){return R.join("")},oe=/^[ \t\n\r]/,Ae=ze([" ","	",`
`,"\r"],!1,!1),k=0,De=[{line:1,column:1}],Ue=0,Le=[],de;if("startRule"in n){if(!(n.startRule in l))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');c=l[n.startRule]}function We(R,z){return{type:"literal",text:R,ignoreCase:z}}function ze(R,z,K){return{type:"class",parts:R,inverted:z,ignoreCase:K}}function Xe(){return{type:"end"}}function it(R){var z=De[R],K;if(z)return z;for(K=R-1;!De[K];)K--;for(z=De[K],z={line:z.line,column:z.column};K<R;)s.charCodeAt(K)===10?(z.line++,z.column=1):z.column++,K++;return De[R]=z,z}function Ke(R,z){var K=it(R),j=it(z);return{start:{offset:R,line:K.line,column:K.column},end:{offset:z,line:j.line,column:j.column}}}function et(R){k<Ue||(k>Ue&&(Ue=k,Le=[]),Le.push(R))}function ii(R,z,K){return new r(r.buildMessage(R,z),R,z,K)}function vi(){var R,z,K,j,te;for(R=k,z=[],K=At();K!==o;)z.push(K),K=At();if(z!==o)if(K=ee(),K===o&&(K=null),K!==o){for(j=[],te=At();te!==o;)j.push(te),te=At();j!==o?(z=u(K),R=z):(k=R,R=o)}else k=R,R=o;else k=R,R=o;return R}function ee(){var R,z,K,j,te,Ee;if(R=k,z=me(),z!==o){for(K=[],j=k,te=[],Ee=At();Ee!==o;)te.push(Ee),Ee=At();for(te!==o?(Ee=me(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;){for(K.push(j),j=k,te=[],Ee=At();Ee!==o;)te.push(Ee),Ee=At();te!==o?(Ee=me(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o)}K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function me(){var R,z,K,j,te,Ee;if(R=k,z=Ne(),z!==o){for(K=[],j=k,te=[],Ee=At();Ee!==o;)te.push(Ee),Ee=At();for(te!==o?(Ee=_e(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;){for(K.push(j),j=k,te=[],Ee=At();Ee!==o;)te.push(Ee),Ee=At();te!==o?(Ee=_e(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o)}K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function _e(){var R;return R=st(),R===o&&(R=Pt(),R===o&&(R=gr(),R===o&&(R=oi(),R===o&&(R=Rs(),R===o&&(R=nx(),R===o&&(R=V(),R===o&&(R=se(),R===o&&(R=Ye())))))))),R}function Ne(){var R,z,K,j,te,Ee,lo;if(R=k,d.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(p)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=nt(),j!==o?(te=k,Ee=_t(),Ee===o&&(Ee=null),Ee!==o?(lo=ki(),lo!==o?(Ee=[Ee,lo],te=Ee):(k=te,te=o)):(k=te,te=o),te===o&&(te=null),te!==o?(z=f(z,j,te),R=z):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function st(){var R,z;return R=k,m.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(g)),z!==o&&(z=v()),R=z,R}function Pt(){var R,z,K,j;if(R=k,y.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(x)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=ki(),j!==o?(z=w(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function ki(){var R,z,K,j,te,Ee;if(R=k,z=nt(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=nt(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=nt(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function gr(){var R,z,K,j;if(R=k,S.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(_)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=fn(),j!==o?(z=A(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function fn(){var R,z,K,j,te,Ee;if(R=k,z=Ct(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=Ct(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=Ct(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function oi(){var R,z,K,j;if(R=k,E.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(M)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=fn(),j!==o?(z=C(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function Rs(){var R,z,K,j;if(R=k,T.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(D)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=Ea(),j!==o?(z=w(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function Ea(){var R,z,K,j,te,Ee;if(R=k,z=Dh(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=Dh(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=Dh(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function Dh(){var R,z,K,j,te,Ee;return R=k,z=nt(),z!==o?(K=_t(),K===o&&(K=null),K!==o?(j=nt(),j!==o?(te=_t(),te===o&&(te=null),te!==o?(Ee=nt(),Ee!==o?(z=I(z,j,Ee),R=z):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o),R}function nx(){var R,z,K,j;if(R=k,O.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(B)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=ox(),j!==o?(z=w(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function ox(){var R,z,K,j,te,Ee;if(R=k,z=dp(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=dp(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=dp(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function dp(){var R,z,K,j;return R=k,z=nt(),z!==o?(K=_t(),K===o&&(K=null),K!==o?(j=nt(),j!==o?(z=q(z,j),R=z):(k=R,R=o)):(k=R,R=o)):(k=R,R=o),R}function V(){var R,z,K,j;if(R=k,F.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(L)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=ce(),j!==o?(z=w(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function ce(){var R,z,K,j,te,Ee;if(R=k,z=ge(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=ge(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=ge(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function ge(){var R,z,K,j;return R=k,z=nt(),z!==o?(K=_t(),K===o&&(K=null),K!==o?(j=nt(),j!==o?(z=X(z,j),R=z):(k=R,R=o)):(k=R,R=o)):(k=R,R=o),R}function se(){var R,z,K,j;if(R=k,G.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(U)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=ve(),j!==o?(z=w(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function ve(){var R,z,K,j,te,Ee;if(R=k,z=nt(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=nt(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=nt(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function Ye(){var R,z,K,j;if(R=k,H.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et($)),z!==o){for(K=[],j=At();j!==o;)K.push(j),j=At();K!==o?(j=gt(),j!==o?(z=w(z,j),R=z):(k=R,R=o)):(k=R,R=o)}else k=R,R=o;return R}function gt(){var R,z,K,j,te,Ee;if(R=k,z=wt(),z!==o){for(K=[],j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=wt(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);j!==o;)K.push(j),j=k,te=_t(),te===o&&(te=null),te!==o?(Ee=wt(),Ee!==o?(te=[te,Ee],j=te):(k=j,j=o)):(k=j,j=o);K!==o?(z=h(z,K),R=z):(k=R,R=o)}else k=R,R=o;return R}function wt(){var R,z,K,j,te,Ee,lo,lx,tg,cx,ig,hx;return R=k,z=qt(),z!==o?(K=_t(),K===o&&(K=null),K!==o?(j=qt(),j!==o?(te=_t(),te===o&&(te=null),te!==o?(Ee=Ct(),Ee!==o?(lo=_t(),lo!==o?(lx=Dt(),lx!==o?(tg=_t(),tg===o&&(tg=null),tg!==o?(cx=Dt(),cx!==o?(ig=_t(),ig===o&&(ig=null),ig!==o?(hx=nt(),hx!==o?(z=Y(z,j,Ee,lx,cx,hx),R=z):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o)):(k=R,R=o),R}function nt(){var R,z,K,j;return R=k,z=Ct(),z!==o?(K=_t(),K===o&&(K=null),K!==o?(j=Ct(),j!==o?(z=J(z,j),R=z):(k=R,R=o)):(k=R,R=o)):(k=R,R=o),R}function qt(){var R,z;return R=k,z=os(),z===o&&(z=Ls()),z!==o&&(z=Z(z)),R=z,R}function Ct(){var R,z,K,j;return R=k,z=k,K=Mt(),K===o&&(K=null),K!==o?(j=os(),j!==o?(K=[K,j],z=K):(k=z,z=o)):(k=z,z=o),z===o&&(z=k,K=Mt(),K===o&&(K=null),K!==o?(j=Ls(),j!==o?(K=[K,j],z=K):(k=z,z=o)):(k=z,z=o)),z!==o&&(z=ne(z)),R=z,R}function Dt(){var R,z;return R=k,re.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(ie)),z!==o&&(z=le(z)),R=z,R}function _t(){var R,z,K,j,te;if(R=k,z=[],K=At(),K!==o)for(;K!==o;)z.push(K),K=At();else z=o;if(z!==o)if(K=Wr(),K===o&&(K=null),K!==o){for(j=[],te=At();te!==o;)j.push(te),te=At();j!==o?(z=[z,K,j],R=z):(k=R,R=o)}else k=R,R=o;else k=R,R=o;if(R===o){if(R=k,z=k,K=Wr(),K!==o){for(j=[],te=At();te!==o;)j.push(te),te=At();j!==o?(K=[K,j],z=K):(k=z,z=o)}else k=z,z=o;z!==o&&(z=ue()),R=z}return R}function Wr(){var R;return s.charCodeAt(k)===44?(R=fe,k++):(R=o,et(be)),R}function os(){var R,z,K,j;return R=k,z=k,K=no(),K!==o?(j=yi(),j===o&&(j=null),j!==o?(K=[K,j],z=K):(k=z,z=o)):(k=z,z=o),z===o&&(z=k,K=Ls(),K!==o?(j=yi(),j!==o?(K=[K,j],z=K):(k=z,z=o)):(k=z,z=o)),z!==o&&(z=ke(z)),R=z,R}function no(){var R,z,K,j,te;return R=k,z=k,K=Ls(),K===o&&(K=null),K!==o?(s.charCodeAt(k)===46?(j=Ce,k++):(j=o,et(Ve)),j!==o?(te=Ls(),te!==o?(K=[K,j,te],z=K):(k=z,z=o)):(k=z,z=o)):(k=z,z=o),z===o&&(z=k,K=Ls(),K!==o?(s.charCodeAt(k)===46?(j=Ce,k++):(j=o,et(Ve)),j!==o?(K=[K,j],z=K):(k=z,z=o)):(k=z,z=o)),z!==o&&(z=ke(z)),R=z,R}function yi(){var R,z,K,j,te;return R=k,z=k,je.test(s.charAt(k))?(K=s.charAt(k),k++):(K=o,et(Pe)),K!==o?(j=Mt(),j===o&&(j=null),j!==o?(te=Ls(),te!==o?(K=[K,j,te],z=K):(k=z,z=o)):(k=z,z=o)):(k=z,z=o),z!==o&&(z=ke(z)),R=z,R}function Mt(){var R;return Me.test(s.charAt(k))?(R=s.charAt(k),k++):(R=o,et(Ze)),R}function Ls(){var R,z,K;if(R=k,z=[],qe.test(s.charAt(k))?(K=s.charAt(k),k++):(K=o,et(W)),K!==o)for(;K!==o;)z.push(K),qe.test(s.charAt(k))?(K=s.charAt(k),k++):(K=o,et(W));else z=o;return z!==o&&(z=N(z)),R=z,R}function At(){var R,z;return R=k,oe.test(s.charAt(k))?(z=s.charAt(k),k++):(z=o,et(Ae)),z!==o&&(z=ue()),R=z,R}function oo(R,z){if(!z)return[R];for(var K=[R],j=0,te=z.length;j<te;j++)K[j+1]=z[j][1];return K}var mc={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var sl in mc)mc[sl.toUpperCase()]=mc[sl];function mn(R,z){z||(z=[{}]);for(var K=z.length;K--;){var j={code:R,command:mc[R]};R==R.toLowerCase()&&(j.relative=!0);for(var te in z[K])j[te]=z[K][te];z[K]=j}return z}if(de=c(),de!==o&&k===s.length)return de;throw de!==o&&k<s.length&&et(Xe()),ii(Le,Ue<s.length?s.charAt(Ue):null,Ue<s.length?Ke(Ue,Ue+1):Ke(Ue,Ue))}t.exports={SyntaxError:r,parse:a}}),Ck=Pr((e,t)=>{var i=h8().parse;i.parseSVG=i,i.makeAbsolute=r,t.exports=i;function r(a){var s,n={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return a.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=n.x,l.y0=n.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=n.x),"y"in l||(l.y=n.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),n=l}),a}}),u8=Pr((e,t)=>{function i(r){for(var a=new Array(r),s=0;s<r;++s)a[s]=s;return a}t.exports=i}),d8=Pr((e,t)=>{t.exports=function(a){return a!=null&&(i(a)||r(a)||!!a._isBuffer)};function i(a){return!!a.constructor&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function r(a){return typeof a.readFloatLE=="function"&&typeof a.slice=="function"&&i(a.slice(0,0))}}),km=Pr((e,t)=>{var i=u8(),r=d8(),a=typeof Float64Array<"u";function s(h,d){return h[0]-d[0]}function n(){var h=this.stride,d=new Array(h.length),p;for(p=0;p<d.length;++p)d[p]=[Math.abs(h[p]),p];d.sort(s);var f=new Array(d.length);for(p=0;p<f.length;++p)f[p]=d[p][1];return f}function o(h,d){var p=["View",d,"d",h].join("");d<0&&(p="View_Nil"+h);var f=h==="generic";if(d===-1){var m="function "+p+"(a){this.data=a;};var proto="+p+".prototype;proto.dtype='"+h+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+p+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+p+"(a){return new "+p+"(a);}",C=new Function(m);return C()}else if(d===0){var m="function "+p+"(a,d) {this.data = a;this.offset = d};var proto="+p+".prototype;proto.dtype='"+h+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+p+"_copy() {return new "+p+"(this.data,this.offset)};proto.pick=function "+p+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+p+"_get(){return "+(f?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+p+"_set(v){return "+(f?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+p+"(a,b,c,d){return new "+p+"(a,d)}",C=new Function("TrivialArray",m);return C(c[h][0])}var m=["'use strict'"],g=i(d),v=g.map(function(T){return"i"+T}),y="this.offset+"+g.map(function(T){return"this.stride["+T+"]*i"+T}).join("+"),x=g.map(function(T){return"b"+T}).join(","),w=g.map(function(T){return"c"+T}).join(",");m.push("function "+p+"(a,"+x+","+w+",d){this.data=a","this.shape=["+x+"]","this.stride=["+w+"]","this.offset=d|0}","var proto="+p+".prototype","proto.dtype='"+h+"'","proto.dimension="+d),m.push("Object.defineProperty(proto,'size',{get:function "+p+"_size(){return "+g.map(function(T){return"this.shape["+T+"]"}).join("*"),"}})"),d===1?m.push("proto.order=[0]"):(m.push("Object.defineProperty(proto,'order',{get:"),d<4?(m.push("function "+p+"_order(){"),d===2?m.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):d===3&&m.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):m.push("ORDER})")),m.push("proto.set=function "+p+"_set("+v.join(",")+",v){"),f?m.push("return this.data.set("+y+",v)}"):m.push("return this.data["+y+"]=v}"),m.push("proto.get=function "+p+"_get("+v.join(",")+"){"),f?m.push("return this.data.get("+y+")}"):m.push("return this.data["+y+"]}"),m.push("proto.index=function "+p+"_index(",v.join(),"){return "+y+"}"),m.push("proto.hi=function "+p+"_hi("+v.join(",")+"){return new "+p+"(this.data,"+g.map(function(T){return["(typeof i",T,"!=='number'||i",T,"<0)?this.shape[",T,"]:i",T,"|0"].join("")}).join(",")+","+g.map(function(T){return"this.stride["+T+"]"}).join(",")+",this.offset)}");var S=g.map(function(T){return"a"+T+"=this.shape["+T+"]"}),_=g.map(function(T){return"c"+T+"=this.stride["+T+"]"});m.push("proto.lo=function "+p+"_lo("+v.join(",")+"){var b=this.offset,d=0,"+S.join(",")+","+_.join(","));for(var A=0;A<d;++A)m.push("if(typeof i"+A+"==='number'&&i"+A+">=0){d=i"+A+"|0;b+=c"+A+"*d;a"+A+"-=d}");m.push("return new "+p+"(this.data,"+g.map(function(T){return"a"+T}).join(",")+","+g.map(function(T){return"c"+T}).join(",")+",b)}"),m.push("proto.step=function "+p+"_step("+v.join(",")+"){var "+g.map(function(T){return"a"+T+"=this.shape["+T+"]"}).join(",")+","+g.map(function(T){return"b"+T+"=this.stride["+T+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var A=0;A<d;++A)m.push("if(typeof i"+A+"==='number'){d=i"+A+"|0;if(d<0){c+=b"+A+"*(a"+A+"-1);a"+A+"=ceil(-a"+A+"/d)}else{a"+A+"=ceil(a"+A+"/d)}b"+A+"*=d}");m.push("return new "+p+"(this.data,"+g.map(function(T){return"a"+T}).join(",")+","+g.map(function(T){return"b"+T}).join(",")+",c)}");for(var E=new Array(d),M=new Array(d),A=0;A<d;++A)E[A]="a[i"+A+"]",M[A]="b[i"+A+"]";m.push("proto.transpose=function "+p+"_transpose("+v+"){"+v.map(function(T,D){return T+"=("+T+"===undefined?"+D+":"+T+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+p+"(this.data,"+E.join(",")+","+M.join(",")+",this.offset)}"),m.push("proto.pick=function "+p+"_pick("+v+"){var a=[],b=[],c=this.offset");for(var A=0;A<d;++A)m.push("if(typeof i"+A+"==='number'&&i"+A+">=0){c=(c+this.stride["+A+"]*i"+A+")|0}else{a.push(this.shape["+A+"]);b.push(this.stride["+A+"])}");m.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),m.push("return function construct_"+p+"(data,shape,stride,offset){return new "+p+"(data,"+g.map(function(T){return"shape["+T+"]"}).join(",")+","+g.map(function(T){return"stride["+T+"]"}).join(",")+",offset)}");var C=new Function("CTOR_LIST","ORDER",m.join(`
`));return C(c[h],n)}function l(h){if(r(h))return"buffer";if(a)switch(Object.prototype.toString.call(h)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(h)?"array":"generic"}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function u(h,d,p,f){if(h===void 0){var w=c.array[0];return w([])}else typeof h=="number"&&(h=[h]);d===void 0&&(d=[h.length]);var m=d.length;if(p===void 0){p=new Array(m);for(var g=m-1,v=1;g>=0;--g)p[g]=v,v*=d[g]}if(f===void 0){f=0;for(var g=0;g<m;++g)p[g]<0&&(f-=(d[g]-1)*p[g])}for(var y=l(h),x=c[y];x.length<=m+1;)x.push(o(y,x.length-1));var w=x[m+1];return w(h,d,p,f)}t.exports=u}),p8=Pr((e,t)=>{function i(s,n){for(var o=1,l=s.length,c=s[0],u=s[0],h=1;h<l;++h)if(u=c,c=s[h],n(c,u)){if(h===o){o++;continue}s[o++]=c}return s.length=o,s}function r(s){for(var n=1,o=s.length,l=s[0],c=s[0],u=1;u<o;++u,c=l)if(c=l,l=s[u],l!==c){if(u===n){n++;continue}s[n++]=l}return s.length=n,s}function a(s,n,o){return s.length===0?s:n?(o||s.sort(n),i(s,n)):(o||s.sort(),r(s))}t.exports=a}),f8=Pr((e,t)=>{var i=p8();function r(c,u,h){var d=c.length,p=u.arrayArgs.length,f=u.indexArgs.length>0,m=[],g=[],v=0,y=0,x,w;for(x=0;x<d;++x)g.push(["i",x,"=0"].join(""));for(w=0;w<p;++w)for(x=0;x<d;++x)y=v,v=c[x],x===0?g.push(["d",w,"s",x,"=t",w,"p",v].join("")):g.push(["d",w,"s",x,"=(t",w,"p",v,"-s",y,"*t",w,"p",y,")"].join(""));for(g.length>0&&m.push("var "+g.join(",")),x=d-1;x>=0;--x)v=c[x],m.push(["for(i",x,"=0;i",x,"<s",v,";++i",x,"){"].join(""));for(m.push(h),x=0;x<d;++x){for(y=v,v=c[x],w=0;w<p;++w)m.push(["p",w,"+=d",w,"s",x].join(""));f&&(x>0&&m.push(["index[",y,"]-=s",y].join("")),m.push(["++index[",v,"]"].join(""))),m.push("}")}return m.join(`
`)}function a(c,u,h,d){for(var p=u.length,f=h.arrayArgs.length,m=h.blockSize,g=h.indexArgs.length>0,v=[],y=0;y<f;++y)v.push(["var offset",y,"=p",y].join(""));for(var y=c;y<p;++y)v.push(["for(var j"+y+"=SS[",u[y],"]|0;j",y,">0;){"].join("")),v.push(["if(j",y,"<",m,"){"].join("")),v.push(["s",u[y],"=j",y].join("")),v.push(["j",y,"=0"].join("")),v.push(["}else{s",u[y],"=",m].join("")),v.push(["j",y,"-=",m,"}"].join("")),g&&v.push(["index[",u[y],"]=j",y].join(""));for(var y=0;y<f;++y){for(var x=["offset"+y],w=c;w<p;++w)x.push(["j",w,"*t",y,"p",u[w]].join(""));v.push(["p",y,"=(",x.join("+"),")"].join(""))}v.push(r(u,h,d));for(var y=c;y<p;++y)v.push("}");return v.join(`
`)}function s(c){for(var u=0,h=c[0].length;u<h;){for(var d=1;d<c.length;++d)if(c[d][u]!==c[0][u])return u;++u}return u}function n(c,u,h){for(var d=c.body,p=[],f=[],m=0;m<c.args.length;++m){var g=c.args[m];if(!(g.count<=0)){var v=new RegExp(g.name,"g"),y="",x=u.arrayArgs.indexOf(m);switch(u.argTypes[m]){case"offset":var w=u.offsetArgIndex.indexOf(m),S=u.offsetArgs[w];x=S.array,y="+q"+w;case"array":y="p"+x+y;var _="l"+m,A="a"+x;if(u.arrayBlockIndices[x]===0)g.count===1?h[x]==="generic"?g.lvalue?(p.push(["var ",_,"=",A,".get(",y,")"].join("")),d=d.replace(v,_),f.push([A,".set(",y,",",_,")"].join(""))):d=d.replace(v,[A,".get(",y,")"].join("")):d=d.replace(v,[A,"[",y,"]"].join("")):h[x]==="generic"?(p.push(["var ",_,"=",A,".get(",y,")"].join("")),d=d.replace(v,_),g.lvalue&&f.push([A,".set(",y,",",_,")"].join(""))):(p.push(["var ",_,"=",A,"[",y,"]"].join("")),d=d.replace(v,_),g.lvalue&&f.push([A,"[",y,"]=",_].join("")));else{for(var E=[g.name],M=[y],C=0;C<Math.abs(u.arrayBlockIndices[x]);C++)E.push("\\s*\\[([^\\]]+)\\]"),M.push("$"+(C+1)+"*t"+x+"b"+C);if(v=new RegExp(E.join(""),"g"),y=M.join("+"),h[x]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");d=d.replace(v,[A,"[",y,"]"].join(""))}break;case"scalar":d=d.replace(v,"Y"+u.scalarArgs.indexOf(m));break;case"index":d=d.replace(v,"index");break;case"shape":d=d.replace(v,"shape");break}}}return[p.join(`
`),d,f.join(`
`)].join(`
`).trim()}function o(c){for(var u=new Array(c.length),h=!0,d=0;d<c.length;++d){var p=c[d],f=p.match(/\d+/);f?f=f[0]:f="",p.charAt(0)===0?u[d]="u"+p.charAt(1)+f:u[d]=p.charAt(0)+f,d>0&&(h=h&&u[d]===u[d-1])}return h?u[0]:u.join("")}function l(c,u){for(var h=u[1].length-Math.abs(c.arrayBlockIndices[0])|0,d=new Array(c.arrayArgs.length),p=new Array(c.arrayArgs.length),f=0;f<c.arrayArgs.length;++f)p[f]=u[2*f],d[f]=u[2*f+1];for(var m=[],g=[],v=[],y=[],x=[],f=0;f<c.arrayArgs.length;++f){c.arrayBlockIndices[f]<0?(v.push(0),y.push(h),m.push(h),g.push(h+c.arrayBlockIndices[f])):(v.push(c.arrayBlockIndices[f]),y.push(c.arrayBlockIndices[f]+h),m.push(0),g.push(c.arrayBlockIndices[f]));for(var w=[],S=0;S<d[f].length;S++)v[f]<=d[f][S]&&d[f][S]<y[f]&&w.push(d[f][S]-v[f]);x.push(w)}for(var _=["SS"],A=["'use strict'"],E=[],S=0;S<h;++S)E.push(["s",S,"=SS[",S,"]"].join(""));for(var f=0;f<c.arrayArgs.length;++f){_.push("a"+f),_.push("t"+f),_.push("p"+f);for(var S=0;S<h;++S)E.push(["t",f,"p",S,"=t",f,"[",v[f]+S,"]"].join(""));for(var S=0;S<Math.abs(c.arrayBlockIndices[f]);++S)E.push(["t",f,"b",S,"=t",f,"[",m[f]+S,"]"].join(""))}for(var f=0;f<c.scalarArgs.length;++f)_.push("Y"+f);if(c.shapeArgs.length>0&&E.push("shape=SS.slice(0)"),c.indexArgs.length>0){for(var M=new Array(h),f=0;f<h;++f)M[f]="0";E.push(["index=[",M.join(","),"]"].join(""))}for(var f=0;f<c.offsetArgs.length;++f){for(var C=c.offsetArgs[f],T=[],S=0;S<C.offset.length;++S)C.offset[S]!==0&&(C.offset[S]===1?T.push(["t",C.array,"p",S].join("")):T.push([C.offset[S],"*t",C.array,"p",S].join("")));T.length===0?E.push("q"+f+"=0"):E.push(["q",f,"=",T.join("+")].join(""))}var D=i([].concat(c.pre.thisVars).concat(c.body.thisVars).concat(c.post.thisVars));E=E.concat(D),E.length>0&&A.push("var "+E.join(","));for(var f=0;f<c.arrayArgs.length;++f)A.push("p"+f+"|=0");c.pre.body.length>3&&A.push(n(c.pre,c,p));var I=n(c.body,c,p),O=s(x);O<h?A.push(a(O,x[0],c,I)):A.push(r(x[0],c,I)),c.post.body.length>3&&A.push(n(c.post,c,p)),c.debug&&console.log("-----Generated cwise routine for ",u,`:
`+A.join(`
`)+`
----------`);var B=[c.funcName||"unnamed","_cwise_loop_",d[0].join("s"),"m",O,o(p)].join(""),q=new Function(["function ",B,"(",_.join(","),"){",A.join(`
`),"} return ",B].join(""));return q()}t.exports=l}),m8=Pr((e,t)=>{var i=f8();function r(a){var s=["'use strict'","var CACHED={}"],n=[],o=a.funcName+"_cwise_thunk";s.push(["return function ",o,"(",a.shimArgs.join(","),"){"].join(""));for(var l=[],c=[],u=[["array",a.arrayArgs[0],".shape.slice(",Math.max(0,a.arrayBlockIndices[0]),a.arrayBlockIndices[0]<0?","+a.arrayBlockIndices[0]+")":")"].join("")],h=[],d=[],p=0;p<a.arrayArgs.length;++p){var f=a.arrayArgs[p];n.push(["t",f,"=array",f,".dtype,","r",f,"=array",f,".order"].join("")),l.push("t"+f),l.push("r"+f),c.push("t"+f),c.push("r"+f+".join()"),u.push("array"+f+".data"),u.push("array"+f+".stride"),u.push("array"+f+".offset|0"),p>0&&(h.push("array"+a.arrayArgs[0]+".shape.length===array"+f+".shape.length+"+(Math.abs(a.arrayBlockIndices[0])-Math.abs(a.arrayBlockIndices[p]))),d.push("array"+a.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[0])+"]===array"+f+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[p])+"]"))}a.arrayArgs.length>1&&(s.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),s.push("for(var shapeIndex=array"+a.arrayArgs[0]+".shape.length-"+Math.abs(a.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),s.push("if (!("+d.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),s.push("}"));for(var p=0;p<a.scalarArgs.length;++p)u.push("scalar"+a.scalarArgs[p]);n.push(["type=[",c.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),s.push("var "+n.join(",")),s.push(["if(!proc){","CACHED[type]=proc=compile([",l.join(","),"])}","return proc(",u.join(","),")}"].join("")),a.debug&&console.log(`-----Generated thunk:
`+s.join(`
`)+`
----------`);var m=new Function("compile",s.join(`
`));return m(i.bind(void 0,a))}t.exports=r}),g8=Pr((e,t)=>{var i=m8();function r(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function a(s){var n=new r;n.pre=s.pre,n.body=s.body,n.post=s.post;var o=s.args.slice(0);n.argTypes=o;for(var l=0;l<o.length;++l){var c=o[l];if(c==="array"||typeof c=="object"&&c.blockIndices){if(n.argTypes[l]="array",n.arrayArgs.push(l),n.arrayBlockIndices.push(c.blockIndices?c.blockIndices:0),n.shimArgs.push("array"+l),l<n.pre.args.length&&n.pre.args[l].count>0)throw new Error("cwise: pre() block may not reference array args");if(l<n.post.args.length&&n.post.args[l].count>0)throw new Error("cwise: post() block may not reference array args")}else if(c==="scalar")n.scalarArgs.push(l),n.shimArgs.push("scalar"+l);else if(c==="index"){if(n.indexArgs.push(l),l<n.pre.args.length&&n.pre.args[l].count>0)throw new Error("cwise: pre() block may not reference array index");if(l<n.body.args.length&&n.body.args[l].lvalue)throw new Error("cwise: body() block may not write to array index");if(l<n.post.args.length&&n.post.args[l].count>0)throw new Error("cwise: post() block may not reference array index")}else if(c==="shape"){if(n.shapeArgs.push(l),l<n.pre.args.length&&n.pre.args[l].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(l<n.body.args.length&&n.body.args[l].lvalue)throw new Error("cwise: body() block may not write to array shape");if(l<n.post.args.length&&n.post.args[l].lvalue)throw new Error("cwise: post() block may not write to array shape")}else if(typeof c=="object"&&c.offset)n.argTypes[l]="offset",n.offsetArgs.push({array:c.array,offset:c.offset}),n.offsetArgIndex.push(l);else throw new Error("cwise: Unknown argument type "+o[l])}if(n.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(n.pre.args.length>o.length)throw new Error("cwise: Too many arguments in pre() block");if(n.body.args.length>o.length)throw new Error("cwise: Too many arguments in body() block");if(n.post.args.length>o.length)throw new Error("cwise: Too many arguments in post() block");return n.debug=!!s.printCode||!!s.debug,n.funcName=s.funcName||"cwise",n.blockSize=s.blockSize||64,i(n)}t.exports=a}),zm=Pr(e=>{var t=g8(),i={body:"",args:[],thisVars:[],localVars:[]};function r(d){if(!d)return i;for(var p=0;p<d.args.length;++p){var f=d.args[p];p===0?d.args[p]={name:f,lvalue:!0,rvalue:!!d.rvalue,count:d.count||1}:d.args[p]={name:f,lvalue:!1,rvalue:!0,count:1}}return d.thisVars||(d.thisVars=[]),d.localVars||(d.localVars=[]),d}function a(d){return t({args:d.args,pre:r(d.pre),body:r(d.body),post:r(d.proc),funcName:d.funcName})}function s(d){for(var p=[],f=0;f<d.args.length;++f)p.push("a"+f);var m=new Function("P",["return function ",d.funcName,"_ndarrayops(",p.join(","),") {P(",p.join(","),");return a0}"].join(""));return m(a(d))}var n={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var d in n){var p=n[d];e[d]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+p+"c"},funcName:d}),e[d+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a"+p+"=b"},rvalue:!0,funcName:d+"eq"}),e[d+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+p+"s"},funcName:d+"s"}),e[d+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a"+p+"=s"},rvalue:!0,funcName:d+"seq"})}})();var o={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var d in o){var p=o[d];e[d]=s({args:["array","array"],body:{args:["a","b"],body:"a="+p+"b"},funcName:d}),e[d+"eq"]=s({args:["array"],body:{args:["a"],body:"a="+p+"a"},rvalue:!0,count:2,funcName:d+"eq"})}})();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var d in l){var p=l[d];e[d]=s({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+p+"c"},funcName:d}),e[d+"s"]=s({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+p+"s"},funcName:d+"s"}),e[d+"eq"]=s({args:["array","array"],body:{args:["a","b"],body:"a=a"+p+"b"},rvalue:!0,count:2,funcName:d+"eq"}),e[d+"seq"]=s({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+p+"s"},rvalue:!0,count:2,funcName:d+"seq"})}})();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var d=0;d<c.length;++d){var p=c[d];e[p]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:p}),e[p+"eq"]=s({args:["array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"eq"})}})();var u=["max","min","atan2","pow"];(function(){for(var d=0;d<u.length;++d){var p=u[d];e[p]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:p}),e[p+"s"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:p+"s"}),e[p+"eq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"eq"}),e[p+"seq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"seq"})}})();var h=["atan2","pow"];(function(){for(var d=0;d<h.length;++d){var p=h[d];e[p+"op"]=s({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:p+"op"}),e[p+"ops"]=s({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:p+"ops"}),e[p+"opeq"]=s({args:["array","array"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"opeq"}),e[p+"opseq"]=s({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+p,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:p+"opseq"})}})(),e.any=t({args:["array"],pre:i,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=t({args:["array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=t({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=t({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=t({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=t({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=t({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=s({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=s({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=s({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=t({args:["array","array"],pre:i,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),v8=Pr((e,t)=>{t.exports=function(i,r){for(var a=i.split("."),s=r.split("."),n=0;n<3;n++){var o=Number(a[n]),l=Number(s[n]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),Yd="149",ls={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},y8=0,b3=1,x8=2,iE=1,b8=2,nf=3,on=0,Er=1,La=2,ir=0,$c=1,w3=2,_3=3,S3=4,w8=5,xu=100,_8=101,S8=102,A3=103,E3=104,A8=200,E8=201,C8=202,M8=203,Mk=204,Tk=205,T8=206,P8=207,D8=208,O8=209,I8=210,R8=0,L8=1,k8=2,V_=3,z8=4,N8=5,B8=6,j8=7,Pk=0,F8=1,U8=2,qn=0,V8=1,G8=2,H8=3,W8=4,q8=5,Dk=300,uh=301,dh=302,G_=303,H_=304,Nm=306,No=1e3,pi=1001,W_=1002,Gt=1003,C3=1004,Nx=1005,bt=1006,X8=1007,Cd=1008,na=1009,Y8=1010,Q8=1011,Ok=1012,Z8=1013,Bo=1014,er=1015,ph=1016,K8=1017,$8=1018,Jc=1020,J8=1021,Sr=1023,eV=1024,tV=1025,eh=1026,fh=1027,iV=1028,rV=1029,q0=1030,aV=1031,Ik=1033,Bx=33776,jx=33777,Fx=33778,Ux=33779,M3=35840,T3=35841,P3=35842,D3=35843,sV=36196,O3=37492,I3=37496,R3=37808,L3=37809,k3=37810,z3=37811,N3=37812,B3=37813,j3=37814,F3=37815,U3=37816,V3=37817,G3=37818,H3=37819,W3=37820,q3=37821,Vx=36492,nV=36283,X3=36284,Y3=36285,Q3=36286,Rk=2200,Lk=2201,rE=2202,X0=2300,Y0=2301,Gx=2302,ju=2400,Fu=2401,Q0=2402,aE=2500,oV=2501,ln=3e3,yt=3001,il=3200,kk=3201,lV=0,cV=1,On="srgb",Z0="srgb-linear",Hx=7680,hV=519,q_=35044,uV=35048,Z3="300 es",X_=1035,Hr=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let i=this._listeners[e];if(i!==void 0){let r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let r=0,a=i.length;r<a;r++)i[r].call(this,e);e.target=null}}},Yr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],K3=1234567,Ef=Math.PI/180,rm=180/Math.PI;function Cs(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Yr[e&255]+Yr[e>>8&255]+Yr[e>>16&255]+Yr[e>>24&255]+"-"+Yr[t&255]+Yr[t>>8&255]+"-"+Yr[t>>16&15|64]+Yr[t>>24&255]+"-"+Yr[i&63|128]+Yr[i>>8&255]+"-"+Yr[i>>16&255]+Yr[i>>24&255]+Yr[r&255]+Yr[r>>8&255]+Yr[r>>16&255]+Yr[r>>24&255]).toLowerCase()}function Zi(e,t,i){return Math.max(t,Math.min(i,e))}function sE(e,t){return(e%t+t)%t}function dV(e,t,i,r,a){return r+(e-t)*(a-r)/(i-t)}function pV(e,t,i){return e!==t?(i-e)/(t-e):0}function Cf(e,t,i){return(1-i)*e+i*t}function fV(e,t,i,r){return Cf(e,t,1-Math.exp(-i*r))}function mV(e,t=1){return t-Math.abs(sE(e,t*2)-t)}function gV(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))}function vV(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))}function yV(e,t){return e+Math.floor(Math.random()*(t-e+1))}function xV(e,t){return e+Math.random()*(t-e)}function bV(e){return e*(.5-Math.random())}function wV(e){e!==void 0&&(K3=e);let t=K3+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function _V(e){return e*Ef}function SV(e){return e*rm}function Y_(e){return(e&e-1)===0&&e!==0}function zk(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function K0(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function AV(e,t,i,r,a){let s=Math.cos,n=Math.sin,o=s(i/2),l=n(i/2),c=s((t+r)/2),u=n((t+r)/2),h=s((t-r)/2),d=n((t-r)/2),p=s((r-t)/2),f=n((r-t)/2);switch(a){case"XYX":e.set(o*u,l*h,l*d,o*c);break;case"YZY":e.set(l*d,o*u,l*h,o*c);break;case"ZXZ":e.set(l*h,l*d,o*u,o*c);break;case"XZX":e.set(o*u,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*u,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}}function jo(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function ni(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(e*65535);case Uint8Array:return Math.round(e*255);case Int16Array:return Math.round(e*32767);case Int8Array:return Math.round(e*127);default:throw new Error("Invalid component type.")}}var Ge=Object.freeze({__proto__:null,DEG2RAD:Ef,RAD2DEG:rm,ceilPowerOfTwo:zk,clamp:Zi,damp:fV,degToRad:_V,denormalize:jo,euclideanModulo:sE,floorPowerOfTwo:K0,generateUUID:Cs,inverseLerp:pV,isPowerOfTwo:Y_,lerp:Cf,mapLinear:dV,normalize:ni,pingpong:mV,radToDeg:SV,randFloat:xV,randFloatSpread:bV,randInt:yV,seededRandom:wV,setQuaternionFromProperEuler:AV,smootherstep:vV,smoothstep:gV}),Q=class{constructor(t=0,i=0){Q.prototype.isVector2=!0,this.x=t,this.y=i}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,i){return this.x=t,this.y=i,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,i){switch(t){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}addScaledVector(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let i=this.x,r=this.y,a=t.elements;return this.x=a[0]*i+a[3]*r+a[6],this.y=a[1]*i+a[4]*r+a[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}clampScalar(t,i){return this.x=Math.max(t,Math.min(i,this.x)),this.y=Math.max(t,Math.min(i,this.y)),this}clampLength(t,i){let r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(i,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let i=this.x-t.x,r=this.y-t.y;return i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this}lerpVectors(t,i,r){return this.x=t.x+(i.x-t.x)*r,this.y=t.y+(i.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,i=0){return this.x=t[i],this.y=t[i+1],this}toArray(t=[],i=0){return t[i]=this.x,t[i+1]=this.y,t}fromBufferAttribute(t,i){return this.x=t.getX(i),this.y=t.getY(i),this}rotateAround(t,i){let r=Math.cos(i),a=Math.sin(i),s=this.x-t.x,n=this.y-t.y;return this.x=s*r-n*a+t.x,this.y=s*a+n*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Ui=class{constructor(){Ui.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,a,s,n,o,l){let c=this.elements;return c[0]=e,c[1]=r,c[2]=n,c[3]=t,c[4]=a,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,r=t.elements,a=this.elements,s=i[0],n=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],p=i[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],x=r[7],w=r[2],S=r[5],_=r[8];return a[0]=s*f+n*v+o*w,a[3]=s*m+n*y+o*S,a[6]=s*g+n*x+o*_,a[1]=l*f+c*v+u*w,a[4]=l*m+c*y+u*S,a[7]=l*g+c*x+u*_,a[2]=h*f+d*v+p*w,a[5]=h*m+d*y+p*S,a[8]=h*g+d*x+p*_,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],s=e[4],n=e[5],o=e[6],l=e[7],c=e[8];return t*s*c-t*n*l-i*a*c+i*n*o+r*a*l-r*s*o}invert(){let e=this.elements,t=e[0],i=e[1],r=e[2],a=e[3],s=e[4],n=e[5],o=e[6],l=e[7],c=e[8],u=c*s-n*l,h=n*o-c*a,d=l*a-s*o,p=t*u+i*h+r*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=u*f,e[1]=(r*l-c*i)*f,e[2]=(n*i-r*s)*f,e[3]=h*f,e[4]=(c*t-r*o)*f,e[5]=(r*a-n*t)*f,e[6]=d*f,e[7]=(i*o-l*t)*f,e[8]=(s*t-i*a)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,a,s,n){let o=Math.cos(a),l=Math.sin(a);return this.set(i*o,i*l,-i*(o*s+l*n)+s+e,-r*l,r*o,-r*(-l*s+o*n)+n+t,0,0,1),this}scale(e,t){return this.premultiply(Wx.makeScale(e,t)),this}rotate(e){return this.premultiply(Wx.makeRotation(-e)),this}translate(e,t){return this.premultiply(Wx.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){let i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}},Wx=new Ui;function Nk(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var EV={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function bg(e,t){return new EV[e](t)}function am(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function th(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function r0(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}var qx={[On]:{[Z0]:th},[Z0]:{[On]:r0}},oa={legacyMode:!0,get workingColorSpace(){return Z0},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(qx[t]&&qx[t][i]!==void 0){let r=qx[t][i];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Bk={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},sr={r:0,g:0,b:0},zs={h:0,s:0,l:0},wg={h:0,s:0,l:0};function Xx(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+(t-e)*6*i:i<1/2?t:i<2/3?e+(t-e)*6*(2/3-i):e}function _g(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var tt=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=On){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,oa.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=oa.workingColorSpace){return this.r=e,this.g=t,this.b=i,oa.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=oa.workingColorSpace){if(e=sE(e,1),t=Zi(t,0,1),i=Zi(i,0,1),t===0)this.r=this.g=this.b=i;else{let a=i<=.5?i*(1+t):i+t-i*t,s=2*i-a;this.r=Xx(s,a,e+1/3),this.g=Xx(s,a,e),this.b=Xx(s,a,e-1/3)}return oa.toWorkingColorSpace(this,r),this}setStyle(e,t=On){function i(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let a,s=r[1],n=r[2];switch(s){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,oa.toWorkingColorSpace(this,t),i(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,oa.toWorkingColorSpace(this,t),i(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n)){let o=parseFloat(a[1])/360,l=parseFloat(a[2])/100,c=parseFloat(a[3])/100;return i(a[4]),this.setHSL(o,l,c,t)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){let a=r[1],s=a.length;if(s===3)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,oa.toWorkingColorSpace(this,t),this;if(s===6)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,oa.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=On){let i=Bk[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=th(e.r),this.g=th(e.g),this.b=th(e.b),this}copyLinearToSRGB(e){return this.r=r0(e.r),this.g=r0(e.g),this.b=r0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=On){return oa.fromWorkingColorSpace(_g(this,sr),e),Zi(sr.r*255,0,255)<<16^Zi(sr.g*255,0,255)<<8^Zi(sr.b*255,0,255)<<0}getHexString(e=On){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=oa.workingColorSpace){oa.fromWorkingColorSpace(_g(this,sr),t);let i=sr.r,r=sr.g,a=sr.b,s=Math.max(i,r,a),n=Math.min(i,r,a),o,l,c=(n+s)/2;if(n===s)o=0,l=0;else{let u=s-n;switch(l=c<=.5?u/(s+n):u/(2-s-n),s){case i:o=(r-a)/u+(r<a?6:0);break;case r:o=(a-i)/u+2;break;case a:o=(i-r)/u+4;break}o/=6}return e.h=o,e.s=l,e.l=c,e}getRGB(e,t=oa.workingColorSpace){return oa.fromWorkingColorSpace(_g(this,sr),t),e.r=sr.r,e.g=sr.g,e.b=sr.b,e}getStyle(e=On){return oa.fromWorkingColorSpace(_g(this,sr),e),e!==On?`color(${e} ${sr.r} ${sr.g} ${sr.b})`:`rgb(${sr.r*255|0},${sr.g*255|0},${sr.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(zs),zs.h+=e,zs.s+=t,zs.l+=i,this.setHSL(zs.h,zs.s,zs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(zs),e.getHSL(wg);let i=Cf(zs.h,wg.h,t),r=Cf(zs.s,wg.s,t),a=Cf(zs.l,wg.l,t);return this.setHSL(i,r,a),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};tt.NAMES=Bk;var Ih,jk=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ih===void 0&&(Ih=am("canvas")),Ih.width=e.width,Ih.height=e.height;let i=Ih.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ih}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=am("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height),a=r.data;for(let s=0;s<a.length;s++)a[s]=th(a[s]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){let t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(th(t[i]/255)*255):t[i]=th(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Fk=class{constructor(e=null){this.isSource=!0,this.uuid=Cs(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let a;if(Array.isArray(r)){a=[];for(let s=0,n=r.length;s<n;s++)r[s].isDataTexture?a.push(Yx(r[s].image)):a.push(Yx(r[s]))}else a=Yx(r);i.url=a}return t||(e.images[this.uuid]=i),i}};function Yx(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?jk.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var CV=0,Si=class extends Hr{constructor(e=Si.DEFAULT_IMAGE,t=Si.DEFAULT_MAPPING,i=pi,r=pi,a=bt,s=Cd,n=Sr,o=na,l=Si.DEFAULT_ANISOTROPY,c=ln){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:CV++}),this.uuid=Cs(),this.name="",this.source=new Fk(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=r,this.magFilter=a,this.minFilter=s,this.anisotropy=l,this.format=n,this.internalFormat=null,this.type=o,this.offset=new Q(0,0),this.repeat=new Q(1,1),this.center=new Q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ui,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Dk)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case No:e.x=e.x-Math.floor(e.x);break;case pi:e.x=e.x<0?0:1;break;case W_:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case No:e.y=e.y-Math.floor(e.y);break;case pi:e.y=e.y<0?0:1;break;case W_:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Si.DEFAULT_IMAGE=null;Si.DEFAULT_MAPPING=Dk;Si.DEFAULT_ANISOTROPY=1;var dt=class{constructor(e=0,t=0,i=0,r=1){dt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,a=this.w,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r+s[12]*a,this.y=s[1]*t+s[5]*i+s[9]*r+s[13]*a,this.z=s[2]*t+s[6]*i+s[10]*r+s[14]*a,this.w=s[3]*t+s[7]*i+s[11]*r+s[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,a,s=e.elements,n=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],p=s[6],f=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+p)<.1&&Math.abs(n+u+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let g=(n+1)/2,v=(u+1)/2,y=(f+1)/2,x=(o+c)/4,w=(l+d)/4,S=(h+p)/4;return g>v&&g>y?g<.01?(i=0,r=.707106781,a=.707106781):(i=Math.sqrt(g),r=x/i,a=w/i):v>y?v<.01?(i=.707106781,r=0,a=.707106781):(r=Math.sqrt(v),i=x/r,a=S/r):y<.01?(i=.707106781,r=.707106781,a=0):(a=Math.sqrt(y),i=w/a,r=S/a),this.set(i,r,a,t),this}let m=Math.sqrt((p-h)*(p-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(p-h)/m,this.y=(l-d)/m,this.z=(c-o)/m,this.w=Math.acos((n+u+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Ht=class extends Hr{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new dt(0,0,e,t),this.scissorTest=!1,this.viewport=new dt(0,0,e,t);let r={width:e,height:t,depth:1};this.texture=new Si(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:bt,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new Fk(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Uk=class extends Si{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Gt,this.minFilter=Gt,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},MV=class extends Si{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Gt,this.minFilter=Gt,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},TV=class extends Ht{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;let a=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=a.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ut=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,a,s,n){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=a[s+0],d=a[s+1],p=a[s+2],f=a[s+3];if(n===0){e[t+0]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u;return}if(n===1){e[t+0]=h,e[t+1]=d,e[t+2]=p,e[t+3]=f;return}if(u!==f||o!==h||l!==d||c!==p){let m=1-n,g=o*h+l*d+c*p+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){let w=Math.sqrt(y),S=Math.atan2(w,g*v);m=Math.sin(m*S)/w,n=Math.sin(n*S)/w}let x=n*v;if(o=o*m+h*x,l=l*m+d*x,c=c*m+p*x,u=u*m+f*x,m===1-n){let w=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=w,l*=w,c*=w,u*=w}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,r,a,s){let n=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=a[s],h=a[s+1],d=a[s+2],p=a[s+3];return e[t]=n*p+c*u+o*d-l*h,e[t+1]=o*p+c*h+l*u-n*d,e[t+2]=l*p+c*d+n*h-o*u,e[t+3]=c*p-n*u-o*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,r=e._y,a=e._z,s=e._order,n=Math.cos,o=Math.sin,l=n(i/2),c=n(r/2),u=n(a/2),h=o(i/2),d=o(r/2),p=o(a/2);switch(s){case"XYZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"YXZ":this._x=h*c*u+l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"ZXY":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u-h*d*p;break;case"ZYX":this._x=h*c*u-l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u+h*d*p;break;case"YZX":this._x=h*c*u+l*d*p,this._y=l*d*u+h*c*p,this._z=l*c*p-h*d*u,this._w=l*c*u-h*d*p;break;case"XZY":this._x=h*c*u-l*d*p,this._y=l*d*u-h*c*p,this._z=l*c*p+h*d*u,this._w=l*c*u+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],r=t[4],a=t[8],s=t[1],n=t[5],o=t[9],l=t[2],c=t[6],u=t[10],h=i+n+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(a-l)*d,this._z=(s-r)*d}else if(i>n&&i>u){let d=2*Math.sqrt(1+i-n-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(a+l)/d}else if(n>u){let d=2*Math.sqrt(1+n-i-u);this._w=(a-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-n);this._w=(s-r)/d,this._x=(a+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Zi(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(i===0)return this;let r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,r=e._y,a=e._z,s=e._w,n=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+s*n+r*l-a*o,this._y=r*c+s*o+a*n-i*l,this._z=a*c+s*l+i*o-r*n,this._w=s*c-i*n-r*o-a*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let i=this._x,r=this._y,a=this._z,s=this._w,n=s*e._w+i*e._x+r*e._y+a*e._z;if(n<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,n=-n):this.copy(e),n>=1)return this._w=s,this._x=i,this._y=r,this._z=a,this;let o=1-n*n;if(o<=Number.EPSILON){let d=1-t;return this._w=d*s+t*this._w,this._x=d*i+t*this._x,this._y=d*r+t*this._y,this._z=d*a+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,n),u=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=a*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(a),i*Math.cos(a),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},P=class{constructor(e=0,t=0,i=0){P.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion($3.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion($3.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*i+a[6]*r,this.y=a[1]*t+a[4]*i+a[7]*r,this.z=a[2]*t+a[5]*i+a[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,r=this.z,a=e.elements,s=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*i+a[8]*r+a[12])*s,this.y=(a[1]*t+a[5]*i+a[9]*r+a[13])*s,this.z=(a[2]*t+a[6]*i+a[10]*r+a[14])*s,this}applyQuaternion(e){let t=this.x,i=this.y,r=this.z,a=e.x,s=e.y,n=e.z,o=e.w,l=o*t+s*r-n*i,c=o*i+n*t-a*r,u=o*r+a*i-s*t,h=-a*t-s*i-n*r;return this.x=l*o+h*-a+c*-n-u*-s,this.y=c*o+h*-s+u*-a-l*-n,this.z=u*o+h*-n+l*-s-c*-a,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r,this.y=a[1]*t+a[5]*i+a[9]*r,this.z=a[2]*t+a[6]*i+a[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,r=e.y,a=e.z,s=t.x,n=t.y,o=t.z;return this.x=r*o-a*n,this.y=a*s-i*o,this.z=i*n-r*s,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Qx.copy(this).projectOnVector(e),this.sub(Qx)}reflect(e){return this.sub(Qx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Zi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},Qx=new P,$3=new ut,Hi=class{constructor(e=new P(1/0,1/0,1/0),t=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,a=-1/0,s=-1/0,n=-1/0;for(let o=0,l=e.length;o<l;o+=3){let c=e[o],u=e[o+1],h=e[o+2];c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>a&&(a=c),u>s&&(s=u),h>n&&(n=h)}return this.min.set(t,i,r),this.max.set(a,s,n),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,a=-1/0,s=-1/0,n=-1/0;for(let o=0,l=e.count;o<l;o++){let c=e.getX(o),u=e.getY(o),h=e.getZ(o);c<t&&(t=c),u<i&&(i=u),h<r&&(r=h),c>a&&(a=c),u>s&&(s=u),h>n&&(n=h)}return this.min.set(t,i,r),this.max.set(a,s,n),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=gc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){let a=i.attributes.position;for(let s=0,n=a.count;s<n;s++)gc.fromBufferAttribute(a,s).applyMatrix4(e.matrixWorld),this.expandByPoint(gc)}else i.boundingBox===null&&i.computeBoundingBox(),Zx.copy(i.boundingBox),Zx.applyMatrix4(e.matrixWorld),this.union(Zx);let r=e.children;for(let a=0,s=r.length;a<s;a++)this.expandByObject(r[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,gc),gc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(wp),Sg.subVectors(this.max,wp),Rh.subVectors(e.a,wp),Lh.subVectors(e.b,wp),kh.subVectors(e.c,wp),ol.subVectors(Lh,Rh),ll.subVectors(kh,Lh),vc.subVectors(Rh,kh);let t=[0,-ol.z,ol.y,0,-ll.z,ll.y,0,-vc.z,vc.y,ol.z,0,-ol.x,ll.z,0,-ll.x,vc.z,0,-vc.x,-ol.y,ol.x,0,-ll.y,ll.x,0,-vc.y,vc.x,0];return!Kx(t,Rh,Lh,kh,Sg)||(t=[1,0,0,0,1,0,0,0,1],!Kx(t,Rh,Lh,kh,Sg))?!1:(Ag.crossVectors(ol,ll),t=[Ag.x,Ag.y,Ag.z],Kx(t,Rh,Lh,kh,Sg))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return gc.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(gc).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(co[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),co[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),co[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),co[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),co[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),co[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),co[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),co[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(co),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},co=[new P,new P,new P,new P,new P,new P,new P,new P],gc=new P,Zx=new Hi,Rh=new P,Lh=new P,kh=new P,ol=new P,ll=new P,vc=new P,wp=new P,Sg=new P,Ag=new P,yc=new P;function Kx(e,t,i,r,a){for(let s=0,n=e.length-3;s<=n;s+=3){yc.fromArray(e,s);let o=a.x*Math.abs(yc.x)+a.y*Math.abs(yc.y)+a.z*Math.abs(yc.z),l=t.dot(yc),c=i.dot(yc),u=r.dot(yc);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var PV=new Hi,_p=new P,$x=new P,Fa=class{constructor(e=new P,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;t!==void 0?i.copy(t):PV.setFromPoints(e).getCenter(i);let r=0;for(let a=0,s=e.length;a<s;a++)r=Math.max(r,i.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_p.subVectors(e,this.center);let t=_p.lengthSq();if(t>this.radius*this.radius){let i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(_p,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):($x.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_p.copy(e.center).add($x)),this.expandByPoint(_p.copy(e.center).sub($x))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},ho=new P,Jx=new P,Eg=new P,cl=new P,eb=new P,Cg=new P,tb=new P,Qd=class{constructor(e=new P,t=new P(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ho)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=ho.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ho.copy(this.direction).multiplyScalar(t).add(this.origin),ho.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Jx.copy(e).add(t).multiplyScalar(.5),Eg.copy(t).sub(e).normalize(),cl.copy(this.origin).sub(Jx);let a=e.distanceTo(t)*.5,s=-this.direction.dot(Eg),n=cl.dot(this.direction),o=-cl.dot(Eg),l=cl.lengthSq(),c=Math.abs(1-s*s),u,h,d,p;if(c>0)if(u=s*o-n,h=s*n-o,p=a*c,u>=0)if(h>=-p)if(h<=p){let f=1/c;u*=f,h*=f,d=u*(u+s*h+2*n)+h*(s*u+h+2*o)+l}else h=a,u=Math.max(0,-(s*h+n)),d=-u*u+h*(h+2*o)+l;else h=-a,u=Math.max(0,-(s*h+n)),d=-u*u+h*(h+2*o)+l;else h<=-p?(u=Math.max(0,-(-s*a+n)),h=u>0?-a:Math.min(Math.max(-a,-o),a),d=-u*u+h*(h+2*o)+l):h<=p?(u=0,h=Math.min(Math.max(-a,-o),a),d=h*(h+2*o)+l):(u=Math.max(0,-(s*a+n)),h=u>0?a:Math.min(Math.max(-a,-o),a),d=-u*u+h*(h+2*o)+l);else h=s>0?-a:a,u=Math.max(0,-(s*h+n)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Eg).multiplyScalar(h).add(Jx),d}intersectSphere(e,t){ho.subVectors(e.center,this.origin);let i=ho.dot(this.direction),r=ho.dot(ho)-i*i,a=e.radius*e.radius;if(r>a)return null;let s=Math.sqrt(a-r),n=i-s,o=i+s;return n<0&&o<0?null:n<0?this.at(o,t):this.at(n,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,a,s,n,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),c>=0?(a=(e.min.y-h.y)*c,s=(e.max.y-h.y)*c):(a=(e.max.y-h.y)*c,s=(e.min.y-h.y)*c),i>s||a>r||((a>i||isNaN(i))&&(i=a),(s<r||isNaN(r))&&(r=s),u>=0?(n=(e.min.z-h.z)*u,o=(e.max.z-h.z)*u):(n=(e.max.z-h.z)*u,o=(e.min.z-h.z)*u),i>o||n>r)||((n>i||i!==i)&&(i=n),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,ho)!==null}intersectTriangle(e,t,i,r,a){eb.subVectors(t,e),Cg.subVectors(i,e),tb.crossVectors(eb,Cg);let s=this.direction.dot(tb),n;if(s>0){if(r)return null;n=1}else if(s<0)n=-1,s=-s;else return null;cl.subVectors(this.origin,e);let o=n*this.direction.dot(Cg.crossVectors(cl,Cg));if(o<0)return null;let l=n*this.direction.dot(eb.cross(cl));if(l<0||o+l>s)return null;let c=-n*cl.dot(tb);return c<0?null:this.at(c/s,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Se=class{constructor(){Se.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,i,r,a,s,n,o,l,c,u,h,d,p,f,m,g){let v=this.elements;return v[0]=t,v[4]=i,v[8]=r,v[12]=a,v[1]=s,v[5]=n,v[9]=o,v[13]=l,v[2]=c,v[6]=u,v[10]=h,v[14]=d,v[3]=p,v[7]=f,v[11]=m,v[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Se().fromArray(this.elements)}copy(t){let i=this.elements,r=t.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(t){let i=this.elements,r=t.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(t){let i=t.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(t,i,r){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,i,r){return this.set(t.x,i.x,r.x,0,t.y,i.y,r.y,0,t.z,i.z,r.z,0,0,0,0,1),this}extractRotation(t){let i=this.elements,r=t.elements,a=1/zh.setFromMatrixColumn(t,0).length(),s=1/zh.setFromMatrixColumn(t,1).length(),n=1/zh.setFromMatrixColumn(t,2).length();return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*n,i[9]=r[9]*n,i[10]=r[10]*n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(t){let i=this.elements,r=t.x,a=t.y,s=t.z,n=Math.cos(r),o=Math.sin(r),l=Math.cos(a),c=Math.sin(a),u=Math.cos(s),h=Math.sin(s);if(t.order==="XYZ"){let d=n*u,p=n*h,f=o*u,m=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=p+f*c,i[5]=d-m*c,i[9]=-o*l,i[2]=m-d*c,i[6]=f+p*c,i[10]=n*l}else if(t.order==="YXZ"){let d=l*u,p=l*h,f=c*u,m=c*h;i[0]=d+m*o,i[4]=f*o-p,i[8]=n*c,i[1]=n*h,i[5]=n*u,i[9]=-o,i[2]=p*o-f,i[6]=m+d*o,i[10]=n*l}else if(t.order==="ZXY"){let d=l*u,p=l*h,f=c*u,m=c*h;i[0]=d-m*o,i[4]=-n*h,i[8]=f+p*o,i[1]=p+f*o,i[5]=n*u,i[9]=m-d*o,i[2]=-n*c,i[6]=o,i[10]=n*l}else if(t.order==="ZYX"){let d=n*u,p=n*h,f=o*u,m=o*h;i[0]=l*u,i[4]=f*c-p,i[8]=d*c+m,i[1]=l*h,i[5]=m*c+d,i[9]=p*c-f,i[2]=-c,i[6]=o*l,i[10]=n*l}else if(t.order==="YZX"){let d=n*l,p=n*c,f=o*l,m=o*c;i[0]=l*u,i[4]=m-d*h,i[8]=f*h+p,i[1]=h,i[5]=n*u,i[9]=-o*u,i[2]=-c*u,i[6]=p*h+f,i[10]=d-m*h}else if(t.order==="XZY"){let d=n*l,p=n*c,f=o*l,m=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+m,i[5]=n*u,i[9]=p*h-f,i[2]=f*h-p,i[6]=o*u,i[10]=m*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(t){return this.compose(DV,t,OV)}lookAt(t,i,r){let a=this.elements;return Ha.subVectors(t,i),Ha.lengthSq()===0&&(Ha.z=1),Ha.normalize(),hl.crossVectors(r,Ha),hl.lengthSq()===0&&(Math.abs(r.z)===1?Ha.x+=1e-4:Ha.z+=1e-4,Ha.normalize(),hl.crossVectors(r,Ha)),hl.normalize(),Mg.crossVectors(Ha,hl),a[0]=hl.x,a[4]=Mg.x,a[8]=Ha.x,a[1]=hl.y,a[5]=Mg.y,a[9]=Ha.y,a[2]=hl.z,a[6]=Mg.z,a[10]=Ha.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,i){let r=t.elements,a=i.elements,s=this.elements,n=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],p=r[13],f=r[2],m=r[6],g=r[10],v=r[14],y=r[3],x=r[7],w=r[11],S=r[15],_=a[0],A=a[4],E=a[8],M=a[12],C=a[1],T=a[5],D=a[9],I=a[13],O=a[2],B=a[6],q=a[10],F=a[14],L=a[3],X=a[7],G=a[11],U=a[15];return s[0]=n*_+o*C+l*O+c*L,s[4]=n*A+o*T+l*B+c*X,s[8]=n*E+o*D+l*q+c*G,s[12]=n*M+o*I+l*F+c*U,s[1]=u*_+h*C+d*O+p*L,s[5]=u*A+h*T+d*B+p*X,s[9]=u*E+h*D+d*q+p*G,s[13]=u*M+h*I+d*F+p*U,s[2]=f*_+m*C+g*O+v*L,s[6]=f*A+m*T+g*B+v*X,s[10]=f*E+m*D+g*q+v*G,s[14]=f*M+m*I+g*F+v*U,s[3]=y*_+x*C+w*O+S*L,s[7]=y*A+x*T+w*B+S*X,s[11]=y*E+x*D+w*q+S*G,s[15]=y*M+x*I+w*F+S*U,this}multiplyScalar(t){let i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this}determinant(){let t=this.elements,i=t[0],r=t[4],a=t[8],s=t[12],n=t[1],o=t[5],l=t[9],c=t[13],u=t[2],h=t[6],d=t[10],p=t[14],f=t[3],m=t[7],g=t[11],v=t[15];return f*(+s*l*h-a*c*h-s*o*d+r*c*d+a*o*p-r*l*p)+m*(+i*l*p-i*c*d+s*n*d-a*n*p+a*c*u-s*l*u)+g*(+i*c*h-i*o*p-s*n*h+r*n*p+s*o*u-r*c*u)+v*(-a*o*u-i*l*h+i*o*d+a*n*h-r*n*d+r*l*u)}transpose(){let t=this.elements,i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,this}setPosition(t,i,r){let a=this.elements;return t.isVector3?(a[12]=t.x,a[13]=t.y,a[14]=t.z):(a[12]=t,a[13]=i,a[14]=r),this}invert(){let t=this.elements,i=t[0],r=t[1],a=t[2],s=t[3],n=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=h*g*c-m*d*c+m*l*p-o*g*p-h*l*v+o*d*v,x=f*d*c-u*g*c-f*l*p+n*g*p+u*l*v-n*d*v,w=u*m*c-f*h*c+f*o*p-n*m*p-u*o*v+n*h*v,S=f*h*l-u*m*l-f*o*d+n*m*d+u*o*g-n*h*g,_=i*y+r*x+a*w+s*S;if(_===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let A=1/_;return t[0]=y*A,t[1]=(m*d*s-h*g*s-m*a*p+r*g*p+h*a*v-r*d*v)*A,t[2]=(o*g*s-m*l*s+m*a*c-r*g*c-o*a*v+r*l*v)*A,t[3]=(h*l*s-o*d*s-h*a*c+r*d*c+o*a*p-r*l*p)*A,t[4]=x*A,t[5]=(u*g*s-f*d*s+f*a*p-i*g*p-u*a*v+i*d*v)*A,t[6]=(f*l*s-n*g*s-f*a*c+i*g*c+n*a*v-i*l*v)*A,t[7]=(n*d*s-u*l*s+u*a*c-i*d*c-n*a*p+i*l*p)*A,t[8]=w*A,t[9]=(f*h*s-u*m*s-f*r*p+i*m*p+u*r*v-i*h*v)*A,t[10]=(n*m*s-f*o*s+f*r*c-i*m*c-n*r*v+i*o*v)*A,t[11]=(u*o*s-n*h*s-u*r*c+i*h*c+n*r*p-i*o*p)*A,t[12]=S*A,t[13]=(u*m*a-f*h*a+f*r*d-i*m*d-u*r*g+i*h*g)*A,t[14]=(f*o*a-n*m*a-f*r*l+i*m*l+n*r*g-i*o*g)*A,t[15]=(n*h*a-u*o*a+u*r*l-i*h*l-n*r*d+i*o*d)*A,this}scale(t){let i=this.elements,r=t.x,a=t.y,s=t.z;return i[0]*=r,i[4]*=a,i[8]*=s,i[1]*=r,i[5]*=a,i[9]*=s,i[2]*=r,i[6]*=a,i[10]*=s,i[3]*=r,i[7]*=a,i[11]*=s,this}getMaxScaleOnAxis(){let t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],a=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,r,a))}makeTranslation(t,i,r){return this.set(1,0,0,t,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(t){let i=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(t){let i=Math.cos(t),r=Math.sin(t);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,i){let r=Math.cos(i),a=Math.sin(i),s=1-r,n=t.x,o=t.y,l=t.z,c=s*n,u=s*o;return this.set(c*n+r,c*o-a*l,c*l+a*o,0,c*o+a*l,u*o+r,u*l-a*n,0,c*l-a*o,u*l+a*n,s*l*l+r,0,0,0,0,1),this}makeScale(t,i,r){return this.set(t,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,i,r,a,s,n){return this.set(1,r,s,0,t,1,n,0,i,a,1,0,0,0,0,1),this}compose(t,i,r){let a=this.elements,s=i._x,n=i._y,o=i._z,l=i._w,c=s+s,u=n+n,h=o+o,d=s*c,p=s*u,f=s*h,m=n*u,g=n*h,v=o*h,y=l*c,x=l*u,w=l*h,S=r.x,_=r.y,A=r.z;return a[0]=(1-(m+v))*S,a[1]=(p+w)*S,a[2]=(f-x)*S,a[3]=0,a[4]=(p-w)*_,a[5]=(1-(d+v))*_,a[6]=(g+y)*_,a[7]=0,a[8]=(f+x)*A,a[9]=(g-y)*A,a[10]=(1-(d+m))*A,a[11]=0,a[12]=t.x,a[13]=t.y,a[14]=t.z,a[15]=1,this}decompose(t,i,r){let a=this.elements,s=zh.set(a[0],a[1],a[2]).length(),n=zh.set(a[4],a[5],a[6]).length(),o=zh.set(a[8],a[9],a[10]).length();this.determinant()<0&&(s=-s),t.x=a[12],t.y=a[13],t.z=a[14],Ns.copy(this);let l=1/s,c=1/n,u=1/o;return Ns.elements[0]*=l,Ns.elements[1]*=l,Ns.elements[2]*=l,Ns.elements[4]*=c,Ns.elements[5]*=c,Ns.elements[6]*=c,Ns.elements[8]*=u,Ns.elements[9]*=u,Ns.elements[10]*=u,i.setFromRotationMatrix(Ns),r.x=s,r.y=n,r.z=o,this}makePerspective(t,i,r,a,s,n){let o=this.elements,l=2*s/(i-t),c=2*s/(r-a),u=(i+t)/(i-t),h=(r+a)/(r-a),d=-(n+s)/(n-s),p=-2*n*s/(n-s);return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,i,r,a,s,n){let o=this.elements,l=1/(i-t),c=1/(r-a),u=1/(n-s),h=(i+t)*l,d=(r+a)*c,p=(n+s)*u;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){let i=this.elements,r=t.elements;for(let a=0;a<16;a++)if(i[a]!==r[a])return!1;return!0}fromArray(t,i=0){for(let r=0;r<16;r++)this.elements[r]=t[r+i];return this}toArray(t=[],i=0){let r=this.elements;return t[i]=r[0],t[i+1]=r[1],t[i+2]=r[2],t[i+3]=r[3],t[i+4]=r[4],t[i+5]=r[5],t[i+6]=r[6],t[i+7]=r[7],t[i+8]=r[8],t[i+9]=r[9],t[i+10]=r[10],t[i+11]=r[11],t[i+12]=r[12],t[i+13]=r[13],t[i+14]=r[14],t[i+15]=r[15],t}},zh=new P,Ns=new Se,DV=new P(0,0,0),OV=new P(1,1,1),hl=new P,Mg=new P,Ha=new P,J3=new Se,eT=new ut,hr=class{constructor(e=0,t=0,i=0,r=hr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){let r=e.elements,a=r[0],s=r[4],n=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(t){case"XYZ":this._y=Math.asin(Zi(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Zi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(n,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(Zi(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,a));break;case"ZYX":this._y=Math.asin(-Zi(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,a)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Zi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(n,d));break;case"XZY":this._z=Math.asin(-Zi(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(n,a)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return J3.makeRotationFromQuaternion(e),this.setFromRotationMatrix(J3,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return eT.setFromEuler(this),this.setFromQuaternion(eT,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};hr.DEFAULT_ORDER="XYZ";var nE=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},IV=0,tT=new P,Nh=new ut,uo=new Se,Tg=new P,Sp=new P,RV=new P,LV=new ut,iT=new P(1,0,0),rT=new P(0,1,0),aT=new P(0,0,1),kV={type:"added"},sT={type:"removed"},Yt=class extends Hr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:IV++}),this.uuid=Cs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Yt.DEFAULT_UP.clone();let e=new P,t=new hr,i=new ut,r=new P(1,1,1);function a(){i.setFromEuler(t,!1)}function s(){t.setFromQuaternion(i,void 0,!1)}t._onChange(a),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Se},normalMatrix:{value:new Ui}}),this.matrix=new Se,this.matrixWorld=new Se,this.matrixAutoUpdate=Yt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new nE,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Nh.setFromAxisAngle(e,t),this.quaternion.multiply(Nh),this}rotateOnWorldAxis(e,t){return Nh.setFromAxisAngle(e,t),this.quaternion.premultiply(Nh),this}rotateX(e){return this.rotateOnAxis(iT,e)}rotateY(e){return this.rotateOnAxis(rT,e)}rotateZ(e){return this.rotateOnAxis(aT,e)}translateOnAxis(e,t){return tT.copy(e).applyQuaternion(this.quaternion),this.position.add(tT.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(iT,e)}translateY(e){return this.translateOnAxis(rT,e)}translateZ(e){return this.translateOnAxis(aT,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(uo.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Tg.copy(e):Tg.set(e,t,i);let r=this.parent;this.updateWorldMatrix(!0,!1),Sp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?uo.lookAt(Sp,Tg,this.up):uo.lookAt(Tg,Sp,this.up),this.quaternion.setFromRotationMatrix(uo),r&&(uo.extractRotation(r.matrixWorld),Nh.setFromRotationMatrix(uo),this.quaternion.premultiply(Nh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(kV)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(sT)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(sT)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),uo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),uo.multiply(e.parent.matrixWorld)),e.applyMatrix4(uo),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){let a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let r=0,a=this.children.length;r<a;r++){let s=this.children[r].getObjectsByProperty(e,t);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Sp,e,RV),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Sp,LV,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,r=t.length;i<r;i++){let a=t[i];(a.matrixWorldAutoUpdate===!0||e===!0)&&a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let r=this.children;for(let a=0,s=r.length;a<s;a++){let n=r[a];n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function a(n,o){return n[o.uuid]===void 0&&(n[o.uuid]=o.toJSON(e)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);let n=this.geometry.parameters;if(n!==void 0&&n.shapes!==void 0){let o=n.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];a(e.shapes,u)}else a(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let n=[];for(let o=0,l=this.material.length;o<l;o++)n.push(a(e.materials,this.material[o]));r.material=n}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(let n=0;n<this.children.length;n++)r.children.push(this.children[n].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let n=0;n<this.animations.length;n++){let o=this.animations[n];r.animations.push(a(e.animations,o))}}if(t){let n=s(e.geometries),o=s(e.materials),l=s(e.textures),c=s(e.images),u=s(e.shapes),h=s(e.skeletons),d=s(e.animations),p=s(e.nodes);n.length>0&&(i.geometries=n),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),p.length>0&&(i.nodes=p)}return i.object=r,i;function s(n){let o=[];for(let l in n){let c=n[l];delete c.metadata,o.push(c)}return o}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){let r=e.children[i];this.add(r.clone())}return this}};Yt.DEFAULT_UP=new P(0,1,0);Yt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var Bs=new P,po=new P,ib=new P,fo=new P,Bh=new P,jh=new P,nT=new P,rb=new P,ab=new P,sb=new P,Nr=class{constructor(t=new P,i=new P,r=new P){this.a=t,this.b=i,this.c=r}static getNormal(t,i,r,a){a.subVectors(r,i),Bs.subVectors(t,i),a.cross(Bs);let s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}static getBarycoord(t,i,r,a,s){Bs.subVectors(a,i),po.subVectors(r,i),ib.subVectors(t,i);let n=Bs.dot(Bs),o=Bs.dot(po),l=Bs.dot(ib),c=po.dot(po),u=po.dot(ib),h=n*c-o*o;if(h===0)return s.set(-2,-1,-1);let d=1/h,p=(c*l-o*u)*d,f=(n*u-o*l)*d;return s.set(1-p-f,f,p)}static containsPoint(t,i,r,a){return this.getBarycoord(t,i,r,a,fo),fo.x>=0&&fo.y>=0&&fo.x+fo.y<=1}static getUV(t,i,r,a,s,n,o,l){return this.getBarycoord(t,i,r,a,fo),l.set(0,0),l.addScaledVector(s,fo.x),l.addScaledVector(n,fo.y),l.addScaledVector(o,fo.z),l}static isFrontFacing(t,i,r,a){return Bs.subVectors(r,i),po.subVectors(t,i),Bs.cross(po).dot(a)<0}set(t,i,r){return this.a.copy(t),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(t,i,r,a){return this.a.copy(t[i]),this.b.copy(t[r]),this.c.copy(t[a]),this}setFromAttributeAndIndices(t,i,r,a){return this.a.fromBufferAttribute(t,i),this.b.fromBufferAttribute(t,r),this.c.fromBufferAttribute(t,a),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Bs.subVectors(this.c,this.b),po.subVectors(this.a,this.b),Bs.cross(po).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Nr.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,i){return Nr.getBarycoord(t,this.a,this.b,this.c,i)}getUV(t,i,r,a,s){return Nr.getUV(t,this.a,this.b,this.c,i,r,a,s)}containsPoint(t){return Nr.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Nr.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,i){let r=this.a,a=this.b,s=this.c,n,o;Bh.subVectors(a,r),jh.subVectors(s,r),rb.subVectors(t,r);let l=Bh.dot(rb),c=jh.dot(rb);if(l<=0&&c<=0)return i.copy(r);ab.subVectors(t,a);let u=Bh.dot(ab),h=jh.dot(ab);if(u>=0&&h<=u)return i.copy(a);let d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return n=l/(l-u),i.copy(r).addScaledVector(Bh,n);sb.subVectors(t,s);let p=Bh.dot(sb),f=jh.dot(sb);if(f>=0&&p<=f)return i.copy(s);let m=p*c-l*f;if(m<=0&&c>=0&&f<=0)return o=c/(c-f),i.copy(r).addScaledVector(jh,o);let g=u*f-p*h;if(g<=0&&h-u>=0&&p-f>=0)return nT.subVectors(s,a),o=(h-u)/(h-u+(p-f)),i.copy(a).addScaledVector(nT,o);let v=1/(g+m+d);return n=m*v,o=d*v,i.copy(r).addScaledVector(Bh,n).addScaledVector(jh,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},zV=0,Bm=class extends Hr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:zV++}),this.uuid=Cs(),this.name="",this.type="Material",this.blending=$c,this.side=on,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Mk,this.blendDst=Tk,this.blendEquation=xu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V_,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hV,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Hx,this.stencilZFail=Hx,this.stencilZPass=Hx,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let r=this[t];if(r===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==$c&&(i.blending=this.blending),this.side!==on&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(a){let s=[];for(let n in a){let o=a[n];delete o.metadata,s.push(o)}return s}if(t){let a=r(e.textures),s=r(e.images);a.length>0&&(i.textures=a),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(t!==null){let r=t.length;i=new Array(r);for(let a=0;a!==r;++a)i[a]=t[a].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}},_h=class extends Bm{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Pk,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Xi=new P,Pg=new Q,ht=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=q_,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Pg.fromBufferAttribute(this,t),Pg.applyMatrix3(e),this.setXY(t,Pg.x,Pg.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Xi.fromBufferAttribute(this,t),Xi.applyMatrix3(e),this.setXYZ(t,Xi.x,Xi.y,Xi.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Xi.fromBufferAttribute(this,t),Xi.applyMatrix4(e),this.setXYZ(t,Xi.x,Xi.y,Xi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Xi.fromBufferAttribute(this,t),Xi.applyNormalMatrix(e),this.setXYZ(t,Xi.x,Xi.y,Xi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Xi.fromBufferAttribute(this,t),Xi.transformDirection(e),this.setXYZ(t,Xi.x,Xi.y,Xi.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=jo(t,this.array)),t}setX(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=jo(t,this.array)),t}setY(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=jo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=jo(t,this.array)),t}setW(e,t){return this.normalized&&(t=ni(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),r=ni(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,a){return e*=this.itemSize,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),r=ni(r,this.array),a=ni(a,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==q_&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},Vk=class extends ht{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Ju=class extends ht{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Re=class extends ht{constructor(e,t,i){super(new Float32Array(e),t,i)}},NV=0,cs=new Se,nb=new Yt,Fh=new P,Wa=new Hi,Ap=new Hi,vr=new P,Qe=class extends Hr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:NV++}),this.uuid=Cs(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Nk(e)?Ju:Vk)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let a=new Ui().getNormalMatrix(e);i.applyNormalMatrix(a),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return cs.makeRotationFromQuaternion(e),this.applyMatrix4(cs),this}rotateX(e){return cs.makeRotationX(e),this.applyMatrix4(cs),this}rotateY(e){return cs.makeRotationY(e),this.applyMatrix4(cs),this}rotateZ(e){return cs.makeRotationZ(e),this.applyMatrix4(cs),this}translate(e,t,i){return cs.makeTranslation(e,t,i),this.applyMatrix4(cs),this}scale(e,t,i){return cs.makeScale(e,t,i),this.applyMatrix4(cs),this}lookAt(e){return nb.lookAt(e),nb.updateMatrix(),this.applyMatrix4(nb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fh).negate(),this.translate(Fh.x,Fh.y,Fh.z),this}setFromPoints(e){let t=[];for(let i=0,r=e.length;i<r;i++){let a=e[i];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Re(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Hi);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){let a=t[i];Wa.setFromBufferAttribute(a),this.morphTargetsRelative?(vr.addVectors(this.boundingBox.min,Wa.min),this.boundingBox.expandByPoint(vr),vr.addVectors(this.boundingBox.max,Wa.max),this.boundingBox.expandByPoint(vr)):(this.boundingBox.expandByPoint(Wa.min),this.boundingBox.expandByPoint(Wa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Fa);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new P,1/0);return}if(e){let i=this.boundingSphere.center;if(Wa.setFromBufferAttribute(e),t)for(let a=0,s=t.length;a<s;a++){let n=t[a];Ap.setFromBufferAttribute(n),this.morphTargetsRelative?(vr.addVectors(Wa.min,Ap.min),Wa.expandByPoint(vr),vr.addVectors(Wa.max,Ap.max),Wa.expandByPoint(vr)):(Wa.expandByPoint(Ap.min),Wa.expandByPoint(Ap.max))}Wa.getCenter(i);let r=0;for(let a=0,s=e.count;a<s;a++)vr.fromBufferAttribute(e,a),r=Math.max(r,i.distanceToSquared(vr));if(t)for(let a=0,s=t.length;a<s;a++){let n=t[a],o=this.morphTargetsRelative;for(let l=0,c=n.count;l<c;l++)vr.fromBufferAttribute(n,l),o&&(Fh.fromBufferAttribute(e,l),vr.add(Fh)),r=Math.max(r,i.distanceToSquared(vr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=e.array,r=t.position.array,a=t.normal.array,s=t.uv.array,n=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ht(new Float32Array(4*n),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let M=0;M<n;M++)l[M]=new P,c[M]=new P;let u=new P,h=new P,d=new P,p=new Q,f=new Q,m=new Q,g=new P,v=new P;function y(M,C,T){u.fromArray(r,M*3),h.fromArray(r,C*3),d.fromArray(r,T*3),p.fromArray(s,M*2),f.fromArray(s,C*2),m.fromArray(s,T*2),h.sub(u),d.sub(u),f.sub(p),m.sub(p);let D=1/(f.x*m.y-m.x*f.y);!isFinite(D)||(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(D),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(D),l[M].add(g),l[C].add(g),l[T].add(g),c[M].add(v),c[C].add(v),c[T].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let M=0,C=x.length;M<C;++M){let T=x[M],D=T.start,I=T.count;for(let O=D,B=D+I;O<B;O+=3)y(i[O+0],i[O+1],i[O+2])}let w=new P,S=new P,_=new P,A=new P;function E(M){_.fromArray(a,M*3),A.copy(_);let C=l[M];w.copy(C),w.sub(_.multiplyScalar(_.dot(C))).normalize(),S.crossVectors(A,C);let T=S.dot(c[M])<0?-1:1;o[M*4]=w.x,o[M*4+1]=w.y,o[M*4+2]=w.z,o[M*4+3]=T}for(let M=0,C=x.length;M<C;++M){let T=x[M],D=T.start,I=T.count;for(let O=D,B=D+I;O<B;O+=3)E(i[O+0]),E(i[O+1]),E(i[O+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new ht(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new P,a=new P,s=new P,n=new P,o=new P,l=new P,c=new P,u=new P;if(e)for(let h=0,d=e.count;h<d;h+=3){let p=e.getX(h+0),f=e.getX(h+1),m=e.getX(h+2);r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),s.fromBufferAttribute(t,m),c.subVectors(s,a),u.subVectors(r,a),c.cross(u),n.fromBufferAttribute(i,p),o.fromBufferAttribute(i,f),l.fromBufferAttribute(i,m),n.add(c),o.add(c),l.add(c),i.setXYZ(p,n.x,n.y,n.z),i.setXYZ(f,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let h=0,d=t.count;h<d;h+=3)r.fromBufferAttribute(t,h+0),a.fromBufferAttribute(t,h+1),s.fromBufferAttribute(t,h+2),c.subVectors(s,a),u.subVectors(r,a),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)vr.fromBufferAttribute(e,t),vr.normalize(),e.setXYZ(t,vr.x,vr.y,vr.z)}toNonIndexed(){function e(n,o){let l=n.array,c=n.itemSize,u=n.normalized,h=new l.constructor(o.length*c),d=0,p=0;for(let f=0,m=o.length;f<m;f++){n.isInterleavedBufferAttribute?d=o[f]*n.data.stride+n.offset:d=o[f]*c;for(let g=0;g<c;g++)h[p++]=l[d++]}return new ht(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Qe,i=this.index.array,r=this.attributes;for(let n in r){let o=r[n],l=e(o,i);t.setAttribute(n,l)}let a=this.morphAttributes;for(let n in a){let o=[],l=a[n];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=e(h,i);o.push(d)}t.morphAttributes[n]=o}t.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let n=0,o=s.length;n<o;n++){let l=s[n];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(e[l]=o[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let l=i[o];e.data.attributes[o]=l.toJSON(e.data)}let r={},a=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(e.data))}c.length>0&&(r[o]=c,a=!0)}a&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));let n=this.boundingSphere;return n!==null&&(e.data.boundingSphere={center:n.center.toArray(),radius:n.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;i!==null&&this.setIndex(i.clone(t));let r=e.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(t))}let a=e.morphAttributes;for(let l in a){let c=[],u=a[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;let s=e.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let n=e.boundingBox;n!==null&&(this.boundingBox=n.clone());let o=e.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},oT=new Se,Uh=new Qd,ob=new Fa,Ep=new P,Cp=new P,Mp=new P,lb=new P,Dg=new P,Og=new Q,Ig=new Q,Rg=new Q,cb=new P,Lg=new P,tr=class extends Yt{constructor(e=new Qe,t=new _h){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(e,t){let i=this.geometry,r=i.attributes.position,a=i.morphAttributes.position,s=i.morphTargetsRelative;t.fromBufferAttribute(r,e);let n=this.morphTargetInfluences;if(a&&n){Dg.set(0,0,0);for(let o=0,l=a.length;o<l;o++){let c=n[o],u=a[o];c!==0&&(lb.fromBufferAttribute(u,e),s?Dg.addScaledVector(lb,c):Dg.addScaledVector(lb.sub(t),c))}t.add(Dg)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,r=this.material,a=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),ob.copy(i.boundingSphere),ob.applyMatrix4(a),e.ray.intersectsSphere(ob)===!1)||(oT.copy(a).invert(),Uh.copy(e.ray).applyMatrix4(oT),i.boundingBox!==null&&Uh.intersectsBox(i.boundingBox)===!1))return;let s,n=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(n!==null)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],m=r[f.materialIndex],g=Math.max(f.start,h.start),v=Math.min(n.count,Math.min(f.start+f.count,h.start+h.count));for(let y=g,x=v;y<x;y+=3){let w=n.getX(y),S=n.getX(y+1),_=n.getX(y+2);s=kg(this,m,e,Uh,l,c,w,S,_),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(n.count,h.start+h.count);for(let f=d,m=p;f<m;f+=3){let g=n.getX(f),v=n.getX(f+1),y=n.getX(f+2);s=kg(this,r,e,Uh,l,c,g,v,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,p=u.length;d<p;d++){let f=u[d],m=r[f.materialIndex],g=Math.max(f.start,h.start),v=Math.min(o.count,Math.min(f.start+f.count,h.start+h.count));for(let y=g,x=v;y<x;y+=3){let w=y,S=y+1,_=y+2;s=kg(this,m,e,Uh,l,c,w,S,_),s&&(s.faceIndex=Math.floor(y/3),s.face.materialIndex=f.materialIndex,t.push(s))}}else{let d=Math.max(0,h.start),p=Math.min(o.count,h.start+h.count);for(let f=d,m=p;f<m;f+=3){let g=f,v=f+1,y=f+2;s=kg(this,r,e,Uh,l,c,g,v,y),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}}};function BV(e,t,i,r,a,s,n,o){let l;if(t.side===Er?l=r.intersectTriangle(n,s,a,!0,o):l=r.intersectTriangle(a,s,n,t.side===on,o),l===null)return null;Lg.copy(o),Lg.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(Lg);return c<i.near||c>i.far?null:{distance:c,point:Lg.clone(),object:e}}function kg(e,t,i,r,a,s,n,o,l){e.getVertexPosition(n,Ep),e.getVertexPosition(o,Cp),e.getVertexPosition(l,Mp);let c=BV(e,t,i,r,Ep,Cp,Mp,cb);if(c){a&&(Og.fromBufferAttribute(a,n),Ig.fromBufferAttribute(a,o),Rg.fromBufferAttribute(a,l),c.uv=Nr.getUV(cb,Ep,Cp,Mp,Og,Ig,Rg,new Q)),s&&(Og.fromBufferAttribute(s,n),Ig.fromBufferAttribute(s,o),Rg.fromBufferAttribute(s,l),c.uv2=Nr.getUV(cb,Ep,Cp,Mp,Og,Ig,Rg,new Q));let u={a:n,b:o,c:l,normal:new P,materialIndex:0};Nr.getNormal(Ep,Cp,Mp,u.normal),c.face=u}return c}var cn=class extends Qe{constructor(e=1,t=1,i=1,r=1,a=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:a,depthSegments:s};let n=this;r=Math.floor(r),a=Math.floor(a),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;p("z","y","x",-1,-1,i,t,e,s,a,0),p("z","y","x",1,-1,i,t,-e,s,a,1),p("x","z","y",1,1,e,i,t,r,s,2),p("x","z","y",1,-1,e,i,-t,r,s,3),p("x","y","z",1,-1,e,t,i,r,a,4),p("x","y","z",-1,-1,e,t,-i,r,a,5),this.setIndex(o),this.setAttribute("position",new Re(l,3)),this.setAttribute("normal",new Re(c,3)),this.setAttribute("uv",new Re(u,2));function p(f,m,g,v,y,x,w,S,_,A,E){let M=x/_,C=w/A,T=x/2,D=w/2,I=S/2,O=_+1,B=A+1,q=0,F=0,L=new P;for(let X=0;X<B;X++){let G=X*C-D;for(let U=0;U<O;U++){let H=U*M-T;L[f]=H*v,L[m]=G*y,L[g]=I,l.push(L.x,L.y,L.z),L[f]=0,L[m]=0,L[g]=S>0?1:-1,c.push(L.x,L.y,L.z),u.push(U/_),u.push(1-X/A),q+=1}}for(let X=0;X<A;X++)for(let G=0;G<_;G++){let U=h+G+O*X,H=h+G+O*(X+1),$=h+(G+1)+O*(X+1),Y=h+(G+1)+O*X;o.push(U,H,Y),o.push(H,$,Y),F+=6}n.addGroup(d,F,E),d+=F,h+=q}}static fromJSON(e){return new cn(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function Md(e){let t={};for(let i in e){t[i]={};for(let r in e[i]){let a=e[i][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?t[i][r]=a.clone():Array.isArray(a)?t[i][r]=a.slice():t[i][r]=a}}return t}function ua(e){let t={};for(let i=0;i<e.length;i++){let r=Md(e[i]);for(let a in r)t[a]=r[a]}return t}function jV(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}function Gk(e){return e.getRenderTarget()===null&&e.outputEncoding===yt?On:Z0}var Zd={clone:Md,merge:ua},FV=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,UV=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Wt=class extends Bm{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=FV,this.fragmentShader=UV,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Md(e.uniforms),this.uniformsGroups=jV(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let r in this.uniforms){let a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},Sh=class extends Yt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Se,this.projectionMatrix=new Se,this.projectionMatrixInverse=new Se}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},Jr=class extends Sh{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=rm*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Ef*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return rm*2*Math.atan(Math.tan(Ef*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,a,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Ef*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,a=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;a+=s.offsetX*r/o,t-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let n=this.filmOffset;n!==0&&(a+=e*n/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},Vh=-90,Gh=1,VV=class extends Yt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new Jr(Vh,Gh,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let a=new Jr(Vh,Gh,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(-1,0,0),this.add(a);let s=new Jr(Vh,Gh,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let n=new Jr(Vh,Gh,e,t);n.layers=this.layers,n.up.set(0,0,1),n.lookAt(0,-1,0),this.add(n);let o=new Jr(Vh,Gh,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new Jr(Vh,Gh,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,a,s,n,o,l]=this.children,c=e.getRenderTarget(),u=e.toneMapping,h=e.xr.enabled;e.toneMapping=qn,e.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,a),e.setRenderTarget(i,2),e.render(t,s),e.setRenderTarget(i,3),e.render(t,n),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=d,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=u,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},oE=class extends Si{constructor(e,t,i,r,a,s,n,o,l,c){e=e!==void 0?e:[],t=t!==void 0?t:uh,super(e,t,i,r,a,s,n,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},GV=class extends Ht{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new oE(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:bt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new cn(5,5,5),a=new Wt({name:"CubemapFromEquirect",uniforms:Md(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Er,blending:ir});a.uniforms.tEquirect.value=t;let s=new tr(r,a),n=t.minFilter;return t.minFilter===Cd&&(t.minFilter=bt),new VV(1,10,this).update(e,s),t.minFilter=n,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,i,r){let a=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,r);e.setRenderTarget(a)}},hb=new P,HV=new P,WV=new Ui,Ya=class{constructor(e=new P(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let r=hb.subVectors(i,t).cross(HV.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(hb),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(i).multiplyScalar(a).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||WV.getNormalMatrix(e),r=this.coplanarPoint(hb).applyMatrix4(e),a=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}},Hh=new Fa,zg=new P,lE=class{constructor(e=new Ya,t=new Ya,i=new Ya,r=new Ya,a=new Ya,s=new Ya){this.planes=[e,t,i,r,a,s]}set(e,t,i,r,a,s){let n=this.planes;return n[0].copy(e),n[1].copy(t),n[2].copy(i),n[3].copy(r),n[4].copy(a),n[5].copy(s),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,r=i[0],a=i[1],s=i[2],n=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(n-r,u-o,f-h,y-m).normalize(),t[1].setComponents(n+r,u+o,f+h,y+m).normalize(),t[2].setComponents(n+a,u+l,f+d,y+g).normalize(),t[3].setComponents(n-a,u-l,f-d,y-g).normalize(),t[4].setComponents(n-s,u-c,f-p,y-v).normalize(),t[5].setComponents(n+s,u+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Hh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Hh)}intersectsSprite(e){return Hh.center.set(0,0,0),Hh.radius=.7071067811865476,Hh.applyMatrix4(e.matrixWorld),this.intersectsSphere(Hh)}intersectsSphere(e){let t=this.planes,i=e.center,r=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let r=t[i];if(zg.x=r.normal.x>0?e.max.x:e.min.x,zg.y=r.normal.y>0?e.max.y:e.min.y,zg.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(zg)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function Hk(){let e=null,t=!1,i=null,r=null;function a(s,n){i(s,n),r=e.requestAnimationFrame(a)}return{start:function(){t!==!0&&i!==null&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(s){i=s},setContext:function(s){e=s}}}function qV(e,t){let i=t.isWebGL2,r=new WeakMap;function a(c,u){let h=c.array,d=c.usage,p=e.createBuffer();e.bindBuffer(u,p),e.bufferData(u,h,d),c.onUploadCallback();let f;if(h instanceof Float32Array)f=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)f=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else f=5123;else if(h instanceof Int16Array)f=5122;else if(h instanceof Uint32Array)f=5125;else if(h instanceof Int32Array)f=5124;else if(h instanceof Int8Array)f=5120;else if(h instanceof Uint8Array)f=5121;else if(h instanceof Uint8ClampedArray)f=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:f,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,p=u.updateRange;e.bindBuffer(h,c),p.count===-1?e.bufferSubData(h,0,d):(i?e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):e.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1),u.onUploadCallback()}function n(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(e.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,a(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:n,remove:o,update:l}}var Ah=class extends Qe{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};let a=e/2,s=t/2,n=Math.floor(i),o=Math.floor(r),l=n+1,c=o+1,u=e/n,h=t/o,d=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let v=g*h-s;for(let y=0;y<l;y++){let x=y*u-a;p.push(x,-v,0),f.push(0,0,1),m.push(y/n),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let v=0;v<n;v++){let y=v+l*g,x=v+l*(g+1),w=v+1+l*(g+1),S=v+1+l*g;d.push(y,x,S),d.push(x,w,S)}this.setIndex(d),this.setAttribute("position",new Re(p,3)),this.setAttribute("normal",new Re(f,3)),this.setAttribute("uv",new Re(m,2))}static fromJSON(e){return new Ah(e.width,e.height,e.widthSegments,e.heightSegments)}},XV=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,YV=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,QV=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,ZV=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,KV=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,$V=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,JV="vec3 transformed = vec3( position );",e9=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,t9=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,i9=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,r9=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,a9=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,s9=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,n9=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,o9=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,l9=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,c9=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,h9=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,u9=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,d9=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,p9=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,f9=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,m9=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,g9=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,v9=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,y9=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,x9="gl_FragColor = linearToOutputTexel( gl_FragColor );",b9=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,w9=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,_9=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,S9=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,A9=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,E9=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,C9=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,M9=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,T9=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,P9=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,D9=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,O9=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,I9=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,R9=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,L9=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,k9=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,z9=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,N9=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,B9=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,j9=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,F9=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,U9=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,V9=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,G9=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,H9=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,W9=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,q9=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,X9=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Y9=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Q9=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Z9=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,K9=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,$9=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,J9=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,e7=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,t7=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,i7=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,r7=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,a7=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,s7=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,n7=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,o7=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,l7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,c7=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,h7=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,u7=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,d7=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,p7=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,f7=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,m7=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,g7=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,v7=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,y7=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,x7=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,b7=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,w7=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,_7=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,S7=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,A7=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,E7=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,C7=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,M7=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,T7=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,P7=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,D7=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,O7=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,I7=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,R7=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,L7=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,k7=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,z7=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,N7=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,B7=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,j7=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,F7=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,U7=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,V7=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,G7=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,H7=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,W7=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,q7=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,X7=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Y7=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,Q7=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Z7=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,K7=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,$7=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,J7=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,eG=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,tG=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,iG=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,rG=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,aG=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sG=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,nG=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oG=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lG=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cG=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,hG=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uG=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dG=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,pG=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fG=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mG=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gG=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vG=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yG=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xG=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,bG=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wG=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_G=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,SG=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,AG=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,xt={alphamap_fragment:XV,alphamap_pars_fragment:YV,alphatest_fragment:QV,alphatest_pars_fragment:ZV,aomap_fragment:KV,aomap_pars_fragment:$V,begin_vertex:JV,beginnormal_vertex:e9,bsdfs:t9,iridescence_fragment:i9,bumpmap_pars_fragment:r9,clipping_planes_fragment:a9,clipping_planes_pars_fragment:s9,clipping_planes_pars_vertex:n9,clipping_planes_vertex:o9,color_fragment:l9,color_pars_fragment:c9,color_pars_vertex:h9,color_vertex:u9,common:d9,cube_uv_reflection_fragment:p9,defaultnormal_vertex:f9,displacementmap_pars_vertex:m9,displacementmap_vertex:g9,emissivemap_fragment:v9,emissivemap_pars_fragment:y9,encodings_fragment:x9,encodings_pars_fragment:b9,envmap_fragment:w9,envmap_common_pars_fragment:_9,envmap_pars_fragment:S9,envmap_pars_vertex:A9,envmap_physical_pars_fragment:z9,envmap_vertex:E9,fog_vertex:C9,fog_pars_vertex:M9,fog_fragment:T9,fog_pars_fragment:P9,gradientmap_pars_fragment:D9,lightmap_fragment:O9,lightmap_pars_fragment:I9,lights_lambert_fragment:R9,lights_lambert_pars_fragment:L9,lights_pars_begin:k9,lights_toon_fragment:N9,lights_toon_pars_fragment:B9,lights_phong_fragment:j9,lights_phong_pars_fragment:F9,lights_physical_fragment:U9,lights_physical_pars_fragment:V9,lights_fragment_begin:G9,lights_fragment_maps:H9,lights_fragment_end:W9,logdepthbuf_fragment:q9,logdepthbuf_pars_fragment:X9,logdepthbuf_pars_vertex:Y9,logdepthbuf_vertex:Q9,map_fragment:Z9,map_pars_fragment:K9,map_particle_fragment:$9,map_particle_pars_fragment:J9,metalnessmap_fragment:e7,metalnessmap_pars_fragment:t7,morphcolor_vertex:i7,morphnormal_vertex:r7,morphtarget_pars_vertex:a7,morphtarget_vertex:s7,normal_fragment_begin:n7,normal_fragment_maps:o7,normal_pars_fragment:l7,normal_pars_vertex:c7,normal_vertex:h7,normalmap_pars_fragment:u7,clearcoat_normal_fragment_begin:d7,clearcoat_normal_fragment_maps:p7,clearcoat_pars_fragment:f7,iridescence_pars_fragment:m7,output_fragment:g7,packing:v7,premultiplied_alpha_fragment:y7,project_vertex:x7,dithering_fragment:b7,dithering_pars_fragment:w7,roughnessmap_fragment:_7,roughnessmap_pars_fragment:S7,shadowmap_pars_fragment:A7,shadowmap_pars_vertex:E7,shadowmap_vertex:C7,shadowmask_pars_fragment:M7,skinbase_vertex:T7,skinning_pars_vertex:P7,skinning_vertex:D7,skinnormal_vertex:O7,specularmap_fragment:I7,specularmap_pars_fragment:R7,tonemapping_fragment:L7,tonemapping_pars_fragment:k7,transmission_fragment:z7,transmission_pars_fragment:N7,uv_pars_fragment:B7,uv_pars_vertex:j7,uv_vertex:F7,uv2_pars_fragment:U7,uv2_pars_vertex:V7,uv2_vertex:G7,worldpos_vertex:H7,background_vert:W7,background_frag:q7,backgroundCube_vert:X7,backgroundCube_frag:Y7,cube_vert:Q7,cube_frag:Z7,depth_vert:K7,depth_frag:$7,distanceRGBA_vert:J7,distanceRGBA_frag:eG,equirect_vert:tG,equirect_frag:iG,linedashed_vert:rG,linedashed_frag:aG,meshbasic_vert:sG,meshbasic_frag:nG,meshlambert_vert:oG,meshlambert_frag:lG,meshmatcap_vert:cG,meshmatcap_frag:hG,meshnormal_vert:uG,meshnormal_frag:dG,meshphong_vert:pG,meshphong_frag:fG,meshphysical_vert:mG,meshphysical_frag:gG,meshtoon_vert:vG,meshtoon_frag:yG,points_vert:xG,points_frag:bG,shadow_vert:wG,shadow_frag:_G,sprite_vert:SG,sprite_frag:AG},Oe={common:{diffuse:{value:new tt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ui},uv2Transform:{value:new Ui},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Q(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new tt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ui}},sprite:{diffuse:{value:new tt(16777215)},opacity:{value:1},center:{value:new Q(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ui}}},Rn={basic:{uniforms:ua([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.fog]),vertexShader:xt.meshbasic_vert,fragmentShader:xt.meshbasic_frag},lambert:{uniforms:ua([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new tt(0)}}]),vertexShader:xt.meshlambert_vert,fragmentShader:xt.meshlambert_frag},phong:{uniforms:ua([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new tt(0)},specular:{value:new tt(1118481)},shininess:{value:30}}]),vertexShader:xt.meshphong_vert,fragmentShader:xt.meshphong_frag},standard:{uniforms:ua([Oe.common,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.roughnessmap,Oe.metalnessmap,Oe.fog,Oe.lights,{emissive:{value:new tt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:xt.meshphysical_vert,fragmentShader:xt.meshphysical_frag},toon:{uniforms:ua([Oe.common,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.gradientmap,Oe.fog,Oe.lights,{emissive:{value:new tt(0)}}]),vertexShader:xt.meshtoon_vert,fragmentShader:xt.meshtoon_frag},matcap:{uniforms:ua([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,{matcap:{value:null}}]),vertexShader:xt.meshmatcap_vert,fragmentShader:xt.meshmatcap_frag},points:{uniforms:ua([Oe.points,Oe.fog]),vertexShader:xt.points_vert,fragmentShader:xt.points_frag},dashed:{uniforms:ua([Oe.common,Oe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xt.linedashed_vert,fragmentShader:xt.linedashed_frag},depth:{uniforms:ua([Oe.common,Oe.displacementmap]),vertexShader:xt.depth_vert,fragmentShader:xt.depth_frag},normal:{uniforms:ua([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,{opacity:{value:1}}]),vertexShader:xt.meshnormal_vert,fragmentShader:xt.meshnormal_frag},sprite:{uniforms:ua([Oe.sprite,Oe.fog]),vertexShader:xt.sprite_vert,fragmentShader:xt.sprite_frag},background:{uniforms:{uvTransform:{value:new Ui},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:xt.background_vert,fragmentShader:xt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:xt.backgroundCube_vert,fragmentShader:xt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:xt.cube_vert,fragmentShader:xt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xt.equirect_vert,fragmentShader:xt.equirect_frag},distanceRGBA:{uniforms:ua([Oe.common,Oe.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xt.distanceRGBA_vert,fragmentShader:xt.distanceRGBA_frag},shadow:{uniforms:ua([Oe.lights,Oe.fog,{color:{value:new tt(0)},opacity:{value:1}}]),vertexShader:xt.shadow_vert,fragmentShader:xt.shadow_frag}};Rn.physical={uniforms:ua([Rn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Q(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new tt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Q},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new tt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new tt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:xt.meshphysical_vert,fragmentShader:xt.meshphysical_frag};var Ng={r:0,b:0,g:0};function EG(e,t,i,r,a,s,n){let o=new tt(0),l=s===!0?0:1,c,u,h=null,d=0,p=null;function f(g,v){let y=!1,x=v.isScene===!0?v.background:null;x&&x.isTexture&&(x=(v.backgroundBlurriness>0?i:t).get(x));let w=e.xr,S=w.getSession&&w.getSession();S&&S.environmentBlendMode==="additive"&&(x=null),x===null?m(o,l):x&&x.isColor&&(m(x,1),y=!0),(e.autoClear||y)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Nm)?(u===void 0&&(u=new tr(new cn(1,1,1),new Wt({name:"BackgroundCubeMaterial",uniforms:Md(Rn.backgroundCube.uniforms),vertexShader:Rn.backgroundCube.vertexShader,fragmentShader:Rn.backgroundCube.fragmentShader,side:Er,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(_,A,E){this.matrixWorld.copyPosition(E.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),a.update(u)),u.material.uniforms.envMap.value=x,u.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,u.material.toneMapped=x.encoding!==yt,(h!==x||d!==x.version||p!==e.toneMapping)&&(u.material.needsUpdate=!0,h=x,d=x.version,p=e.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new tr(new Ah(2,2),new Wt({name:"BackgroundMaterial",uniforms:Md(Rn.background.uniforms),vertexShader:Rn.background.vertexShader,fragmentShader:Rn.background.fragmentShader,side:on,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),a.update(c)),c.material.uniforms.t2D.value=x,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=x.encoding!==yt,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(h!==x||d!==x.version||p!==e.toneMapping)&&(c.material.needsUpdate=!0,h=x,d=x.version,p=e.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function m(g,v){g.getRGB(Ng,Gk(e)),r.buffers.color.setClear(Ng.r,Ng.g,Ng.b,v,n)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),l=v,m(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,m(o,l)},render:f}}function CG(e,t,i,r){let a=e.getParameter(34921),s=r.isWebGL2?null:t.get("OES_vertex_array_object"),n=r.isWebGL2||s!==null,o={},l=g(null),c=l,u=!1;function h(O,B,q,F,L){let X=!1;if(n){let G=m(F,q,B);c!==G&&(c=G,p(c.object)),X=v(O,F,q,L),X&&y(O,F,q,L)}else{let G=B.wireframe===!0;(c.geometry!==F.id||c.program!==q.id||c.wireframe!==G)&&(c.geometry=F.id,c.program=q.id,c.wireframe=G,X=!0)}L!==null&&i.update(L,34963),(X||u)&&(u=!1,E(O,B,q,F),L!==null&&e.bindBuffer(34963,i.get(L).buffer))}function d(){return r.isWebGL2?e.createVertexArray():s.createVertexArrayOES()}function p(O){return r.isWebGL2?e.bindVertexArray(O):s.bindVertexArrayOES(O)}function f(O){return r.isWebGL2?e.deleteVertexArray(O):s.deleteVertexArrayOES(O)}function m(O,B,q){let F=q.wireframe===!0,L=o[O.id];L===void 0&&(L={},o[O.id]=L);let X=L[B.id];X===void 0&&(X={},L[B.id]=X);let G=X[F];return G===void 0&&(G=g(d()),X[F]=G),G}function g(O){let B=[],q=[],F=[];for(let L=0;L<a;L++)B[L]=0,q[L]=0,F[L]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:B,enabledAttributes:q,attributeDivisors:F,object:O,attributes:{},index:null}}function v(O,B,q,F){let L=c.attributes,X=B.attributes,G=0,U=q.getAttributes();for(let H in U)if(U[H].location>=0){let $=L[H],Y=X[H];if(Y===void 0&&(H==="instanceMatrix"&&O.instanceMatrix&&(Y=O.instanceMatrix),H==="instanceColor"&&O.instanceColor&&(Y=O.instanceColor)),$===void 0||$.attribute!==Y||Y&&$.data!==Y.data)return!0;G++}return c.attributesNum!==G||c.index!==F}function y(O,B,q,F){let L={},X=B.attributes,G=0,U=q.getAttributes();for(let H in U)if(U[H].location>=0){let $=X[H];$===void 0&&(H==="instanceMatrix"&&O.instanceMatrix&&($=O.instanceMatrix),H==="instanceColor"&&O.instanceColor&&($=O.instanceColor));let Y={};Y.attribute=$,$&&$.data&&(Y.data=$.data),L[H]=Y,G++}c.attributes=L,c.attributesNum=G,c.index=F}function x(){let O=c.newAttributes;for(let B=0,q=O.length;B<q;B++)O[B]=0}function w(O){S(O,0)}function S(O,B){let q=c.newAttributes,F=c.enabledAttributes,L=c.attributeDivisors;q[O]=1,F[O]===0&&(e.enableVertexAttribArray(O),F[O]=1),L[O]!==B&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](O,B),L[O]=B)}function _(){let O=c.newAttributes,B=c.enabledAttributes;for(let q=0,F=B.length;q<F;q++)B[q]!==O[q]&&(e.disableVertexAttribArray(q),B[q]=0)}function A(O,B,q,F,L,X){r.isWebGL2===!0&&(q===5124||q===5125)?e.vertexAttribIPointer(O,B,q,L,X):e.vertexAttribPointer(O,B,q,F,L,X)}function E(O,B,q,F){if(r.isWebGL2===!1&&(O.isInstancedMesh||F.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;x();let L=F.attributes,X=q.getAttributes(),G=B.defaultAttributeValues;for(let U in X){let H=X[U];if(H.location>=0){let $=L[U];if($===void 0&&(U==="instanceMatrix"&&O.instanceMatrix&&($=O.instanceMatrix),U==="instanceColor"&&O.instanceColor&&($=O.instanceColor)),$!==void 0){let Y=$.normalized,J=$.itemSize,Z=i.get($);if(Z===void 0)continue;let ne=Z.buffer,re=Z.type,ie=Z.bytesPerElement;if($.isInterleavedBufferAttribute){let le=$.data,ue=le.stride,fe=$.offset;if(le.isInstancedInterleavedBuffer){for(let be=0;be<H.locationSize;be++)S(H.location+be,le.meshPerAttribute);O.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let be=0;be<H.locationSize;be++)w(H.location+be);e.bindBuffer(34962,ne);for(let be=0;be<H.locationSize;be++)A(H.location+be,J/H.locationSize,re,Y,ue*ie,(fe+J/H.locationSize*be)*ie)}else{if($.isInstancedBufferAttribute){for(let le=0;le<H.locationSize;le++)S(H.location+le,$.meshPerAttribute);O.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=$.meshPerAttribute*$.count)}else for(let le=0;le<H.locationSize;le++)w(H.location+le);e.bindBuffer(34962,ne);for(let le=0;le<H.locationSize;le++)A(H.location+le,J/H.locationSize,re,Y,J*ie,J/H.locationSize*le*ie)}}else if(G!==void 0){let Y=G[U];if(Y!==void 0)switch(Y.length){case 2:e.vertexAttrib2fv(H.location,Y);break;case 3:e.vertexAttrib3fv(H.location,Y);break;case 4:e.vertexAttrib4fv(H.location,Y);break;default:e.vertexAttrib1fv(H.location,Y)}}}}_()}function M(){D();for(let O in o){let B=o[O];for(let q in B){let F=B[q];for(let L in F)f(F[L].object),delete F[L];delete B[q]}delete o[O]}}function C(O){if(o[O.id]===void 0)return;let B=o[O.id];for(let q in B){let F=B[q];for(let L in F)f(F[L].object),delete F[L];delete B[q]}delete o[O.id]}function T(O){for(let B in o){let q=o[B];if(q[O.id]===void 0)continue;let F=q[O.id];for(let L in F)f(F[L].object),delete F[L];delete q[O.id]}}function D(){I(),u=!0,c!==l&&(c=l,p(c.object))}function I(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:D,resetDefaultState:I,dispose:M,releaseStatesOfGeometry:C,releaseStatesOfProgram:T,initAttributes:x,enableAttribute:w,disableUnusedAttributes:_}}function MG(e,t,i,r){let a=r.isWebGL2,s;function n(c){s=c}function o(c,u){e.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,p;if(a)d=e,p="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](s,c,u,h),i.update(u,s,h)}this.setMode=n,this.render=o,this.renderInstances=l}function TG(e,t,i){let r;function a(){if(r!==void 0)return r;if(t.has("EXT_texture_filter_anisotropic")===!0){let A=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(A){if(A==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return A==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let n=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=n||t.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=e.getParameter(34930),d=e.getParameter(35660),p=e.getParameter(3379),f=e.getParameter(34076),m=e.getParameter(34921),g=e.getParameter(36347),v=e.getParameter(36348),y=e.getParameter(36349),x=d>0,w=n||t.has("OES_texture_float"),S=x&&w,_=n?e.getParameter(36183):0;return{isWebGL2:n,drawBuffers:c,getMaxAnisotropy:a,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:f,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:x,floatFragmentTextures:w,floatVertexTextures:S,maxSamples:_}}function PG(e){let t=this,i=null,r=0,a=!1,s=!1,n=new Ya,o=new Ui,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let p=h.length!==0||d||r!==0||a;return a=d,r=h.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,p){let f=h.clippingPlanes,m=h.clipIntersection,g=h.clipShadows,v=e.get(h);if(!a||f===null||f.length===0||s&&!g)s?u(null):c();else{let y=s?0:r,x=y*4,w=v.clippingState||null;l.value=w,w=u(f,d,x,p);for(let S=0;S!==x;++S)w[S]=i[S];v.clippingState=w,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function u(h,d,p,f){let m=h!==null?h.length:0,g=null;if(m!==0){if(g=l.value,f!==!0||g===null){let v=p+m*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(g===null||g.length<v)&&(g=new Float32Array(v));for(let x=0,w=p;x!==m;++x,w+=4)n.copy(h[x]).applyMatrix4(y,o),n.normal.toArray(g,w),g[w+3]=n.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}}function DG(e){let t=new WeakMap;function i(n,o){return o===G_?n.mapping=uh:o===H_&&(n.mapping=dh),n}function r(n){if(n&&n.isTexture&&n.isRenderTargetTexture===!1){let o=n.mapping;if(o===G_||o===H_)if(t.has(n)){let l=t.get(n).texture;return i(l,n.mapping)}else{let l=n.image;if(l&&l.height>0){let c=new GV(l.height/2);return c.fromEquirectangularTexture(e,n),t.set(n,c),n.addEventListener("dispose",a),i(c.texture,n.mapping)}else return null}}return n}function a(n){let o=n.target;o.removeEventListener("dispose",a);let l=t.get(o);l!==void 0&&(t.delete(o),l.dispose())}function s(){t=new WeakMap}return{get:r,dispose:s}}var cE=class extends Sh{constructor(e=-1,t=1,i=1,r=-1,a=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=a,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,a,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,a=i-e,s=i+e,n=r+t,o=r-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=l*this.view.offsetX,s=a+l*this.view.width,n-=c*this.view.offsetY,o=n-c*this.view.height}this.projectionMatrix.makeOrthographic(a,s,n,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}},Uu=4,lT=[.125,.215,.35,.446,.526,.582],Oc=20,ub=new cE,cT=new tt,db=null,Cc=(1+Math.sqrt(5))/2,Wh=1/Cc,hT=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,Cc,Wh),new P(0,Cc,-Wh),new P(Wh,0,Cc),new P(-Wh,0,Cc),new P(Cc,Wh,0),new P(-Cc,Wh,0)],uT=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){db=this._renderer.getRenderTarget(),this._setSize(256);let a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,i,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=fT(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=pT(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(db),e.scissorTest=!1,Bg(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===uh||e.mapping===dh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),db=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:bt,minFilter:bt,generateMipmaps:!1,type:ph,format:Sr,encoding:ln,depthBuffer:!1},r=dT(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=dT(e,t,i);let{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=OG(a)),this._blurMaterial=IG(a,e,t)}return r}_compileMaterial(e){let t=new tr(this._lodPlanes[0],e);this._renderer.compile(t,ub)}_sceneToCubeUV(e,t,i,r){let a=new Jr(90,1,t,i),s=[1,-1,1,1,1,1],n=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(cT),o.toneMapping=qn,o.autoClear=!1;let u=new _h({name:"PMREM.Background",side:Er,depthWrite:!1,depthTest:!1}),h=new tr(new cn,u),d=!1,p=e.background;p?p.isColor&&(u.color.copy(p),e.background=null,d=!0):(u.color.copy(cT),d=!0);for(let f=0;f<6;f++){let m=f%3;m===0?(a.up.set(0,s[f],0),a.lookAt(n[f],0,0)):m===1?(a.up.set(0,0,s[f]),a.lookAt(0,n[f],0)):(a.up.set(0,s[f],0),a.lookAt(0,0,n[f]));let g=this._cubeSize;Bg(r,m*g,f>2?g:0,g,g),o.setRenderTarget(r),d&&o.render(h,a),o.render(e,a)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,r=e.mapping===uh||e.mapping===dh;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=fT()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=pT());let a=r?this._cubemapMaterial:this._equirectMaterial,s=new tr(this._lodPlanes[0],a),n=a.uniforms;n.envMap.value=e;let o=this._cubeSize;Bg(t,0,0,3*o,2*o),i.setRenderTarget(t),i.render(s,ub)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=hT[(r-1)%hT.length];this._blur(e,r-1,r,a,s)}t.autoClear=i}_blur(e,t,i,r,a){let s=this._pingPongRenderTarget;this._halfBlur(e,s,t,i,r,"latitudinal",a),this._halfBlur(s,e,i,i,r,"longitudinal",a)}_halfBlur(e,t,i,r,a,s,n){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new tr(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,p=isFinite(a)?Math.PI/(2*d):2*Math.PI/(2*Oc-1),f=a/p,m=isFinite(a)?1+Math.floor(c*f):Oc;m>Oc&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Oc}`);let g=[],v=0;for(let _=0;_<Oc;++_){let A=_/f,E=Math.exp(-A*A/2);g.push(E),_===0?v+=E:_<m&&(v+=2*E)}for(let _=0;_<g.length;_++)g[_]=g[_]/v;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=g,h.latitudinal.value=s==="latitudinal",n&&(h.poleAxis.value=n);let{_lodMax:y}=this;h.dTheta.value=p,h.mipInt.value=y-i;let x=this._sizeLods[r],w=3*x*(r>y-Uu?r-y+Uu:0),S=4*(this._cubeSize-x);Bg(t,w,S,3*x,2*x),o.setRenderTarget(t),o.render(u,ub)}};function OG(e){let t=[],i=[],r=[],a=e,s=e-Uu+1+lT.length;for(let n=0;n<s;n++){let o=Math.pow(2,a);i.push(o);let l=1/o;n>e-Uu?l=lT[n-e+Uu-1]:n===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),x=new Float32Array(g*f*p),w=new Float32Array(v*f*p);for(let _=0;_<p;_++){let A=_%3*2/3-1,E=_>2?0:-1,M=[A,E,0,A+2/3,E,0,A+2/3,E+1,0,A,E,0,A+2/3,E+1,0,A,E+1,0];y.set(M,m*f*_),x.set(d,g*f*_);let C=[_,_,_,_,_,_];w.set(C,v*f*_)}let S=new Qe;S.setAttribute("position",new ht(y,m)),S.setAttribute("uv",new ht(x,g)),S.setAttribute("faceIndex",new ht(w,v)),t.push(S),a>Uu&&a--}return{lodPlanes:t,sizeLods:i,sigmas:r}}function dT(e,t,i){let r=new Ht(e,t,i);return r.texture.mapping=Nm,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Bg(e,t,i,r,a){e.viewport.set(t,i,r,a),e.scissor.set(t,i,r,a)}function IG(e,t,i){let r=new Float32Array(Oc),a=new P(0,1,0);return new Wt({name:"SphericalGaussianBlur",defines:{n:Oc,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:hE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ir,depthTest:!1,depthWrite:!1})}function pT(){return new Wt({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:hE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ir,depthTest:!1,depthWrite:!1})}function fT(){return new Wt({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:hE(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ir,depthTest:!1,depthWrite:!1})}function hE(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function RG(e){let t=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===G_||l===H_,u=l===uh||l===dh;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=t.get(o);return i===null&&(i=new uT(e)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),t.set(o,h),h.texture}else{if(t.has(o))return t.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&a(h)){i===null&&(i=new uT(e));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return t.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function a(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function n(){t=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:n}}function LG(e){let t={};function i(r){if(t[r]!==void 0)return t[r];let a;switch(r){case"WEBGL_depth_texture":a=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":a=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:a=e.getExtension(r)}return t[r]=a,a}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let a=i(r);return a===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),a}}}function kG(e,t,i,r){let a={},s=new WeakMap;function n(h){let d=h.target;d.index!==null&&t.remove(d.index);for(let f in d.attributes)t.remove(d.attributes[f]);d.removeEventListener("dispose",n),delete a[d.id];let p=s.get(d);p&&(t.remove(p),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return a[d.id]===!0||(d.addEventListener("dispose",n),a[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let f in d)t.update(d[f],34962);let p=h.morphAttributes;for(let f in p){let m=p[f];for(let g=0,v=m.length;g<v;g++)t.update(m[g],34962)}}function c(h){let d=[],p=h.index,f=h.attributes.position,m=0;if(p!==null){let y=p.array;m=p.version;for(let x=0,w=y.length;x<w;x+=3){let S=y[x+0],_=y[x+1],A=y[x+2];d.push(S,_,_,A,A,S)}}else{let y=f.array;m=f.version;for(let x=0,w=y.length/3-1;x<w;x+=3){let S=x+0,_=x+1,A=x+2;d.push(S,_,_,A,A,S)}}let g=new(Nk(d)?Ju:Vk)(d,1);g.version=m;let v=s.get(h);v&&t.remove(v),s.set(h,g)}function u(h){let d=s.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function zG(e,t,i,r){let a=r.isWebGL2,s;function n(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,p){e.drawElements(s,p,o,d*l),i.update(p,s,1)}function h(d,p,f){if(f===0)return;let m,g;if(a)m=e,g="drawElementsInstanced";else if(m=t.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[g](s,p,o,d*l,f),i.update(p,s,f)}this.setMode=n,this.setIndex=c,this.render=u,this.renderInstances=h}function NG(e){let t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,n,o){switch(i.calls++,n){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n);break}}function a(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:a,update:r}}function BG(e,t){return e[0]-t[0]}function jG(e,t){return Math.abs(t[1])-Math.abs(e[1])}function FG(e,t,i){let r={},a=new Float32Array(8),s=new WeakMap,n=new dt,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let p=c.morphTargetInfluences;if(t.isWebGL2===!0){let f=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=f!==void 0?f.length:0,g=s.get(u);if(g===void 0||g.count!==m){let x=function(){O.dispose(),s.delete(u),u.removeEventListener("dispose",x)};g!==void 0&&g.texture.dispose();let w=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,_=u.morphAttributes.color!==void 0,A=u.morphAttributes.position||[],E=u.morphAttributes.normal||[],M=u.morphAttributes.color||[],C=0;w===!0&&(C=1),S===!0&&(C=2),_===!0&&(C=3);let T=u.attributes.position.count*C,D=1;T>t.maxTextureSize&&(D=Math.ceil(T/t.maxTextureSize),T=t.maxTextureSize);let I=new Float32Array(T*D*4*m),O=new Uk(I,T,D,m);O.type=er,O.needsUpdate=!0;let B=C*4;for(let q=0;q<m;q++){let F=A[q],L=E[q],X=M[q],G=T*D*4*q;for(let U=0;U<F.count;U++){let H=U*B;w===!0&&(n.fromBufferAttribute(F,U),I[G+H+0]=n.x,I[G+H+1]=n.y,I[G+H+2]=n.z,I[G+H+3]=0),S===!0&&(n.fromBufferAttribute(L,U),I[G+H+4]=n.x,I[G+H+5]=n.y,I[G+H+6]=n.z,I[G+H+7]=0),_===!0&&(n.fromBufferAttribute(X,U),I[G+H+8]=n.x,I[G+H+9]=n.y,I[G+H+10]=n.z,I[G+H+11]=X.itemSize===4?n.w:1)}}g={count:m,texture:O,size:new Q(T,D)},s.set(u,g),u.addEventListener("dispose",x)}let v=0;for(let x=0;x<p.length;x++)v+=p[x];let y=u.morphTargetsRelative?1:1-v;d.getUniforms().setValue(e,"morphTargetBaseInfluence",y),d.getUniforms().setValue(e,"morphTargetInfluences",p),d.getUniforms().setValue(e,"morphTargetsTexture",g.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",g.size)}else{let f=p===void 0?0:p.length,m=r[u.id];if(m===void 0||m.length!==f){m=[];for(let w=0;w<f;w++)m[w]=[w,0];r[u.id]=m}for(let w=0;w<f;w++){let S=m[w];S[0]=w,S[1]=p[w]}m.sort(jG);for(let w=0;w<8;w++)w<f&&m[w][1]?(o[w][0]=m[w][0],o[w][1]=m[w][1]):(o[w][0]=Number.MAX_SAFE_INTEGER,o[w][1]=0);o.sort(BG);let g=u.morphAttributes.position,v=u.morphAttributes.normal,y=0;for(let w=0;w<8;w++){let S=o[w],_=S[0],A=S[1];_!==Number.MAX_SAFE_INTEGER&&A?(g&&u.getAttribute("morphTarget"+w)!==g[_]&&u.setAttribute("morphTarget"+w,g[_]),v&&u.getAttribute("morphNormal"+w)!==v[_]&&u.setAttribute("morphNormal"+w,v[_]),a[w]=A,y+=A):(g&&u.hasAttribute("morphTarget"+w)===!0&&u.deleteAttribute("morphTarget"+w),v&&u.hasAttribute("morphNormal"+w)===!0&&u.deleteAttribute("morphNormal"+w),a[w]=0)}let x=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(e,"morphTargetBaseInfluence",x),d.getUniforms().setValue(e,"morphTargetInfluences",a)}}return{update:l}}function UG(e,t,i,r){let a=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=t.get(l,u);return a.get(h)!==c&&(t.update(h),a.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function n(){a=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:n}}var Wk=new Si,qk=new Uk,Xk=new MV,Yk=new oE,mT=[],gT=[],vT=new Float32Array(16),yT=new Float32Array(9),xT=new Float32Array(4);function Kd(e,t,i){let r=e[0];if(r<=0||r>0)return e;let a=t*i,s=mT[a];if(s===void 0&&(s=new Float32Array(a),mT[a]=s),t!==0){r.toArray(s,0);for(let n=1,o=0;n!==t;++n)o+=i,e[n].toArray(s,o)}return s}function pr(e,t){if(e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}function fr(e,t){for(let i=0,r=t.length;i<r;i++)e[i]=t[i]}function w1(e,t){let i=gT[t];i===void 0&&(i=new Int32Array(t),gT[t]=i);for(let r=0;r!==t;++r)i[r]=e.allocateTextureUnit();return i}function VG(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function GG(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(pr(i,t))return;e.uniform2fv(this.addr,t),fr(i,t)}}function HG(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(pr(i,t))return;e.uniform3fv(this.addr,t),fr(i,t)}}function WG(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(pr(i,t))return;e.uniform4fv(this.addr,t),fr(i,t)}}function qG(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(pr(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),fr(i,t)}else{if(pr(i,r))return;xT.set(r),e.uniformMatrix2fv(this.addr,!1,xT),fr(i,r)}}function XG(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(pr(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),fr(i,t)}else{if(pr(i,r))return;yT.set(r),e.uniformMatrix3fv(this.addr,!1,yT),fr(i,r)}}function YG(e,t){let i=this.cache,r=t.elements;if(r===void 0){if(pr(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),fr(i,t)}else{if(pr(i,r))return;vT.set(r),e.uniformMatrix4fv(this.addr,!1,vT),fr(i,r)}}function QG(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function ZG(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(pr(i,t))return;e.uniform2iv(this.addr,t),fr(i,t)}}function KG(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(pr(i,t))return;e.uniform3iv(this.addr,t),fr(i,t)}}function $G(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(pr(i,t))return;e.uniform4iv(this.addr,t),fr(i,t)}}function JG(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function eH(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(pr(i,t))return;e.uniform2uiv(this.addr,t),fr(i,t)}}function tH(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(pr(i,t))return;e.uniform3uiv(this.addr,t),fr(i,t)}}function iH(e,t){let i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(pr(i,t))return;e.uniform4uiv(this.addr,t),fr(i,t)}}function rH(e,t,i){let r=this.cache,a=i.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),i.setTexture2D(t||Wk,a)}function aH(e,t,i){let r=this.cache,a=i.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),i.setTexture3D(t||Xk,a)}function sH(e,t,i){let r=this.cache,a=i.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),i.setTextureCube(t||Yk,a)}function nH(e,t,i){let r=this.cache,a=i.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),i.setTexture2DArray(t||qk,a)}function oH(e){switch(e){case 5126:return VG;case 35664:return GG;case 35665:return HG;case 35666:return WG;case 35674:return qG;case 35675:return XG;case 35676:return YG;case 5124:case 35670:return QG;case 35667:case 35671:return ZG;case 35668:case 35672:return KG;case 35669:case 35673:return $G;case 5125:return JG;case 36294:return eH;case 36295:return tH;case 36296:return iH;case 35678:case 36198:case 36298:case 36306:case 35682:return rH;case 35679:case 36299:case 36307:return aH;case 35680:case 36300:case 36308:case 36293:return sH;case 36289:case 36303:case 36311:case 36292:return nH}}function lH(e,t){e.uniform1fv(this.addr,t)}function cH(e,t){let i=Kd(t,this.size,2);e.uniform2fv(this.addr,i)}function hH(e,t){let i=Kd(t,this.size,3);e.uniform3fv(this.addr,i)}function uH(e,t){let i=Kd(t,this.size,4);e.uniform4fv(this.addr,i)}function dH(e,t){let i=Kd(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function pH(e,t){let i=Kd(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function fH(e,t){let i=Kd(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function mH(e,t){e.uniform1iv(this.addr,t)}function gH(e,t){e.uniform2iv(this.addr,t)}function vH(e,t){e.uniform3iv(this.addr,t)}function yH(e,t){e.uniform4iv(this.addr,t)}function xH(e,t){e.uniform1uiv(this.addr,t)}function bH(e,t){e.uniform2uiv(this.addr,t)}function wH(e,t){e.uniform3uiv(this.addr,t)}function _H(e,t){e.uniform4uiv(this.addr,t)}function SH(e,t,i){let r=this.cache,a=t.length,s=w1(i,a);pr(r,s)||(e.uniform1iv(this.addr,s),fr(r,s));for(let n=0;n!==a;++n)i.setTexture2D(t[n]||Wk,s[n])}function AH(e,t,i){let r=this.cache,a=t.length,s=w1(i,a);pr(r,s)||(e.uniform1iv(this.addr,s),fr(r,s));for(let n=0;n!==a;++n)i.setTexture3D(t[n]||Xk,s[n])}function EH(e,t,i){let r=this.cache,a=t.length,s=w1(i,a);pr(r,s)||(e.uniform1iv(this.addr,s),fr(r,s));for(let n=0;n!==a;++n)i.setTextureCube(t[n]||Yk,s[n])}function CH(e,t,i){let r=this.cache,a=t.length,s=w1(i,a);pr(r,s)||(e.uniform1iv(this.addr,s),fr(r,s));for(let n=0;n!==a;++n)i.setTexture2DArray(t[n]||qk,s[n])}function MH(e){switch(e){case 5126:return lH;case 35664:return cH;case 35665:return hH;case 35666:return uH;case 35674:return dH;case 35675:return pH;case 35676:return fH;case 5124:case 35670:return mH;case 35667:case 35671:return gH;case 35668:case 35672:return vH;case 35669:case 35673:return yH;case 5125:return xH;case 36294:return bH;case 36295:return wH;case 36296:return _H;case 35678:case 36198:case 36298:case 36306:case 35682:return SH;case 35679:case 36299:case 36307:return AH;case 35680:case 36300:case 36308:case 36293:return EH;case 36289:case 36303:case 36311:case 36292:return CH}}var TH=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=oH(t.type)}},PH=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=MH(t.type)}},DH=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let r=this.seq;for(let a=0,s=r.length;a!==s;++a){let n=r[a];n.setValue(e,t[n.id],i)}}},pb=/(\w+)(\])?(\[|\.)?/g;function bT(e,t){e.seq.push(t),e.map[t.id]=t}function OH(e,t,i){let r=e.name,a=r.length;for(pb.lastIndex=0;;){let s=pb.exec(r),n=pb.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&n+2===a){bT(i,c===void 0?new TH(o,e,t):new PH(o,e,t));break}else{let u=i.map[o];u===void 0&&(u=new DH(o),bT(i,u)),i=u}}}var a0=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){let a=e.getActiveUniform(t,r),s=e.getUniformLocation(t,a.name);OH(a,s,this)}}setValue(e,t,i,r){let a=this.map[t];a!==void 0&&a.setValue(e,i,r)}setOptional(e,t,i){let r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let a=0,s=t.length;a!==s;++a){let n=t[a],o=i[n.id];o.needsUpdate!==!1&&n.setValue(e,o.value,r)}}static seqWithValue(e,t){let i=[];for(let r=0,a=e.length;r!==a;++r){let s=e[r];s.id in t&&i.push(s)}return i}};function wT(e,t,i){let r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),r}var IH=0;function RH(e,t){let i=e.split(`
`),r=[],a=Math.max(t-6,0),s=Math.min(t+6,i.length);for(let n=a;n<s;n++){let o=n+1;r.push(`${o===t?">":" "} ${o}: ${i[n]}`)}return r.join(`
`)}function LH(e){switch(e){case ln:return["Linear","( value )"];case yt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function _T(e,t,i){let r=e.getShaderParameter(t,35713),a=e.getShaderInfoLog(t).trim();if(r&&a==="")return"";let s=/ERROR: 0:(\d+)/.exec(a);if(s){let n=parseInt(s[1]);return i.toUpperCase()+`

`+a+`

`+RH(e.getShaderSource(t),n)}else return a}function kH(e,t){let i=LH(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function zH(e,t){let i;switch(t){case V8:i="Linear";break;case G8:i="Reinhard";break;case H8:i="OptimizedCineon";break;case W8:i="ACESFilmic";break;case q8:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function NH(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(of).join(`
`)}function BH(e){let t=[];for(let i in e){let r=e[i];r!==!1&&t.push("#define "+i+" "+r)}return t.join(`
`)}function jH(e,t){let i={},r=e.getProgramParameter(t,35721);for(let a=0;a<r;a++){let s=e.getActiveAttrib(t,a),n=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[n]={type:s.type,location:e.getAttribLocation(t,n),locationSize:o}}return i}function of(e){return e!==""}function ST(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function AT(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var FH=/^[ \t]*#include +<([\w\d./]+)>/gm;function Q_(e){return e.replace(FH,UH)}function UH(e,t){let i=xt[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return Q_(i)}var VH=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ET(e){return e.replace(VH,GH)}function GH(e,t,i,r){let a="";for(let s=parseInt(t);s<parseInt(i);s++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return a}function CT(e){let t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function HH(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===iE?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===b8?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===nf&&(t="SHADOWMAP_TYPE_VSM"),t}function WH(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case uh:case dh:t="ENVMAP_TYPE_CUBE";break;case Nm:t="ENVMAP_TYPE_CUBE_UV";break}return t}function qH(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case dh:t="ENVMAP_MODE_REFRACTION";break}return t}function XH(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Pk:t="ENVMAP_BLENDING_MULTIPLY";break;case F8:t="ENVMAP_BLENDING_MIX";break;case U8:t="ENVMAP_BLENDING_ADD";break}return t}function YH(e){let t=e.envMapCubeUVHeight;if(t===null)return null;let i=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),7*16)),texelHeight:r,maxMip:i}}function QH(e,t,i,r){let a=e.getContext(),s=i.defines,n=i.vertexShader,o=i.fragmentShader,l=HH(i),c=WH(i),u=qH(i),h=XH(i),d=YH(i),p=i.isWebGL2?"":NH(i),f=BH(s),m=a.createProgram(),g,v,y=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(g=[f].filter(of).join(`
`),g.length>0&&(g+=`
`),v=[p,f].filter(of).join(`
`),v.length>0&&(v+=`
`)):(g=[CT(i),"#define SHADER_NAME "+i.shaderName,f,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(of).join(`
`),v=[p,CT(i),"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==qn?"#define TONE_MAPPING":"",i.toneMapping!==qn?xt.tonemapping_pars_fragment:"",i.toneMapping!==qn?zH("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",xt.encodings_pars_fragment,kH("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(of).join(`
`)),n=Q_(n),n=ST(n,i),n=AT(n,i),o=Q_(o),o=ST(o,i),o=AT(o,i),n=ET(n),o=ET(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,v=["#define varying in",i.glslVersion===Z3?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Z3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);let x=y+g+n,w=y+v+o,S=wT(a,35633,x),_=wT(a,35632,w);if(a.attachShader(m,S),a.attachShader(m,_),i.index0AttributeName!==void 0?a.bindAttribLocation(m,0,i.index0AttributeName):i.morphTargets===!0&&a.bindAttribLocation(m,0,"position"),a.linkProgram(m),e.debug.checkShaderErrors){let M=a.getProgramInfoLog(m).trim(),C=a.getShaderInfoLog(S).trim(),T=a.getShaderInfoLog(_).trim(),D=!0,I=!0;if(a.getProgramParameter(m,35714)===!1){D=!1;let O=_T(a,S,"vertex"),B=_T(a,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(m,35715)+`

Program Info Log: `+M+`
`+O+`
`+B)}else M!==""?console.warn("THREE.WebGLProgram: Program Info Log:",M):(C===""||T==="")&&(I=!1);I&&(this.diagnostics={runnable:D,programLog:M,vertexShader:{log:C,prefix:g},fragmentShader:{log:T,prefix:v}})}a.deleteShader(S),a.deleteShader(_);let A;this.getUniforms=function(){return A===void 0&&(A=new a0(a,m)),A};let E;return this.getAttributes=function(){return E===void 0&&(E=jH(a,m)),E},this.destroy=function(){r.releaseStatesOfProgram(this),a.deleteProgram(m),this.program=void 0},this.name=i.shaderName,this.id=IH++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=S,this.fragmentShader=_,this}var ZH=0,KH=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(i),s=this._getShaderCacheForMaterial(e);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(a)===!1&&(s.add(a),a.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return i===void 0&&(i=new $H(e),t.set(e,i)),i}},$H=class{constructor(e){this.id=ZH++,this.code=e,this.usedTimes=0}};function JH(e,t,i,r,a,s,n){let o=new nE,l=new KH,c=[],u=a.isWebGL2,h=a.logarithmicDepthBuffer,d=a.vertexTextures,p=a.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(E,M,C,T,D){let I=T.fog,O=D.geometry,B=E.isMeshStandardMaterial?T.environment:null,q=(E.isMeshStandardMaterial?i:t).get(E.envMap||B),F=q&&q.mapping===Nm?q.image.height:null,L=f[E.type];E.precision!==null&&(p=a.getMaxPrecision(E.precision),p!==E.precision&&console.warn("THREE.WebGLProgram.getParameters:",E.precision,"not supported, using",p,"instead."));let X=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,G=X!==void 0?X.length:0,U=0;O.morphAttributes.position!==void 0&&(U=1),O.morphAttributes.normal!==void 0&&(U=2),O.morphAttributes.color!==void 0&&(U=3);let H,$,Y,J;if(L){let le=Rn[L];H=le.vertexShader,$=le.fragmentShader}else H=E.vertexShader,$=E.fragmentShader,l.update(E),Y=l.getVertexShaderID(E),J=l.getFragmentShaderID(E);let Z=e.getRenderTarget(),ne=E.alphaTest>0,re=E.clearcoat>0,ie=E.iridescence>0;return{isWebGL2:u,shaderID:L,shaderName:E.type,vertexShader:H,fragmentShader:$,defines:E.defines,customVertexShaderID:Y,customFragmentShaderID:J,isRawShaderMaterial:E.isRawShaderMaterial===!0,glslVersion:E.glslVersion,precision:p,instancing:D.isInstancedMesh===!0,instancingColor:D.isInstancedMesh===!0&&D.instanceColor!==null,supportsVertexTextures:d,outputEncoding:Z===null?e.outputEncoding:Z.isXRRenderTarget===!0?Z.texture.encoding:ln,map:!!E.map,matcap:!!E.matcap,envMap:!!q,envMapMode:q&&q.mapping,envMapCubeUVHeight:F,lightMap:!!E.lightMap,aoMap:!!E.aoMap,emissiveMap:!!E.emissiveMap,bumpMap:!!E.bumpMap,normalMap:!!E.normalMap,objectSpaceNormalMap:E.normalMapType===cV,tangentSpaceNormalMap:E.normalMapType===lV,decodeVideoTexture:!!E.map&&E.map.isVideoTexture===!0&&E.map.encoding===yt,clearcoat:re,clearcoatMap:re&&!!E.clearcoatMap,clearcoatRoughnessMap:re&&!!E.clearcoatRoughnessMap,clearcoatNormalMap:re&&!!E.clearcoatNormalMap,iridescence:ie,iridescenceMap:ie&&!!E.iridescenceMap,iridescenceThicknessMap:ie&&!!E.iridescenceThicknessMap,displacementMap:!!E.displacementMap,roughnessMap:!!E.roughnessMap,metalnessMap:!!E.metalnessMap,specularMap:!!E.specularMap,specularIntensityMap:!!E.specularIntensityMap,specularColorMap:!!E.specularColorMap,opaque:E.transparent===!1&&E.blending===$c,alphaMap:!!E.alphaMap,alphaTest:ne,gradientMap:!!E.gradientMap,sheen:E.sheen>0,sheenColorMap:!!E.sheenColorMap,sheenRoughnessMap:!!E.sheenRoughnessMap,transmission:E.transmission>0,transmissionMap:!!E.transmissionMap,thicknessMap:!!E.thicknessMap,combine:E.combine,vertexTangents:!!E.normalMap&&!!O.attributes.tangent,vertexColors:E.vertexColors,vertexAlphas:E.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,vertexUvs:!!E.map||!!E.bumpMap||!!E.normalMap||!!E.specularMap||!!E.alphaMap||!!E.emissiveMap||!!E.roughnessMap||!!E.metalnessMap||!!E.clearcoatMap||!!E.clearcoatRoughnessMap||!!E.clearcoatNormalMap||!!E.iridescenceMap||!!E.iridescenceThicknessMap||!!E.displacementMap||!!E.transmissionMap||!!E.thicknessMap||!!E.specularIntensityMap||!!E.specularColorMap||!!E.sheenColorMap||!!E.sheenRoughnessMap,uvsVertexOnly:!(E.map||E.bumpMap||E.normalMap||E.specularMap||E.alphaMap||E.emissiveMap||E.roughnessMap||E.metalnessMap||E.clearcoatNormalMap||E.iridescenceMap||E.iridescenceThicknessMap||E.transmission>0||E.transmissionMap||E.thicknessMap||E.specularIntensityMap||E.specularColorMap||E.sheen>0||E.sheenColorMap||E.sheenRoughnessMap)&&!!E.displacementMap,fog:!!I,useFog:E.fog===!0,fogExp2:I&&I.isFogExp2,flatShading:!!E.flatShading,sizeAttenuation:E.sizeAttenuation,logarithmicDepthBuffer:h,skinning:D.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:G,morphTextureStride:U,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:E.dithering,shadowMapEnabled:e.shadowMap.enabled&&C.length>0,shadowMapType:e.shadowMap.type,toneMapping:E.toneMapped?e.toneMapping:qn,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:E.premultipliedAlpha,doubleSided:E.side===La,flipSided:E.side===Er,useDepthPacking:!!E.depthPacking,depthPacking:E.depthPacking||0,index0AttributeName:E.index0AttributeName,extensionDerivatives:E.extensions&&E.extensions.derivatives,extensionFragDepth:E.extensions&&E.extensions.fragDepth,extensionDrawBuffers:E.extensions&&E.extensions.drawBuffers,extensionShaderTextureLOD:E.extensions&&E.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:E.customProgramCacheKey()}}function g(E){let M=[];if(E.shaderID?M.push(E.shaderID):(M.push(E.customVertexShaderID),M.push(E.customFragmentShaderID)),E.defines!==void 0)for(let C in E.defines)M.push(C),M.push(E.defines[C]);return E.isRawShaderMaterial===!1&&(v(M,E),y(M,E),M.push(e.outputEncoding)),M.push(E.customProgramCacheKey),M.join()}function v(E,M){E.push(M.precision),E.push(M.outputEncoding),E.push(M.envMapMode),E.push(M.envMapCubeUVHeight),E.push(M.combine),E.push(M.vertexUvs),E.push(M.fogExp2),E.push(M.sizeAttenuation),E.push(M.morphTargetsCount),E.push(M.morphAttributeCount),E.push(M.numDirLights),E.push(M.numPointLights),E.push(M.numSpotLights),E.push(M.numSpotLightMaps),E.push(M.numHemiLights),E.push(M.numRectAreaLights),E.push(M.numDirLightShadows),E.push(M.numPointLightShadows),E.push(M.numSpotLightShadows),E.push(M.numSpotLightShadowsWithMaps),E.push(M.shadowMapType),E.push(M.toneMapping),E.push(M.numClippingPlanes),E.push(M.numClipIntersection),E.push(M.depthPacking)}function y(E,M){o.disableAll(),M.isWebGL2&&o.enable(0),M.supportsVertexTextures&&o.enable(1),M.instancing&&o.enable(2),M.instancingColor&&o.enable(3),M.map&&o.enable(4),M.matcap&&o.enable(5),M.envMap&&o.enable(6),M.lightMap&&o.enable(7),M.aoMap&&o.enable(8),M.emissiveMap&&o.enable(9),M.bumpMap&&o.enable(10),M.normalMap&&o.enable(11),M.objectSpaceNormalMap&&o.enable(12),M.tangentSpaceNormalMap&&o.enable(13),M.clearcoat&&o.enable(14),M.clearcoatMap&&o.enable(15),M.clearcoatRoughnessMap&&o.enable(16),M.clearcoatNormalMap&&o.enable(17),M.iridescence&&o.enable(18),M.iridescenceMap&&o.enable(19),M.iridescenceThicknessMap&&o.enable(20),M.displacementMap&&o.enable(21),M.specularMap&&o.enable(22),M.roughnessMap&&o.enable(23),M.metalnessMap&&o.enable(24),M.gradientMap&&o.enable(25),M.alphaMap&&o.enable(26),M.alphaTest&&o.enable(27),M.vertexColors&&o.enable(28),M.vertexAlphas&&o.enable(29),M.vertexUvs&&o.enable(30),M.vertexTangents&&o.enable(31),M.uvsVertexOnly&&o.enable(32),E.push(o.mask),o.disableAll(),M.fog&&o.enable(0),M.useFog&&o.enable(1),M.flatShading&&o.enable(2),M.logarithmicDepthBuffer&&o.enable(3),M.skinning&&o.enable(4),M.morphTargets&&o.enable(5),M.morphNormals&&o.enable(6),M.morphColors&&o.enable(7),M.premultipliedAlpha&&o.enable(8),M.shadowMapEnabled&&o.enable(9),M.physicallyCorrectLights&&o.enable(10),M.doubleSided&&o.enable(11),M.flipSided&&o.enable(12),M.useDepthPacking&&o.enable(13),M.dithering&&o.enable(14),M.specularIntensityMap&&o.enable(15),M.specularColorMap&&o.enable(16),M.transmission&&o.enable(17),M.transmissionMap&&o.enable(18),M.thicknessMap&&o.enable(19),M.sheen&&o.enable(20),M.sheenColorMap&&o.enable(21),M.sheenRoughnessMap&&o.enable(22),M.decodeVideoTexture&&o.enable(23),M.opaque&&o.enable(24),E.push(o.mask)}function x(E){let M=f[E.type],C;if(M){let T=Rn[M];C=Zd.clone(T.uniforms)}else C=E.uniforms;return C}function w(E,M){let C;for(let T=0,D=c.length;T<D;T++){let I=c[T];if(I.cacheKey===M){C=I,++C.usedTimes;break}}return C===void 0&&(C=new QH(e,M,E,s),c.push(C)),C}function S(E){if(--E.usedTimes===0){let M=c.indexOf(E);c[M]=c[c.length-1],c.pop(),E.destroy()}}function _(E){l.remove(E)}function A(){l.dispose()}return{getParameters:m,getProgramCacheKey:g,getUniforms:x,acquireProgram:w,releaseProgram:S,releaseShaderCache:_,programs:c,dispose:A}}function eW(){let e=new WeakMap;function t(s){let n=e.get(s);return n===void 0&&(n={},e.set(s,n)),n}function i(s){e.delete(s)}function r(s,n,o){e.get(s)[n]=o}function a(){e=new WeakMap}return{get:t,remove:i,update:r,dispose:a}}function tW(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function MT(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function TT(){let e=[],t=0,i=[],r=[],a=[];function s(){t=0,i.length=0,r.length=0,a.length=0}function n(h,d,p,f,m,g){let v=e[t];return v===void 0?(v={id:h.id,object:h,geometry:d,material:p,groupOrder:f,renderOrder:h.renderOrder,z:m,group:g},e[t]=v):(v.id=h.id,v.object=h,v.geometry=d,v.material=p,v.groupOrder=f,v.renderOrder=h.renderOrder,v.z=m,v.group=g),t++,v}function o(h,d,p,f,m,g){let v=n(h,d,p,f,m,g);p.transmission>0?r.push(v):p.transparent===!0?a.push(v):i.push(v)}function l(h,d,p,f,m,g){let v=n(h,d,p,f,m,g);p.transmission>0?r.unshift(v):p.transparent===!0?a.unshift(v):i.unshift(v)}function c(h,d){i.length>1&&i.sort(h||tW),r.length>1&&r.sort(d||MT),a.length>1&&a.sort(d||MT)}function u(){for(let h=t,d=e.length;h<d;h++){let p=e[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:i,transmissive:r,transparent:a,init:s,push:o,unshift:l,finish:u,sort:c}}function iW(){let e=new WeakMap;function t(r,a){let s=e.get(r),n;return s===void 0?(n=new TT,e.set(r,[n])):a>=s.length?(n=new TT,s.push(n)):n=s[a],n}function i(){e=new WeakMap}return{get:t,dispose:i}}function rW(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new P,color:new tt};break;case"SpotLight":i={position:new P,direction:new P,color:new tt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new P,color:new tt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new P,skyColor:new tt,groundColor:new tt};break;case"RectAreaLight":i={color:new tt,position:new P,halfWidth:new P,halfHeight:new P};break}return e[t.id]=i,i}}}function aW(){let e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];let i;switch(t.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Q,shadowCameraNear:1,shadowCameraFar:1e3};break}return e[t.id]=i,i}}}var sW=0;function nW(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function oW(e,t){let i=new rW,r=aW(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)a.probe.push(new P);let s=new P,n=new Se,o=new Se;function l(u,h){let d=0,p=0,f=0;for(let T=0;T<9;T++)a.probe[T].set(0,0,0);let m=0,g=0,v=0,y=0,x=0,w=0,S=0,_=0,A=0,E=0;u.sort(nW);let M=h!==!0?Math.PI:1;for(let T=0,D=u.length;T<D;T++){let I=u[T],O=I.color,B=I.intensity,q=I.distance,F=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)d+=O.r*B*M,p+=O.g*B*M,f+=O.b*B*M;else if(I.isLightProbe)for(let L=0;L<9;L++)a.probe[L].addScaledVector(I.sh.coefficients[L],B);else if(I.isDirectionalLight){let L=i.get(I);if(L.color.copy(I.color).multiplyScalar(I.intensity*M),I.castShadow){let X=I.shadow,G=r.get(I);G.shadowBias=X.bias,G.shadowNormalBias=X.normalBias,G.shadowRadius=X.radius,G.shadowMapSize=X.mapSize,a.directionalShadow[m]=G,a.directionalShadowMap[m]=F,a.directionalShadowMatrix[m]=I.shadow.matrix,w++}a.directional[m]=L,m++}else if(I.isSpotLight){let L=i.get(I);L.position.setFromMatrixPosition(I.matrixWorld),L.color.copy(O).multiplyScalar(B*M),L.distance=q,L.coneCos=Math.cos(I.angle),L.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),L.decay=I.decay,a.spot[v]=L;let X=I.shadow;if(I.map&&(a.spotLightMap[A]=I.map,A++,X.updateMatrices(I),I.castShadow&&E++),a.spotLightMatrix[v]=X.matrix,I.castShadow){let G=r.get(I);G.shadowBias=X.bias,G.shadowNormalBias=X.normalBias,G.shadowRadius=X.radius,G.shadowMapSize=X.mapSize,a.spotShadow[v]=G,a.spotShadowMap[v]=F,_++}v++}else if(I.isRectAreaLight){let L=i.get(I);L.color.copy(O).multiplyScalar(B),L.halfWidth.set(I.width*.5,0,0),L.halfHeight.set(0,I.height*.5,0),a.rectArea[y]=L,y++}else if(I.isPointLight){let L=i.get(I);if(L.color.copy(I.color).multiplyScalar(I.intensity*M),L.distance=I.distance,L.decay=I.decay,I.castShadow){let X=I.shadow,G=r.get(I);G.shadowBias=X.bias,G.shadowNormalBias=X.normalBias,G.shadowRadius=X.radius,G.shadowMapSize=X.mapSize,G.shadowCameraNear=X.camera.near,G.shadowCameraFar=X.camera.far,a.pointShadow[g]=G,a.pointShadowMap[g]=F,a.pointShadowMatrix[g]=I.shadow.matrix,S++}a.point[g]=L,g++}else if(I.isHemisphereLight){let L=i.get(I);L.skyColor.copy(I.color).multiplyScalar(B*M),L.groundColor.copy(I.groundColor).multiplyScalar(B*M),a.hemi[x]=L,x++}}y>0&&(t.isWebGL2||e.has("OES_texture_float_linear")===!0?(a.rectAreaLTC1=Oe.LTC_FLOAT_1,a.rectAreaLTC2=Oe.LTC_FLOAT_2):e.has("OES_texture_half_float_linear")===!0?(a.rectAreaLTC1=Oe.LTC_HALF_1,a.rectAreaLTC2=Oe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=d,a.ambient[1]=p,a.ambient[2]=f;let C=a.hash;(C.directionalLength!==m||C.pointLength!==g||C.spotLength!==v||C.rectAreaLength!==y||C.hemiLength!==x||C.numDirectionalShadows!==w||C.numPointShadows!==S||C.numSpotShadows!==_||C.numSpotMaps!==A)&&(a.directional.length=m,a.spot.length=v,a.rectArea.length=y,a.point.length=g,a.hemi.length=x,a.directionalShadow.length=w,a.directionalShadowMap.length=w,a.pointShadow.length=S,a.pointShadowMap.length=S,a.spotShadow.length=_,a.spotShadowMap.length=_,a.directionalShadowMatrix.length=w,a.pointShadowMatrix.length=S,a.spotLightMatrix.length=_+A-E,a.spotLightMap.length=A,a.numSpotLightShadowsWithMaps=E,C.directionalLength=m,C.pointLength=g,C.spotLength=v,C.rectAreaLength=y,C.hemiLength=x,C.numDirectionalShadows=w,C.numPointShadows=S,C.numSpotShadows=_,C.numSpotMaps=A,a.version=sW++)}function c(u,h){let d=0,p=0,f=0,m=0,g=0,v=h.matrixWorldInverse;for(let y=0,x=u.length;y<x;y++){let w=u[y];if(w.isDirectionalLight){let S=a.directional[d];S.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),d++}else if(w.isSpotLight){let S=a.spot[f];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),S.direction.setFromMatrixPosition(w.matrixWorld),s.setFromMatrixPosition(w.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(v),f++}else if(w.isRectAreaLight){let S=a.rectArea[m];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),o.identity(),n.copy(w.matrixWorld),n.premultiply(v),o.extractRotation(n),S.halfWidth.set(w.width*.5,0,0),S.halfHeight.set(0,w.height*.5,0),S.halfWidth.applyMatrix4(o),S.halfHeight.applyMatrix4(o),m++}else if(w.isPointLight){let S=a.point[p];S.position.setFromMatrixPosition(w.matrixWorld),S.position.applyMatrix4(v),p++}else if(w.isHemisphereLight){let S=a.hemi[g];S.direction.setFromMatrixPosition(w.matrixWorld),S.direction.transformDirection(v),g++}}}return{setup:l,setupView:c,state:a}}function PT(e,t){let i=new oW(e,t),r=[],a=[];function s(){r.length=0,a.length=0}function n(u){r.push(u)}function o(u){a.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:a,lights:i},setupLights:l,setupLightsView:c,pushLight:n,pushShadow:o}}function lW(e,t){let i=new WeakMap;function r(s,n=0){let o=i.get(s),l;return o===void 0?(l=new PT(e,t),i.set(s,[l])):n>=o.length?(l=new PT(e,t),o.push(l)):l=o[n],l}function a(){i=new WeakMap}return{get:r,dispose:a}}var Qk=class extends Bm{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=il,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},cW=class extends Bm{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new P,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},hW=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,uW=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function dW(e,t,i){let r=new lE,a=new Q,s=new Q,n=new dt,o=new Qk({depthPacking:kk}),l=new cW,c={},u=i.maxTextureSize,h={[on]:Er,[Er]:on,[La]:La},d=new Wt({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Q},radius:{value:4}},vertexShader:hW,fragmentShader:uW}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let f=new Qe;f.setAttribute("position",new ht(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new tr(f,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=iE,this.render=function(w,S,_){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||w.length===0)return;let A=e.getRenderTarget(),E=e.getActiveCubeFace(),M=e.getActiveMipmapLevel(),C=e.state;C.setBlending(ir),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let T=0,D=w.length;T<D;T++){let I=w[T],O=I.shadow;if(O===void 0){console.warn("THREE.WebGLShadowMap:",I,"has no shadow.");continue}if(O.autoUpdate===!1&&O.needsUpdate===!1)continue;a.copy(O.mapSize);let B=O.getFrameExtents();if(a.multiply(B),s.copy(O.mapSize),(a.x>u||a.y>u)&&(a.x>u&&(s.x=Math.floor(u/B.x),a.x=s.x*B.x,O.mapSize.x=s.x),a.y>u&&(s.y=Math.floor(u/B.y),a.y=s.y*B.y,O.mapSize.y=s.y)),O.map===null){let F=this.type!==nf?{minFilter:Gt,magFilter:Gt}:{};O.map=new Ht(a.x,a.y,F),O.map.texture.name=I.name+".shadowMap",O.camera.updateProjectionMatrix()}e.setRenderTarget(O.map),e.clear();let q=O.getViewportCount();for(let F=0;F<q;F++){let L=O.getViewport(F);n.set(s.x*L.x,s.y*L.y,s.x*L.z,s.y*L.w),C.viewport(n),O.updateMatrices(I,F),r=O.getFrustum(),x(S,_,O.camera,I,this.type)}O.isPointLightShadow!==!0&&this.type===nf&&v(O,_),O.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(A,E,M)};function v(w,S){let _=t.update(m);d.defines.VSM_SAMPLES!==w.blurSamples&&(d.defines.VSM_SAMPLES=w.blurSamples,p.defines.VSM_SAMPLES=w.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new Ht(a.x,a.y)),d.uniforms.shadow_pass.value=w.map.texture,d.uniforms.resolution.value=w.mapSize,d.uniforms.radius.value=w.radius,e.setRenderTarget(w.mapPass),e.clear(),e.renderBufferDirect(S,null,_,d,m,null),p.uniforms.shadow_pass.value=w.mapPass.texture,p.uniforms.resolution.value=w.mapSize,p.uniforms.radius.value=w.radius,e.setRenderTarget(w.map),e.clear(),e.renderBufferDirect(S,null,_,p,m,null)}function y(w,S,_,A,E,M){let C=null,T=_.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(T!==void 0)C=T;else if(C=_.isPointLight===!0?l:o,e.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){let D=C.uuid,I=S.uuid,O=c[D];O===void 0&&(O={},c[D]=O);let B=O[I];B===void 0&&(B=C.clone(),O[I]=B),C=B}return C.visible=S.visible,C.wireframe=S.wireframe,M===nf?C.side=S.shadowSide!==null?S.shadowSide:S.side:C.side=S.shadowSide!==null?S.shadowSide:h[S.side],C.alphaMap=S.alphaMap,C.alphaTest=S.alphaTest,C.map=S.map,C.clipShadows=S.clipShadows,C.clippingPlanes=S.clippingPlanes,C.clipIntersection=S.clipIntersection,C.displacementMap=S.displacementMap,C.displacementScale=S.displacementScale,C.displacementBias=S.displacementBias,C.wireframeLinewidth=S.wireframeLinewidth,C.linewidth=S.linewidth,_.isPointLight===!0&&C.isMeshDistanceMaterial===!0&&(C.referencePosition.setFromMatrixPosition(_.matrixWorld),C.nearDistance=A,C.farDistance=E),C}function x(w,S,_,A,E){if(w.visible===!1)return;if(w.layers.test(S.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&E===nf)&&(!w.frustumCulled||r.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(_.matrixWorldInverse,w.matrixWorld);let C=t.update(w),T=w.material;if(Array.isArray(T)){let D=C.groups;for(let I=0,O=D.length;I<O;I++){let B=D[I],q=T[B.materialIndex];if(q&&q.visible){let F=y(w,q,A,_.near,_.far,E);e.renderBufferDirect(_,null,C,F,w,B)}}}else if(T.visible){let D=y(w,T,A,_.near,_.far,E);e.renderBufferDirect(_,null,C,D,w,null)}}let M=w.children;for(let C=0,T=M.length;C<T;C++)x(M[C],S,_,A,E)}}function pW(e,t,i){let r=i.isWebGL2;function a(){let ee=!1,me=new dt,_e=null,Ne=new dt(0,0,0,0);return{setMask:function(st){_e!==st&&!ee&&(e.colorMask(st,st,st,st),_e=st)},setLocked:function(st){ee=st},setClear:function(st,Pt,ki,gr,fn){fn===!0&&(st*=gr,Pt*=gr,ki*=gr),me.set(st,Pt,ki,gr),Ne.equals(me)===!1&&(e.clearColor(st,Pt,ki,gr),Ne.copy(me))},reset:function(){ee=!1,_e=null,Ne.set(-1,0,0,0)}}}function s(){let ee=!1,me=null,_e=null,Ne=null;return{setTest:function(st){st?ne(2929):re(2929)},setMask:function(st){me!==st&&!ee&&(e.depthMask(st),me=st)},setFunc:function(st){if(_e!==st){switch(st){case R8:e.depthFunc(512);break;case L8:e.depthFunc(519);break;case k8:e.depthFunc(513);break;case V_:e.depthFunc(515);break;case z8:e.depthFunc(514);break;case N8:e.depthFunc(518);break;case B8:e.depthFunc(516);break;case j8:e.depthFunc(517);break;default:e.depthFunc(515)}_e=st}},setLocked:function(st){ee=st},setClear:function(st){Ne!==st&&(e.clearDepth(st),Ne=st)},reset:function(){ee=!1,me=null,_e=null,Ne=null}}}function n(){let ee=!1,me=null,_e=null,Ne=null,st=null,Pt=null,ki=null,gr=null,fn=null;return{setTest:function(oi){ee||(oi?ne(2960):re(2960))},setMask:function(oi){me!==oi&&!ee&&(e.stencilMask(oi),me=oi)},setFunc:function(oi,Rs,Ea){(_e!==oi||Ne!==Rs||st!==Ea)&&(e.stencilFunc(oi,Rs,Ea),_e=oi,Ne=Rs,st=Ea)},setOp:function(oi,Rs,Ea){(Pt!==oi||ki!==Rs||gr!==Ea)&&(e.stencilOp(oi,Rs,Ea),Pt=oi,ki=Rs,gr=Ea)},setLocked:function(oi){ee=oi},setClear:function(oi){fn!==oi&&(e.clearStencil(oi),fn=oi)},reset:function(){ee=!1,me=null,_e=null,Ne=null,st=null,Pt=null,ki=null,gr=null,fn=null}}}let o=new a,l=new s,c=new n,u=new WeakMap,h=new WeakMap,d={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,x=null,w=null,S=null,_=null,A=null,E=null,M=!1,C=null,T=null,D=null,I=null,O=null,B=e.getParameter(35661),q=!1,F=0,L=e.getParameter(7938);L.indexOf("WebGL")!==-1?(F=parseFloat(/^WebGL (\d)/.exec(L)[1]),q=F>=1):L.indexOf("OpenGL ES")!==-1&&(F=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),q=F>=2);let X=null,G={},U=e.getParameter(3088),H=e.getParameter(2978),$=new dt().fromArray(U),Y=new dt().fromArray(H);function J(ee,me,_e){let Ne=new Uint8Array(4),st=e.createTexture();e.bindTexture(ee,st),e.texParameteri(ee,10241,9728),e.texParameteri(ee,10240,9728);for(let Pt=0;Pt<_e;Pt++)e.texImage2D(me+Pt,0,6408,1,1,0,6408,5121,Ne);return st}let Z={};Z[3553]=J(3553,3553,1),Z[34067]=J(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ne(2929),l.setFunc(V_),Ve(!1),je(b3),ne(2884),ke(ir);function ne(ee){d[ee]!==!0&&(e.enable(ee),d[ee]=!0)}function re(ee){d[ee]!==!1&&(e.disable(ee),d[ee]=!1)}function ie(ee,me){return p[ee]!==me?(e.bindFramebuffer(ee,me),p[ee]=me,r&&(ee===36009&&(p[36160]=me),ee===36160&&(p[36009]=me)),!0):!1}function le(ee,me){let _e=m,Ne=!1;if(ee)if(_e=f.get(me),_e===void 0&&(_e=[],f.set(me,_e)),ee.isWebGLMultipleRenderTargets){let st=ee.texture;if(_e.length!==st.length||_e[0]!==36064){for(let Pt=0,ki=st.length;Pt<ki;Pt++)_e[Pt]=36064+Pt;_e.length=st.length,Ne=!0}}else _e[0]!==36064&&(_e[0]=36064,Ne=!0);else _e[0]!==1029&&(_e[0]=1029,Ne=!0);Ne&&(i.isWebGL2?e.drawBuffers(_e):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(_e))}function ue(ee){return g!==ee?(e.useProgram(ee),g=ee,!0):!1}let fe={[xu]:32774,[_8]:32778,[S8]:32779};if(r)fe[A3]=32775,fe[E3]=32776;else{let ee=t.get("EXT_blend_minmax");ee!==null&&(fe[A3]=ee.MIN_EXT,fe[E3]=ee.MAX_EXT)}let be={[A8]:0,[E8]:1,[C8]:768,[Mk]:770,[I8]:776,[D8]:774,[T8]:772,[M8]:769,[Tk]:771,[O8]:775,[P8]:773};function ke(ee,me,_e,Ne,st,Pt,ki,gr){if(ee===ir){v===!0&&(re(3042),v=!1);return}if(v===!1&&(ne(3042),v=!0),ee!==w8){if(ee!==y||gr!==M){if((x!==xu||_!==xu)&&(e.blendEquation(32774),x=xu,_=xu),gr)switch(ee){case $c:e.blendFuncSeparate(1,771,1,771);break;case w3:e.blendFunc(1,1);break;case _3:e.blendFuncSeparate(0,769,0,1);break;case S3:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}else switch(ee){case $c:e.blendFuncSeparate(770,771,1,771);break;case w3:e.blendFunc(770,1);break;case _3:e.blendFuncSeparate(0,769,0,1);break;case S3:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",ee);break}w=null,S=null,A=null,E=null,y=ee,M=gr}return}st=st||me,Pt=Pt||_e,ki=ki||Ne,(me!==x||st!==_)&&(e.blendEquationSeparate(fe[me],fe[st]),x=me,_=st),(_e!==w||Ne!==S||Pt!==A||ki!==E)&&(e.blendFuncSeparate(be[_e],be[Ne],be[Pt],be[ki]),w=_e,S=Ne,A=Pt,E=ki),y=ee,M=!1}function Ce(ee,me){ee.side===La?re(2884):ne(2884);let _e=ee.side===Er;me&&(_e=!_e),Ve(_e),ee.blending===$c&&ee.transparent===!1?ke(ir):ke(ee.blending,ee.blendEquation,ee.blendSrc,ee.blendDst,ee.blendEquationAlpha,ee.blendSrcAlpha,ee.blendDstAlpha,ee.premultipliedAlpha),l.setFunc(ee.depthFunc),l.setTest(ee.depthTest),l.setMask(ee.depthWrite),o.setMask(ee.colorWrite);let Ne=ee.stencilWrite;c.setTest(Ne),Ne&&(c.setMask(ee.stencilWriteMask),c.setFunc(ee.stencilFunc,ee.stencilRef,ee.stencilFuncMask),c.setOp(ee.stencilFail,ee.stencilZFail,ee.stencilZPass)),Me(ee.polygonOffset,ee.polygonOffsetFactor,ee.polygonOffsetUnits),ee.alphaToCoverage===!0?ne(32926):re(32926)}function Ve(ee){C!==ee&&(ee?e.frontFace(2304):e.frontFace(2305),C=ee)}function je(ee){ee!==y8?(ne(2884),ee!==T&&(ee===b3?e.cullFace(1029):ee===x8?e.cullFace(1028):e.cullFace(1032))):re(2884),T=ee}function Pe(ee){ee!==D&&(q&&e.lineWidth(ee),D=ee)}function Me(ee,me,_e){ee?(ne(32823),(I!==me||O!==_e)&&(e.polygonOffset(me,_e),I=me,O=_e)):re(32823)}function Ze(ee){ee?ne(3089):re(3089)}function qe(ee){ee===void 0&&(ee=33984+B-1),X!==ee&&(e.activeTexture(ee),X=ee)}function W(ee,me,_e){_e===void 0&&(X===null?_e=33984+B-1:_e=X);let Ne=G[_e];Ne===void 0&&(Ne={type:void 0,texture:void 0},G[_e]=Ne),(Ne.type!==ee||Ne.texture!==me)&&(X!==_e&&(e.activeTexture(_e),X=_e),e.bindTexture(ee,me||Z[ee]),Ne.type=ee,Ne.texture=me)}function N(){let ee=G[X];ee!==void 0&&ee.type!==void 0&&(e.bindTexture(ee.type,null),ee.type=void 0,ee.texture=void 0)}function oe(){try{e.compressedTexImage2D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ae(){try{e.compressedTexImage3D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function k(){try{e.texSubImage2D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function De(){try{e.texSubImage3D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Ue(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Le(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function de(){try{e.texStorage2D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function We(){try{e.texStorage3D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function ze(){try{e.texImage2D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function Xe(){try{e.texImage3D.apply(e,arguments)}catch(ee){console.error("THREE.WebGLState:",ee)}}function it(ee){$.equals(ee)===!1&&(e.scissor(ee.x,ee.y,ee.z,ee.w),$.copy(ee))}function Ke(ee){Y.equals(ee)===!1&&(e.viewport(ee.x,ee.y,ee.z,ee.w),Y.copy(ee))}function et(ee,me){let _e=h.get(me);_e===void 0&&(_e=new WeakMap,h.set(me,_e));let Ne=_e.get(ee);Ne===void 0&&(Ne=e.getUniformBlockIndex(me,ee.name),_e.set(ee,Ne))}function ii(ee,me){let _e=h.get(me).get(ee);u.get(me)!==_e&&(e.uniformBlockBinding(me,_e,ee.__bindingPointIndex),u.set(me,_e))}function vi(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),r===!0&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},X=null,G={},p={},f=new WeakMap,m=[],g=null,v=!1,y=null,x=null,w=null,S=null,_=null,A=null,E=null,M=!1,C=null,T=null,D=null,I=null,O=null,$.set(0,0,e.canvas.width,e.canvas.height),Y.set(0,0,e.canvas.width,e.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:ne,disable:re,bindFramebuffer:ie,drawBuffers:le,useProgram:ue,setBlending:ke,setMaterial:Ce,setFlipSided:Ve,setCullFace:je,setLineWidth:Pe,setPolygonOffset:Me,setScissorTest:Ze,activeTexture:qe,bindTexture:W,unbindTexture:N,compressedTexImage2D:oe,compressedTexImage3D:Ae,texImage2D:ze,texImage3D:Xe,updateUBOMapping:et,uniformBlockBinding:ii,texStorage2D:de,texStorage3D:We,texSubImage2D:k,texSubImage3D:De,compressedTexSubImage2D:Ue,compressedTexSubImage3D:Le,scissor:it,viewport:Ke,reset:vi}}function fW(e,t,i,r,a,s,n){let o=a.isWebGL2,l=a.maxTextures,c=a.maxCubemapSize,u=a.maxTextureSize,h=a.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),f=new WeakMap,m,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(W,N){return v?new OffscreenCanvas(W,N):am("canvas")}function x(W,N,oe,Ae){let k=1;if((W.width>Ae||W.height>Ae)&&(k=Ae/Math.max(W.width,W.height)),k<1||N===!0)if(typeof HTMLImageElement<"u"&&W instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&W instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&W instanceof ImageBitmap){let De=N?K0:Math.floor,Ue=De(k*W.width),Le=De(k*W.height);m===void 0&&(m=y(Ue,Le));let de=oe?y(Ue,Le):m;return de.width=Ue,de.height=Le,de.getContext("2d").drawImage(W,0,0,Ue,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+W.width+"x"+W.height+") to ("+Ue+"x"+Le+")."),de}else return"data"in W&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+W.width+"x"+W.height+")."),W;return W}function w(W){return Y_(W.width)&&Y_(W.height)}function S(W){return o?!1:W.wrapS!==pi||W.wrapT!==pi||W.minFilter!==Gt&&W.minFilter!==bt}function _(W,N){return W.generateMipmaps&&N&&W.minFilter!==Gt&&W.minFilter!==bt}function A(W){e.generateMipmap(W)}function E(W,N,oe,Ae,k=!1){if(o===!1)return N;if(W!==null){if(e[W]!==void 0)return e[W];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+W+"'")}let De=N;return N===6403&&(oe===5126&&(De=33326),oe===5131&&(De=33325),oe===5121&&(De=33321)),N===33319&&(oe===5126&&(De=33328),oe===5131&&(De=33327),oe===5121&&(De=33323)),N===6408&&(oe===5126&&(De=34836),oe===5131&&(De=34842),oe===5121&&(De=Ae===yt&&k===!1?35907:32856),oe===32819&&(De=32854),oe===32820&&(De=32855)),(De===33325||De===33326||De===33327||De===33328||De===34842||De===34836)&&t.get("EXT_color_buffer_float"),De}function M(W,N,oe){return _(W,oe)===!0||W.isFramebufferTexture&&W.minFilter!==Gt&&W.minFilter!==bt?Math.log2(Math.max(N.width,N.height))+1:W.mipmaps!==void 0&&W.mipmaps.length>0?W.mipmaps.length:W.isCompressedTexture&&Array.isArray(W.image)?N.mipmaps.length:1}function C(W){return W===Gt||W===C3||W===Nx?9728:9729}function T(W){let N=W.target;N.removeEventListener("dispose",T),I(N),N.isVideoTexture&&f.delete(N)}function D(W){let N=W.target;N.removeEventListener("dispose",D),B(N)}function I(W){let N=r.get(W);if(N.__webglInit===void 0)return;let oe=W.source,Ae=g.get(oe);if(Ae){let k=Ae[N.__cacheKey];k.usedTimes--,k.usedTimes===0&&O(W),Object.keys(Ae).length===0&&g.delete(oe)}r.remove(W)}function O(W){let N=r.get(W);e.deleteTexture(N.__webglTexture);let oe=W.source,Ae=g.get(oe);delete Ae[N.__cacheKey],n.memory.textures--}function B(W){let N=W.texture,oe=r.get(W),Ae=r.get(N);if(Ae.__webglTexture!==void 0&&(e.deleteTexture(Ae.__webglTexture),n.memory.textures--),W.depthTexture&&W.depthTexture.dispose(),W.isWebGLCubeRenderTarget)for(let k=0;k<6;k++)e.deleteFramebuffer(oe.__webglFramebuffer[k]),oe.__webglDepthbuffer&&e.deleteRenderbuffer(oe.__webglDepthbuffer[k]);else{if(e.deleteFramebuffer(oe.__webglFramebuffer),oe.__webglDepthbuffer&&e.deleteRenderbuffer(oe.__webglDepthbuffer),oe.__webglMultisampledFramebuffer&&e.deleteFramebuffer(oe.__webglMultisampledFramebuffer),oe.__webglColorRenderbuffer)for(let k=0;k<oe.__webglColorRenderbuffer.length;k++)oe.__webglColorRenderbuffer[k]&&e.deleteRenderbuffer(oe.__webglColorRenderbuffer[k]);oe.__webglDepthRenderbuffer&&e.deleteRenderbuffer(oe.__webglDepthRenderbuffer)}if(W.isWebGLMultipleRenderTargets)for(let k=0,De=N.length;k<De;k++){let Ue=r.get(N[k]);Ue.__webglTexture&&(e.deleteTexture(Ue.__webglTexture),n.memory.textures--),r.remove(N[k])}r.remove(N),r.remove(W)}let q=0;function F(){q=0}function L(){let W=q;return W>=l&&console.warn("THREE.WebGLTextures: Trying to use "+W+" texture units while this GPU supports only "+l),q+=1,W}function X(W){let N=[];return N.push(W.wrapS),N.push(W.wrapT),N.push(W.wrapR||0),N.push(W.magFilter),N.push(W.minFilter),N.push(W.anisotropy),N.push(W.internalFormat),N.push(W.format),N.push(W.type),N.push(W.generateMipmaps),N.push(W.premultiplyAlpha),N.push(W.flipY),N.push(W.unpackAlignment),N.push(W.encoding),N.join()}function G(W,N){let oe=r.get(W);if(W.isVideoTexture&&Ze(W),W.isRenderTargetTexture===!1&&W.version>0&&oe.__version!==W.version){let Ae=W.image;if(Ae===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ae.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{re(oe,W,N);return}}i.bindTexture(3553,oe.__webglTexture,33984+N)}function U(W,N){let oe=r.get(W);if(W.version>0&&oe.__version!==W.version){re(oe,W,N);return}i.bindTexture(35866,oe.__webglTexture,33984+N)}function H(W,N){let oe=r.get(W);if(W.version>0&&oe.__version!==W.version){re(oe,W,N);return}i.bindTexture(32879,oe.__webglTexture,33984+N)}function $(W,N){let oe=r.get(W);if(W.version>0&&oe.__version!==W.version){ie(oe,W,N);return}i.bindTexture(34067,oe.__webglTexture,33984+N)}let Y={[No]:10497,[pi]:33071,[W_]:33648},J={[Gt]:9728,[C3]:9984,[Nx]:9986,[bt]:9729,[X8]:9985,[Cd]:9987};function Z(W,N,oe){if(oe?(e.texParameteri(W,10242,Y[N.wrapS]),e.texParameteri(W,10243,Y[N.wrapT]),(W===32879||W===35866)&&e.texParameteri(W,32882,Y[N.wrapR]),e.texParameteri(W,10240,J[N.magFilter]),e.texParameteri(W,10241,J[N.minFilter])):(e.texParameteri(W,10242,33071),e.texParameteri(W,10243,33071),(W===32879||W===35866)&&e.texParameteri(W,32882,33071),(N.wrapS!==pi||N.wrapT!==pi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(W,10240,C(N.magFilter)),e.texParameteri(W,10241,C(N.minFilter)),N.minFilter!==Gt&&N.minFilter!==bt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){let Ae=t.get("EXT_texture_filter_anisotropic");if(N.magFilter===Gt||N.minFilter!==Nx&&N.minFilter!==Cd||N.type===er&&t.has("OES_texture_float_linear")===!1||o===!1&&N.type===ph&&t.has("OES_texture_half_float_linear")===!1)return;(N.anisotropy>1||r.get(N).__currentAnisotropy)&&(e.texParameterf(W,Ae.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(N.anisotropy,a.getMaxAnisotropy())),r.get(N).__currentAnisotropy=N.anisotropy)}}function ne(W,N){let oe=!1;W.__webglInit===void 0&&(W.__webglInit=!0,N.addEventListener("dispose",T));let Ae=N.source,k=g.get(Ae);k===void 0&&(k={},g.set(Ae,k));let De=X(N);if(De!==W.__cacheKey){k[De]===void 0&&(k[De]={texture:e.createTexture(),usedTimes:0},n.memory.textures++,oe=!0),k[De].usedTimes++;let Ue=k[W.__cacheKey];Ue!==void 0&&(k[W.__cacheKey].usedTimes--,Ue.usedTimes===0&&O(N)),W.__cacheKey=De,W.__webglTexture=k[De].texture}return oe}function re(W,N,oe){let Ae=3553;(N.isDataArrayTexture||N.isCompressedArrayTexture)&&(Ae=35866),N.isData3DTexture&&(Ae=32879);let k=ne(W,N),De=N.source;i.bindTexture(Ae,W.__webglTexture,33984+oe);let Ue=r.get(De);if(De.version!==Ue.__version||k===!0){i.activeTexture(33984+oe),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);let Le=S(N)&&w(N.image)===!1,de=x(N.image,Le,!1,u);de=qe(N,de);let We=w(de)||o,ze=s.convert(N.format,N.encoding),Xe=s.convert(N.type),it=E(N.internalFormat,ze,Xe,N.encoding,N.isVideoTexture);Z(Ae,N,We);let Ke,et=N.mipmaps,ii=o&&N.isVideoTexture!==!0,vi=Ue.__version===void 0||k===!0,ee=M(N,de,We);if(N.isDepthTexture)it=6402,o?N.type===er?it=36012:N.type===Bo?it=33190:N.type===Jc?it=35056:it=33189:N.type===er&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),N.format===eh&&it===6402&&N.type!==Ok&&N.type!==Bo&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),N.type=Bo,Xe=s.convert(N.type)),N.format===fh&&it===6402&&(it=34041,N.type!==Jc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),N.type=Jc,Xe=s.convert(N.type))),vi&&(ii?i.texStorage2D(3553,1,it,de.width,de.height):i.texImage2D(3553,0,it,de.width,de.height,0,ze,Xe,null));else if(N.isDataTexture)if(et.length>0&&We){ii&&vi&&i.texStorage2D(3553,ee,it,et[0].width,et[0].height);for(let me=0,_e=et.length;me<_e;me++)Ke=et[me],ii?i.texSubImage2D(3553,me,0,0,Ke.width,Ke.height,ze,Xe,Ke.data):i.texImage2D(3553,me,it,Ke.width,Ke.height,0,ze,Xe,Ke.data);N.generateMipmaps=!1}else ii?(vi&&i.texStorage2D(3553,ee,it,de.width,de.height),i.texSubImage2D(3553,0,0,0,de.width,de.height,ze,Xe,de.data)):i.texImage2D(3553,0,it,de.width,de.height,0,ze,Xe,de.data);else if(N.isCompressedTexture)if(N.isCompressedArrayTexture){ii&&vi&&i.texStorage3D(35866,ee,it,et[0].width,et[0].height,de.depth);for(let me=0,_e=et.length;me<_e;me++)Ke=et[me],N.format!==Sr?ze!==null?ii?i.compressedTexSubImage3D(35866,me,0,0,0,Ke.width,Ke.height,de.depth,ze,Ke.data,0,0):i.compressedTexImage3D(35866,me,it,Ke.width,Ke.height,de.depth,0,Ke.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ii?i.texSubImage3D(35866,me,0,0,0,Ke.width,Ke.height,de.depth,ze,Xe,Ke.data):i.texImage3D(35866,me,it,Ke.width,Ke.height,de.depth,0,ze,Xe,Ke.data)}else{ii&&vi&&i.texStorage2D(3553,ee,it,et[0].width,et[0].height);for(let me=0,_e=et.length;me<_e;me++)Ke=et[me],N.format!==Sr?ze!==null?ii?i.compressedTexSubImage2D(3553,me,0,0,Ke.width,Ke.height,ze,Ke.data):i.compressedTexImage2D(3553,me,it,Ke.width,Ke.height,0,Ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ii?i.texSubImage2D(3553,me,0,0,Ke.width,Ke.height,ze,Xe,Ke.data):i.texImage2D(3553,me,it,Ke.width,Ke.height,0,ze,Xe,Ke.data)}else if(N.isDataArrayTexture)ii?(vi&&i.texStorage3D(35866,ee,it,de.width,de.height,de.depth),i.texSubImage3D(35866,0,0,0,0,de.width,de.height,de.depth,ze,Xe,de.data)):i.texImage3D(35866,0,it,de.width,de.height,de.depth,0,ze,Xe,de.data);else if(N.isData3DTexture)ii?(vi&&i.texStorage3D(32879,ee,it,de.width,de.height,de.depth),i.texSubImage3D(32879,0,0,0,0,de.width,de.height,de.depth,ze,Xe,de.data)):i.texImage3D(32879,0,it,de.width,de.height,de.depth,0,ze,Xe,de.data);else if(N.isFramebufferTexture){if(vi)if(ii)i.texStorage2D(3553,ee,it,de.width,de.height);else{let me=de.width,_e=de.height;for(let Ne=0;Ne<ee;Ne++)i.texImage2D(3553,Ne,it,me,_e,0,ze,Xe,null),me>>=1,_e>>=1}}else if(et.length>0&&We){ii&&vi&&i.texStorage2D(3553,ee,it,et[0].width,et[0].height);for(let me=0,_e=et.length;me<_e;me++)Ke=et[me],ii?i.texSubImage2D(3553,me,0,0,ze,Xe,Ke):i.texImage2D(3553,me,it,ze,Xe,Ke);N.generateMipmaps=!1}else ii?(vi&&i.texStorage2D(3553,ee,it,de.width,de.height),i.texSubImage2D(3553,0,0,0,ze,Xe,de)):i.texImage2D(3553,0,it,ze,Xe,de);_(N,We)&&A(Ae),Ue.__version=De.version,N.onUpdate&&N.onUpdate(N)}W.__version=N.version}function ie(W,N,oe){if(N.image.length!==6)return;let Ae=ne(W,N),k=N.source;i.bindTexture(34067,W.__webglTexture,33984+oe);let De=r.get(k);if(k.version!==De.__version||Ae===!0){i.activeTexture(33984+oe),e.pixelStorei(37440,N.flipY),e.pixelStorei(37441,N.premultiplyAlpha),e.pixelStorei(3317,N.unpackAlignment),e.pixelStorei(37443,0);let Ue=N.isCompressedTexture||N.image[0].isCompressedTexture,Le=N.image[0]&&N.image[0].isDataTexture,de=[];for(let me=0;me<6;me++)!Ue&&!Le?de[me]=x(N.image[me],!1,!0,c):de[me]=Le?N.image[me].image:N.image[me],de[me]=qe(N,de[me]);let We=de[0],ze=w(We)||o,Xe=s.convert(N.format,N.encoding),it=s.convert(N.type),Ke=E(N.internalFormat,Xe,it,N.encoding),et=o&&N.isVideoTexture!==!0,ii=De.__version===void 0||Ae===!0,vi=M(N,We,ze);Z(34067,N,ze);let ee;if(Ue){et&&ii&&i.texStorage2D(34067,vi,Ke,We.width,We.height);for(let me=0;me<6;me++){ee=de[me].mipmaps;for(let _e=0;_e<ee.length;_e++){let Ne=ee[_e];N.format!==Sr?Xe!==null?et?i.compressedTexSubImage2D(34069+me,_e,0,0,Ne.width,Ne.height,Xe,Ne.data):i.compressedTexImage2D(34069+me,_e,Ke,Ne.width,Ne.height,0,Ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):et?i.texSubImage2D(34069+me,_e,0,0,Ne.width,Ne.height,Xe,it,Ne.data):i.texImage2D(34069+me,_e,Ke,Ne.width,Ne.height,0,Xe,it,Ne.data)}}}else{ee=N.mipmaps,et&&ii&&(ee.length>0&&vi++,i.texStorage2D(34067,vi,Ke,de[0].width,de[0].height));for(let me=0;me<6;me++)if(Le){et?i.texSubImage2D(34069+me,0,0,0,de[me].width,de[me].height,Xe,it,de[me].data):i.texImage2D(34069+me,0,Ke,de[me].width,de[me].height,0,Xe,it,de[me].data);for(let _e=0;_e<ee.length;_e++){let Ne=ee[_e].image[me].image;et?i.texSubImage2D(34069+me,_e+1,0,0,Ne.width,Ne.height,Xe,it,Ne.data):i.texImage2D(34069+me,_e+1,Ke,Ne.width,Ne.height,0,Xe,it,Ne.data)}}else{et?i.texSubImage2D(34069+me,0,0,0,Xe,it,de[me]):i.texImage2D(34069+me,0,Ke,Xe,it,de[me]);for(let _e=0;_e<ee.length;_e++){let Ne=ee[_e];et?i.texSubImage2D(34069+me,_e+1,0,0,Xe,it,Ne.image[me]):i.texImage2D(34069+me,_e+1,Ke,Xe,it,Ne.image[me])}}}_(N,ze)&&A(34067),De.__version=k.version,N.onUpdate&&N.onUpdate(N)}W.__version=N.version}function le(W,N,oe,Ae,k){let De=s.convert(oe.format,oe.encoding),Ue=s.convert(oe.type),Le=E(oe.internalFormat,De,Ue,oe.encoding);r.get(N).__hasExternalTextures||(k===32879||k===35866?i.texImage3D(k,0,Le,N.width,N.height,N.depth,0,De,Ue,null):i.texImage2D(k,0,Le,N.width,N.height,0,De,Ue,null)),i.bindFramebuffer(36160,W),Me(N)?d.framebufferTexture2DMultisampleEXT(36160,Ae,k,r.get(oe).__webglTexture,0,Pe(N)):(k===3553||k>=34069&&k<=34074)&&e.framebufferTexture2D(36160,Ae,k,r.get(oe).__webglTexture,0),i.bindFramebuffer(36160,null)}function ue(W,N,oe){if(e.bindRenderbuffer(36161,W),N.depthBuffer&&!N.stencilBuffer){let Ae=33189;if(oe||Me(N)){let k=N.depthTexture;k&&k.isDepthTexture&&(k.type===er?Ae=36012:k.type===Bo&&(Ae=33190));let De=Pe(N);Me(N)?d.renderbufferStorageMultisampleEXT(36161,De,Ae,N.width,N.height):e.renderbufferStorageMultisample(36161,De,Ae,N.width,N.height)}else e.renderbufferStorage(36161,Ae,N.width,N.height);e.framebufferRenderbuffer(36160,36096,36161,W)}else if(N.depthBuffer&&N.stencilBuffer){let Ae=Pe(N);oe&&Me(N)===!1?e.renderbufferStorageMultisample(36161,Ae,35056,N.width,N.height):Me(N)?d.renderbufferStorageMultisampleEXT(36161,Ae,35056,N.width,N.height):e.renderbufferStorage(36161,34041,N.width,N.height),e.framebufferRenderbuffer(36160,33306,36161,W)}else{let Ae=N.isWebGLMultipleRenderTargets===!0?N.texture:[N.texture];for(let k=0;k<Ae.length;k++){let De=Ae[k],Ue=s.convert(De.format,De.encoding),Le=s.convert(De.type),de=E(De.internalFormat,Ue,Le,De.encoding),We=Pe(N);oe&&Me(N)===!1?e.renderbufferStorageMultisample(36161,We,de,N.width,N.height):Me(N)?d.renderbufferStorageMultisampleEXT(36161,We,de,N.width,N.height):e.renderbufferStorage(36161,de,N.width,N.height)}}e.bindRenderbuffer(36161,null)}function fe(W,N){if(N&&N.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,W),!(N.depthTexture&&N.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(N.depthTexture).__webglTexture||N.depthTexture.image.width!==N.width||N.depthTexture.image.height!==N.height)&&(N.depthTexture.image.width=N.width,N.depthTexture.image.height=N.height,N.depthTexture.needsUpdate=!0),G(N.depthTexture,0);let oe=r.get(N.depthTexture).__webglTexture,Ae=Pe(N);if(N.depthTexture.format===eh)Me(N)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,oe,0,Ae):e.framebufferTexture2D(36160,36096,3553,oe,0);else if(N.depthTexture.format===fh)Me(N)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,oe,0,Ae):e.framebufferTexture2D(36160,33306,3553,oe,0);else throw new Error("Unknown depthTexture format")}function be(W){let N=r.get(W),oe=W.isWebGLCubeRenderTarget===!0;if(W.depthTexture&&!N.__autoAllocateDepthBuffer){if(oe)throw new Error("target.depthTexture not supported in Cube render targets");fe(N.__webglFramebuffer,W)}else if(oe){N.__webglDepthbuffer=[];for(let Ae=0;Ae<6;Ae++)i.bindFramebuffer(36160,N.__webglFramebuffer[Ae]),N.__webglDepthbuffer[Ae]=e.createRenderbuffer(),ue(N.__webglDepthbuffer[Ae],W,!1)}else i.bindFramebuffer(36160,N.__webglFramebuffer),N.__webglDepthbuffer=e.createRenderbuffer(),ue(N.__webglDepthbuffer,W,!1);i.bindFramebuffer(36160,null)}function ke(W,N,oe){let Ae=r.get(W);N!==void 0&&le(Ae.__webglFramebuffer,W,W.texture,36064,3553),oe!==void 0&&be(W)}function Ce(W){let N=W.texture,oe=r.get(W),Ae=r.get(N);W.addEventListener("dispose",D),W.isWebGLMultipleRenderTargets!==!0&&(Ae.__webglTexture===void 0&&(Ae.__webglTexture=e.createTexture()),Ae.__version=N.version,n.memory.textures++);let k=W.isWebGLCubeRenderTarget===!0,De=W.isWebGLMultipleRenderTargets===!0,Ue=w(W)||o;if(k){oe.__webglFramebuffer=[];for(let Le=0;Le<6;Le++)oe.__webglFramebuffer[Le]=e.createFramebuffer()}else{if(oe.__webglFramebuffer=e.createFramebuffer(),De)if(a.drawBuffers){let Le=W.texture;for(let de=0,We=Le.length;de<We;de++){let ze=r.get(Le[de]);ze.__webglTexture===void 0&&(ze.__webglTexture=e.createTexture(),n.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&W.samples>0&&Me(W)===!1){let Le=De?N:[N];oe.__webglMultisampledFramebuffer=e.createFramebuffer(),oe.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,oe.__webglMultisampledFramebuffer);for(let de=0;de<Le.length;de++){let We=Le[de];oe.__webglColorRenderbuffer[de]=e.createRenderbuffer(),e.bindRenderbuffer(36161,oe.__webglColorRenderbuffer[de]);let ze=s.convert(We.format,We.encoding),Xe=s.convert(We.type),it=E(We.internalFormat,ze,Xe,We.encoding,W.isXRRenderTarget===!0),Ke=Pe(W);e.renderbufferStorageMultisample(36161,Ke,it,W.width,W.height),e.framebufferRenderbuffer(36160,36064+de,36161,oe.__webglColorRenderbuffer[de])}e.bindRenderbuffer(36161,null),W.depthBuffer&&(oe.__webglDepthRenderbuffer=e.createRenderbuffer(),ue(oe.__webglDepthRenderbuffer,W,!0)),i.bindFramebuffer(36160,null)}}if(k){i.bindTexture(34067,Ae.__webglTexture),Z(34067,N,Ue);for(let Le=0;Le<6;Le++)le(oe.__webglFramebuffer[Le],W,N,36064,34069+Le);_(N,Ue)&&A(34067),i.unbindTexture()}else if(De){let Le=W.texture;for(let de=0,We=Le.length;de<We;de++){let ze=Le[de],Xe=r.get(ze);i.bindTexture(3553,Xe.__webglTexture),Z(3553,ze,Ue),le(oe.__webglFramebuffer,W,ze,36064+de,3553),_(ze,Ue)&&A(3553)}i.unbindTexture()}else{let Le=3553;(W.isWebGL3DRenderTarget||W.isWebGLArrayRenderTarget)&&(o?Le=W.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(Le,Ae.__webglTexture),Z(Le,N,Ue),le(oe.__webglFramebuffer,W,N,36064,Le),_(N,Ue)&&A(Le),i.unbindTexture()}W.depthBuffer&&be(W)}function Ve(W){let N=w(W)||o,oe=W.isWebGLMultipleRenderTargets===!0?W.texture:[W.texture];for(let Ae=0,k=oe.length;Ae<k;Ae++){let De=oe[Ae];if(_(De,N)){let Ue=W.isWebGLCubeRenderTarget?34067:3553,Le=r.get(De).__webglTexture;i.bindTexture(Ue,Le),A(Ue),i.unbindTexture()}}}function je(W){if(o&&W.samples>0&&Me(W)===!1){let N=W.isWebGLMultipleRenderTargets?W.texture:[W.texture],oe=W.width,Ae=W.height,k=16384,De=[],Ue=W.stencilBuffer?33306:36096,Le=r.get(W),de=W.isWebGLMultipleRenderTargets===!0;if(de)for(let We=0;We<N.length;We++)i.bindFramebuffer(36160,Le.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+We,36161,null),i.bindFramebuffer(36160,Le.__webglFramebuffer),e.framebufferTexture2D(36009,36064+We,3553,null,0);i.bindFramebuffer(36008,Le.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,Le.__webglFramebuffer);for(let We=0;We<N.length;We++){De.push(36064+We),W.depthBuffer&&De.push(Ue);let ze=Le.__ignoreDepthValues!==void 0?Le.__ignoreDepthValues:!1;if(ze===!1&&(W.depthBuffer&&(k|=256),W.stencilBuffer&&(k|=1024)),de&&e.framebufferRenderbuffer(36008,36064,36161,Le.__webglColorRenderbuffer[We]),ze===!0&&(e.invalidateFramebuffer(36008,[Ue]),e.invalidateFramebuffer(36009,[Ue])),de){let Xe=r.get(N[We]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,Xe,0)}e.blitFramebuffer(0,0,oe,Ae,0,0,oe,Ae,k,9728),p&&e.invalidateFramebuffer(36008,De)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),de)for(let We=0;We<N.length;We++){i.bindFramebuffer(36160,Le.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+We,36161,Le.__webglColorRenderbuffer[We]);let ze=r.get(N[We]).__webglTexture;i.bindFramebuffer(36160,Le.__webglFramebuffer),e.framebufferTexture2D(36009,36064+We,3553,ze,0)}i.bindFramebuffer(36009,Le.__webglMultisampledFramebuffer)}}function Pe(W){return Math.min(h,W.samples)}function Me(W){let N=r.get(W);return o&&W.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&N.__useRenderToTexture!==!1}function Ze(W){let N=n.render.frame;f.get(W)!==N&&(f.set(W,N),W.update())}function qe(W,N){let oe=W.encoding,Ae=W.format,k=W.type;return W.isCompressedTexture===!0||W.isVideoTexture===!0||W.format===X_||oe!==ln&&(oe===yt?o===!1?t.has("EXT_sRGB")===!0&&Ae===Sr?(W.format=X_,W.minFilter=bt,W.generateMipmaps=!1):N=jk.sRGBToLinear(N):(Ae!==Sr||k!==na)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",oe)),N}this.allocateTextureUnit=L,this.resetTextureUnits=F,this.setTexture2D=G,this.setTexture2DArray=U,this.setTexture3D=H,this.setTextureCube=$,this.rebindTextures=ke,this.setupRenderTarget=Ce,this.updateRenderTargetMipmap=Ve,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=be,this.setupFrameBufferTexture=le,this.useMultisampledRTT=Me}function mW(e,t,i){let r=i.isWebGL2;function a(s,n=null){let o;if(s===na)return 5121;if(s===K8)return 32819;if(s===$8)return 32820;if(s===Y8)return 5120;if(s===Q8)return 5122;if(s===Ok)return 5123;if(s===Z8)return 5124;if(s===Bo)return 5125;if(s===er)return 5126;if(s===ph)return r?5131:(o=t.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===J8)return 6406;if(s===Sr)return 6408;if(s===eV)return 6409;if(s===tV)return 6410;if(s===eh)return 6402;if(s===fh)return 34041;if(s===X_)return o=t.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===iV)return 6403;if(s===rV)return 36244;if(s===q0)return 33319;if(s===aV)return 33320;if(s===Ik)return 36249;if(s===Bx||s===jx||s===Fx||s===Ux)if(n===yt)if(o=t.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===Bx)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===jx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===Fx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===Ux)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=t.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===Bx)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===jx)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===Fx)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===Ux)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===M3||s===T3||s===P3||s===D3)if(o=t.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===M3)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===T3)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===P3)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===D3)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===sV)return o=t.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===O3||s===I3)if(o=t.get("WEBGL_compressed_texture_etc"),o!==null){if(s===O3)return n===yt?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===I3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===R3||s===L3||s===k3||s===z3||s===N3||s===B3||s===j3||s===F3||s===U3||s===V3||s===G3||s===H3||s===W3||s===q3)if(o=t.get("WEBGL_compressed_texture_astc"),o!==null){if(s===R3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===L3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===k3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===z3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===N3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===B3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===j3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===F3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===U3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===V3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===G3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===H3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===W3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===q3)return n===yt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===Vx)if(o=t.get("EXT_texture_compression_bptc"),o!==null){if(s===Vx)return n===yt?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===nV||s===X3||s===Y3||s===Q3)if(o=t.get("EXT_texture_compression_rgtc"),o!==null){if(s===Vx)return o.COMPRESSED_RED_RGTC1_EXT;if(s===X3)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===Y3)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===Q3)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===Jc?r?34042:(o=t.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):e[s]!==void 0?e[s]:null}return{convert:a}}var gW=class extends Jr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}},Fc=class extends Yt{constructor(){super(),this.isGroup=!0,this.type="Group"}},vW={type:"move"},fb=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Fc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Fc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Fc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,a=null,s=null,n=this._targetRay,o=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(let f of e.hand.values()){let m=t.getJointPose(f,i),g=this._getHandJoint(l,f);m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=m!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,p=.005;l.inputState.pinching&&h>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&h<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else o!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,i),a!==null&&(o.matrix.fromArray(a.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),a.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(a.linearVelocity)):o.hasLinearVelocity=!1,a.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(a.angularVelocity)):o.hasAngularVelocity=!1));n!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&a!==null&&(r=a),r!==null&&(n.matrix.fromArray(r.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),r.linearVelocity?(n.hasLinearVelocity=!0,n.linearVelocity.copy(r.linearVelocity)):n.hasLinearVelocity=!1,r.angularVelocity?(n.hasAngularVelocity=!0,n.angularVelocity.copy(r.angularVelocity)):n.hasAngularVelocity=!1,this.dispatchEvent(vW)))}return n!==null&&(n.visible=r!==null),o!==null&&(o.visible=a!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){let i=new Fc;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},Td=class extends Si{constructor(e,t,i,r,a,s,n,o,l,c){if(c=c!==void 0?c:eh,c!==eh&&c!==fh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===eh&&(i=Bo),i===void 0&&c===fh&&(i=Jc),super(null,r,a,s,n,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=n!==void 0?n:Gt,this.minFilter=o!==void 0?o:Gt,this.flipY=!1,this.generateMipmaps=!1}},yW=class extends Hr{constructor(e,t){super();let i=this,r=null,a=1,s=null,n="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],x=new Set,w=new Map,S=new Jr;S.layers.enable(1),S.viewport=new dt;let _=new Jr;_.layers.enable(2),_.viewport=new dt;let A=[S,_],E=new gW;E.layers.enable(1),E.layers.enable(2);let M=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(U){let H=v[U];return H===void 0&&(H=new fb,v[U]=H),H.getTargetRaySpace()},this.getControllerGrip=function(U){let H=v[U];return H===void 0&&(H=new fb,v[U]=H),H.getGripSpace()},this.getHand=function(U){let H=v[U];return H===void 0&&(H=new fb,v[U]=H),H.getHandSpace()};function T(U){let H=y.indexOf(U.inputSource);if(H===-1)return;let $=v[H];$!==void 0&&$.dispatchEvent({type:U.type,data:U.inputSource})}function D(){r.removeEventListener("select",T),r.removeEventListener("selectstart",T),r.removeEventListener("selectend",T),r.removeEventListener("squeeze",T),r.removeEventListener("squeezestart",T),r.removeEventListener("squeezeend",T),r.removeEventListener("end",D),r.removeEventListener("inputsourceschange",I);for(let U=0;U<v.length;U++){let H=y[U];H!==null&&(y[U]=null,v[U].disconnect(H))}M=null,C=null,e.setRenderTarget(m),d=null,h=null,u=null,r=null,g=null,G.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(U){a=U,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(U){n=U,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(U){l=U},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(U){if(r=U,r!==null){if(m=e.getRenderTarget(),r.addEventListener("select",T),r.addEventListener("selectstart",T),r.addEventListener("selectend",T),r.addEventListener("squeeze",T),r.addEventListener("squeezestart",T),r.addEventListener("squeezeend",T),r.addEventListener("end",D),r.addEventListener("inputsourceschange",I),f.xrCompatible!==!0&&await t.makeXRCompatible(),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let H={antialias:r.renderState.layers===void 0?f.antialias:!0,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:a};d=new XRWebGLLayer(r,t,H),r.updateRenderState({baseLayer:d}),g=new Ht(d.framebufferWidth,d.framebufferHeight,{format:Sr,type:na,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let H=null,$=null,Y=null;f.depth&&(Y=f.stencil?35056:33190,H=f.stencil?fh:eh,$=f.stencil?Jc:Bo);let J={colorFormat:32856,depthFormat:Y,scaleFactor:a};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(J),r.updateRenderState({layers:[h]}),g=new Ht(h.textureWidth,h.textureHeight,{format:Sr,type:na,depthTexture:new Td(h.textureWidth,h.textureHeight,$,void 0,void 0,void 0,void 0,void 0,void 0,H),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0});let Z=e.properties.get(g);Z.__ignoreDepthValues=h.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(n),G.setContext(r),G.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function I(U){for(let H=0;H<U.removed.length;H++){let $=U.removed[H],Y=y.indexOf($);Y>=0&&(y[Y]=null,v[Y].disconnect($))}for(let H=0;H<U.added.length;H++){let $=U.added[H],Y=y.indexOf($);if(Y===-1){for(let Z=0;Z<v.length;Z++)if(Z>=y.length){y.push($),Y=Z;break}else if(y[Z]===null){y[Z]=$,Y=Z;break}if(Y===-1)break}let J=v[Y];J&&J.connect($)}}let O=new P,B=new P;function q(U,H,$){O.setFromMatrixPosition(H.matrixWorld),B.setFromMatrixPosition($.matrixWorld);let Y=O.distanceTo(B),J=H.projectionMatrix.elements,Z=$.projectionMatrix.elements,ne=J[14]/(J[10]-1),re=J[14]/(J[10]+1),ie=(J[9]+1)/J[5],le=(J[9]-1)/J[5],ue=(J[8]-1)/J[0],fe=(Z[8]+1)/Z[0],be=ne*ue,ke=ne*fe,Ce=Y/(-ue+fe),Ve=Ce*-ue;H.matrixWorld.decompose(U.position,U.quaternion,U.scale),U.translateX(Ve),U.translateZ(Ce),U.matrixWorld.compose(U.position,U.quaternion,U.scale),U.matrixWorldInverse.copy(U.matrixWorld).invert();let je=ne+Ce,Pe=re+Ce,Me=be-Ve,Ze=ke+(Y-Ve),qe=ie*re/Pe*je,W=le*re/Pe*je;U.projectionMatrix.makePerspective(Me,Ze,qe,W,je,Pe)}function F(U,H){H===null?U.matrixWorld.copy(U.matrix):U.matrixWorld.multiplyMatrices(H.matrixWorld,U.matrix),U.matrixWorldInverse.copy(U.matrixWorld).invert()}this.updateCamera=function(U){if(r===null)return;E.near=_.near=S.near=U.near,E.far=_.far=S.far=U.far,(M!==E.near||C!==E.far)&&(r.updateRenderState({depthNear:E.near,depthFar:E.far}),M=E.near,C=E.far);let H=U.parent,$=E.cameras;F(E,H);for(let J=0;J<$.length;J++)F($[J],H);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),U.matrix.copy(E.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale);let Y=U.children;for(let J=0,Z=Y.length;J<Z;J++)Y[J].updateMatrixWorld(!0);$.length===2?q(E,S,_):E.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(U){o=U,h!==null&&(h.fixedFoveation=U),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=U)},this.getPlanes=function(){return x};let L=null;function X(U,H){if(c=H.getViewerPose(l||s),p=H,c!==null){let $=c.views;d!==null&&(e.setRenderTargetFramebuffer(g,d.framebuffer),e.setRenderTarget(g));let Y=!1;$.length!==E.cameras.length&&(E.cameras.length=0,Y=!0);for(let J=0;J<$.length;J++){let Z=$[J],ne=null;if(d!==null)ne=d.getViewport(Z);else{let ie=u.getViewSubImage(h,Z);ne=ie.viewport,J===0&&(e.setRenderTargetTextures(g,ie.colorTexture,h.ignoreDepthValues?void 0:ie.depthStencilTexture),e.setRenderTarget(g))}let re=A[J];re===void 0&&(re=new Jr,re.layers.enable(J),re.viewport=new dt,A[J]=re),re.matrix.fromArray(Z.transform.matrix),re.projectionMatrix.fromArray(Z.projectionMatrix),re.viewport.set(ne.x,ne.y,ne.width,ne.height),J===0&&E.matrix.copy(re.matrix),Y===!0&&E.cameras.push(re)}}for(let $=0;$<v.length;$++){let Y=y[$],J=v[$];Y!==null&&J!==void 0&&J.update(Y,H,l||s)}if(L&&L(U,H),H.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:H.detectedPlanes});let $=null;for(let Y of x)H.detectedPlanes.has(Y)||($===null&&($=[]),$.push(Y));if($!==null)for(let Y of $)x.delete(Y),w.delete(Y),i.dispatchEvent({type:"planeremoved",data:Y});for(let Y of H.detectedPlanes)if(!x.has(Y))x.add(Y),w.set(Y,H.lastChangedTime),i.dispatchEvent({type:"planeadded",data:Y});else{let J=w.get(Y);Y.lastChangedTime>J&&(w.set(Y,Y.lastChangedTime),i.dispatchEvent({type:"planechanged",data:Y}))}}p=null}let G=new Hk;G.setAnimationLoop(X),this.setAnimationLoop=function(U){L=U},this.dispose=function(){}}};function xW(e,t){function i(m,g){g.color.getRGB(m.fogColor.value,Gk(e)),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)}function r(m,g,v,y,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?a(m,g):g.isMeshToonMaterial?(a(m,g),u(m,g)):g.isMeshPhongMaterial?(a(m,g),c(m,g)):g.isMeshStandardMaterial?(a(m,g),h(m,g),g.isMeshPhysicalMaterial&&d(m,g,x)):g.isMeshMatcapMaterial?(a(m,g),p(m,g)):g.isMeshDepthMaterial?a(m,g):g.isMeshDistanceMaterial?(a(m,g),f(m,g)):g.isMeshNormalMaterial?a(m,g):g.isLineBasicMaterial?(s(m,g),g.isLineDashedMaterial&&n(m,g)):g.isPointsMaterial?o(m,g,v,y):g.isSpriteMaterial?l(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function a(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,g.side===Er&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),g.side===Er&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v=t.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;let w=e.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*w}g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity);let y;g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.iridescenceMap?y=g.iridescenceMap:g.iridescenceThicknessMap?y=g.iridescenceThicknessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix));let x;g.aoMap?x=g.aoMap:g.lightMap&&(x=g.lightMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uv2Transform.value.copy(x.matrix))}function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}function n(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}function o(m,g,v,y){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=y*.5,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let x;g.map?x=g.map:g.alphaMap&&(x=g.alphaMap),x!==void 0&&(x.matrixAutoUpdate===!0&&x.updateMatrix(),m.uvTransform.value.copy(x.matrix))}function l(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);let v;g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),v!==void 0&&(v.matrixAutoUpdate===!0&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}function u(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}function h(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),t.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}function d(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,g.side===Er&&m.clearcoatNormalScale.value.negate())),g.iridescence>0&&(m.iridescence.value=g.iridescence,m.iridescenceIOR.value=g.iridescenceIOR,m.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(m.iridescenceMap.value=g.iridescenceMap),g.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=g.iridescenceThicknessMap)),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}function p(m,g){g.matcap&&(m.matcap.value=g.matcap)}function f(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function bW(e,t,i,r){let a={},s={},n=[],o=i.isWebGL2?e.getParameter(35375):0;function l(y,x){let w=x.program;r.uniformBlockBinding(y,w)}function c(y,x){let w=a[y.id];w===void 0&&(f(y),w=u(y),a[y.id]=w,y.addEventListener("dispose",g));let S=x.program;r.updateUBOMapping(y,S);let _=t.render.frame;s[y.id]!==_&&(d(y),s[y.id]=_)}function u(y){let x=h();y.__bindingPointIndex=x;let w=e.createBuffer(),S=y.__size,_=y.usage;return e.bindBuffer(35345,w),e.bufferData(35345,S,_),e.bindBuffer(35345,null),e.bindBufferBase(35345,x,w),w}function h(){for(let y=0;y<o;y++)if(n.indexOf(y)===-1)return n.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){let x=a[y.id],w=y.uniforms,S=y.__cache;e.bindBuffer(35345,x);for(let _=0,A=w.length;_<A;_++){let E=w[_];if(p(E,_,S)===!0){let M=E.__offset,C=Array.isArray(E.value)?E.value:[E.value],T=0;for(let D=0;D<C.length;D++){let I=C[D],O=m(I);typeof I=="number"?(E.__data[0]=I,e.bufferSubData(35345,M+T,E.__data)):I.isMatrix3?(E.__data[0]=I.elements[0],E.__data[1]=I.elements[1],E.__data[2]=I.elements[2],E.__data[3]=I.elements[0],E.__data[4]=I.elements[3],E.__data[5]=I.elements[4],E.__data[6]=I.elements[5],E.__data[7]=I.elements[0],E.__data[8]=I.elements[6],E.__data[9]=I.elements[7],E.__data[10]=I.elements[8],E.__data[11]=I.elements[0]):(I.toArray(E.__data,T),T+=O.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,M,E.__data)}}e.bindBuffer(35345,null)}function p(y,x,w){let S=y.value;if(w[x]===void 0){if(typeof S=="number")w[x]=S;else{let _=Array.isArray(S)?S:[S],A=[];for(let E=0;E<_.length;E++)A.push(_[E].clone());w[x]=A}return!0}else if(typeof S=="number"){if(w[x]!==S)return w[x]=S,!0}else{let _=Array.isArray(w[x])?w[x]:[w[x]],A=Array.isArray(S)?S:[S];for(let E=0;E<_.length;E++){let M=_[E];if(M.equals(A[E])===!1)return M.copy(A[E]),!0}}return!1}function f(y){let x=y.uniforms,w=0,S=16,_=0;for(let A=0,E=x.length;A<E;A++){let M=x[A],C={boundary:0,storage:0},T=Array.isArray(M.value)?M.value:[M.value];for(let D=0,I=T.length;D<I;D++){let O=T[D],B=m(O);C.boundary+=B.boundary,C.storage+=B.storage}if(M.__data=new Float32Array(C.storage/Float32Array.BYTES_PER_ELEMENT),M.__offset=w,A>0){_=w%S;let D=S-_;_!==0&&D-C.boundary<0&&(w+=S-_,M.__offset=w)}w+=C.storage}return _=w%S,_>0&&(w+=S-_),y.__size=w,y.__cache={},this}function m(y){let x={boundary:0,storage:0};return typeof y=="number"?(x.boundary=4,x.storage=4):y.isVector2?(x.boundary=8,x.storage=8):y.isVector3||y.isColor?(x.boundary=16,x.storage=12):y.isVector4?(x.boundary=16,x.storage=16):y.isMatrix3?(x.boundary=48,x.storage=48):y.isMatrix4?(x.boundary=64,x.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),x}function g(y){let x=y.target;x.removeEventListener("dispose",g);let w=n.indexOf(x.__bindingPointIndex);n.splice(w,1),e.deleteBuffer(a[x.id]),delete a[x.id],delete s[x.id]}function v(){for(let y in a)e.deleteBuffer(a[y]);n=[],a={},s={}}return{bind:l,update:c,dispose:v}}function wW(){let e=am("canvas");return e.style.display="block",e}function Zk(e={}){this.isWebGLRenderer=!0;let t=e.canvas!==void 0?e.canvas:wW(),i=e.context!==void 0?e.context:null,r=e.depth!==void 0?e.depth:!0,a=e.stencil!==void 0?e.stencil:!0,s=e.antialias!==void 0?e.antialias:!1,n=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,o=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,l=e.powerPreference!==void 0?e.powerPreference:"default",c=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=e.alpha!==void 0?e.alpha:!1;let h=null,d=null,p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ln,this.physicallyCorrectLights=!1,this.toneMapping=qn,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,x=null,w=-1,S=null,_=new dt,A=new dt,E=null,M=t.width,C=t.height,T=1,D=null,I=null,O=new dt(0,0,M,C),B=new dt(0,0,M,C),q=!1,F=new lE,L=!1,X=!1,G=null,U=new Se,H=new Q,$=new P,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function J(){return x===null?T:1}let Z=i;function ne(V,ce){for(let ge=0;ge<V.length;ge++){let se=V[ge],ve=t.getContext(se,ce);if(ve!==null)return ve}return null}try{let V={alpha:!0,depth:r,stencil:a,antialias:s,premultipliedAlpha:n,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Yd}`),t.addEventListener("webglcontextlost",it,!1),t.addEventListener("webglcontextrestored",Ke,!1),t.addEventListener("webglcontextcreationerror",et,!1),Z===null){let ce=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&ce.shift(),Z=ne(ce,V),Z===null)throw ne(ce)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Z.getShaderPrecisionFormat===void 0&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(V){throw console.error("THREE.WebGLRenderer: "+V.message),V}let re,ie,le,ue,fe,be,ke,Ce,Ve,je,Pe,Me,Ze,qe,W,N,oe,Ae,k,De,Ue,Le,de,We;function ze(){re=new LG(Z),ie=new TG(Z,re,e),re.init(ie),Le=new mW(Z,re,ie),le=new pW(Z,re,ie),ue=new NG,fe=new eW,be=new fW(Z,re,le,fe,ie,Le,ue),ke=new DG(m),Ce=new RG(m),Ve=new qV(Z,ie),de=new CG(Z,re,Ve,ie),je=new kG(Z,Ve,ue,de),Pe=new UG(Z,je,Ve,ue),k=new FG(Z,ie,be),N=new PG(fe),Me=new JH(m,ke,Ce,re,ie,de,N),Ze=new xW(m,fe),qe=new iW,W=new lW(re,ie),Ae=new EG(m,ke,Ce,le,Pe,u,n),oe=new dW(m,Pe,ie),We=new bW(Z,ue,ie,le),De=new MG(Z,re,ue,ie),Ue=new zG(Z,re,ue,ie),ue.programs=Me.programs,m.capabilities=ie,m.extensions=re,m.properties=fe,m.renderLists=qe,m.shadowMap=oe,m.state=le,m.info=ue}ze();let Xe=new yW(m,Z);this.xr=Xe,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){let V=re.get("WEBGL_lose_context");V&&V.loseContext()},this.forceContextRestore=function(){let V=re.get("WEBGL_lose_context");V&&V.restoreContext()},this.getPixelRatio=function(){return T},this.setPixelRatio=function(V){V!==void 0&&(T=V,this.setSize(M,C,!1))},this.getSize=function(V){return V.set(M,C)},this.setSize=function(V,ce,ge){if(Xe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}M=V,C=ce,t.width=Math.floor(V*T),t.height=Math.floor(ce*T),ge!==!1&&(t.style.width=V+"px",t.style.height=ce+"px"),this.setViewport(0,0,V,ce)},this.getDrawingBufferSize=function(V){return V.set(M*T,C*T).floor()},this.setDrawingBufferSize=function(V,ce,ge){M=V,C=ce,T=ge,t.width=Math.floor(V*ge),t.height=Math.floor(ce*ge),this.setViewport(0,0,V,ce)},this.getCurrentViewport=function(V){return V.copy(_)},this.getViewport=function(V){return V.copy(O)},this.setViewport=function(V,ce,ge,se){V.isVector4?O.set(V.x,V.y,V.z,V.w):O.set(V,ce,ge,se),le.viewport(_.copy(O).multiplyScalar(T).floor())},this.getScissor=function(V){return V.copy(B)},this.setScissor=function(V,ce,ge,se){V.isVector4?B.set(V.x,V.y,V.z,V.w):B.set(V,ce,ge,se),le.scissor(A.copy(B).multiplyScalar(T).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(V){le.setScissorTest(q=V)},this.setOpaqueSort=function(V){D=V},this.setTransparentSort=function(V){I=V},this.getClearColor=function(V){return V.copy(Ae.getClearColor())},this.setClearColor=function(){Ae.setClearColor.apply(Ae,arguments)},this.getClearAlpha=function(){return Ae.getClearAlpha()},this.setClearAlpha=function(){Ae.setClearAlpha.apply(Ae,arguments)},this.clear=function(V=!0,ce=!0,ge=!0){let se=0;V&&(se|=16384),ce&&(se|=256),ge&&(se|=1024),Z.clear(se)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",it,!1),t.removeEventListener("webglcontextrestored",Ke,!1),t.removeEventListener("webglcontextcreationerror",et,!1),qe.dispose(),W.dispose(),fe.dispose(),ke.dispose(),Ce.dispose(),Pe.dispose(),de.dispose(),We.dispose(),Me.dispose(),Xe.dispose(),Xe.removeEventListener("sessionstart",Ne),Xe.removeEventListener("sessionend",st),G&&(G.dispose(),G=null),Pt.stop()};function it(V){V.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function Ke(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let V=ue.autoReset,ce=oe.enabled,ge=oe.autoUpdate,se=oe.needsUpdate,ve=oe.type;ze(),ue.autoReset=V,oe.enabled=ce,oe.autoUpdate=ge,oe.needsUpdate=se,oe.type=ve}function et(V){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",V.statusMessage)}function ii(V){let ce=V.target;ce.removeEventListener("dispose",ii),vi(ce)}function vi(V){ee(V),fe.remove(V)}function ee(V){let ce=fe.get(V).programs;ce!==void 0&&(ce.forEach(function(ge){Me.releaseProgram(ge)}),V.isShaderMaterial&&Me.releaseShaderCache(V))}this.renderBufferDirect=function(V,ce,ge,se,ve,Ye){ce===null&&(ce=Y);let gt=ve.isMesh&&ve.matrixWorld.determinant()<0,wt=nx(V,ce,ge,se,ve);le.setMaterial(se,gt);let nt=ge.index,qt=1;se.wireframe===!0&&(nt=je.getWireframeAttribute(ge),qt=2);let Ct=ge.drawRange,Dt=ge.attributes.position,_t=Ct.start*qt,Wr=(Ct.start+Ct.count)*qt;Ye!==null&&(_t=Math.max(_t,Ye.start*qt),Wr=Math.min(Wr,(Ye.start+Ye.count)*qt)),nt!==null?(_t=Math.max(_t,0),Wr=Math.min(Wr,nt.count)):Dt!=null&&(_t=Math.max(_t,0),Wr=Math.min(Wr,Dt.count));let os=Wr-_t;if(os<0||os===1/0)return;de.setup(ve,se,wt,ge,nt);let no,yi=De;if(nt!==null&&(no=Ve.get(nt),yi=Ue,yi.setIndex(no)),ve.isMesh)se.wireframe===!0?(le.setLineWidth(se.wireframeLinewidth*J()),yi.setMode(1)):yi.setMode(4);else if(ve.isLine){let Mt=se.linewidth;Mt===void 0&&(Mt=1),le.setLineWidth(Mt*J()),ve.isLineSegments?yi.setMode(1):ve.isLineLoop?yi.setMode(2):yi.setMode(3)}else ve.isPoints?yi.setMode(0):ve.isSprite&&yi.setMode(4);if(ve.isInstancedMesh)yi.renderInstances(_t,os,ve.count);else if(ge.isInstancedBufferGeometry){let Mt=ge._maxInstanceCount!==void 0?ge._maxInstanceCount:1/0,Ls=Math.min(ge.instanceCount,Mt);yi.renderInstances(_t,os,Ls)}else yi.render(_t,os)},this.compile=function(V,ce){function ge(se,ve,Ye){se.transparent===!0&&se.side===La&&se.forceSinglePass===!1?(se.side=Er,se.needsUpdate=!0,Ea(se,ve,Ye),se.side=on,se.needsUpdate=!0,Ea(se,ve,Ye),se.side=La):Ea(se,ve,Ye)}d=W.get(V),d.init(),f.push(d),V.traverseVisible(function(se){se.isLight&&se.layers.test(ce.layers)&&(d.pushLight(se),se.castShadow&&d.pushShadow(se))}),d.setupLights(m.physicallyCorrectLights),V.traverse(function(se){let ve=se.material;if(ve)if(Array.isArray(ve))for(let Ye=0;Ye<ve.length;Ye++){let gt=ve[Ye];ge(gt,V,se)}else ge(ve,V,se)}),f.pop(),d=null};let me=null;function _e(V){me&&me(V)}function Ne(){Pt.stop()}function st(){Pt.start()}let Pt=new Hk;Pt.setAnimationLoop(_e),typeof self<"u"&&Pt.setContext(self),this.setAnimationLoop=function(V){me=V,Xe.setAnimationLoop(V),V===null?Pt.stop():Pt.start()},Xe.addEventListener("sessionstart",Ne),Xe.addEventListener("sessionend",st),this.render=function(V,ce){if(ce!==void 0&&ce.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(g===!0)return;V.matrixWorldAutoUpdate===!0&&V.updateMatrixWorld(),ce.parent===null&&ce.matrixWorldAutoUpdate===!0&&ce.updateMatrixWorld(),Xe.enabled===!0&&Xe.isPresenting===!0&&(Xe.cameraAutoUpdate===!0&&Xe.updateCamera(ce),ce=Xe.getCamera()),V.isScene===!0&&V.onBeforeRender(m,V,ce,x),d=W.get(V,f.length),d.init(),f.push(d),U.multiplyMatrices(ce.projectionMatrix,ce.matrixWorldInverse),F.setFromProjectionMatrix(U),X=this.localClippingEnabled,L=N.init(this.clippingPlanes,X),h=qe.get(V,p.length),h.init(),p.push(h),ki(V,ce,0,m.sortObjects),h.finish(),m.sortObjects===!0&&h.sort(D,I),L===!0&&N.beginShadows();let ge=d.state.shadowsArray;if(oe.render(ge,V,ce),L===!0&&N.endShadows(),this.info.autoReset===!0&&this.info.reset(),Ae.render(h,V),d.setupLights(m.physicallyCorrectLights),ce.isArrayCamera){let se=ce.cameras;for(let ve=0,Ye=se.length;ve<Ye;ve++){let gt=se[ve];gr(h,V,gt,gt.viewport)}}else gr(h,V,ce);x!==null&&(be.updateMultisampleRenderTarget(x),be.updateRenderTargetMipmap(x)),V.isScene===!0&&V.onAfterRender(m,V,ce),de.resetDefaultState(),w=-1,S=null,f.pop(),f.length>0?d=f[f.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function ki(V,ce,ge,se){if(V.visible===!1)return;if(V.layers.test(ce.layers)){if(V.isGroup)ge=V.renderOrder;else if(V.isLOD)V.autoUpdate===!0&&V.update(ce);else if(V.isLight)d.pushLight(V),V.castShadow&&d.pushShadow(V);else if(V.isSprite){if(!V.frustumCulled||F.intersectsSprite(V)){se&&$.setFromMatrixPosition(V.matrixWorld).applyMatrix4(U);let Ye=Pe.update(V),gt=V.material;gt.visible&&h.push(V,Ye,gt,ge,$.z,null)}}else if((V.isMesh||V.isLine||V.isPoints)&&(V.isSkinnedMesh&&V.skeleton.frame!==ue.render.frame&&(V.skeleton.update(),V.skeleton.frame=ue.render.frame),!V.frustumCulled||F.intersectsObject(V))){se&&$.setFromMatrixPosition(V.matrixWorld).applyMatrix4(U);let Ye=Pe.update(V),gt=V.material;if(Array.isArray(gt)){let wt=Ye.groups;for(let nt=0,qt=wt.length;nt<qt;nt++){let Ct=wt[nt],Dt=gt[Ct.materialIndex];Dt&&Dt.visible&&h.push(V,Ye,Dt,ge,$.z,Ct)}}else gt.visible&&h.push(V,Ye,gt,ge,$.z,null)}}let ve=V.children;for(let Ye=0,gt=ve.length;Ye<gt;Ye++)ki(ve[Ye],ce,ge,se)}function gr(V,ce,ge,se){let ve=V.opaque,Ye=V.transmissive,gt=V.transparent;d.setupLightsView(ge),L===!0&&N.setGlobalState(m.clippingPlanes,ge),Ye.length>0&&fn(ve,ce,ge),se&&le.viewport(_.copy(se)),ve.length>0&&oi(ve,ce,ge),Ye.length>0&&oi(Ye,ce,ge),gt.length>0&&oi(gt,ce,ge),le.buffers.depth.setTest(!0),le.buffers.depth.setMask(!0),le.buffers.color.setMask(!0),le.setPolygonOffset(!1)}function fn(V,ce,ge){let se=ie.isWebGL2;G===null&&(G=new Ht(1,1,{generateMipmaps:!0,type:re.has("EXT_color_buffer_half_float")?ph:na,minFilter:Cd,samples:se&&s===!0?4:0})),m.getDrawingBufferSize(H),se?G.setSize(H.x,H.y):G.setSize(K0(H.x),K0(H.y));let ve=m.getRenderTarget();m.setRenderTarget(G),m.clear();let Ye=m.toneMapping;m.toneMapping=qn,oi(V,ce,ge),m.toneMapping=Ye,be.updateMultisampleRenderTarget(G),be.updateRenderTargetMipmap(G),m.setRenderTarget(ve)}function oi(V,ce,ge){let se=ce.isScene===!0?ce.overrideMaterial:null;for(let ve=0,Ye=V.length;ve<Ye;ve++){let gt=V[ve],wt=gt.object,nt=gt.geometry,qt=se===null?gt.material:se,Ct=gt.group;wt.layers.test(ge.layers)&&Rs(wt,ce,ge,nt,qt,Ct)}}function Rs(V,ce,ge,se,ve,Ye){V.onBeforeRender(m,ce,ge,se,ve,Ye),V.modelViewMatrix.multiplyMatrices(ge.matrixWorldInverse,V.matrixWorld),V.normalMatrix.getNormalMatrix(V.modelViewMatrix),ve.onBeforeRender(m,ce,ge,se,V,Ye),ve.transparent===!0&&ve.side===La&&ve.forceSinglePass===!1?(ve.side=Er,ve.needsUpdate=!0,m.renderBufferDirect(ge,ce,se,ve,V,Ye),ve.side=on,ve.needsUpdate=!0,m.renderBufferDirect(ge,ce,se,ve,V,Ye),ve.side=La):m.renderBufferDirect(ge,ce,se,ve,V,Ye),V.onAfterRender(m,ce,ge,se,ve,Ye)}function Ea(V,ce,ge){ce.isScene!==!0&&(ce=Y);let se=fe.get(V),ve=d.state.lights,Ye=d.state.shadowsArray,gt=ve.state.version,wt=Me.getParameters(V,ve.state,Ye,ce,ge),nt=Me.getProgramCacheKey(wt),qt=se.programs;se.environment=V.isMeshStandardMaterial?ce.environment:null,se.fog=ce.fog,se.envMap=(V.isMeshStandardMaterial?Ce:ke).get(V.envMap||se.environment),qt===void 0&&(V.addEventListener("dispose",ii),qt=new Map,se.programs=qt);let Ct=qt.get(nt);if(Ct!==void 0){if(se.currentProgram===Ct&&se.lightsStateVersion===gt)return Dh(V,wt),Ct}else wt.uniforms=Me.getUniforms(V),V.onBuild(ge,wt,m),V.onBeforeCompile(wt,m),Ct=Me.acquireProgram(wt,nt),qt.set(nt,Ct),se.uniforms=wt.uniforms;let Dt=se.uniforms;(!V.isShaderMaterial&&!V.isRawShaderMaterial||V.clipping===!0)&&(Dt.clippingPlanes=N.uniform),Dh(V,wt),se.needsLights=dp(V),se.lightsStateVersion=gt,se.needsLights&&(Dt.ambientLightColor.value=ve.state.ambient,Dt.lightProbe.value=ve.state.probe,Dt.directionalLights.value=ve.state.directional,Dt.directionalLightShadows.value=ve.state.directionalShadow,Dt.spotLights.value=ve.state.spot,Dt.spotLightShadows.value=ve.state.spotShadow,Dt.rectAreaLights.value=ve.state.rectArea,Dt.ltc_1.value=ve.state.rectAreaLTC1,Dt.ltc_2.value=ve.state.rectAreaLTC2,Dt.pointLights.value=ve.state.point,Dt.pointLightShadows.value=ve.state.pointShadow,Dt.hemisphereLights.value=ve.state.hemi,Dt.directionalShadowMap.value=ve.state.directionalShadowMap,Dt.directionalShadowMatrix.value=ve.state.directionalShadowMatrix,Dt.spotShadowMap.value=ve.state.spotShadowMap,Dt.spotLightMatrix.value=ve.state.spotLightMatrix,Dt.spotLightMap.value=ve.state.spotLightMap,Dt.pointShadowMap.value=ve.state.pointShadowMap,Dt.pointShadowMatrix.value=ve.state.pointShadowMatrix);let _t=Ct.getUniforms(),Wr=a0.seqWithValue(_t.seq,Dt);return se.currentProgram=Ct,se.uniformsList=Wr,Ct}function Dh(V,ce){let ge=fe.get(V);ge.outputEncoding=ce.outputEncoding,ge.instancing=ce.instancing,ge.skinning=ce.skinning,ge.morphTargets=ce.morphTargets,ge.morphNormals=ce.morphNormals,ge.morphColors=ce.morphColors,ge.morphTargetsCount=ce.morphTargetsCount,ge.numClippingPlanes=ce.numClippingPlanes,ge.numIntersection=ce.numClipIntersection,ge.vertexAlphas=ce.vertexAlphas,ge.vertexTangents=ce.vertexTangents,ge.toneMapping=ce.toneMapping}function nx(V,ce,ge,se,ve){ce.isScene!==!0&&(ce=Y),be.resetTextureUnits();let Ye=ce.fog,gt=se.isMeshStandardMaterial?ce.environment:null,wt=x===null?m.outputEncoding:x.isXRRenderTarget===!0?x.texture.encoding:ln,nt=(se.isMeshStandardMaterial?Ce:ke).get(se.envMap||gt),qt=se.vertexColors===!0&&!!ge.attributes.color&&ge.attributes.color.itemSize===4,Ct=!!se.normalMap&&!!ge.attributes.tangent,Dt=!!ge.morphAttributes.position,_t=!!ge.morphAttributes.normal,Wr=!!ge.morphAttributes.color,os=se.toneMapped?m.toneMapping:qn,no=ge.morphAttributes.position||ge.morphAttributes.normal||ge.morphAttributes.color,yi=no!==void 0?no.length:0,Mt=fe.get(se),Ls=d.state.lights;if(L===!0&&(X===!0||V!==S)){let j=V===S&&se.id===w;N.setState(se,V,j)}let At=!1;se.version===Mt.__version?(Mt.needsLights&&Mt.lightsStateVersion!==Ls.state.version||Mt.outputEncoding!==wt||ve.isInstancedMesh&&Mt.instancing===!1||!ve.isInstancedMesh&&Mt.instancing===!0||ve.isSkinnedMesh&&Mt.skinning===!1||!ve.isSkinnedMesh&&Mt.skinning===!0||Mt.envMap!==nt||se.fog===!0&&Mt.fog!==Ye||Mt.numClippingPlanes!==void 0&&(Mt.numClippingPlanes!==N.numPlanes||Mt.numIntersection!==N.numIntersection)||Mt.vertexAlphas!==qt||Mt.vertexTangents!==Ct||Mt.morphTargets!==Dt||Mt.morphNormals!==_t||Mt.morphColors!==Wr||Mt.toneMapping!==os||ie.isWebGL2===!0&&Mt.morphTargetsCount!==yi)&&(At=!0):(At=!0,Mt.__version=se.version);let oo=Mt.currentProgram;At===!0&&(oo=Ea(se,ce,ve));let mc=!1,sl=!1,mn=!1,R=oo.getUniforms(),z=Mt.uniforms;if(le.useProgram(oo.program)&&(mc=!0,sl=!0,mn=!0),se.id!==w&&(w=se.id,sl=!0),mc||S!==V){if(R.setValue(Z,"projectionMatrix",V.projectionMatrix),ie.logarithmicDepthBuffer&&R.setValue(Z,"logDepthBufFC",2/(Math.log(V.far+1)/Math.LN2)),S!==V&&(S=V,sl=!0,mn=!0),se.isShaderMaterial||se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshStandardMaterial||se.envMap){let j=R.map.cameraPosition;j!==void 0&&j.setValue(Z,$.setFromMatrixPosition(V.matrixWorld))}(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial)&&R.setValue(Z,"isOrthographic",V.isOrthographicCamera===!0),(se.isMeshPhongMaterial||se.isMeshToonMaterial||se.isMeshLambertMaterial||se.isMeshBasicMaterial||se.isMeshStandardMaterial||se.isShaderMaterial||se.isShadowMaterial||ve.isSkinnedMesh)&&R.setValue(Z,"viewMatrix",V.matrixWorldInverse)}if(ve.isSkinnedMesh){R.setOptional(Z,ve,"bindMatrix"),R.setOptional(Z,ve,"bindMatrixInverse");let j=ve.skeleton;j&&(ie.floatVertexTextures?(j.boneTexture===null&&j.computeBoneTexture(),R.setValue(Z,"boneTexture",j.boneTexture,be),R.setValue(Z,"boneTextureSize",j.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let K=ge.morphAttributes;if((K.position!==void 0||K.normal!==void 0||K.color!==void 0&&ie.isWebGL2===!0)&&k.update(ve,ge,se,oo),(sl||Mt.receiveShadow!==ve.receiveShadow)&&(Mt.receiveShadow=ve.receiveShadow,R.setValue(Z,"receiveShadow",ve.receiveShadow)),se.isMeshGouraudMaterial&&se.envMap!==null&&(z.envMap.value=nt,z.flipEnvMap.value=nt.isCubeTexture&&nt.isRenderTargetTexture===!1?-1:1),sl&&(R.setValue(Z,"toneMappingExposure",m.toneMappingExposure),Mt.needsLights&&ox(z,mn),Ye&&se.fog===!0&&Ze.refreshFogUniforms(z,Ye),Ze.refreshMaterialUniforms(z,se,T,C,G),a0.upload(Z,Mt.uniformsList,z,be)),se.isShaderMaterial&&se.uniformsNeedUpdate===!0&&(a0.upload(Z,Mt.uniformsList,z,be),se.uniformsNeedUpdate=!1),se.isSpriteMaterial&&R.setValue(Z,"center",ve.center),R.setValue(Z,"modelViewMatrix",ve.modelViewMatrix),R.setValue(Z,"normalMatrix",ve.normalMatrix),R.setValue(Z,"modelMatrix",ve.matrixWorld),ve.previousModelViewMatrix&&R.setValue(Z,"previousModelViewMatrix",ve.previousModelViewMatrix),V.previousProjectionMatrix&&R.setValue(Z,"previousProjectionMatrix",V.previousProjectionMatrix),se.isShaderMaterial||se.isRawShaderMaterial){let j=se.uniformsGroups;for(let te=0,Ee=j.length;te<Ee;te++)if(ie.isWebGL2){let lo=j[te];We.update(lo,oo),We.bind(lo,oo)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return oo}function ox(V,ce){V.ambientLightColor.needsUpdate=ce,V.lightProbe.needsUpdate=ce,V.directionalLights.needsUpdate=ce,V.directionalLightShadows.needsUpdate=ce,V.pointLights.needsUpdate=ce,V.pointLightShadows.needsUpdate=ce,V.spotLights.needsUpdate=ce,V.spotLightShadows.needsUpdate=ce,V.rectAreaLights.needsUpdate=ce,V.hemisphereLights.needsUpdate=ce}function dp(V){return V.isMeshLambertMaterial||V.isMeshToonMaterial||V.isMeshPhongMaterial||V.isMeshStandardMaterial||V.isShadowMaterial||V.isShaderMaterial&&V.lights===!0}this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(V,ce,ge){fe.get(V.texture).__webglTexture=ce,fe.get(V.depthTexture).__webglTexture=ge;let se=fe.get(V);se.__hasExternalTextures=!0,se.__hasExternalTextures&&(se.__autoAllocateDepthBuffer=ge===void 0,se.__autoAllocateDepthBuffer||re.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),se.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(V,ce){let ge=fe.get(V);ge.__webglFramebuffer=ce,ge.__useDefaultFramebuffer=ce===void 0},this.setRenderTarget=function(V,ce=0,ge=0){x=V,v=ce,y=ge;let se=!0,ve=null,Ye=!1,gt=!1;if(V){let wt=fe.get(V);wt.__useDefaultFramebuffer!==void 0?(le.bindFramebuffer(36160,null),se=!1):wt.__webglFramebuffer===void 0?be.setupRenderTarget(V):wt.__hasExternalTextures&&be.rebindTextures(V,fe.get(V.texture).__webglTexture,fe.get(V.depthTexture).__webglTexture);let nt=V.texture;(nt.isData3DTexture||nt.isDataArrayTexture||nt.isCompressedArrayTexture)&&(gt=!0);let qt=fe.get(V).__webglFramebuffer;V.isWebGLCubeRenderTarget?(ve=qt[ce],Ye=!0):ie.isWebGL2&&V.samples>0&&be.useMultisampledRTT(V)===!1?ve=fe.get(V).__webglMultisampledFramebuffer:ve=qt,_.copy(V.viewport),A.copy(V.scissor),E=V.scissorTest}else _.copy(O).multiplyScalar(T).floor(),A.copy(B).multiplyScalar(T).floor(),E=q;if(le.bindFramebuffer(36160,ve)&&ie.drawBuffers&&se&&le.drawBuffers(V,ve),le.viewport(_),le.scissor(A),le.setScissorTest(E),Ye){let wt=fe.get(V.texture);Z.framebufferTexture2D(36160,36064,34069+ce,wt.__webglTexture,ge)}else if(gt){let wt=fe.get(V.texture),nt=ce||0;Z.framebufferTextureLayer(36160,36064,wt.__webglTexture,ge||0,nt)}w=-1},this.readRenderTargetPixels=function(V,ce,ge,se,ve,Ye,gt){if(!(V&&V.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let wt=fe.get(V).__webglFramebuffer;if(V.isWebGLCubeRenderTarget&&gt!==void 0&&(wt=wt[gt]),wt){le.bindFramebuffer(36160,wt);try{let nt=V.texture,qt=nt.format,Ct=nt.type;if(qt!==Sr&&Le.convert(qt)!==Z.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Dt=Ct===ph&&(re.has("EXT_color_buffer_half_float")||ie.isWebGL2&&re.has("EXT_color_buffer_float"));if(Ct!==na&&Le.convert(Ct)!==Z.getParameter(35738)&&!(Ct===er&&(ie.isWebGL2||re.has("OES_texture_float")||re.has("WEBGL_color_buffer_float")))&&!Dt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ce>=0&&ce<=V.width-se&&ge>=0&&ge<=V.height-ve&&Z.readPixels(ce,ge,se,ve,Le.convert(qt),Le.convert(Ct),Ye)}finally{let nt=x!==null?fe.get(x).__webglFramebuffer:null;le.bindFramebuffer(36160,nt)}}},this.copyFramebufferToTexture=function(V,ce,ge=0){let se=Math.pow(2,-ge),ve=Math.floor(ce.image.width*se),Ye=Math.floor(ce.image.height*se);be.setTexture2D(ce,0),Z.copyTexSubImage2D(3553,ge,0,0,V.x,V.y,ve,Ye),le.unbindTexture()},this.copyTextureToTexture=function(V,ce,ge,se=0){let ve=ce.image.width,Ye=ce.image.height,gt=Le.convert(ge.format),wt=Le.convert(ge.type);be.setTexture2D(ge,0),Z.pixelStorei(37440,ge.flipY),Z.pixelStorei(37441,ge.premultiplyAlpha),Z.pixelStorei(3317,ge.unpackAlignment),ce.isDataTexture?Z.texSubImage2D(3553,se,V.x,V.y,ve,Ye,gt,wt,ce.image.data):ce.isCompressedTexture?Z.compressedTexSubImage2D(3553,se,V.x,V.y,ce.mipmaps[0].width,ce.mipmaps[0].height,gt,ce.mipmaps[0].data):Z.texSubImage2D(3553,se,V.x,V.y,gt,wt,ce.image),se===0&&ge.generateMipmaps&&Z.generateMipmap(3553),le.unbindTexture()},this.copyTextureToTexture3D=function(V,ce,ge,se,ve=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ye=V.max.x-V.min.x+1,gt=V.max.y-V.min.y+1,wt=V.max.z-V.min.z+1,nt=Le.convert(se.format),qt=Le.convert(se.type),Ct;if(se.isData3DTexture)be.setTexture3D(se,0),Ct=32879;else if(se.isDataArrayTexture)be.setTexture2DArray(se,0),Ct=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(37440,se.flipY),Z.pixelStorei(37441,se.premultiplyAlpha),Z.pixelStorei(3317,se.unpackAlignment);let Dt=Z.getParameter(3314),_t=Z.getParameter(32878),Wr=Z.getParameter(3316),os=Z.getParameter(3315),no=Z.getParameter(32877),yi=ge.isCompressedTexture?ge.mipmaps[0]:ge.image;Z.pixelStorei(3314,yi.width),Z.pixelStorei(32878,yi.height),Z.pixelStorei(3316,V.min.x),Z.pixelStorei(3315,V.min.y),Z.pixelStorei(32877,V.min.z),ge.isDataTexture||ge.isData3DTexture?Z.texSubImage3D(Ct,ve,ce.x,ce.y,ce.z,Ye,gt,wt,nt,qt,yi.data):ge.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Z.compressedTexSubImage3D(Ct,ve,ce.x,ce.y,ce.z,Ye,gt,wt,nt,yi.data)):Z.texSubImage3D(Ct,ve,ce.x,ce.y,ce.z,Ye,gt,wt,nt,qt,yi),Z.pixelStorei(3314,Dt),Z.pixelStorei(32878,_t),Z.pixelStorei(3316,Wr),Z.pixelStorei(3315,os),Z.pixelStorei(32877,no),ve===0&&se.generateMipmaps&&Z.generateMipmap(Ct),le.unbindTexture()},this.initTexture=function(V){V.isCubeTexture?be.setTextureCube(V,0):V.isData3DTexture?be.setTexture3D(V,0):V.isDataArrayTexture||V.isCompressedArrayTexture?be.setTexture2DArray(V,0):be.setTexture2D(V,0),le.unbindTexture()},this.resetState=function(){v=0,y=0,x=null,le.reset(),de.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var _W=class extends Zk{};_W.prototype.isWebGL1Renderer=!0;var Kk=class{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new tt(e),this.near=t,this.far=i}clone(){return new Kk(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},Vo=class extends Yt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},SW=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=q_,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Cs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Cs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Cs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},la=new P,Z_=class{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)la.fromBufferAttribute(this,t),la.applyMatrix4(e),this.setXYZ(t,la.x,la.y,la.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)la.fromBufferAttribute(this,t),la.applyNormalMatrix(e),this.setXYZ(t,la.x,la.y,la.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)la.fromBufferAttribute(this,t),la.transformDirection(e),this.setXYZ(t,la.x,la.y,la.z);return this}setX(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ni(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=jo(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=jo(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=jo(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=jo(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),r=ni(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=ni(t,this.array),i=ni(i,this.array),r=ni(r,this.array),a=ni(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=a,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[r+a])}return new ht(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Z_(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let t=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[r+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},$k=class extends Yt{constructor(){super(),this.isBone=!0,this.type="Bone"}},As=class extends Si{constructor(e=null,t=1,i=1,r,a,s,n,o,l=Gt,c=Gt,u,h){super(null,s,n,o,l,c,r,a,u,h),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},DT=new Se,AW=new Se,uE=class{constructor(e=[],t=[]){this.uuid=Cs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Se)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let i=new Se;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let a=0,s=e.length;a<s;a++){let n=e[a]?e[a].matrixWorld:AW;DT.multiplyMatrices(n,t[a]),DT.toArray(i,a*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new uE(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=zk(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new As(t,e,e,Sr,er);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){let a=e.bones[i],s=t[a];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),s=new $k),this.bones.push(s),this.boneInverses.push(new Se().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let r=0,a=t.length;r<a;r++){let s=t[r];e.bones.push(s.uuid);let n=i[r];e.boneInverses.push(n.toArray())}return e}},sm=class extends ht{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},OT=new Se,IT=new Se,jg=[],EW=new Se,Tp=new tr,CW=class extends tr{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new sm(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,EW)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let i=this.matrixWorld,r=this.count;if(Tp.geometry=this.geometry,Tp.material=this.material,Tp.material!==void 0)for(let a=0;a<r;a++){this.getMatrixAt(a,OT),IT.multiplyMatrices(i,OT),Tp.matrixWorld=IT,Tp.raycast(e,jg);for(let s=0,n=jg.length;s<n;s++){let o=jg[s];o.instanceId=a,o.object=this,t.push(o)}jg.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new sm(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},dc=class extends Bm{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new tt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},RT=new P,LT=new P,kT=new Se,mb=new Qd,Fg=new Fa,$0=class extends Yt{constructor(e=new Qe,t=new dc){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[0];for(let r=1,a=t.count;r<a;r++)RT.fromBufferAttribute(t,r-1),LT.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=RT.distanceTo(LT);e.setAttribute("lineDistance",new Re(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Fg.copy(i.boundingSphere),Fg.applyMatrix4(r),Fg.radius+=a,e.ray.intersectsSphere(Fg)===!1)return;kT.copy(r).invert(),mb.copy(e.ray).applyMatrix4(kT);let n=a/((this.scale.x+this.scale.y+this.scale.z)/3),o=n*n,l=new P,c=new P,u=new P,h=new P,d=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(p!==null){let m=Math.max(0,s.start),g=Math.min(p.count,s.start+s.count);for(let v=m,y=g-1;v<y;v+=d){let x=p.getX(v),w=p.getX(v+1);if(l.fromBufferAttribute(f,x),c.fromBufferAttribute(f,w),mb.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let S=e.ray.origin.distanceTo(h);S<e.near||S>e.far||t.push({distance:S,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else{let m=Math.max(0,s.start),g=Math.min(f.count,s.start+s.count);for(let v=m,y=g-1;v<y;v+=d){if(l.fromBufferAttribute(f,v),c.fromBufferAttribute(f,v+1),mb.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let x=e.ray.origin.distanceTo(h);x<e.near||x>e.far||t.push({distance:x,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=i.length;r<a;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},zT=new P,NT=new P,jm=class extends $0{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.index===null){let t=e.attributes.position,i=[];for(let r=0,a=t.count;r<a;r+=2)zT.fromBufferAttribute(t,r),NT.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+zT.distanceTo(NT);e.setAttribute("lineDistance",new Re(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},MW=class extends Si{constructor(e,t,i,r,a,s,n,o,l){super(e,t,i,r,a,s,n,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:bt,this.magFilter=a!==void 0?a:bt,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},TW=class extends Si{constructor(e,t,i,r,a,s,n,o,l){super(e,t,i,r,a,s,n,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},to=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){let t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],i,r=this.getPoint(0),a=0;t.push(0);for(let s=1;s<=e;s++)i=this.getPoint(s/e),a+=i.distanceTo(r),t.push(a),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i=this.getLengths(),r=0,a=i.length,s;t?s=t:s=e*i[a-1];let n=0,o=a-1,l;for(;n<=o;)if(r=Math.floor(n+(o-n)/2),l=i[r]-s,l<0)n=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(a-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(a-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);let a=this.getPoint(i),s=this.getPoint(r),n=t||(a.isVector2?new Q:new P);return n.copy(s).sub(a).normalize(),n}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new P,r=[],a=[],s=[],n=new P,o=new Se;for(let d=0;d<=e;d++){let p=d/e;r[d]=this.getTangentAt(p,new P)}a[0]=new P,s[0]=new P;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),n.crossVectors(r[0],i).normalize(),a[0].crossVectors(r[0],n),s[0].crossVectors(r[0],a[0]);for(let d=1;d<=e;d++){if(a[d]=a[d-1].clone(),s[d]=s[d-1].clone(),n.crossVectors(r[d-1],r[d]),n.length()>Number.EPSILON){n.normalize();let p=Math.acos(Zi(r[d-1].dot(r[d]),-1,1));a[d].applyMatrix4(o.makeRotationAxis(n,p))}s[d].crossVectors(r[d],a[d])}if(t===!0){let d=Math.acos(Zi(a[0].dot(a[e]),-1,1));d/=e,r[0].dot(n.crossVectors(a[0],a[e]))>0&&(d=-d);for(let p=1;p<=e;p++)a[p].applyMatrix4(o.makeRotationAxis(r[p],d*p)),s[p].crossVectors(r[p],a[p])}return{tangents:r,normals:a,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},_1=class extends to{constructor(e=0,t=0,i=1,r=1,a=0,s=Math.PI*2,n=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=a,this.aEndAngle=s,this.aClockwise=n,this.aRotation=o}getPoint(e,t){let i=t||new Q,r=Math.PI*2,a=this.aEndAngle-this.aStartAngle,s=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(s?a=0:a=r),this.aClockwise===!0&&!s&&(a===r?a=-r:a=a-r);let n=this.aStartAngle+e*a,o=this.aX+this.xRadius*Math.cos(n),l=this.aY+this.yRadius*Math.sin(n);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},PW=class extends _1{constructor(e,t,i,r,a,s){super(e,t,i,i,r,a,s),this.isArcCurve=!0,this.type="ArcCurve"}};function dE(){let e=0,t=0,i=0,r=0;function a(s,n,o,l){e=s,t=o,i=-3*s+3*n-2*o-l,r=2*s-2*n+o+l}return{initCatmullRom:function(s,n,o,l,c){a(n,o,c*(o-s),c*(l-n))},initNonuniformCatmullRom:function(s,n,o,l,c,u,h){let d=(n-s)/c-(o-s)/(c+u)+(o-n)/u,p=(o-n)/u-(l-n)/(u+h)+(l-o)/h;d*=u,p*=u,a(n,o,d,p)},calc:function(s){let n=s*s,o=n*s;return e+t*s+i*n+r*o}}}var Ug=new P,gb=new dE,vb=new dE,yb=new dE,DW=class extends to{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new P){let i=t,r=this.points,a=r.length,s=(a-(this.closed?0:1))*e,n=Math.floor(s),o=s-n;this.closed?n+=n>0?0:(Math.floor(Math.abs(n)/a)+1)*a:o===0&&n===a-1&&(n=a-2,o=1);let l,c;this.closed||n>0?l=r[(n-1)%a]:(Ug.subVectors(r[0],r[1]).add(r[0]),l=Ug);let u=r[n%a],h=r[(n+1)%a];if(this.closed||n+2<a?c=r[(n+2)%a]:(Ug.subVectors(r[a-1],r[a-2]).add(r[a-1]),c=Ug),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,p=Math.pow(l.distanceToSquared(u),d),f=Math.pow(u.distanceToSquared(h),d),m=Math.pow(h.distanceToSquared(c),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),gb.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,p,f,m),vb.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,p,f,m),yb.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,p,f,m)}else this.curveType==="catmullrom"&&(gb.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),vb.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),yb.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(gb.calc(o),vb.calc(o),yb.calc(o)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new P().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};function BT(e,t,i,r,a){let s=(r-t)*.5,n=(a-i)*.5,o=e*e,l=e*o;return(2*i-2*r+s+n)*l+(-3*i+3*r-2*s-n)*o+s*e+i}function OW(e,t){let i=1-e;return i*i*t}function IW(e,t){return 2*(1-e)*e*t}function RW(e,t){return e*e*t}function Mf(e,t,i,r){return OW(e,t)+IW(e,i)+RW(e,r)}function LW(e,t){let i=1-e;return i*i*i*t}function kW(e,t){let i=1-e;return 3*i*i*e*t}function zW(e,t){return 3*(1-e)*e*e*t}function NW(e,t){return e*e*e*t}function Tf(e,t,i,r,a){return LW(e,t)+kW(e,i)+zW(e,r)+NW(e,a)}var Ks=class extends to{constructor(e=new Q,t=new Q,i=new Q,r=new Q){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Q){let i=t,r=this.v0,a=this.v1,s=this.v2,n=this.v3;return i.set(Tf(e,r.x,a.x,s.x,n.x),Tf(e,r.y,a.y,s.y,n.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},s0=class extends to{constructor(e=new P,t=new P,i=new P,r=new P){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new P){let i=t,r=this.v0,a=this.v1,s=this.v2,n=this.v3;return i.set(Tf(e,r.x,a.x,s.x,n.x),Tf(e,r.y,a.y,s.y,n.y),Tf(e,r.z,a.z,s.z,n.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},an=class extends to{constructor(e=new Q,t=new Q){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Q){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new Q;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Jk=class extends to{constructor(e=new P,t=new P){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new P){let i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},nc=class extends to{constructor(e=new Q,t=new Q,i=new Q){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Q){let i=t,r=this.v0,a=this.v1,s=this.v2;return i.set(Mf(e,r.x,a.x,s.x),Mf(e,r.y,a.y,s.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},BW=class extends to{constructor(e=new P,t=new P,i=new P){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new P){let i=t,r=this.v0,a=this.v1,s=this.v2;return i.set(Mf(e,r.x,a.x,s.x),Mf(e,r.y,a.y,s.y),Mf(e,r.z,a.z,s.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},pE=class extends to{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Q){let i=t,r=this.points,a=(r.length-1)*e,s=Math.floor(a),n=a-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(BT(n,o.x,l.x,c.x,u.x),BT(n,o.y,l.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let r=e.points[t];this.points.push(new Q().fromArray(r))}return this}},jW=Object.freeze({__proto__:null,ArcCurve:PW,CatmullRomCurve3:DW,CubicBezierCurve:Ks,CubicBezierCurve3:s0,EllipseCurve:_1,LineCurve:an,LineCurve3:Jk,QuadraticBezierCurve:nc,QuadraticBezierCurve3:BW,SplineCurve:pE}),e5=class extends to{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new an(t,e))}getPoint(e,t){let i=e*this.getLength(),r=this.getCurveLengths(),a=0;for(;a<r.length;){if(r[a]>=i){let s=r[a]-i,n=this.curves[a],o=n.getLength(),l=o===0?0:1-s/o;return n.getPointAt(l,t)}a++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],i;for(let r=0,a=this.curves;r<a.length;r++){let s=a[r],n=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(n);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let r=e.curves[t];this.curves.push(new jW[r.type]().fromJSON(r))}return this}},J0=class extends e5{constructor(e){super(),this.type="Path",this.currentPoint=new Q,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new an(this.currentPoint.clone(),new Q(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){let a=new nc(this.currentPoint.clone(),new Q(e,t),new Q(i,r));return this.curves.push(a),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,a,s){let n=new Ks(this.currentPoint.clone(),new Q(e,t),new Q(i,r),new Q(a,s));return this.curves.push(n),this.currentPoint.set(a,s),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new pE(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,a,s){let n=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+n,t+o,i,r,a,s),this}absarc(e,t,i,r,a,s){return this.absellipse(e,t,i,i,r,a,s),this}ellipse(e,t,i,r,a,s,n,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,r,a,s,n,o),this}absellipse(e,t,i,r,a,s,n,o){let l=new _1(e,t,i,r,a,s,n,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},t5=class extends Qe{constructor(e=[new Q(0,-.5),new Q(.5,0),new Q(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Zi(r,0,Math.PI*2);let a=[],s=[],n=[],o=[],l=[],c=1/t,u=new P,h=new Q,d=new P,p=new P,f=new P,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=g*1,d.y=-m,d.z=g*0,f.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,d.x=g*1,d.y=-m,d.z=g*0,p.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),o.push(d.x,d.y,d.z),f.copy(p)}for(let v=0;v<=t;v++){let y=i+v*c*r,x=Math.sin(y),w=Math.cos(y);for(let S=0;S<=e.length-1;S++){u.x=e[S].x*x,u.y=e[S].y,u.z=e[S].x*w,s.push(u.x,u.y,u.z),h.x=v/t,h.y=S/(e.length-1),n.push(h.x,h.y);let _=o[3*S+0]*x,A=o[3*S+1],E=o[3*S+0]*w;l.push(_,A,E)}}for(let v=0;v<t;v++)for(let y=0;y<e.length-1;y++){let x=y+v*e.length,w=x,S=x+e.length,_=x+e.length+1,A=x+1;a.push(w,S,A),a.push(_,A,S)}this.setIndex(a),this.setAttribute("position",new Re(s,3)),this.setAttribute("uv",new Re(n,2)),this.setAttribute("normal",new Re(l,3))}static fromJSON(e){return new t5(e.points,e.segments,e.phiStart,e.phiLength)}},fE=class extends Qe{constructor(e=1,t=1,i=1,r=32,a=1,s=!1,n=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:a,openEnded:s,thetaStart:n,thetaLength:o};let l=this;r=Math.floor(r),a=Math.floor(a);let c=[],u=[],h=[],d=[],p=0,f=[],m=i/2,g=0;v(),s===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(c),this.setAttribute("position",new Re(u,3)),this.setAttribute("normal",new Re(h,3)),this.setAttribute("uv",new Re(d,2));function v(){let x=new P,w=new P,S=0,_=(t-e)/i;for(let A=0;A<=a;A++){let E=[],M=A/a,C=M*(t-e)+e;for(let T=0;T<=r;T++){let D=T/r,I=D*o+n,O=Math.sin(I),B=Math.cos(I);w.x=C*O,w.y=-M*i+m,w.z=C*B,u.push(w.x,w.y,w.z),x.set(O,_,B).normalize(),h.push(x.x,x.y,x.z),d.push(D,1-M),E.push(p++)}f.push(E)}for(let A=0;A<r;A++)for(let E=0;E<a;E++){let M=f[E][A],C=f[E+1][A],T=f[E+1][A+1],D=f[E][A+1];c.push(M,C,D),c.push(C,T,D),S+=6}l.addGroup(g,S,0),g+=S}function y(x){let w=p,S=new Q,_=new P,A=0,E=x===!0?e:t,M=x===!0?1:-1;for(let T=1;T<=r;T++)u.push(0,m*M,0),h.push(0,M,0),d.push(.5,.5),p++;let C=p;for(let T=0;T<=r;T++){let D=T/r*o+n,I=Math.cos(D),O=Math.sin(D);_.x=E*O,_.y=m*M,_.z=E*I,u.push(_.x,_.y,_.z),h.push(0,M,0),S.x=I*.5+.5,S.y=O*.5*M+.5,d.push(S.x,S.y),p++}for(let T=0;T<r;T++){let D=w+T,I=C+T;x===!0?c.push(I,I+1,D):c.push(I+1,I,D),A+=3}l.addGroup(g,A,x===!0?1:2),g+=A}}static fromJSON(e){return new fE(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},mE=class extends fE{constructor(e=1,t=1,i=32,r=1,a=!1,s=0,n=Math.PI*2){super(0,e,t,i,r,a,s,n),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:n}}static fromJSON(e){return new mE(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},gE=class extends Qe{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};let a=[],s=[];n(r),l(i),c(),this.setAttribute("position",new Re(a,3)),this.setAttribute("normal",new Re(a.slice(),3)),this.setAttribute("uv",new Re(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function n(v){let y=new P,x=new P,w=new P;for(let S=0;S<t.length;S+=3)d(t[S+0],y),d(t[S+1],x),d(t[S+2],w),o(y,x,w,v)}function o(v,y,x,w){let S=w+1,_=[];for(let A=0;A<=S;A++){_[A]=[];let E=v.clone().lerp(x,A/S),M=y.clone().lerp(x,A/S),C=S-A;for(let T=0;T<=C;T++)T===0&&A===S?_[A][T]=E:_[A][T]=E.clone().lerp(M,T/C)}for(let A=0;A<S;A++)for(let E=0;E<2*(S-A)-1;E++){let M=Math.floor(E/2);E%2===0?(h(_[A][M+1]),h(_[A+1][M]),h(_[A][M])):(h(_[A][M+1]),h(_[A+1][M+1]),h(_[A+1][M]))}}function l(v){let y=new P;for(let x=0;x<a.length;x+=3)y.x=a[x+0],y.y=a[x+1],y.z=a[x+2],y.normalize().multiplyScalar(v),a[x+0]=y.x,a[x+1]=y.y,a[x+2]=y.z}function c(){let v=new P;for(let y=0;y<a.length;y+=3){v.x=a[y+0],v.y=a[y+1],v.z=a[y+2];let x=m(v)/2/Math.PI+.5,w=g(v)/Math.PI+.5;s.push(x,1-w)}p(),u()}function u(){for(let v=0;v<s.length;v+=6){let y=s[v+0],x=s[v+2],w=s[v+4],S=Math.max(y,x,w),_=Math.min(y,x,w);S>.9&&_<.1&&(y<.2&&(s[v+0]+=1),x<.2&&(s[v+2]+=1),w<.2&&(s[v+4]+=1))}}function h(v){a.push(v.x,v.y,v.z)}function d(v,y){let x=v*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function p(){let v=new P,y=new P,x=new P,w=new P,S=new Q,_=new Q,A=new Q;for(let E=0,M=0;E<a.length;E+=9,M+=6){v.set(a[E+0],a[E+1],a[E+2]),y.set(a[E+3],a[E+4],a[E+5]),x.set(a[E+6],a[E+7],a[E+8]),S.set(s[M+0],s[M+1]),_.set(s[M+2],s[M+3]),A.set(s[M+4],s[M+5]),w.copy(v).add(y).add(x).divideScalar(3);let C=m(w);f(S,M+0,v,C),f(_,M+2,y,C),f(A,M+4,x,C)}}function f(v,y,x,w){w<0&&v.x===1&&(s[y]=v.x-1),x.x===0&&x.z===0&&(s[y]=w/2/Math.PI+.5)}function m(v){return Math.atan2(v.z,-v.x)}function g(v){return Math.atan2(-v.y,Math.sqrt(v.x*v.x+v.z*v.z))}}static fromJSON(e){return new gE(e.vertices,e.indices,e.radius,e.details)}},i5=class extends gE{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=1/i,a=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(a,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new i5(e.radius,e.detail)}},ey=class extends J0{constructor(e){super(e),this.uuid=Cs(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let r=e.holes[t];this.holes.push(new J0().fromJSON(r))}return this}},FW={triangulate:function(e,t,i=2){let r=t&&t.length,a=r?t[0]*i:e.length,s=r5(e,0,a,i,!0),n=[];if(!s||s.next===s.prev)return n;let o,l,c,u,h,d,p;if(r&&(s=WW(e,t,s,i)),e.length>80*i){o=c=e[0],l=u=e[1];for(let f=i;f<a;f+=i)h=e[f],d=e[f+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);p=Math.max(c-o,u-l),p=p!==0?32767/p:0}return nm(s,n,i,o,l,p,0),n}};function r5(e,t,i,r,a){let s,n;if(a===iq(e,t,i,r)>0)for(s=t;s<i;s+=r)n=jT(s,e[s],e[s+1],n);else for(s=i-r;s>=t;s-=r)n=jT(s,e[s],e[s+1],n);return n&&S1(n,n.next)&&(lm(n),n=n.next),n}function mh(e,t){if(!e)return e;t||(t=e);let i=e,r;do if(r=!1,!i.steiner&&(S1(i,i.next)||wi(i.prev,i,i.next)===0)){if(lm(i),i=t=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==t);return t}function nm(e,t,i,r,a,s,n){if(!e)return;!n&&s&&ZW(e,r,a,s);let o=e,l,c;for(;e.prev!==e.next;){if(l=e.prev,c=e.next,s?VW(e,r,a,s):UW(e)){t.push(l.i/i|0),t.push(e.i/i|0),t.push(c.i/i|0),lm(e),e=c.next,o=c.next;continue}if(e=c,e===o){n?n===1?(e=GW(mh(e),t,i),nm(e,t,i,r,a,s,2)):n===2&&HW(e,t,i,r,a,s):nm(mh(e),t,i,r,a,s,1);break}}}function UW(e){let t=e.prev,i=e,r=e.next;if(wi(t,i,r)>=0)return!1;let a=t.x,s=i.x,n=r.x,o=t.y,l=i.y,c=r.y,u=a<s?a<n?a:n:s<n?s:n,h=o<l?o<c?o:c:l<c?l:c,d=a>s?a>n?a:n:s>n?s:n,p=o>l?o>c?o:c:l>c?l:c,f=r.next;for(;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Vu(a,o,s,l,n,c,f.x,f.y)&&wi(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function VW(e,t,i,r){let a=e.prev,s=e,n=e.next;if(wi(a,s,n)>=0)return!1;let o=a.x,l=s.x,c=n.x,u=a.y,h=s.y,d=n.y,p=o<l?o<c?o:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=o>l?o>c?o:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,v=K_(p,f,t,i,r),y=K_(m,g,t,i,r),x=e.prevZ,w=e.nextZ;for(;x&&x.z>=v&&w&&w.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==a&&x!==n&&Vu(o,u,l,h,c,d,x.x,x.y)&&wi(x.prev,x,x.next)>=0||(x=x.prevZ,w.x>=p&&w.x<=m&&w.y>=f&&w.y<=g&&w!==a&&w!==n&&Vu(o,u,l,h,c,d,w.x,w.y)&&wi(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==a&&x!==n&&Vu(o,u,l,h,c,d,x.x,x.y)&&wi(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;w&&w.z<=y;){if(w.x>=p&&w.x<=m&&w.y>=f&&w.y<=g&&w!==a&&w!==n&&Vu(o,u,l,h,c,d,w.x,w.y)&&wi(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function GW(e,t,i){let r=e;do{let a=r.prev,s=r.next.next;!S1(a,s)&&a5(a,r,r.next,s)&&om(a,s)&&om(s,a)&&(t.push(a.i/i|0),t.push(r.i/i|0),t.push(s.i/i|0),lm(r),lm(r.next),r=e=s),r=r.next}while(r!==e);return mh(r)}function HW(e,t,i,r,a,s){let n=e;do{let o=n.next.next;for(;o!==n.prev;){if(n.i!==o.i&&JW(n,o)){let l=s5(n,o);n=mh(n,n.next),l=mh(l,l.next),nm(n,t,i,r,a,s,0),nm(l,t,i,r,a,s,0);return}o=o.next}n=n.next}while(n!==e)}function WW(e,t,i,r){let a=[],s,n,o,l,c;for(s=0,n=t.length;s<n;s++)o=t[s]*r,l=s<n-1?t[s+1]*r:e.length,c=r5(e,o,l,r,!1),c===c.next&&(c.steiner=!0),a.push($W(c));for(a.sort(qW),s=0;s<a.length;s++)i=XW(a[s],i);return i}function qW(e,t){return e.x-t.x}function XW(e,t){let i=YW(e,t);if(!i)return t;let r=s5(i,e);return mh(r,r.next),mh(i,i.next)}function YW(e,t){let i=t,r=-1/0,a,s=e.x,n=e.y;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){let d=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,a=i.x<i.next.x?i:i.next,d===s))return a}i=i.next}while(i!==t);if(!a)return null;let o=a,l=a.x,c=a.y,u=1/0,h;i=a;do s>=i.x&&i.x>=l&&s!==i.x&&Vu(n<c?s:r,n,l,c,n<c?r:s,n,i.x,i.y)&&(h=Math.abs(n-i.y)/(s-i.x),om(i,e)&&(h<u||h===u&&(i.x>a.x||i.x===a.x&&QW(a,i)))&&(a=i,u=h)),i=i.next;while(i!==o);return a}function QW(e,t){return wi(e.prev,e,t.prev)<0&&wi(t.next,e,e.next)<0}function ZW(e,t,i,r){let a=e;do a.z===0&&(a.z=K_(a.x,a.y,t,i,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next;while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,KW(a)}function KW(e){let t,i,r,a,s,n,o,l,c=1;do{for(i=e,e=null,s=null,n=0;i;){for(n++,r=i,o=0,t=0;t<c&&(o++,r=r.nextZ,!!r);t++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(a=i,i=i.nextZ,o--):(a=r,r=r.nextZ,l--),s?s.nextZ=a:e=a,a.prevZ=s,s=a;i=r}s.nextZ=null,c*=2}while(n>1);return e}function K_(e,t,i,r,a){return e=(e-i)*a|0,t=(t-r)*a|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function $W(e){let t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Vu(e,t,i,r,a,s,n,o){return(a-n)*(t-o)>=(e-n)*(s-o)&&(e-n)*(r-o)>=(i-n)*(t-o)&&(i-n)*(s-o)>=(a-n)*(r-o)}function JW(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!eq(e,t)&&(om(e,t)&&om(t,e)&&tq(e,t)&&(wi(e.prev,e,t.prev)||wi(e,t.prev,t))||S1(e,t)&&wi(e.prev,e,e.next)>0&&wi(t.prev,t,t.next)>0)}function wi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function S1(e,t){return e.x===t.x&&e.y===t.y}function a5(e,t,i,r){let a=Gg(wi(e,t,i)),s=Gg(wi(e,t,r)),n=Gg(wi(i,r,e)),o=Gg(wi(i,r,t));return!!(a!==s&&n!==o||a===0&&Vg(e,i,t)||s===0&&Vg(e,r,t)||n===0&&Vg(i,e,r)||o===0&&Vg(i,t,r))}function Vg(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Gg(e){return e>0?1:e<0?-1:0}function eq(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&a5(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function om(e,t){return wi(e.prev,e,e.next)<0?wi(e,t,e.next)>=0&&wi(e,e.prev,t)>=0:wi(e,t,e.prev)<0||wi(e,e.next,t)<0}function tq(e,t){let i=e,r=!1,a=(e.x+t.x)/2,s=(e.y+t.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&a<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==e);return r}function s5(e,t){let i=new $_(e.i,e.x,e.y),r=new $_(t.i,t.x,t.y),a=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=a,a.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function jT(e,t,i,r){let a=new $_(e,t,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function lm(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function $_(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function iq(e,t,i,r){let a=0;for(let s=t,n=i-r;s<i;s+=r)a+=(e[n]-e[s])*(e[s+1]+e[n+1]),n=s;return a}var n5=class{static area(e){let t=e.length,i=0;for(let r=t-1,a=0;a<t;r=a++)i+=e[r].x*e[a].y-e[a].x*e[r].y;return i*.5}static isClockWise(e){return n5.area(e)<0}static triangulateShape(e,t){let i=[],r=[],a=[];FT(e),UT(i,e);let s=e.length;t.forEach(FT);for(let o=0;o<t.length;o++)r.push(s),s+=t[o].length,UT(i,t[o]);let n=FW.triangulate(i,r);for(let o=0;o<n.length;o+=3)a.push(n.slice(o,o+3));return a}};function FT(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function UT(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var o5=class extends gE{constructor(e=1,t=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,a,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new o5(e.radius,e.detail)}},ed=class extends Qe{constructor(e=1,t=32,i=16,r=0,a=Math.PI*2,s=0,n=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:a,thetaStart:s,thetaLength:n},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(s+n,Math.PI),l=0,c=[],u=new P,h=new P,d=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let v=[],y=g/i,x=0;g==0&&s==0?x=.5/t:g==i&&o==Math.PI&&(x=-.5/t);for(let w=0;w<=t;w++){let S=w/t;u.x=-e*Math.cos(r+S*a)*Math.sin(s+y*n),u.y=e*Math.cos(s+y*n),u.z=e*Math.sin(r+S*a)*Math.sin(s+y*n),p.push(u.x,u.y,u.z),h.copy(u).normalize(),f.push(h.x,h.y,h.z),m.push(S+x,1-y),v.push(l++)}c.push(v)}for(let g=0;g<i;g++)for(let v=0;v<t;v++){let y=c[g][v+1],x=c[g][v],w=c[g+1][v],S=c[g+1][v+1];(g!==0||s>0)&&d.push(y,x,S),(g!==i-1||o<Math.PI)&&d.push(x,w,S)}this.setIndex(d),this.setAttribute("position",new Re(p,3)),this.setAttribute("normal",new Re(f,3)),this.setAttribute("uv",new Re(m,2))}static fromJSON(e){return new ed(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},l5=class extends Qe{constructor(e=1,t=.4,i=12,r=48,a=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:a},i=Math.floor(i),r=Math.floor(r);let s=[],n=[],o=[],l=[],c=new P,u=new P,h=new P;for(let d=0;d<=i;d++)for(let p=0;p<=r;p++){let f=p/r*a,m=d/i*Math.PI*2;u.x=(e+t*Math.cos(m))*Math.cos(f),u.y=(e+t*Math.cos(m))*Math.sin(f),u.z=t*Math.sin(m),n.push(u.x,u.y,u.z),c.x=e*Math.cos(f),c.y=e*Math.sin(f),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(p/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let p=1;p<=r;p++){let f=(r+1)*d+p-1,m=(r+1)*(d-1)+p-1,g=(r+1)*(d-1)+p,v=(r+1)*d+p;s.push(f,m,v),s.push(m,g,v)}this.setIndex(s),this.setAttribute("position",new Re(n,3)),this.setAttribute("normal",new Re(o,3)),this.setAttribute("uv",new Re(l,2))}static fromJSON(e){return new l5(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},c5=class extends Qe{constructor(e=1,t=.4,i=64,r=8,a=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:a,q:s},i=Math.floor(i),r=Math.floor(r);let n=[],o=[],l=[],c=[],u=new P,h=new P,d=new P,p=new P,f=new P,m=new P,g=new P;for(let y=0;y<=i;++y){let x=y/i*a*Math.PI*2;v(x,a,s,e,d),v(x+.01,a,s,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let w=0;w<=r;++w){let S=w/r*Math.PI*2,_=-t*Math.cos(S),A=t*Math.sin(S);u.x=d.x+(_*g.x+A*f.x),u.y=d.y+(_*g.y+A*f.y),u.z=d.z+(_*g.z+A*f.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(y/i),c.push(w/r)}}for(let y=1;y<=i;y++)for(let x=1;x<=r;x++){let w=(r+1)*(y-1)+(x-1),S=(r+1)*y+(x-1),_=(r+1)*y+x,A=(r+1)*(y-1)+x;n.push(w,S,A),n.push(S,_,A)}this.setIndex(n),this.setAttribute("position",new Re(o,3)),this.setAttribute("normal",new Re(l,3)),this.setAttribute("uv",new Re(c,2));function v(y,x,w,S,_){let A=Math.cos(y),E=Math.sin(y),M=w/x*y,C=Math.cos(M);_.x=S*(2+C)*.5*A,_.y=S*(2+C)*E*.5,_.z=S*Math.sin(M)*.5}}static fromJSON(e){return new c5(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function ul(e,t,i){return h5(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)}function Hg(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)}function h5(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function rq(e){function t(a,s){return e[a]-e[s]}let i=e.length,r=new Array(i);for(let a=0;a!==i;++a)r[a]=a;return r.sort(t),r}function VT(e,t,i){let r=e.length,a=new e.constructor(r);for(let s=0,n=0;n!==r;++s){let o=i[s]*t;for(let l=0;l!==t;++l)a[n++]=e[o+l]}return a}function u5(e,t,i,r){let a=1,s=e[0];for(;s!==void 0&&s[r]===void 0;)s=e[a++];if(s===void 0)return;let n=s[r];if(n!==void 0)if(Array.isArray(n))do n=s[r],n!==void 0&&(t.push(s.time),i.push.apply(i,n)),s=e[a++];while(s!==void 0);else if(n.toArray!==void 0)do n=s[r],n!==void 0&&(t.push(s.time),n.toArray(i,i.length)),s=e[a++];while(s!==void 0);else do n=s[r],n!==void 0&&(t.push(s.time),i.push(n)),s=e[a++];while(s!==void 0)}var A1=class{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,r=t[i],a=t[i-1];e:{t:{let s;i:{r:if(!(e<r)){for(let n=i+2;;){if(r===void 0){if(e<a)break r;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===n)break;if(a=r,r=t[++i],e<r)break t}s=t.length;break i}if(!(e>=a)){let n=t[1];e<n&&(i=2,a=n);for(let o=i-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=a,a=t[--i-1],e>=a)break t}s=i,i=0;break i}break e}for(;i<s;){let n=i+s>>>1;e<t[n]?s=n:i=n+1}if(r=t[i],a=t[i-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,a,r)}return this.interpolate_(i,a,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,a=e*r;for(let s=0;s!==r;++s)t[s]=i[a+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},aq=class extends A1{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ju,endingEnd:ju}}intervalChanged_(e,t,i){let r=this.parameterPositions,a=e-2,s=e+1,n=r[a],o=r[s];if(n===void 0)switch(this.getSettings_().endingStart){case Fu:a=e,n=2*t-i;break;case Q0:a=r.length-2,n=t+r[a]-r[a+1];break;default:a=e,n=i}if(o===void 0)switch(this.getSettings_().endingEnd){case Fu:s=e,o=2*i-t;break;case Q0:s=1,o=i+r[1]-r[0];break;default:s=e-1,o=t}let l=(i-t)*.5,c=this.valueSize;this._weightPrev=l/(t-n),this._weightNext=l/(o-i),this._offsetPrev=a*c,this._offsetNext=s*c}interpolate_(e,t,i,r){let a=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=e*n,l=o-n,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(i-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let w=0;w!==n;++w)a[w]=g*s[c+w]+v*s[l+w]+y*s[o+w]+x*s[u+w];return a}},d5=class extends A1{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let a=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=e*n,l=o-n,c=(i-t)/(r-t),u=1-c;for(let h=0;h!==n;++h)a[h]=s[l+h]*u+s[o+h]*c;return a}},sq=class extends A1{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}},io=class{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Hg(t,this.TimeBufferType),this.values=Hg(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Hg(e.times,Array),values:Hg(e.values,Array)};let r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new sq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new d5(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new aq(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case X0:t=this.InterpolantFactoryMethodDiscrete;break;case Y0:t=this.InterpolantFactoryMethodLinear;break;case Gx:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return X0;case this.InterpolantFactoryMethodLinear:return Y0;case this.InterpolantFactoryMethodSmooth:return Gx}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){let i=this.times,r=i.length,a=0,s=r-1;for(;a!==r&&i[a]<e;)++a;for(;s!==-1&&i[s]>t;)--s;if(++s,a!==0||s!==r){a>=s&&(s=Math.max(s,1),a=s-1);let n=this.getValueSize();this.times=ul(i,a,s),this.values=ul(this.values,a*n,s*n)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,r=this.values,a=i.length;a===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let n=0;n!==a;n++){let o=i[n];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,n,o),e=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,n,o,s),e=!1;break}s=o}if(r!==void 0&&h5(r))for(let n=0,o=r.length;n!==o;++n){let l=r[n];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,n,l),e=!1;break}}return e}optimize(){let e=ul(this.times),t=ul(this.values),i=this.getValueSize(),r=this.getInterpolation()===Gx,a=e.length-1,s=1;for(let n=1;n<a;++n){let o=!1,l=e[n],c=e[n+1];if(l!==c&&(n!==1||l!==e[0]))if(r)o=!0;else{let u=n*i,h=u-i,d=u+i;for(let p=0;p!==i;++p){let f=t[u+p];if(f!==t[h+p]||f!==t[d+p]){o=!0;break}}}if(o){if(n!==s){e[s]=e[n];let u=n*i,h=s*i;for(let d=0;d!==i;++d)t[h+d]=t[u+d]}++s}}if(a>0){e[s]=e[a];for(let n=a*i,o=s*i,l=0;l!==i;++l)t[o+l]=t[n+l];++s}return s!==e.length?(this.times=ul(e,0,s),this.values=ul(t,0,s*i)):(this.times=e,this.values=t),this}clone(){let e=ul(this.times,0),t=ul(this.values,0),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}};io.prototype.TimeBufferType=Float32Array;io.prototype.ValueBufferType=Float32Array;io.prototype.DefaultInterpolation=Y0;var $d=class extends io{};$d.prototype.ValueTypeName="bool";$d.prototype.ValueBufferType=Array;$d.prototype.DefaultInterpolation=X0;$d.prototype.InterpolantFactoryMethodLinear=void 0;$d.prototype.InterpolantFactoryMethodSmooth=void 0;var p5=class extends io{};p5.prototype.ValueTypeName="color";var ty=class extends io{};ty.prototype.ValueTypeName="number";var nq=class extends A1{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){let a=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=(i-t)/(r-t),l=e*n;for(let c=l+n;l!==c;l+=4)ut.slerpFlat(a,0,s,l-n,s,l,o);return a}},Fm=class extends io{InterpolantFactoryMethodLinear(e){return new nq(this.times,this.values,this.getValueSize(),e)}};Fm.prototype.ValueTypeName="quaternion";Fm.prototype.DefaultInterpolation=Y0;Fm.prototype.InterpolantFactoryMethodSmooth=void 0;var Jd=class extends io{};Jd.prototype.ValueTypeName="string";Jd.prototype.ValueBufferType=Array;Jd.prototype.DefaultInterpolation=X0;Jd.prototype.InterpolantFactoryMethodLinear=void 0;Jd.prototype.InterpolantFactoryMethodSmooth=void 0;var iy=class extends io{};iy.prototype.ValueTypeName="vector";var J_=class{constructor(e,t=-1,i,r=aE){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Cs(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,r=1/(e.fps||1);for(let s=0,n=i.length;s!==n;++s)t.push(lq(i[s]).scale(r));let a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){let t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,s=i.length;a!==s;++a)t.push(io.toJSON(i[a]));return r}static CreateFromMorphTargetSequence(e,t,i,r){let a=t.length,s=[];for(let n=0;n<a;n++){let o=[],l=[];o.push((n+a-1)%a,n,(n+1)%a),l.push(0,1,0);let c=rq(o);o=VT(o,1,c),l=VT(l,1,c),!r&&o[0]===0&&(o.push(a),l.push(l[0])),s.push(new ty(".morphTargetInfluences["+t[n].name+"]",o,l).scale(1/i))}return new this(e,-1,s)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let r={},a=/^([\w-]*?)([\d]+)$/;for(let n=0,o=e.length;n<o;n++){let l=e[n],c=l.name.match(a);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let n in r)s.push(this.CreateFromMorphTargetSequence(n,r[n],t,i));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,p){if(h.length!==0){let f=[],m=[];u5(h,f,m,d),f.length!==0&&p.push(new c(u,f,m))}},r=[],a=e.name||"default",s=e.fps||30,n=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let p=0;p<u[d].morphTargets.length;p++)h[u[d].morphTargets[p]]=-1;for(let p in h){let f=[],m=[];for(let g=0;g!==u[d].morphTargets.length;++g){let v=u[d];f.push(v.time),m.push(v.morphTarget===p?1:0)}r.push(new ty(".morphTargetInfluence["+p+"]",f,m))}o=h.length*s}else{let h=".bones["+t[c].name+"]";i(iy,h+".position",u,"pos",r),i(Fm,h+".quaternion",u,"rot",r),i(iy,h+".scale",u,"scl",r)}}return r.length===0?null:new this(a,o,r,n)}resetDuration(){let e=this.tracks,t=0;for(let i=0,r=e.length;i!==r;++i){let a=this.tracks[i];t=Math.max(t,a.times[a.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function oq(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ty;case"vector":case"vector2":case"vector3":case"vector4":return iy;case"color":return p5;case"quaternion":return Fm;case"bool":case"boolean":return $d;case"string":return Jd}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function lq(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=oq(e.type);if(e.times===void 0){let i=[],r=[];u5(e.keys,i,r,"value"),e.times=i,e.values=r}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var ry={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},f5=class{constructor(e,t,i){let r=this,a=!1,s=0,n=0,o,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){n++,a===!1&&r.onStart!==void 0&&r.onStart(c,s,n),a=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,n),s===n&&(a=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],p=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}},cq=new f5,Um=class{constructor(e){this.manager=e!==void 0?e:cq,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise(function(r,a){i.load(e,r,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},mo={},hq=class extends Error{constructor(e,t){super(e),this.response=t}},e2=class extends Um{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let a=ry.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(mo[e]!==void 0){mo[e].push({onLoad:t,onProgress:i,onError:r});return}mo[e]=[],mo[e].push({onLoad:t,onProgress:i,onError:r});let s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),n=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=mo[e],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,p=d!==0,f=0,m=new ReadableStream({start(g){v();function v(){u.read().then(({done:y,value:x})=>{if(y)g.close();else{f+=x.byteLength;let w=new ProgressEvent("progress",{lengthComputable:p,loaded:f,total:d});for(let S=0,_=c.length;S<_;S++){let A=c[S];A.onProgress&&A.onProgress(w)}g.enqueue(x),v()}})}}});return new Response(m)}else throw new hq(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,n));case"json":return l.json();default:if(n===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(n),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{ry.add(e,l);let c=mo[e];delete mo[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=mo[e];if(c===void 0)throw this.manager.itemError(e),l;delete mo[e];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},uq=class extends Um{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let a=this,s=ry.get(e);if(s!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(s),a.manager.itemEnd(e)},0),s;let n=am("img");function o(){c(),ry.add(e,this),t&&t(this),a.manager.itemEnd(e)}function l(u){c(),r&&r(u),a.manager.itemError(e),a.manager.itemEnd(e)}function c(){n.removeEventListener("load",o,!1),n.removeEventListener("error",l,!1)}return n.addEventListener("load",o,!1),n.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(n.crossOrigin=this.crossOrigin),a.manager.itemStart(e),n.src=e,n}},dq=class extends Um{constructor(e){super(e)}load(e,t,i,r){let a=new Si,s=new uq(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(n){a.image=n,a.needsUpdate=!0,t!==void 0&&t(a)},i,r),a}},Vm=class extends Yt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new tt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}},pq=class extends Vm{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new tt(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},xb=new Se,GT=new P,HT=new P,vE=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Q(512,512),this.map=null,this.mapPass=null,this.matrix=new Se,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new lE,this._frameExtents=new Q(1,1),this._viewportCount=1,this._viewports=[new dt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;GT.setFromMatrixPosition(e.matrixWorld),t.position.copy(GT),HT.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(HT),t.updateMatrixWorld(),xb.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xb),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(xb)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},fq=class extends vE{constructor(){super(new Jr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=rm*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;(i!==t.fov||r!==t.aspect||a!==t.far)&&(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},mq=class extends Vm{constructor(e,t,i=0,r=Math.PI/3,a=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.target=new Yt,this.distance=i,this.angle=r,this.penumbra=a,this.decay=s,this.map=null,this.shadow=new fq}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},WT=new Se,Pp=new P,bb=new P,gq=class extends vE{constructor(){super(new Jr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Q(4,2),this._viewportCount=6,this._viewports=[new dt(2,1,1,1),new dt(0,1,1,1),new dt(3,1,1,1),new dt(1,1,1,1),new dt(3,0,1,1),new dt(1,0,1,1)],this._cubeDirections=[new P(1,0,0),new P(-1,0,0),new P(0,0,1),new P(0,0,-1),new P(0,1,0),new P(0,-1,0)],this._cubeUps=[new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,0,1),new P(0,0,-1)]}updateMatrices(e,t=0){let i=this.camera,r=this.matrix,a=e.distance||i.far;a!==i.far&&(i.far=a,i.updateProjectionMatrix()),Pp.setFromMatrixPosition(e.matrixWorld),i.position.copy(Pp),bb.copy(i.position),bb.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(bb),i.updateMatrixWorld(),r.makeTranslation(-Pp.x,-Pp.y,-Pp.z),WT.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(WT)}},vq=class extends Vm{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new gq}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},yq=class extends vE{constructor(){super(new cE(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},xq=class extends Vm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.target=new Yt,this.shadow=new yq}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},m5=class extends Qe{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},g5=class extends Um{constructor(e){super(e)}load(e,t,i,r){let a=this,s=new e2(a.manager);s.setPath(a.path),s.setRequestHeader(a.requestHeader),s.setWithCredentials(a.withCredentials),s.load(e,function(n){try{t(a.parse(JSON.parse(n)))}catch(o){r?r(o):console.error(o),a.manager.itemError(e)}},i,r)}parse(e){let t={},i={};function r(h,d){if(t[d]!==void 0)return t[d];let p=h.interleavedBuffers[d],f=a(h,p.buffer),m=bg(p.type,f),g=new SW(m,p.stride);return g.uuid=p.uuid,t[d]=g,g}function a(h,d){if(i[d]!==void 0)return i[d];let p=h.arrayBuffers[d],f=new Uint32Array(p).buffer;return i[d]=f,f}let s=e.isInstancedBufferGeometry?new m5:new Qe,n=e.data.index;if(n!==void 0){let h=bg(n.type,n.array);s.setIndex(new ht(h,1))}let o=e.data.attributes;for(let h in o){let d=o[h],p;if(d.isInterleavedBufferAttribute){let f=r(e.data,d.data);p=new Z_(f,d.itemSize,d.offset,d.normalized)}else{let f=bg(d.type,d.array),m=d.isInstancedBufferAttribute?sm:ht;p=new m(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),d.updateRange!==void 0&&(p.updateRange.offset=d.updateRange.offset,p.updateRange.count=d.updateRange.count),s.setAttribute(h,p)}let l=e.data.morphAttributes;if(l)for(let h in l){let d=l[h],p=[];for(let f=0,m=d.length;f<m;f++){let g=d[f],v;if(g.isInterleavedBufferAttribute){let y=r(e.data,g.data);v=new Z_(y,g.itemSize,g.offset,g.normalized)}else{let y=bg(g.type,g.array);v=new ht(y,g.itemSize,g.normalized)}g.name!==void 0&&(v.name=g.name),p.push(v)}s.morphAttributes[h]=p}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let p=c[h];s.addGroup(p.start,p.count,p.materialIndex)}let u=e.data.boundingSphere;if(u!==void 0){let h=new P;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new Fa(h,u.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}},bq=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=qT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=qT();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function qT(){return(typeof performance>"u"?Date:performance).now()}var wq=class{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,a,s;switch(t){case"quaternion":r=this._slerp,a=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,a=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,r=this.valueSize,a=e*r+r,s=this.cumulativeWeight;if(s===0){for(let n=0;n!==r;++n)i[a+n]=i[n];s=t}else{s+=t;let n=t/s;this._mixBufferRegion(i,a,0,n,r)}this.cumulativeWeight=s}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,r=e*t+t,a=this.cumulativeWeight,s=this.cumulativeWeightAdditive,n=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){let o=t*this._origIndex;this._mixBufferRegion(i,r,o,1-a,t)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){n.setValue(i,r);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let a=i,s=r;a!==s;++a)t[a]=t[r+a%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,a){if(r>=.5)for(let s=0;s!==a;++s)e[t+s]=e[i+s]}_slerp(e,t,i,r){ut.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,a){let s=this._workIndex*a;ut.multiplyQuaternionsFlat(e,s,e,t,e,i),ut.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,i,r,a){let s=1-r;for(let n=0;n!==a;++n){let o=t+n;e[o]=e[o]*s+e[i+n]*r}}_lerpAdditive(e,t,i,r,a){for(let s=0;s!==a;++s){let n=t+s;e[n]=e[n]+e[i+s]*r}}},yE="\\[\\]\\.:\\/",_q=new RegExp("["+yE+"]","g"),xE="[^"+yE+"]",Sq="[^"+yE.replace("\\.","")+"]",Aq=/((?:WC+[\/:])*)/.source.replace("WC",xE),Eq=/(WCOD+)?/.source.replace("WCOD",Sq),Cq=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",xE),Mq=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",xE),Tq=new RegExp("^"+Aq+Eq+Cq+Mq+"$"),Pq=["material","materials","bones","map"],Dq=class{constructor(e,t,i){let r=i||ri.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,a=i.length;r!==a;++r)i[r].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},ri=class{constructor(e,t,i){this.path=t,this.parsedPath=i||ri.parseTrackName(t),this.node=ri.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new ri.Composite(e,t,i):new ri(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_q,"")}static parseTrackName(e){let t=Tq.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let a=i.nodeName.substring(r+1);Pq.indexOf(a)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=a)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){let i=function(a){for(let s=0;s<a.length;s++){let n=a[s];if(n.name===t||n.uuid===t)return n;let o=i(n.children);if(o)return o}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let r=0,a=i.length;r!==a;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,a=t.propertyIndex;if(e||(e=ri.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let s=e[r];if(s===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e);return}let n=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?n=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(n=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(a!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=a}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][n]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};ri.Composite=Dq;ri.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ri.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ri.prototype.GetterByBindingType=[ri.prototype._getValue_direct,ri.prototype._getValue_array,ri.prototype._getValue_arrayElement,ri.prototype._getValue_toArray];ri.prototype.SetterByBindingTypeAndVersioning=[[ri.prototype._setValue_direct,ri.prototype._setValue_direct_setNeedsUpdate,ri.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ri.prototype._setValue_array,ri.prototype._setValue_array_setNeedsUpdate,ri.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ri.prototype._setValue_arrayElement,ri.prototype._setValue_arrayElement_setNeedsUpdate,ri.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ri.prototype._setValue_fromArray,ri.prototype._setValue_fromArray_setNeedsUpdate,ri.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Oq=class{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;let a=t.tracks,s=a.length,n=new Array(s),o={endingStart:ju,endingEnd:ju};for(let l=0;l!==s;++l){let c=a[l].createInterpolant(null);n[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=n,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Lk,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let r=this._clip.duration,a=e._clip.duration,s=a/r,n=r/a;e.warp(1,s,t),this.warp(n,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let r=this._mixer,a=r.time,s=this.timeScale,n=this._timeScaleInterpolant;n===null&&(n=r._lendControlInterpolant(),this._timeScaleInterpolant=n);let o=n.parameterPositions,l=n.sampleValues;return o[0]=a,o[1]=a+i,l[0]=e/s,l[1]=t/s,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}let a=this._startTime;if(a!==null){let o=(e-a)*i;o<0||i===0?t=0:(this._startTime=null,t=i*o)}t*=this._updateTimeScale(e);let s=this._updateTime(t),n=this._updateWeight(e);if(n>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case oV:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(n);break;case aE:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,n)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,r=this.time+e,a=this._loopCount,s=i===rE;if(e===0)return a===-1?r:s&&(a&1)===1?t-r:r;if(i===Rk){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=t||r<0){let n=Math.floor(r/t);r-=t*n,a+=Math.abs(n);let o=this.repetitions-a;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(o===1){let l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&(a&1)===1)return t-r}return r}_setEndings(e,t,i){let r=this._interpolantSettings;i?(r.endingStart=Fu,r.endingEnd=Fu):(e?r.endingStart=this.zeroSlopeAtStart?Fu:ju:r.endingStart=Q0,t?r.endingEnd=this.zeroSlopeAtEnd?Fu:ju:r.endingEnd=Q0)}_scheduleFading(e,t,i){let r=this._mixer,a=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let n=s.parameterPositions,o=s.sampleValues;return n[0]=a,o[0]=t,n[1]=a+e,o[1]=i,this}},Iq=new Float32Array(1),Rq=class extends Hr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,r=e._clip.tracks,a=r.length,s=e._propertyBindings,n=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==a;++u){let h=r[u],d=h.name,p=c[d];if(p!==void 0)++p.referenceCount,s[u]=p;else{if(p=s[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,o,d));continue}let f=t&&t._propertyBindings[u].binding.parsedPath;p=new wq(ri.create(i,d,f),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,o,d),s[u]=p}n[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let i=(e._localRoot||this._root).uuid,r=e._clip.uuid,a=this._actionsByClip[r];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,r,i)}let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let a=t[i];a.useCount++===0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let a=t[i];--a.useCount===0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){let r=this._actions,a=this._actionsByClip,s=a[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=s;else{let n=s.knownActions;e._byClipCacheIndex=n.length,n.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;let a=e._clip.uuid,s=this._actionsByClip,n=s[a],o=n.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null;let u=n.actionByRoot,h=(e._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){let a=t[i];--a.referenceCount===0&&this._removeInactiveBinding(a)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_addInactiveBinding(e,t,i){let r=this._bindingsByRootAndName,a=this._bindings,s=r[t];s===void 0&&(s={},r[t]=s),s[i]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,r=i.rootNode.uuid,a=i.path,s=this._bindingsByRootAndName,n=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete n[a],Object.keys(n).length===0&&delete s[r]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=i,t[i]=a}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new d5(new Float32Array(2),new Float32Array(2),1,Iq),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=i,t[i]=a}clipAction(e,t,i){let r=t||this._root,a=r.uuid,s=typeof e=="string"?J_.findByName(r,e):e,n=s!==null?s.uuid:e,o=this._actionsByClip[n],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=aE),o!==void 0){let u=o.actionByRoot[a];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new Oq(this,s,t,i);return this._bindAction(c,l),this._addInactiveAction(c,n,a),c}existingAction(e,t){let i=t||this._root,r=i.uuid,a=typeof e=="string"?J_.findByName(i,e):e,s=a?a.uuid:e,n=this._actionsByClip[s];return n!==void 0&&n.actionByRoot[r]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,r=this.time+=e,a=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(r,e,a,s);let n=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)n[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,r=this._actionsByClip,a=r[i];if(a!==void 0){let s=a.knownActions;for(let n=0,o=s.length;n!==o;++n){let l=s[n];this._deactivateAction(l);let c=l._cacheIndex,u=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let s in i){let n=i[s].actionByRoot,o=n[t];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,a=r[t];if(a!==void 0)for(let s in a){let n=a[s];n.restoreOriginalState(),this._removeInactiveBinding(n)}}uncacheAction(e,t){let i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},we=class{constructor(e){this.value=e}clone(){return new we(this.value.clone===void 0?this.value:this.value.clone())}},v5=class{constructor(e,t,i=0,r=1/0){this.ray=new Qd(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new nE,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return t2(e,this,i,t),i.sort(XT),i}intersectObjects(e,t=!0,i=[]){for(let r=0,a=e.length;r<a;r++)t2(e[r],this,i,t);return i.sort(XT),i}};function XT(e,t){return e.distance-t.distance}function t2(e,t,i,r){if(e.layers.test(t.layers)&&e.raycast(t,i),r===!0){let a=e.children;for(let s=0,n=a.length;s<n;s++)t2(a[s],t,i,!0)}}var YT=class{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Zi(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},QT=new Q,y5=class{constructor(e=new Q(1/0,1/0),t=new Q(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=QT.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return QT.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},ZT=new P,Wg=new P,Ms=class{constructor(e=new P,t=new P){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){ZT.subVectors(e,this.start),Wg.subVectors(this.end,this.start);let i=Wg.dot(Wg),r=Wg.dot(ZT)/i;return t&&(r=Zi(r,0,1)),r}closestPointToPoint(e,t,i){let r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},KT=new P,Lq=class extends Yt{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Qe,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,n=1,o=32;s<o;s++,n++){let l=s/o*Math.PI*2,c=n/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Re(r,3));let a=new dc({fog:!1,toneMapped:!1});this.cone=new jm(i,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),KT.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(KT),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},kq=class extends tr{constructor(e,t,i){let r=new ed(t,4,2),a=new _h({wireframe:!0,fog:!1,toneMapped:!1});super(r,a),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},$T=new P,qg=new P,JT=new P,zq=class extends Yt{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Qe;r.setAttribute("position",new Re([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let a=new dc({fog:!1,toneMapped:!1});this.lightPlane=new $0(r,a),this.add(this.lightPlane),r=new Qe,r.setAttribute("position",new Re([0,0,0,0,0,1],3)),this.targetLine=new $0(r,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),$T.setFromMatrixPosition(this.light.matrixWorld),qg.setFromMatrixPosition(this.light.target.matrixWorld),JT.subVectors(qg,$T),this.lightPlane.lookAt(qg),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(qg),this.targetLine.scale.z=JT.length()}},Xg=new P,Ci=new Sh,ay=class extends jm{constructor(e){let t=new Qe,i=new dc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],a=[],s={};n("n1","n2"),n("n2","n4"),n("n4","n3"),n("n3","n1"),n("f1","f2"),n("f2","f4"),n("f4","f3"),n("f3","f1"),n("n1","f1"),n("n2","f2"),n("n3","f3"),n("n4","f4"),n("p","n1"),n("p","n2"),n("p","n3"),n("p","n4"),n("u1","u2"),n("u2","u3"),n("u3","u1"),n("c","t"),n("p","c"),n("cn1","cn2"),n("cn3","cn4"),n("cf1","cf2"),n("cf3","cf4");function n(p,f){o(p),o(f)}function o(p){r.push(0,0,0),a.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(r.length/3-1)}t.setAttribute("position",new Re(r,3)),t.setAttribute("color",new Re(a,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new tt(16755200),c=new tt(16711680),u=new tt(43775),h=new tt(16777215),d=new tt(3355443);this.setColors(l,c,u,h,d)}setColors(e,t,i,r,a){let s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,a.r,a.g,a.b),s.setXYZ(41,a.r,a.g,a.b),s.setXYZ(42,a.r,a.g,a.b),s.setXYZ(43,a.r,a.g,a.b),s.setXYZ(44,a.r,a.g,a.b),s.setXYZ(45,a.r,a.g,a.b),s.setXYZ(46,a.r,a.g,a.b),s.setXYZ(47,a.r,a.g,a.b),s.setXYZ(48,a.r,a.g,a.b),s.setXYZ(49,a.r,a.g,a.b),s.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap,i=1,r=1;Ci.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),zi("c",t,e,Ci,0,0,-1),zi("t",t,e,Ci,0,0,1),zi("n1",t,e,Ci,-i,-r,-1),zi("n2",t,e,Ci,i,-r,-1),zi("n3",t,e,Ci,-i,r,-1),zi("n4",t,e,Ci,i,r,-1),zi("f1",t,e,Ci,-i,-r,1),zi("f2",t,e,Ci,i,-r,1),zi("f3",t,e,Ci,-i,r,1),zi("f4",t,e,Ci,i,r,1),zi("u1",t,e,Ci,i*.7,r*1.1,-1),zi("u2",t,e,Ci,-i*.7,r*1.1,-1),zi("u3",t,e,Ci,0,r*2,-1),zi("cf1",t,e,Ci,-i,0,1),zi("cf2",t,e,Ci,i,0,1),zi("cf3",t,e,Ci,0,-r,1),zi("cf4",t,e,Ci,0,r,1),zi("cn1",t,e,Ci,-i,0,-1),zi("cn2",t,e,Ci,i,0,-1),zi("cn3",t,e,Ci,0,-r,-1),zi("cn4",t,e,Ci,0,r,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function zi(e,t,i,r,a,s,n){Xg.set(a,s,n).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],Xg.x,Xg.y,Xg.z)}}var sy=class extends jm{constructor(e,t=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],a=new Qe;a.setIndex(new ht(i,1)),a.setAttribute("position",new Re(r,3)),super(a,new dc({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},Nq=class extends jm{constructor(e=1){let t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Qe;r.setAttribute("position",new Re(t,3)),r.setAttribute("color",new Re(i,3));let a=new dc({vertexColors:!0,toneMapped:!1});super(r,a),this.type="AxesHelper"}setColors(e,t,i){let r=new tt,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(i),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},Ro=Bq();function Bq(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),r=new Uint32Array(512),a=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,a[l]=24,a[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,a[l]=-c-1,a[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,a[l]=13,a[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,a[l]=24,a[l|256]=24):(r[l]=31744,r[l|256]=64512,a[l]=13,a[l|256]=13)}let s=new Uint32Array(2048),n=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)n[l]=l<<23;n[31]=1199570944,n[32]=2147483648;for(let l=33;l<63;++l)n[l]=2147483648+(l-32<<23);n[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:r,shiftTable:a,mantissaTable:s,exponentTable:n,offsetTable:o}}function jq(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Zi(e,-65504,65504),Ro.floatView[0]=e;let t=Ro.uint32View[0],i=t>>23&511;return Ro.baseTable[i]+((t&8388607)>>Ro.shiftTable[i])}function Fq(e){let t=e>>10;return Ro.uint32View[0]=Ro.mantissaTable[Ro.offsetTable[t]+(e&1023)]+Ro.exponentTable[t],Ro.floatView[0]}var Uq=Object.freeze({__proto__:null,fromHalfFloat:Fq,toHalfFloat:jq});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Yd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Yd);var Dp=".",bE=Symbol("target"),x5=Symbol("unsubscribe");function i2(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}function Vq(e){return(typeof e=="object"?e===null:typeof e!="function")||e instanceof RegExp}var Bn=Array.isArray;function wE(e){return typeof e=="symbol"}var Gq={after:(e,t)=>Bn(e)?e.slice(t.length):t===""?e:e.slice(t.length+1),concat:(e,t)=>Bn(e)?(e=[...e],t&&e.push(t),e):t&&t.toString!==void 0?(e!==""&&(e+=Dp),wE(t)?e+t.toString():e+t):e,initial:e=>{if(Bn(e))return e.slice(0,-1);if(e==="")return e;let t=e.lastIndexOf(Dp);return t===-1?"":e.slice(0,t)},last:e=>{if(Bn(e))return e[e.length-1]||"";if(e==="")return e;let t=e.lastIndexOf(Dp);return t===-1?e:e.slice(t+1)},walk:(e,t)=>{if(Bn(e))for(let i of e)t(i);else if(e!==""){let i=0,r=e.indexOf(Dp);if(r===-1)t(e);else for(;i<e.length;)r===-1&&(r=e.length),t(e.slice(i,r)),i=r+1,r=e.indexOf(Dp,i)}},get(e,t){return this.walk(t,i=>{e&&(e=e[i])}),e}},gs=Gq;function Hq(e){return typeof e=="object"&&typeof e.next=="function"}function Wq(e,t,i,r,a){let s=e.next;if(t.name==="entries")e.next=function(){let n=s.call(this);return n.done===!1&&(n.value[0]=a(n.value[0],t,n.value[0],r),n.value[1]=a(n.value[1],t,n.value[0],r)),n};else if(t.name==="values"){let n=i[bE].keys();e.next=function(){let o=s.call(this);return o.done===!1&&(o.value=a(o.value,t,n.next().value,r)),o}}else e.next=function(){let n=s.call(this);return n.done===!1&&(n.value=a(n.value,t,n.value,r)),n};return e}function eP(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&wE(i)||t.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var qq=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return i===void 0&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),r=i[t];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(e,t),i[t]=r),r}getProxy(e,t,i,r){if(this.isUnsubscribed)return e;let a=e[r],s=a||e;this._pathCache.set(s,t);let n=this._proxyCache.get(s);return n===void 0&&(n=a===void 0?new Proxy(e,i):e,this._proxyCache.set(s,n)),n}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,gs.get(t,this.getPath(e)))}defineProperty(e,t,i){return Reflect.defineProperty(e,t,i)?(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0):!1}setProperty(e,t,i,r,a){if(!this._equals(a,i)||!(t in e)){let s=this._getOwnPropertyDescriptor(e,t);return s!==void 0&&"set"in s?Reflect.set(e,t,i,r):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(e);r&&(delete r[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let r=this._getOwnPropertyDescriptor(t,i);return e!==void 0&&r!==void 0&&Object.is(e.value,r.value)&&(e.writable||!1)===(r.writable||!1)&&(e.enumerable||!1)===(r.enumerable||!1)&&(e.configurable||!1)===(r.configurable||!1)&&e.get===r.get&&e.set===r.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function r2(e){return toString.call(e)==="[object Object]"}function Yg(){return!0}function qh(e,t){return e.length!==t.length||e.some((i,r)=>t[r]!==i)}var b5=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Xq=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),w5={push:Yg,pop:Yg,shift:Yg,unshift:Yg,copyWithin:qh,reverse:qh,sort:qh,splice:qh,flat:qh,fill:qh},Yq=new Set([...b5,...Xq,...Object.keys(w5)]);function Qg(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var _5=["keys","values","entries"],S5=new Set(["has","toString"]),A5={add:Qg,clear:Qg,delete:Qg,forEach:Qg},Qq=new Set([...S5,...Object.keys(A5),..._5]);function Zg(e,t){if(e.size!==t.size)return!0;let i;for(let[r,a]of e)if(i=t.get(r),i!==a||i===void 0&&!t.has(r))return!0;return!1}var Zq=new Set([...S5,"get"]),E5={set:Zg,clear:Zg,delete:Zg,forEach:Zg},Kq=new Set([...Zq,...Object.keys(E5),..._5]),oc=class{constructor(e,t,i,r){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=t===void 0?e:this._shallowClone(e)}static isHandledMethod(e){return b5.has(e)}_shallowClone(e){let t=e;if(r2(e))t={...e};else if(Bn(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map(i=>this._shallowClone(i)));else if(e instanceof Map){t=new Map;for(let[i,r]of e.entries())t.set(i,this._shallowClone(r))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,r){return e?(Bn(r)?this._onIsChanged=w5[t]:r instanceof Set?this._onIsChanged=A5[t]:r instanceof Map&&(this._onIsChanged=E5[t]),r):i}update(e,t,i){let r=gs.after(e,this._path);if(t!=="length"){let a=this.clone;gs.walk(r,s=>{a&&a[s]&&(this._clonedCache.has(a[s])||(a[s]=this._shallowClone(a[s])),a=a[s])}),this._hasOnValidate&&this._changes.push({path:r,property:t,previous:i}),a&&a[t]&&(a[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;i!==-1;i--)t=this._changes[i],gs.get(e,t.path)[t.property]=t.previous}isChanged(e){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,e)}},tP=class extends oc{static isHandledMethod(e){return Yq.has(e)}},$q=class extends oc{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},iP=class extends oc{static isHandledMethod(e){return Qq.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},rP=class extends oc{static isHandledMethod(e){return Kq.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},Jq=class extends oc{constructor(e,t,i,r){super(void 0,t,i,r),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},eX=class extends oc{constructor(e,t,i,r){super(void 0,t,i,r),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},bu=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return r2(e)||Bn(e)||i2(e)}static isHandledMethod(e,t){return r2(e)?oc.isHandledMethod(t):Bn(e)?tP.isHandledMethod(t):e instanceof Set?iP.isHandledMethod(t):e instanceof Map?rP.isHandledMethod(t):i2(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let r=oc;Bn(e)?r=tP:e instanceof Date?r=$q:e instanceof Set?r=iP:e instanceof Map?r=rP:e instanceof WeakSet?r=Jq:e instanceof WeakMap&&(r=eX),this._stack.push(new r(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:r}=e,a=bu.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(a,r,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){this._previousClone!==void 0&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},tX={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},_E=(e,t,i={})=>{i={...tX,...i};let r=Symbol("ProxyTarget"),{equals:a,isShallow:s,ignoreDetached:n,details:o}=i,l=new qq(a),c=typeof i.onValidate=="function",u=new bu(c),h=(y,x,w,S,_)=>!c||u.isCloning||i.onValidate(gs.concat(l.getPath(y),x),w,S,_)===!0,d=(y,x,w,S)=>{!eP(l,i,x)&&!(n&&l.isDetached(y,e))&&p(l.getPath(y),x,w,S)},p=(y,x,w,S,_)=>{u.isCloning?u.update(y,x,S):t(gs.concat(y,x),w,S,_)},f=y=>y&&(y[r]||y),m=(y,x,w,S)=>Vq(y)||w==="constructor"||s&&!bu.isHandledMethod(x,w)||eP(l,i,w)||l.isGetInvariant(x,w)||n&&l.isDetached(x,e)?y:(S===void 0&&(S=l.getPath(x)),l.getProxy(y,gs.concat(S,w),g,r)),g={get(y,x,w){if(wE(x)){if(x===r||x===bE)return y;if(x===x5&&!l.isUnsubscribed&&l.getPath(y).length===0)return l.unsubscribe(),y}let S=i2(y)?Reflect.get(y,x):Reflect.get(y,x,w);return m(S,y,x)},set(y,x,w,S){w=f(w);let _=y[r]||y,A=_[x];if(a(A,w)&&x in y)return!0;let E=h(y,x,w,A);return E&&l.setProperty(_,x,w,S,A)?(d(y,x,y[x],A),!0):!E},defineProperty(y,x,w){if(!l.isSameDescriptor(w,y,x)){let S=y[x];h(y,x,w.value,S)&&l.defineProperty(y,x,w,S)&&d(y,x,w.value,S)}return!0},deleteProperty(y,x){if(!Reflect.has(y,x))return!0;let w=Reflect.get(y,x),S=h(y,x,void 0,w);return S&&l.deleteProperty(y,x,w)?(d(y,x,void 0,w),!0):!S},apply(y,x,w){let S=x[r]||x;if(l.isUnsubscribed)return Reflect.apply(y,S,w);if((o===!1||o!==!0&&!o.includes(y.name))&&bu.isHandledType(S)){let _=gs.initial(l.getPath(y)),A=bu.isHandledMethod(S,y.name);u.start(S,_,w);let E=Reflect.apply(y,u.preferredThisArg(y,x,S),A?w.map(T=>f(T)):w),M=u.isChanged(S,a),C=u.stop();if(bu.isHandledType(E)&&A&&(x instanceof Map&&y.name==="get"&&(_=gs.concat(_,w[0])),E=l.getProxy(E,_,g)),M){let T={name:y.name,args:w,result:E},D=u.isCloning?gs.initial(_):_,I=u.isCloning?gs.last(_):"";h(gs.get(e,D),I,S,C,T)?p(D,I,S,C,T):u.undo(S)}return(x instanceof Map||x instanceof Set)&&Hq(E)?Wq(E,y,x,_,m):E}return Reflect.apply(y,x,w)}},v=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};_E.target=e=>e&&e[bE]||e;_E.unsubscribe=e=>e[x5]||e;var aP=_E,iX=typeof global=="object"&&global&&global.Object===Object&&global,C5=iX,rX=typeof self=="object"&&self&&self.Object===Object&&self,aX=C5||rX||Function("return this")(),un=aX,sX=un.Symbol,Os=sX,M5=Object.prototype,nX=M5.hasOwnProperty,oX=M5.toString,Op=Os?Os.toStringTag:void 0;function lX(e){var t=nX.call(e,Op),i=e[Op];try{e[Op]=void 0;var r=!0}catch{}var a=oX.call(e);return r&&(t?e[Op]=i:delete e[Op]),a}var cX=lX,hX=Object.prototype,uX=hX.toString;function dX(e){return uX.call(e)}var pX=dX,fX="[object Null]",mX="[object Undefined]",sP=Os?Os.toStringTag:void 0;function gX(e){return e==null?e===void 0?mX:fX:sP&&sP in Object(e)?cX(e):pX(e)}var Eh=gX;function vX(e){return e!=null&&typeof e=="object"}var Zo=vX,yX="[object Symbol]";function xX(e){return typeof e=="symbol"||Zo(e)&&Eh(e)==yX}var E1=xX;function bX(e,t){for(var i=-1,r=e==null?0:e.length,a=Array(r);++i<r;)a[i]=t(e[i],i,e);return a}var T5=bX,wX=Array.isArray,Kn=wX,_X=1/0,nP=Os?Os.prototype:void 0,oP=nP?nP.toString:void 0;function P5(e){if(typeof e=="string")return e;if(Kn(e))return T5(e,P5)+"";if(E1(e))return oP?oP.call(e):"";var t=e+"";return t=="0"&&1/e==-_X?"-0":t}var SX=P5,AX=/\s/;function EX(e){for(var t=e.length;t--&&AX.test(e.charAt(t)););return t}var CX=EX,MX=/^\s+/;function TX(e){return e&&e.slice(0,CX(e)+1).replace(MX,"")}var PX=TX;function DX(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var hn=DX,lP=NaN,OX=/^[-+]0x[0-9a-f]+$/i,IX=/^0b[01]+$/i,RX=/^0o[0-7]+$/i,LX=parseInt;function kX(e){if(typeof e=="number")return e;if(E1(e))return lP;if(hn(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=hn(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=PX(e);var i=IX.test(e);return i||RX.test(e)?LX(e.slice(2),i?2:8):OX.test(e)?lP:+e}var cP=kX;function zX(e){return e}var NX=zX,BX="[object AsyncFunction]",jX="[object Function]",FX="[object GeneratorFunction]",UX="[object Proxy]";function VX(e){if(!hn(e))return!1;var t=Eh(e);return t==jX||t==FX||t==BX||t==UX}var D5=VX,GX=un["__core-js_shared__"],wb=GX,hP=function(){var e=/[^.]+$/.exec(wb&&wb.keys&&wb.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function HX(e){return!!hP&&hP in e}var WX=HX,qX=Function.prototype,XX=qX.toString;function YX(e){if(e!=null){try{return XX.call(e)}catch{}try{return e+""}catch{}}return""}var Ch=YX,QX=/[\\^$.*+?()[\]{}|]/g,ZX=/^\[object .+?Constructor\]$/,KX=Function.prototype,$X=Object.prototype,JX=KX.toString,eY=$X.hasOwnProperty,tY=RegExp("^"+JX.call(eY).replace(QX,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function iY(e){if(!hn(e)||WX(e))return!1;var t=D5(e)?tY:ZX;return t.test(Ch(e))}var rY=iY;function aY(e,t){return e==null?void 0:e[t]}var sY=aY;function nY(e,t){var i=sY(e,t);return rY(i)?i:void 0}var Mh=nY,oY=Mh(un,"WeakMap"),a2=oY,uP=Object.create,lY=function(){function e(){}return function(t){if(!hn(t))return{};if(uP)return uP(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),cY=lY;function hY(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}var uY=hY;function dY(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}var pY=dY,fY=800,mY=16,gY=Date.now;function vY(e){var t=0,i=0;return function(){var r=gY(),a=mY-(r-i);if(i=r,a>0){if(++t>=fY)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var yY=vY;function xY(e){return function(){return e}}var bY=xY,wY=function(){try{var e=Mh(Object,"defineProperty");return e({},"",{}),e}catch{}}(),ny=wY,_Y=ny?function(e,t){return ny(e,"toString",{configurable:!0,enumerable:!1,value:bY(t),writable:!0})}:NX,SY=_Y,AY=yY(SY),EY=AY;function CY(e,t){for(var i=-1,r=e==null?0:e.length;++i<r&&t(e[i],i,e)!==!1;);return e}var MY=CY,TY=9007199254740991,PY=/^(?:0|[1-9]\d*)$/;function DY(e,t){var i=typeof e;return t=t??TY,!!t&&(i=="number"||i!="symbol"&&PY.test(e))&&e>-1&&e%1==0&&e<t}var SE=DY;function OY(e,t,i){t=="__proto__"&&ny?ny(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}var O5=OY;function IY(e,t){return e===t||e!==e&&t!==t}var AE=IY,RY=Object.prototype,LY=RY.hasOwnProperty;function kY(e,t,i){var r=e[t];(!(LY.call(e,t)&&AE(r,i))||i===void 0&&!(t in e))&&O5(e,t,i)}var EE=kY;function zY(e,t,i,r){var a=!i;i||(i={});for(var s=-1,n=t.length;++s<n;){var o=t[s],l=r?r(i[o],e[o],o,i,e):void 0;l===void 0&&(l=e[o]),a?O5(i,o,l):EE(i,o,l)}return i}var Gm=zY,dP=Math.max;function NY(e,t,i){return t=dP(t===void 0?e.length-1:t,0),function(){for(var r=arguments,a=-1,s=dP(r.length-t,0),n=Array(s);++a<s;)n[a]=r[t+a];a=-1;for(var o=Array(t+1);++a<t;)o[a]=r[a];return o[t]=i(n),uY(e,this,o)}}var BY=NY,jY=9007199254740991;function FY(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=jY}var CE=FY;function UY(e){return e!=null&&CE(e.length)&&!D5(e)}var I5=UY,VY=Object.prototype;function GY(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||VY;return e===i}var ME=GY;function HY(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}var WY=HY,qY="[object Arguments]";function XY(e){return Zo(e)&&Eh(e)==qY}var pP=XY,R5=Object.prototype,YY=R5.hasOwnProperty,QY=R5.propertyIsEnumerable,ZY=pP(function(){return arguments}())?pP:function(e){return Zo(e)&&YY.call(e,"callee")&&!QY.call(e,"callee")},TE=ZY;function KY(){return!1}var $Y=KY,L5=typeof Ja=="object"&&Ja&&!Ja.nodeType&&Ja,fP=L5&&typeof es=="object"&&es&&!es.nodeType&&es,JY=fP&&fP.exports===L5,mP=JY?un.Buffer:void 0,eQ=mP?mP.isBuffer:void 0,tQ=eQ||$Y,oy=tQ,iQ="[object Arguments]",rQ="[object Array]",aQ="[object Boolean]",sQ="[object Date]",nQ="[object Error]",oQ="[object Function]",lQ="[object Map]",cQ="[object Number]",hQ="[object Object]",uQ="[object RegExp]",dQ="[object Set]",pQ="[object String]",fQ="[object WeakMap]",mQ="[object ArrayBuffer]",gQ="[object DataView]",vQ="[object Float32Array]",yQ="[object Float64Array]",xQ="[object Int8Array]",bQ="[object Int16Array]",wQ="[object Int32Array]",_Q="[object Uint8Array]",SQ="[object Uint8ClampedArray]",AQ="[object Uint16Array]",EQ="[object Uint32Array]",di={};di[vQ]=di[yQ]=di[xQ]=di[bQ]=di[wQ]=di[_Q]=di[SQ]=di[AQ]=di[EQ]=!0;di[iQ]=di[rQ]=di[mQ]=di[aQ]=di[gQ]=di[sQ]=di[nQ]=di[oQ]=di[lQ]=di[cQ]=di[hQ]=di[uQ]=di[dQ]=di[pQ]=di[fQ]=!1;function CQ(e){return Zo(e)&&CE(e.length)&&!!di[Eh(e)]}var MQ=CQ;function TQ(e){return function(t){return e(t)}}var PE=TQ,k5=typeof Ja=="object"&&Ja&&!Ja.nodeType&&Ja,Pf=k5&&typeof es=="object"&&es&&!es.nodeType&&es,PQ=Pf&&Pf.exports===k5,_b=PQ&&C5.process,DQ=function(){try{var e=Pf&&Pf.require&&Pf.require("util").types;return e||_b&&_b.binding&&_b.binding("util")}catch{}}(),Pd=DQ,gP=Pd&&Pd.isTypedArray,OQ=gP?PE(gP):MQ,z5=OQ,IQ=Object.prototype,RQ=IQ.hasOwnProperty;function LQ(e,t){var i=Kn(e),r=!i&&TE(e),a=!i&&!r&&oy(e),s=!i&&!r&&!a&&z5(e),n=i||r||a||s,o=n?WY(e.length,String):[],l=o.length;for(var c in e)(t||RQ.call(e,c))&&!(n&&(c=="length"||a&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||SE(c,l)))&&o.push(c);return o}var N5=LQ;function kQ(e,t){return function(i){return e(t(i))}}var B5=kQ,zQ=B5(Object.keys,Object),NQ=zQ,BQ=Object.prototype,jQ=BQ.hasOwnProperty;function FQ(e){if(!ME(e))return NQ(e);var t=[];for(var i in Object(e))jQ.call(e,i)&&i!="constructor"&&t.push(i);return t}var UQ=FQ;function VQ(e){return I5(e)?N5(e):UQ(e)}var DE=VQ;function GQ(e){var t=[];if(e!=null)for(var i in Object(e))t.push(i);return t}var HQ=GQ,WQ=Object.prototype,qQ=WQ.hasOwnProperty;function XQ(e){if(!hn(e))return HQ(e);var t=ME(e),i=[];for(var r in e)r=="constructor"&&(t||!qQ.call(e,r))||i.push(r);return i}var YQ=XQ;function QQ(e){return I5(e)?N5(e,!0):YQ(e)}var Uc=QQ,ZQ=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,KQ=/^\w*$/;function $Q(e,t){if(Kn(e))return!1;var i=typeof e;return i=="number"||i=="symbol"||i=="boolean"||e==null||E1(e)?!0:KQ.test(e)||!ZQ.test(e)||t!=null&&e in Object(t)}var JQ=$Q,eZ=Mh(Object,"create"),cm=eZ;function tZ(){this.__data__=cm?cm(null):{},this.size=0}var iZ=tZ;function rZ(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var aZ=rZ,sZ="__lodash_hash_undefined__",nZ=Object.prototype,oZ=nZ.hasOwnProperty;function lZ(e){var t=this.__data__;if(cm){var i=t[e];return i===sZ?void 0:i}return oZ.call(t,e)?t[e]:void 0}var cZ=lZ,hZ=Object.prototype,uZ=hZ.hasOwnProperty;function dZ(e){var t=this.__data__;return cm?t[e]!==void 0:uZ.call(t,e)}var pZ=dZ,fZ="__lodash_hash_undefined__";function mZ(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=cm&&t===void 0?fZ:t,this}var gZ=mZ;function ep(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}ep.prototype.clear=iZ;ep.prototype.delete=aZ;ep.prototype.get=cZ;ep.prototype.has=pZ;ep.prototype.set=gZ;var vP=ep;function vZ(){this.__data__=[],this.size=0}var yZ=vZ;function xZ(e,t){for(var i=e.length;i--;)if(AE(e[i][0],t))return i;return-1}var C1=xZ,bZ=Array.prototype,wZ=bZ.splice;function _Z(e){var t=this.__data__,i=C1(t,e);if(i<0)return!1;var r=t.length-1;return i==r?t.pop():wZ.call(t,i,1),--this.size,!0}var SZ=_Z;function AZ(e){var t=this.__data__,i=C1(t,e);return i<0?void 0:t[i][1]}var EZ=AZ;function CZ(e){return C1(this.__data__,e)>-1}var MZ=CZ;function TZ(e,t){var i=this.__data__,r=C1(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this}var PZ=TZ;function tp(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}tp.prototype.clear=yZ;tp.prototype.delete=SZ;tp.prototype.get=EZ;tp.prototype.has=MZ;tp.prototype.set=PZ;var M1=tp,DZ=Mh(un,"Map"),hm=DZ;function OZ(){this.size=0,this.__data__={hash:new vP,map:new(hm||M1),string:new vP}}var IZ=OZ;function RZ(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var LZ=RZ;function kZ(e,t){var i=e.__data__;return LZ(t)?i[typeof t=="string"?"string":"hash"]:i.map}var T1=kZ;function zZ(e){var t=T1(this,e).delete(e);return this.size-=t?1:0,t}var NZ=zZ;function BZ(e){return T1(this,e).get(e)}var jZ=BZ;function FZ(e){return T1(this,e).has(e)}var UZ=FZ;function VZ(e,t){var i=T1(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this}var GZ=VZ;function ip(e){var t=-1,i=e==null?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}ip.prototype.clear=IZ;ip.prototype.delete=NZ;ip.prototype.get=jZ;ip.prototype.has=UZ;ip.prototype.set=GZ;var P1=ip,HZ="Expected a function";function OE(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(HZ);var i=function(){var r=arguments,a=t?t.apply(this,r):r[0],s=i.cache;if(s.has(a))return s.get(a);var n=e.apply(this,r);return i.cache=s.set(a,n)||s,n};return i.cache=new(OE.Cache||P1),i}OE.Cache=P1;var WZ=OE,qZ=500;function XZ(e){var t=WZ(e,function(r){return i.size===qZ&&i.clear(),r}),i=t.cache;return t}var YZ=XZ,QZ=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ZZ=/\\(\\)?/g,KZ=YZ(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(QZ,function(i,r,a,s){t.push(a?s.replace(ZZ,"$1"):r||i)}),t}),$Z=KZ;function JZ(e){return e==null?"":SX(e)}var eK=JZ;function tK(e,t){return Kn(e)?e:JQ(e,t)?[e]:$Z(eK(e))}var rp=tK,iK=1/0;function rK(e){if(typeof e=="string"||E1(e))return e;var t=e+"";return t=="0"&&1/e==-iK?"-0":t}var D1=rK;function aK(e,t){t=rp(t,e);for(var i=0,r=t.length;e!=null&&i<r;)e=e[D1(t[i++])];return i&&i==r?e:void 0}var j5=aK;function sK(e,t){for(var i=-1,r=t.length,a=e.length;++i<r;)e[a+i]=t[i];return e}var IE=sK,yP=Os?Os.isConcatSpreadable:void 0;function nK(e){return Kn(e)||TE(e)||!!(yP&&e&&e[yP])}var oK=nK;function F5(e,t,i,r,a){var s=-1,n=e.length;for(i||(i=oK),a||(a=[]);++s<n;){var o=e[s];t>0&&i(o)?t>1?F5(o,t-1,i,r,a):IE(a,o):r||(a[a.length]=o)}return a}var lK=F5;function cK(e){var t=e==null?0:e.length;return t?lK(e,1):[]}var hK=cK;function uK(e){return EY(BY(e,void 0,hK),e+"")}var U5=uK,dK=B5(Object.getPrototypeOf,Object),RE=dK,pK="[object Object]",fK=Function.prototype,mK=Object.prototype,V5=fK.toString,gK=mK.hasOwnProperty,vK=V5.call(Object);function yK(e){if(!Zo(e)||Eh(e)!=pK)return!1;var t=RE(e);if(t===null)return!0;var i=gK.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&V5.call(i)==vK}var xK=yK;function bK(e,t,i){var r=-1,a=e.length;t<0&&(t=-t>a?0:a+t),i=i>a?a:i,i<0&&(i+=a),a=t>i?0:i-t>>>0,t>>>=0;for(var s=Array(a);++r<a;)s[r]=e[r+t];return s}var wK=bK;function _K(){this.__data__=new M1,this.size=0}var SK=_K;function AK(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}var EK=AK;function CK(e){return this.__data__.get(e)}var MK=CK;function TK(e){return this.__data__.has(e)}var PK=TK,DK=200;function OK(e,t){var i=this.__data__;if(i instanceof M1){var r=i.__data__;if(!hm||r.length<DK-1)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new P1(r)}return i.set(e,t),this.size=i.size,this}var IK=OK;function ap(e){var t=this.__data__=new M1(e);this.size=t.size}ap.prototype.clear=SK;ap.prototype.delete=EK;ap.prototype.get=MK;ap.prototype.has=PK;ap.prototype.set=IK;var n0=ap;function RK(e,t){return e&&Gm(t,DE(t),e)}var LK=RK;function kK(e,t){return e&&Gm(t,Uc(t),e)}var zK=kK,G5=typeof Ja=="object"&&Ja&&!Ja.nodeType&&Ja,xP=G5&&typeof es=="object"&&es&&!es.nodeType&&es,NK=xP&&xP.exports===G5,bP=NK?un.Buffer:void 0,wP=bP?bP.allocUnsafe:void 0;function BK(e,t){if(t)return e.slice();var i=e.length,r=wP?wP(i):new e.constructor(i);return e.copy(r),r}var jK=BK;function FK(e,t){for(var i=-1,r=e==null?0:e.length,a=0,s=[];++i<r;){var n=e[i];t(n,i,e)&&(s[a++]=n)}return s}var UK=FK;function VK(){return[]}var H5=VK,GK=Object.prototype,HK=GK.propertyIsEnumerable,_P=Object.getOwnPropertySymbols,WK=_P?function(e){return e==null?[]:(e=Object(e),UK(_P(e),function(t){return HK.call(e,t)}))}:H5,LE=WK;function qK(e,t){return Gm(e,LE(e),t)}var XK=qK,YK=Object.getOwnPropertySymbols,QK=YK?function(e){for(var t=[];e;)IE(t,LE(e)),e=RE(e);return t}:H5,W5=QK;function ZK(e,t){return Gm(e,W5(e),t)}var KK=ZK;function $K(e,t,i){var r=t(e);return Kn(e)?r:IE(r,i(e))}var q5=$K;function JK(e){return q5(e,DE,LE)}var s2=JK;function e$(e){return q5(e,Uc,W5)}var X5=e$,t$=Mh(un,"DataView"),n2=t$,i$=Mh(un,"Promise"),o2=i$,r$=Mh(un,"Set"),l2=r$,SP="[object Map]",a$="[object Object]",AP="[object Promise]",EP="[object Set]",CP="[object WeakMap]",MP="[object DataView]",s$=Ch(n2),n$=Ch(hm),o$=Ch(o2),l$=Ch(l2),c$=Ch(a2),Mc=Eh;(n2&&Mc(new n2(new ArrayBuffer(1)))!=MP||hm&&Mc(new hm)!=SP||o2&&Mc(o2.resolve())!=AP||l2&&Mc(new l2)!=EP||a2&&Mc(new a2)!=CP)&&(Mc=function(e){var t=Eh(e),i=t==a$?e.constructor:void 0,r=i?Ch(i):"";if(r)switch(r){case s$:return MP;case n$:return SP;case o$:return AP;case l$:return EP;case c$:return CP}return t});var um=Mc,h$=Object.prototype,u$=h$.hasOwnProperty;function d$(e){var t=e.length,i=new e.constructor(t);return t&&typeof e[0]=="string"&&u$.call(e,"index")&&(i.index=e.index,i.input=e.input),i}var p$=d$,f$=un.Uint8Array,ly=f$;function m$(e){var t=new e.constructor(e.byteLength);return new ly(t).set(new ly(e)),t}var kE=m$;function g$(e,t){var i=t?kE(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)}var v$=g$,y$=/\w*$/;function x$(e){var t=new e.constructor(e.source,y$.exec(e));return t.lastIndex=e.lastIndex,t}var b$=x$,TP=Os?Os.prototype:void 0,PP=TP?TP.valueOf:void 0;function w$(e){return PP?Object(PP.call(e)):{}}var _$=w$;function S$(e,t){var i=t?kE(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}var A$=S$,E$="[object Boolean]",C$="[object Date]",M$="[object Map]",T$="[object Number]",P$="[object RegExp]",D$="[object Set]",O$="[object String]",I$="[object Symbol]",R$="[object ArrayBuffer]",L$="[object DataView]",k$="[object Float32Array]",z$="[object Float64Array]",N$="[object Int8Array]",B$="[object Int16Array]",j$="[object Int32Array]",F$="[object Uint8Array]",U$="[object Uint8ClampedArray]",V$="[object Uint16Array]",G$="[object Uint32Array]";function H$(e,t,i){var r=e.constructor;switch(t){case R$:return kE(e);case E$:case C$:return new r(+e);case L$:return v$(e,i);case k$:case z$:case N$:case B$:case j$:case F$:case U$:case V$:case G$:return A$(e,i);case M$:return new r;case T$:case O$:return new r(e);case P$:return b$(e);case D$:return new r;case I$:return _$(e)}}var W$=H$;function q$(e){return typeof e.constructor=="function"&&!ME(e)?cY(RE(e)):{}}var X$=q$,Y$="[object Map]";function Q$(e){return Zo(e)&&um(e)==Y$}var Z$=Q$,DP=Pd&&Pd.isMap,K$=DP?PE(DP):Z$,$$=K$,J$="[object Set]";function eJ(e){return Zo(e)&&um(e)==J$}var tJ=eJ,OP=Pd&&Pd.isSet,iJ=OP?PE(OP):tJ,rJ=iJ,aJ=1,sJ=2,nJ=4,Y5="[object Arguments]",oJ="[object Array]",lJ="[object Boolean]",cJ="[object Date]",hJ="[object Error]",Q5="[object Function]",uJ="[object GeneratorFunction]",dJ="[object Map]",pJ="[object Number]",Z5="[object Object]",fJ="[object RegExp]",mJ="[object Set]",gJ="[object String]",vJ="[object Symbol]",yJ="[object WeakMap]",xJ="[object ArrayBuffer]",bJ="[object DataView]",wJ="[object Float32Array]",_J="[object Float64Array]",SJ="[object Int8Array]",AJ="[object Int16Array]",EJ="[object Int32Array]",CJ="[object Uint8Array]",MJ="[object Uint8ClampedArray]",TJ="[object Uint16Array]",PJ="[object Uint32Array]",li={};li[Y5]=li[oJ]=li[xJ]=li[bJ]=li[lJ]=li[cJ]=li[wJ]=li[_J]=li[SJ]=li[AJ]=li[EJ]=li[dJ]=li[pJ]=li[Z5]=li[fJ]=li[mJ]=li[gJ]=li[vJ]=li[CJ]=li[MJ]=li[TJ]=li[PJ]=!0;li[hJ]=li[Q5]=li[yJ]=!1;function o0(e,t,i,r,a,s){var n,o=t&aJ,l=t&sJ,c=t&nJ;if(i&&(n=a?i(e,r,a,s):i(e)),n!==void 0)return n;if(!hn(e))return e;var u=Kn(e);if(u){if(n=p$(e),!o)return pY(e,n)}else{var h=um(e),d=h==Q5||h==uJ;if(oy(e))return jK(e,o);if(h==Z5||h==Y5||d&&!a){if(n=l||d?{}:X$(e),!o)return l?KK(e,zK(n,e)):XK(e,LK(n,e))}else{if(!li[h])return a?e:{};n=W$(e,h,o)}}s||(s=new n0);var p=s.get(e);if(p)return p;s.set(e,n),rJ(e)?e.forEach(function(g){n.add(o0(g,t,i,g,e,s))}):$$(e)&&e.forEach(function(g,v){n.set(v,o0(g,t,i,v,e,s))});var f=c?l?X5:s2:l?Uc:DE,m=u?void 0:f(e);return MY(m||e,function(g,v){m&&(v=g,g=e[v]),EE(n,v,o0(g,t,i,v,e,s))}),n}var K5=o0,DJ=1,OJ=4;function IJ(e){return K5(e,DJ|OJ)}var O1=IJ,RJ="__lodash_hash_undefined__";function LJ(e){return this.__data__.set(e,RJ),this}var kJ=LJ;function zJ(e){return this.__data__.has(e)}var NJ=zJ;function cy(e){var t=-1,i=e==null?0:e.length;for(this.__data__=new P1;++t<i;)this.add(e[t])}cy.prototype.add=cy.prototype.push=kJ;cy.prototype.has=NJ;var BJ=cy;function jJ(e,t){for(var i=-1,r=e==null?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}var FJ=jJ;function UJ(e,t){return e.has(t)}var VJ=UJ,GJ=1,HJ=2;function WJ(e,t,i,r,a,s){var n=i&GJ,o=e.length,l=t.length;if(o!=l&&!(n&&l>o))return!1;var c=s.get(e),u=s.get(t);if(c&&u)return c==t&&u==e;var h=-1,d=!0,p=i&HJ?new BJ:void 0;for(s.set(e,t),s.set(t,e);++h<o;){var f=e[h],m=t[h];if(r)var g=n?r(m,f,h,t,e,s):r(f,m,h,e,t,s);if(g!==void 0){if(g)continue;d=!1;break}if(p){if(!FJ(t,function(v,y){if(!VJ(p,y)&&(f===v||a(f,v,i,r,s)))return p.push(y)})){d=!1;break}}else if(!(f===m||a(f,m,i,r,s))){d=!1;break}}return s.delete(e),s.delete(t),d}var $5=WJ;function qJ(e){var t=-1,i=Array(e.size);return e.forEach(function(r,a){i[++t]=[a,r]}),i}var XJ=qJ;function YJ(e){var t=-1,i=Array(e.size);return e.forEach(function(r){i[++t]=r}),i}var QJ=YJ,ZJ=1,KJ=2,$J="[object Boolean]",JJ="[object Date]",eee="[object Error]",tee="[object Map]",iee="[object Number]",ree="[object RegExp]",aee="[object Set]",see="[object String]",nee="[object Symbol]",oee="[object ArrayBuffer]",lee="[object DataView]",IP=Os?Os.prototype:void 0,Sb=IP?IP.valueOf:void 0;function cee(e,t,i,r,a,s,n){switch(i){case lee:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case oee:return!(e.byteLength!=t.byteLength||!s(new ly(e),new ly(t)));case $J:case JJ:case iee:return AE(+e,+t);case eee:return e.name==t.name&&e.message==t.message;case ree:case see:return e==t+"";case tee:var o=XJ;case aee:var l=r&ZJ;if(o||(o=QJ),e.size!=t.size&&!l)return!1;var c=n.get(e);if(c)return c==t;r|=KJ,n.set(e,t);var u=$5(o(e),o(t),r,a,s,n);return n.delete(e),u;case nee:if(Sb)return Sb.call(e)==Sb.call(t)}return!1}var hee=cee,uee=1,dee=Object.prototype,pee=dee.hasOwnProperty;function fee(e,t,i,r,a,s){var n=i&uee,o=s2(e),l=o.length,c=s2(t),u=c.length;if(l!=u&&!n)return!1;for(var h=l;h--;){var d=o[h];if(!(n?d in t:pee.call(t,d)))return!1}var p=s.get(e),f=s.get(t);if(p&&f)return p==t&&f==e;var m=!0;s.set(e,t),s.set(t,e);for(var g=n;++h<l;){d=o[h];var v=e[d],y=t[d];if(r)var x=n?r(y,v,d,t,e,s):r(v,y,d,e,t,s);if(!(x===void 0?v===y||a(v,y,i,r,s):x)){m=!1;break}g||(g=d=="constructor")}if(m&&!g){var w=e.constructor,S=t.constructor;w!=S&&"constructor"in e&&"constructor"in t&&!(typeof w=="function"&&w instanceof w&&typeof S=="function"&&S instanceof S)&&(m=!1)}return s.delete(e),s.delete(t),m}var mee=fee,gee=1,RP="[object Arguments]",LP="[object Array]",Kg="[object Object]",vee=Object.prototype,kP=vee.hasOwnProperty;function yee(e,t,i,r,a,s){var n=Kn(e),o=Kn(t),l=n?LP:um(e),c=o?LP:um(t);l=l==RP?Kg:l,c=c==RP?Kg:c;var u=l==Kg,h=c==Kg,d=l==c;if(d&&oy(e)){if(!oy(t))return!1;n=!0,u=!1}if(d&&!u)return s||(s=new n0),n||z5(e)?$5(e,t,i,r,a,s):hee(e,t,l,i,r,a,s);if(!(i&gee)){var p=u&&kP.call(e,"__wrapped__"),f=h&&kP.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return s||(s=new n0),a(m,g,i,r,s)}}return d?(s||(s=new n0),mee(e,t,i,r,a,s)):!1}var xee=yee;function J5(e,t,i,r,a){return e===t?!0:e==null||t==null||!Zo(e)&&!Zo(t)?e!==e&&t!==t:xee(e,t,i,r,J5,a)}var bee=J5;function wee(e,t){return e!=null&&t in Object(e)}var _ee=wee;function See(e,t,i){t=rp(t,e);for(var r=-1,a=t.length,s=!1;++r<a;){var n=D1(t[r]);if(!(s=e!=null&&i(e,n)))break;e=e[n]}return s||++r!=a?s:(a=e==null?0:e.length,!!a&&CE(a)&&SE(n,a)&&(Kn(e)||TE(e)))}var Aee=See;function Eee(e,t){return e!=null&&Aee(e,t,_ee)}var Cee=Eee,Mee=function(){return un.Date.now()},Ab=Mee,Tee="Expected a function",Pee=Math.max,Dee=Math.min;function Oee(e,t,i){var r,a,s,n,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(Tee);t=cP(t)||0,hn(i)&&(u=!!i.leading,h="maxWait"in i,s=h?Pee(cP(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(_){var A=r,E=a;return r=a=void 0,c=_,n=e.apply(E,A),n}function f(_){return c=_,o=setTimeout(v,t),u?p(_):n}function m(_){var A=_-l,E=_-c,M=t-A;return h?Dee(M,s-E):M}function g(_){var A=_-l,E=_-c;return l===void 0||A>=t||A<0||h&&E>=s}function v(){var _=Ab();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,d&&r?p(_):(r=a=void 0,n)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=a=o=void 0}function w(){return o===void 0?n:y(Ab())}function S(){var _=Ab(),A=g(_);if(r=arguments,a=this,l=_,A){if(o===void 0)return f(l);if(h)return clearTimeout(o),o=setTimeout(v,t),p(l)}return o===void 0&&(o=setTimeout(v,t)),n}return S.cancel=x,S.flush=w,S}var zE=Oee;function Iee(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Ree=Iee;function Lee(e,t){return t.length<2?e:j5(e,wK(t,0,-1))}var kee=Lee;function zee(e,t){return bee(e,t)}var ez=zee;function Nee(e,t){return t=rp(t,e),e=kee(e,t),e==null||delete e[D1(Ree(t))]}var Bee=Nee;function jee(e){return xK(e)?void 0:e}var Fee=jee,Uee=1,Vee=2,Gee=4,Hee=U5(function(e,t){var i={};if(e==null)return i;var r=!1;t=T5(t,function(s){return s=rp(s,e),r||(r=s.length>1),s}),Gm(e,X5(e),i),r&&(i=K5(i,Uee|Vee|Gee,Fee));for(var a=t.length;a--;)Bee(i,t[a]);return i}),c2=Hee;function Wee(e,t,i,r){if(!hn(e))return e;t=rp(t,e);for(var a=-1,s=t.length,n=s-1,o=e;o!=null&&++a<s;){var l=D1(t[a]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(a!=n){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=hn(u)?u:SE(t[a+1])?[]:{})}EE(o,l,c),o=o[l]}return e}var qee=Wee;function Xee(e,t,i){for(var r=-1,a=t.length,s={};++r<a;){var n=t[r],o=j5(e,n);i(o,n)&&qee(s,rp(n,e),o)}return s}var Yee=Xee;function Qee(e,t){return Yee(e,t,function(i,r){return Cee(e,r)})}var Zee=Qee,Kee=U5(function(e,t){return e==null?{}:Zee(e,t)}),Go=Kee,$ee="Expected a function";function Jee(e,t,i){var r=!0,a=!0;if(typeof e!="function")throw new TypeError($ee);return hn(i)&&(r="leading"in i?!!i.leading:r,a="trailing"in i?!!i.trailing:a),zE(e,t,{leading:r,maxWait:t,trailing:a})}var ete=Jee;function tz(e){for(let t of Object.keys(e))e[t]===void 0&&delete e[t];return e}function $n(e,t){return Object.setPrototypeOf(e,t),e}var tte=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),ite=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),rte=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||I1&&"ontouchend"in document,ate=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,ste=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,nte=()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)},ote=()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]},lte=()=>{if(typeof window>"u")return;let e=new URLSearchParams(window.location.search).get("desktop-app-version");return e?(window.localStorage.setItem("desktop-app-version",e),e):window.localStorage.getItem("desktop-app-version")??"0.0.6"},cte=tte();cte&&lte();var I1=ite(),NE=rte(),hte=ate(),Ka=ste(),zP=nte(),NP=Number(ote());function iz(e){return Array.isArray(e)?e:[e]}function rz(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function $g(e){return I1?e.metaKey:e.ctrlKey}function ute(e){return e.wheelDeltaY===0||e.deltaY===0?I1&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120?!1:e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:e.deltaMode===0:e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:e.deltaMode===0}var ot=[],hy={},lf={},l0={};function az(e){ot.includes(e)||ot.push(e)}function td(e){delete hy[e.pointerId];for(let t=0;t<ot.length;t++)if(ot[t].pointerId===e.pointerId){ot.splice(t,1);break}}function dte(){ot.splice(0,ot.length)}function uy(e){if(e.pointerType!=="touch")return;let t=hy[e.pointerId];t===void 0&&(t={x:0,y:0},hy[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function Eb(e){let t=e.pointerId===ot[0].pointerId?ot[1]:ot[0];return hy[t.pointerId]}function sz(e){lf[e.key]=!0,l0[e.key]=l0[e.key]===void 0?1:l0[e.key]+1}function nz(e){if(I1&&lf.Meta)for(let t in lf)lf[t]=!1;else lf[e.key]=!1;l0={}}function pte(e){e.addEventListener("pointerdown",az,!0),e.addEventListener("pointerdown",uy,!0),e.addEventListener("pointermove",uy,!0),e.addEventListener("pointerup",td,!0),e.addEventListener("pointercancel",td,!0),e.addEventListener("pointerleave",td,!0),window.addEventListener("keydown",sz,!0),window.addEventListener("keyup",nz,!0)}function fte(e){e.removeEventListener("pointerdown",az,!0),e.removeEventListener("pointerdown",uy,!0),e.removeEventListener("pointermove",uy,!0),e.removeEventListener("pointerup",td,!0),e.removeEventListener("pointercancel",td,!0),e.removeEventListener("pointerleave",td,!0),window.removeEventListener("keydown",sz,!0),window.removeEventListener("keyup",nz,!0)}var oz,mte=new Promise(e=>{oz=e}),Jg;function gte(){if(Jg)return Jg;async function e(){let t="https://unpkg.com/@splinetool/navmesh-wasm@1.0.26/build",i=Xd(()=>import("./navmesh-QdgGSsus.js"),__vite__mapDeps([])),[r,a]=await Promise.all([i,fetch(`${t}/navmesh.wasm`).then(o=>o.arrayBuffer())]),s=r.default,n=await s({wasmBinary:a});oz(n)}return Jg=e(),Jg}var lz,vte=new Promise(e=>{lz=e}),ev;function yte(){if(ev)return ev;async function e(){let t=await Xd(()=>import("./physics-XY0FX9ij.js"),__vite__mapDeps([]));await t.init(),lz(t)}return ev=e(),ev}var ft=class{modifyById(e,t){let i=this;if(i[e]===void 0)throw new Error("not expected");{let r={...i,[e]:t};return Object.setPrototypeOf(r,ft.prototype),r}}add(e,t){var i;return((i=this.runOp({type:1,id:e,data:t}))==null?void 0:i.data)??this}runOp(e){let t=this;if(e.type===1){let i=t[e.id],r;i===void 0?r={type:2,id:e.id}:r={type:1,id:e.id,data:i};let{id:a,data:s}=e,n={...t,[a]:s};return Object.setPrototypeOf(n,ft.prototype),{data:n,actual:e,reverse:r}}else if(e.type===2){let{id:i}=e,r=t[i];if(r===void 0)return null;{let a={...t};return Object.setPrototypeOf(a,ft.prototype),delete a[i],{data:a,actual:e,reverse:{type:1,id:i,data:r}}}}return null}};function BE(e){if(e.deepFreeze!==void 0){e.deepFreeze(e);return}let t=Object.getOwnPropertyNames(e);for(let i of t){let r=e[i];r&&typeof r=="object"&&BE(r)}return Object.freeze(e)}function xte(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}var cz=class extends Error{};function Cb(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function kl(e,t,i){if(e===void 0?t===void 0?(e=0,t=10):e=t-10:t===void 0&&(t=e+10),e>t){let s=e;e=t,t=s}let r=[],a=1/(i+1);for(let s=0;s<i;s++){let n=e+(t-e)*(s+.75+Math.random()*.5)*a;r.push(n)}return r}function jE(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function bte(){return typeof process<"u"}function hz(e,t){for(let i of e)t(i.id,i.data)!==!0&&hz(i.children,t)}function uz(e,t){if(t(e.id,e.data)!==!0)for(let i of e.children)uz(i,t)}var jr=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,jr.prototype)}deepFreeze(){let t=0;for(;t<this.length;)BE(this[t]),t++}fillCaches0(t,i){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,i);for(let r of t.children)this.fillCaches0(r,t.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,i){if(!this.has(t))return!0;for(;t;){let r=this.parent(t);if(r===i)return!0;t=r}return!1}rootAcestor(t){for(;t;){let i=this.parent(t);if(i)t=i;else return t}return t}isDescendantOf(t,i){for(;t;){let r=this.parent(t);if(r===i)return!0;t=r}return!1}data(t){var i;return(i=this.get(t))==null?void 0:i.data}has(t){return this.childrenOf(t)!==void 0}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){var i;return t===null?this:(i=this.get(t))==null?void 0:i.children}traverseFrom(t,i){if(t===null)this.traverse(i);else{let r=this.get(t);r&&uz(r,i)}}traverse(t){hz(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return t===null?this:this.get(t).children}modifyById(t,i){if(this.get(t)===void 0)throw new Error("not expected");{let r=this.parent(t),a=this.childrenArray(r),s=a.findIndex(o=>o.id===t);if(s<0)throw new Error("not expected");let n=a[s];return a=[...a],a[s]={...n,data:i},this.modifyArrayBy(r,a)}}modifyArrayBy(t,i){let r=t,a=i;for(;r!==null;){let n=a,o=r;if(r=this.parent(r),r===void 0)throw new Error;a=this.childrenArray(r);let l=a.findIndex(c=>c.id===o);if(l<0)throw new Error;a=[...a],a[l]={...a[l],children:n}}Object.setPrototypeOf(a,jr.prototype);let s=a;return s.fillCaches(),s}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec({id:t,children:i}){if(this.get(t)!==void 0)return!0;for(let r of i)if(this.checkDuplicatedIdRec(r))return!0;return!1}addOp(t){let{parent:i,fi:r,id:a,data:s,children:n}=t;if(i!==null&&this.get(i)===void 0||this.checkDuplicatedIdRec(t))return null;{let o=i,l=this.childrenArray(o),c={fi:r,id:a,data:s,children:n};return l=[...l,c],l.sort((u,h)=>u.fi-h.fi),t.localIndex=l.indexOf(c),{data:this.modifyArrayBy(o,l),actual:t,reverse:{type:8,id:a}}}}deleteOp(t){let{id:i}=t;if(this.get(i)===null)return null;{let r=this.parent(i);if(r===void 0)return null;let a=this.childrenArray(r),s=a.findIndex(o=>o.id===i);t.localIndex=s,a=[...a];let n=a.splice(s,1)[0];return{data:this.modifyArrayBy(r,a),actual:t,reverse:{type:7,...n,parent:r}}}}moveOp(t){let{parent:i,fi:r,id:a}=t;if(i!==null&&this.get(i)===void 0)return this.deleteOp({type:8,id:a});if(i!==null){let d=i;for(;d!==null;){if(d===void 0)throw new Error;if(d===a)throw new cz("cyclic tree");d=this.parent(d)}}let s=this.parent(a);if(s===void 0)return null;let n=s,o=this.childrenArray(s),l=o.findIndex(d=>d.id===a);o=[...o];let c=o.splice(l,1)[0],u=this.modifyArrayBy(s,o);s=i,o=u.childrenArray(s);let h=c.fi;return c={...c,fi:r},o=[...o,c],o.sort((d,p)=>d.fi-p.fi),t.localIndex=o.indexOf(c),u=u.modifyArrayBy(s,o),{data:u,actual:t,reverse:{type:9,parent:n,fi:h,id:a}}}previous(t,i){if(i===null){let a=this.childrenArray(t);return a.length===0?null:a[a.length-1].id}let r=null;for(let a of this.childrenArray(t)){if(a.id===i)return r;r=a.id}return null}traverseSortNext(t){let i=this.parent(t);if(i!==void 0){let r=this.childrenArray(i),a=r.findIndex(s=>s.id===t)+1;if(a<r.length)return r[a].id;if(i)return this.traverseSortNext(i)}}sortNext(t){let i=this.childrenArray(t);return i.length>0?i[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let i=this.childrenArray(t);return i.length>0?this.traverseSortPrevious(i[i.length-1].id):t}sortPrevious(t){let i=this.parent(t);if(i!==void 0){let r=this.childrenArray(i),a=r.findIndex(s=>s.id===t)-1;return a>=0?this.traverseSortPrevious(r[a].id):i}}getAllSorted(t){let i=[];for(let r of t){let a=this.getWithSortKey(r.id);a!==void 0&&i.push({...r,...a})}i.sort((r,a)=>xte(r.sortKey,a.sortKey));for(let r of i)delete r.sortKey;return i}getWithSortKey(t){var i=t;let r=[],a=this.get(i),s=a;if(a!==void 0){for(;i;)r.splice(0,0,a.fi),i=this.parent(i),i!==null&&(a=this.get(i));return{...s,sortKey:r}}}insertBeforeHelper(t,i,r){return this.insertAfterHelper(t,this.previous(t,i),r)}insertAfterHelper(t,i,r){let a=this.childrenArray(t);if(i===null){if(a.length===0)return kl(0,r,r);{let s=a[0].fi;return kl(s-r,s,r)}}else{let s=this.get(i);if(s===void 0||this.parent(i)!==t)throw new Error("illegal args");let n=a.find(o=>o.fi>s.fi);if(n===void 0){let o=a[a.length-1].fi;return kl(o,o+r,r)}else return kl(s.fi,n.fi,r)}}},dy;(e=>{function t(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let a=r.props,s={},n=[...i],o=!1;if(a)for(let l of Object.keys(a)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=n[c],n[c]=a[l],o=!0}return o?{data:n,actual:r,reverse:{type:0,props:s}}:null}else{let a=r.props,s={},n={...i},o=!1;if(a)for(let l of Object.keys(a)){s[l]=n[l];let c=a[l];c===void 0?delete n[l]:n[l]=c,o=!0}return o?{data:n,actual:r,reverse:{type:0,props:s}}:null}}e.runOp=t})(dy||(dy={}));var Je=class extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Je.prototype)}deepFreeze(){let e=0;for(;e<this.length;)BE(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(e.length!==0)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return(t=this.get(e))==null?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(this.get(e)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===e);if(r<0)throw new Error("not expected");let a=i[r];return i=[...i],i[r]={...a,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,Je.prototype);let t=e;return bte()||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:r}=e,a=this,s={fi:t,id:i,data:r};return a=[...a,s],a.sort((n,o)=>n.fi-o.fi),e.localIndex=a.indexOf(s),{data:this.modifyArrayBy(a),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,r=i.findIndex(s=>s.id===t);if(r===-1)return null;e.localIndex=r,i=[...i];let a=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...a}}}moveOp(e){let{fi:t,id:i}=e,r=this;r=[...r];let a=r.findIndex(o=>o.id===i);if(a===-1)return null;let s=r[a].fi,n={...r[a],fi:t};return r[a]=n,r.sort((o,l)=>o.fi-l.fi),e.localIndex=r.indexOf(n),{data:this.modifyArrayBy(r),actual:e,reverse:{type:6,fi:s,id:i}}}previous(e){if(e===null)return this.length===0?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(e===null){if(i.length===0)return kl(0,t,t);{let r=i[0].fi;return kl(r-t,r,t)}}else{let r=this.get(e);if(r===void 0)throw new Error("illegal args");let a=i.find(s=>s.fi>r.fi);if(a===void 0){let s=i[i.length-1].fi;return kl(s,s+t,t)}else return kl(r.fi,a.fi,t)}}};function Dd(e){return e&&typeof e=="object"&&e instanceof rr}var rr=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,r=0,a={};for(;r<e.path.length;){if(t.push(i),i=i===void 0?void 0:i[e.path[r]],i!==void 0&&!Dd(i))return null;r+=1}i=i?Cb(i):new rr;for(let[o,l]of Object.entries(e.props)){let c=i[o];a[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=t[r-1];o&&(i=Cb(o),delete i[e.path[r-1]])}else{let o=t[r-1];if(o){let l=Cb(o);l[e.path[r-1]]=i,i=l}else{let l=new rr;l[e.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,rr.prototype),n={...e,props:a};return{data:s,actual:e,reverse:n}}},ec;(e=>{function t(a,s){return dm(a,s)??a}e.apply=t;function i(a,s){return UE(a,s)}e.merge=i;function r(a,s){let n=0,o=s.path,l=a;for(;n<o.length&&l!==void 0;){if(l=Br.zoomOnce(l,o[n]),l===void 0)return s;if(!Dd(l))return;n+=1}if(l===void 0)return s;if(Dd(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=FE([s],l);return c?(console.log(c),c):s}else return s}e.filterOp=r})(ec||(ec={}));function FE(e,t){if(t===void 0)return;let i=!1,r=e.map(a=>{let s=a.id,n=dm(a.data,t[s]);if(i=i||n!==void 0,n===void 0&&(n=a.data),a.children){let o=FE(a.children,t);return o!==void 0?i=!0:o=a.children,{...a,id:s,data:n,children:o}}else return{...a,id:s,data:n}});if(i)return r}function wte(e,t){if(t===void 0)return;let i=!1,r=e.map(a=>{let s=a.id,n=dm(a.data,t[s]);return i=i||n!==void 0,n===void 0&&(n=a.data),{...a,id:s,data:n}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}function dm(e,t){if(!Dd(t))return t;if(e instanceof jr){let i=FE(e,t);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}else{if(e instanceof Je)return wte(e,t);if(Array.isArray(e)){let i=!1,r=e.map((a,s)=>{let n=dm(a,t[s]);return i=i||n!==void 0,n===void 0&&(n=a),n});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else{if(e instanceof rr)return UE(e,t);if(e&&typeof e=="object"){let i={},r=!1;for(let[a,s]of Object.entries(e)){let n=dm(s,t[a]);r=r||n!==void 0,n===void 0&&(n=s),i[a]=n}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}}}function UE(e,t){if(e===void 0)return t;if(t===void 0)return e;if(!Dd(t))return t;if(!Dd(e))return ec.apply(e,t);let i=new Set;for(let a of Object.keys(e))i.add(a);for(let a of Object.keys(t))i.add(a);let r=new rr;for(let a of i){let s=UE(e===void 0?void 0:e[a],t===void 0?void 0:t[a]);r[a]=s}return r}function _te(e,t){let i={cur:[],result:[],len:0};return e=pm(e,t,i)??e,[e,i.result]}function py(e,t){return e===null?null:(e.cur[e.len]=t,e.len+=1,e)}function fy(e){e&&(e.len-=1)}function Ste(e){if(e===null)return null;e.result.push(e.cur.slice(0,e.len))}function dz(e,t,i){let r=!1,a=e.map(s=>{let n=s.id,o=t[n];if(o!==void 0&&typeof o=="string"&&(r=!0,n=o,i!==null))throw new Error("not supported");let l=pm(s.data,t,py(i,n));fy(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=dz(s.children,t,i);return c!==void 0?r=!0:c=s.children,{...s,id:n,data:l,children:c}});if(r)return a}function Ate(e,t,i){let r=!1,a=e.map(s=>{let n=s.id,o=t[n];if(o!==void 0&&typeof o=="string"&&(r=!0,n=o,i!==null))throw new Error("not supported");let l=pm(s.data,t,py(i,n));return fy(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:n,data:l}});if(r)return Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a}function pm(e,t,i){if(e instanceof jr){let r=dz(e,t,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}else{if(e instanceof Je)return Ate(e,t,i);if(Array.isArray(e)){let r=!1,a=e.map((s,n)=>{let o=pm(s,t,py(i,n));return fy(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(a,Object.getPrototypeOf(e)),a):void 0}else if(e&&typeof e=="object"&&!jE(e)){let r={},a=!1;for(let[s,n]of Object.entries(e))if(s!=="name"){let o=t[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");a=!0,s=o}let l=pm(n,t,py(i,s));fy(i),a=a||l!==void 0,l===void 0&&(l=n),r[s]=l}else r[s]=n;return a?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}else if(typeof e=="string"){let r=t[e];return r!==void 0&&Ste(i),r}else return}}var my;(e=>{function t(i,r){let a=Br.zoom(r,i.path);if(typeof a=="object"){let s={};for(let n of Object.keys(i.props))s[n]=a[n];return{...i,props:s}}else return{...i,props:{}}}e.replaceProps=t})(my||(my={}));var Ar;(e=>{function t(l,c){return{...l,path:l.path.slice(c)}}e.drop=t;function i(l,c){var u;return((u=r(l,c))==null?void 0:u.data)??l}e.applySimple=i;function r(l,c){var d,p;let u=c.path;for(var h=[];;){let f;if(l instanceof rr&&c.type===0&&(f=l.runOp({...c,path:u.slice(h.length)}),f===null&&(f=void 0)),f===void 0&&h.length===u.length&&(l instanceof jr||l instanceof Je||l instanceof ft?f=l.runOp(c):f=dy.runOp(l,c)),f!==void 0)if(f!==null){let v=f.data;for(let y=h.length-1;y>=0;y--){let x=u[y],w=h[y];if(w instanceof jr){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof Je){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof ft){if(typeof x=="number")throw new Error("illegal arg");v=w.modifyById(x,v)}else if(w instanceof rr){let S={...w,[x]:v};v=Object.setPrototypeOf(S,rr.prototype)}else if(typeof w=="object")if(Array.isArray(w)){if(typeof x=="string"&&(x=parseInt(x),isNaN(x)))throw new Error("Invalid path");let S=v;v=[...w],v[x]=S}else v={...w,[x]:v};else return null}return{data:v,actual:{...f.actual,path:u},reverse:{...f.reverse,path:u}}}else return null;let m=u[h.length],g;if(l instanceof jr){if(typeof m=="number")throw new Error("");g=(d=l.get(m))==null?void 0:d.data}else if(l instanceof Je){if(typeof m=="number")throw new Error("");g=(p=l.get(m))==null?void 0:p.data}else l!==null&&(g=l[m]);if(g!==void 0)h.push(l),l=g;else return null}}e.apply=r;function a(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}e.pathDisjoint=a;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}e.pathEq=s;function n(l,c){return a(l.path,c.path)}e.commutative=n;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}e.subsumed=o})(Ar||(Ar={}));var h2;(e=>{function t(){return[]}e.empty=t;function i(c,u){let h=[];for(let d of c){let[p,...f]=d.path;p===u&&h.push({...d,path:f})}return h}e.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}e.addPrefix=r;function a(c,u){return[...c,...u]}e.concat=a;function s(c,u){return[...c.filter(h=>!u.some(d=>Ar.subsumed(h,d))),...u]}e.compress=s;function n(c,u){return c.every(h=>u.every(d=>Ar.commutative(h,d)))}e.commutative=n;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}e.applyAll=o;function l(c,u){var h=c;let d=[],p=[];for(let f of u)try{if(f.type===3||f.type===5&&f.path[f.path.length-1]==="variables"){let m,g,v;if(f.type===3?(m=Br.zoom(h,[...f.path,f.id]),v=Ar.apply(h,{...f,type:2})):(m=Br.zoom(h,[...f.path,f.id,"value"]),v=Ar.apply(h,f)),v!==null){h=v.data;let[y,x]=_te(h,{[f.id]:m});h=y;for(let w=0;w<x.length;w++){let S=x[w],_=S.pop();if(typeof _=="number"){let A=[_];for(let M=w+1;M<x.length;M++){let C=x[M],T=C[C.length-1];if(typeof T=="number"&&Br.equal(S,C.slice(0,C.length-1)))A.push(T),x.splice(M,1);else break}let E=Br.zoom(h,S);g=E.map((M,C)=>A.includes(C)?f.id:M),m=E,_=S.pop()}else{if(_==="alphaOverride"||_==="alpha"){m/=100;let A=m,E=Br.zoom(h,S.slice(0,S.length-2)),M=E.layers.map(C=>C.id===S[S.length-1]?{...C,data:{...C.data,[_]:A}}:C);Object.setPrototypeOf(M,Object.getPrototypeOf(E.layers)),E.layers=M}g=f.id}d.push({type:0,path:S,props:{[_]:m}}),p.push({type:0,path:S,props:{[_]:g}})}p.push(v.reverse),d.push(v.actual)}}else{let m=Ar.apply(h,f);m!==null&&(d.push(m.actual),h=m.data,p.push(m.reverse))}}catch(m){if(m instanceof cz)return null;throw m}return{data:h,actual:d,reverse:p.reverse()}}e.apply=l})(h2||(h2={}));var pz=Symbol(),Ete=Symbol(),R1=Symbol(),Hm=class{reportOp(e,t,i=[]){let r=this;if(t===null)return;r._current=t.data;let a=i;for(;!(r instanceof mz);){let s=r._path,n=r._current;if(s!==""&&a.splice(0,0,s),r=r._parent,r===null)return;r.update(s,n)}r.push(a,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[R1];i&&i(),delete this._children[e]}}}},Cte=class extends Hm{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if(typeof e=="string"&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,dy.runOp(this._current,e),e.path)}},Mte=class extends Hm{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,ft.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},fz={get(e,t){if(t===R1)return()=>{e._parent=null};if(t===pz)return e._current;if(t===Ete)return e;let{_current:i,_children:r}=e;if(t==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let a=r===void 0?void 0:r[t];if(a!==void 0)return a;let s=i[t],n=L1(e,t,s);return n!==s?(r===void 0&&(r={},e._children=r),r[t]=n,n):s},has(e,t){return t in e._current},ownKeys(e){return Reflect.ownKeys(e._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(e){return Object.getPrototypeOf(e._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,r=Reflect.getOwnPropertyDescriptor(i,t);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[t]}}},Tte={...fz,set(e,t,i){let r={type:0,props:{[t]:Vi(i)??i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},Pte={...fz,set(e,t,i){return i===void 0?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty(e,t){return e.runOp({type:2,id:t}),!0}},VE=class extends Hm{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[R1]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse((t,i)=>{e(t,this.data(t))})}data(e){var n;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let a=(n=t.get(e))==null?void 0:n.data,s=L1(this,e,a);return s!==a?(i===void 0&&(i={},this._children=i),i[e]=s,s):a}add(e,t,i,r,a){this.runOp({type:7,parent:e,fi:t,id:i,data:r,children:a})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let a=0;a<i.length;a++){let s=i[a];this.add(e,r[a],s.id,s.data,s.children)}}insertBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let a=0;a<i.length;a++){let s=i[a];this.add(e,r[a],s.id,s.data,s.children)}}moveAfter(e,t,i){let r=this._current.insertAfterHelper(e,t,i.length);for(let a=0;a<i.length;a++){let s=i[a];this.move(e,r[a],s)}}moveBefore(e,t,i){let r=this._current.insertBeforeHelper(e,t,i.length);for(let a=0;a<i.length;a++){let s=i[a];this.move(e,r[a],s)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},GE=class extends Hm{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[R1]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id,a=this._current[i].fi;e(this.data(this._current[i].id),r,a)}}find(e){let t=this.length;for(let i=0;i<t;i++){let r=this._current[i].id;if(e(this.data(r),r))return this.get(r)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var n;let{_current:t,_children:i}=this,r=i===void 0?void 0:i[e];if(r!==void 0)return r;let a=(n=t.get(e))==null?void 0:n.data,s=L1(this,e,a);return s!==a?(i===void 0&&(i={},this._children=i),i[e]=s,s):a}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let a=t[r];this.add(i[r],a.id,a.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let a=t[r];this.add(i[r],a.id,a.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let r=0;r<t.length;r++){let a=t[r];this.move(i[r],a)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let r=0;r<t.length;r++){let a=t[r];this.move(i[r],a)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function Mb(e,t,i){if(e.length>0){let r=e[e.length-1];if(r.type===0&&t.type===0&&Br.equal(r.path,i)){Object.assign(r.props,t.props);return}}e.push({...t,path:i})}var mz=class extends Hm{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(e!=="")throw new Error("");this._current=t}push(e,t,i,r){Mb(this.ts,t,e),Mb(this.actual,i,e),Mb(this.reverse,r,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function L1(e,t,i){return i instanceof jr?new VE(e,t,i):i instanceof Je?new GE(e,t,i):i instanceof ft?new Proxy(new Mte(e,t,i),Pte):i!==null&&typeof i=="object"?jE(i)?i:new Proxy(new Cte(e,t,i),Tte):i}function gz(e){let t=new mz(e);return[L1(t,"",e),t]}function fm(e,t){let[i,r]=gz(e);return t(i),r.result()}function Vi(e){return e instanceof VE||e instanceof GE?e._current:e!==null&&typeof e=="object"?e[pz]:e}var Br;(e=>{function t(s,n){if(n.length===s.length)for(var o=0;o<s.length;){if(s[o]!==n[o])return!1;o+=1}else return!1;return!0}e.equal=t;function i(s,n,o){let l=a(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...n};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return n}e.removeOverridden=i;function r(s,n){if((s instanceof jr||s instanceof VE)&&typeof n=="string"||(s instanceof Je||s instanceof GE)&&typeof n=="string")return s.data(n);if(typeof n=="number"&&Array.isArray(s)||typeof n=="string"&&typeof s=="object"&&s!==null)return s[n]}e.zoomOnce=r;function a(s,n,o=0){for(;o<n.length&&s!==void 0;)s=r(s,n[o]),o+=1;return s}e.zoom=a})(Br||(Br={}));function Dte(e,t){let i=[];if(t.length===e.length)for(var r=0;r<e.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}function si(e,t){let i=[];if(t.length<=e.length)for(var r=0;r<t.length;){if(t[r]==="*")i.push(e[r]);else if(e[r]!==t[r])return null;r+=1}else return null;return i}var vz=class{},BP=class extends vz{constructor(e){super(),this.id=e}},jP=class extends vz{constructor(e){super(),this.data=e}},u2;try{u2=new TextDecoder}catch{}var Fe,tc,ae=0,Oa={},jt,zl,vs=0,jn=0,Xa,Ho,xa=[],Xt,FP={useRecords:!1,mapsAsObjects:!0},yz=class{},xz=new yz;xz.name="MessagePack 0xC1";var Od=!1,gy=class{constructor(e){e&&(e.useRecords===!1&&e.mapsAsObjects===void 0&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(Fe)return Ez(()=>(p2(),this?this.unpack(e,t):gy.prototype.unpack.call(FP,e,t)));tc=t>-1?t:e.length,ae=0,jn=0,zl=null,Xa=null,Fe=e;try{Xt=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(i){throw Fe=null,e instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&typeof e=="object"?e.constructor.name:typeof e))}if(this instanceof gy){if(Oa=this,this.structures)return jt=this.structures,tv();(!jt||jt.length>0)&&(jt=[])}else Oa=FP,(!jt||jt.length>0)&&(jt=[]);return tv()}unpackMultiple(e,t){let i,r=0;try{Od=!0;let a=e.length,s=this?this.unpack(e,a):z1.unpack(e,a);if(t){for(t(s);ae<a;)if(r=ae,t(tv())===!1)return}else{for(i=[s];ae<a;)r=ae,i.push(tv());return i}}catch(a){throw a.lastPosition=r,a.values=i,a}finally{Od=!1,p2()}}_mergeStructures(e,t){e=e||[];for(let i=0,r=e.length;i<r;i++){let a=e[i];a&&(a.isShared=!0,i>=32&&(a.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let r=e[i],a=t[i];a&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[i]=r),e[i]=a)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function tv(){try{if(!Oa.trusted&&!Od){let t=jt.sharedLength||0;t<jt.length&&(jt.length=t)}let e=Ii();if(ae==tc)jt.restoreStructures&&UP(),jt=null,Fe=null,Ho&&(Ho=null);else if(ae>tc){let t=new Error("Unexpected end of MessagePack data");throw t.incomplete=!0,t}else if(!Od)throw new Error("Data read, but end of buffer not reached");return e}catch(e){throw jt.restoreStructures&&UP(),p2(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function UP(){for(let e in jt.restoreStructures)jt[e]=jt.restoreStructures[e];jt.restoreStructures=null}function Ii(){let e=Fe[ae++];if(e<160)if(e<128){if(e<64)return e;{let t=jt[e&63]||Oa.getStructures&&bz()[e&63];return t?(t.read||(t.read=HE(t,e&63)),t.read()):e}}else if(e<144)if(e-=128,Oa.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[_z()]=Ii();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Ii(),Ii());return t}else{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=Ii();return t}else if(e<192){let t=e-160;if(jn>=ae)return zl.slice(ae-vs,(ae+=t)-vs);if(jn==0&&tc<140){let i=t<16?WE(t):wz(t);if(i!=null)return i}return d2(t)}else{let t;switch(e){case 192:return null;case 193:return Xa?(t=Ii(),t>0?Xa[1].slice(Xa.position1,Xa.position1+=t):Xa[0].slice(Xa.position0,Xa.position0-=t)):xz;case 194:return!1;case 195:return!0;case 196:return Tb(Fe[ae++]);case 197:return t=Xt.getUint16(ae),ae+=2,Tb(t);case 198:return t=Xt.getUint32(ae),ae+=4,Tb(t);case 199:return xc(Fe[ae++]);case 200:return t=Xt.getUint16(ae),ae+=2,xc(t);case 201:return t=Xt.getUint32(ae),ae+=4,xc(t);case 202:if(t=Xt.getFloat32(ae),Oa.useFloat32>2){let i=qE[(Fe[ae]&127)<<1|Fe[ae+1]>>7];return ae+=4,(i*t+(t>0?.5:-.5)>>0)/i}return ae+=4,t;case 203:return t=Xt.getFloat64(ae),ae+=8,t;case 204:return Fe[ae++];case 205:return t=Xt.getUint16(ae),ae+=2,t;case 206:return t=Xt.getUint32(ae),ae+=4,t;case 207:return Oa.int64AsNumber?(t=Xt.getUint32(ae)*4294967296,t+=Xt.getUint32(ae+4)):t=Xt.getBigUint64(ae),ae+=8,t;case 208:return Xt.getInt8(ae++);case 209:return t=Xt.getInt16(ae),ae+=2,t;case 210:return t=Xt.getInt32(ae),ae+=4,t;case 211:return Oa.int64AsNumber?(t=Xt.getInt32(ae)*4294967296,t+=Xt.getUint32(ae+4)):t=Xt.getBigInt64(ae),ae+=8,t;case 212:if(t=Fe[ae++],t==114)return qP(Fe[ae++]&63);{let i=xa[t];if(i)return i.read?(ae++,i.read(Ii())):i.noBuffer?(ae++,i()):i(Fe.subarray(ae,++ae));throw new Error("Unknown extension "+t)}case 213:return t=Fe[ae],t==114?(ae++,qP(Fe[ae++]&63,Fe[ae++])):xc(2);case 214:return xc(4);case 215:return xc(8);case 216:return xc(16);case 217:return t=Fe[ae++],jn>=ae?zl.slice(ae-vs,(ae+=t)-vs):Ite(t);case 218:return t=Xt.getUint16(ae),ae+=2,jn>=ae?zl.slice(ae-vs,(ae+=t)-vs):Rte(t);case 219:return t=Xt.getUint32(ae),ae+=4,jn>=ae?zl.slice(ae-vs,(ae+=t)-vs):Lte(t);case 220:return t=Xt.getUint16(ae),ae+=2,GP(t);case 221:return t=Xt.getUint32(ae),ae+=4,GP(t);case 222:return t=Xt.getUint16(ae),ae+=2,HP(t);case 223:return t=Xt.getUint32(ae),ae+=4,HP(t);default:if(e>=224)return e-256;if(e===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+e)}}}var Ote=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function HE(e,t){function i(){if(i.count++>2){let a=e.read=new Function("r","return function(){return {"+e.map(s=>Ote.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(Ii);return e.highByte===0&&(e.read=VP(t,e.read)),a()}let r={};for(let a=0,s=e.length;a<s;a++){let n=e[a];r[n]=Ii()}return r}return i.count=0,e.highByte===0?VP(t,i):i}var VP=(e,t)=>function(){let i=Fe[ae++];if(i===0)return t();let r=e<32?-(e+(i<<5)):e+(i<<5),a=jt[r]||bz()[r];if(!a)throw new Error("Record id is not defined for "+r);return a.read||(a.read=HE(a,e)),a.read()};function bz(){let e=Ez(()=>(Fe=null,Oa.getStructures()));return jt=Oa._mergeStructures(e,jt)}var d2=k1,Ite=k1,Rte=k1,Lte=k1;function k1(e){let t;if(e<16&&(t=WE(e)))return t;if(e>64&&u2)return u2.decode(Fe.subarray(ae,ae+=e));let i=ae+e,r=[];for(t="";ae<i;){let a=Fe[ae++];if(!(a&128))r.push(a);else if((a&224)===192){let s=Fe[ae++]&63;r.push((a&31)<<6|s)}else if((a&240)===224){let s=Fe[ae++]&63,n=Fe[ae++]&63;r.push((a&31)<<12|s<<6|n)}else if((a&248)===240){let s=Fe[ae++]&63,n=Fe[ae++]&63,o=Fe[ae++]&63,l=(a&7)<<18|s<<12|n<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(a);r.length>=4096&&(t+=xr.apply(String,r),r.length=0)}return r.length>0&&(t+=xr.apply(String,r)),t}function GP(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=Ii();return t}function HP(e){if(Oa.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[_z()]=Ii();return t}else{let t=new Map;for(let i=0;i<e;i++)t.set(Ii(),Ii());return t}}var xr=String.fromCharCode;function wz(e){let t=ae,i=new Array(e);for(let r=0;r<e;r++){let a=Fe[ae++];if((a&128)>0){ae=t;return}i[r]=a}return xr.apply(String,i)}function WE(e){if(e<4)if(e<2){if(e===0)return"";{let t=Fe[ae++];if((t&128)>1){ae-=1;return}return xr(t)}}else{let t=Fe[ae++],i=Fe[ae++];if((t&128)>0||(i&128)>0){ae-=2;return}if(e<3)return xr(t,i);let r=Fe[ae++];if((r&128)>0){ae-=3;return}return xr(t,i,r)}else{let t=Fe[ae++],i=Fe[ae++],r=Fe[ae++],a=Fe[ae++];if((t&128)>0||(i&128)>0||(r&128)>0||(a&128)>0){ae-=4;return}if(e<6){if(e===4)return xr(t,i,r,a);{let s=Fe[ae++];if((s&128)>0){ae-=5;return}return xr(t,i,r,a,s)}}else if(e<8){let s=Fe[ae++],n=Fe[ae++];if((s&128)>0||(n&128)>0){ae-=6;return}if(e<7)return xr(t,i,r,a,s,n);let o=Fe[ae++];if((o&128)>0){ae-=7;return}return xr(t,i,r,a,s,n,o)}else{let s=Fe[ae++],n=Fe[ae++],o=Fe[ae++],l=Fe[ae++];if((s&128)>0||(n&128)>0||(o&128)>0||(l&128)>0){ae-=8;return}if(e<10){if(e===8)return xr(t,i,r,a,s,n,o,l);{let c=Fe[ae++];if((c&128)>0){ae-=9;return}return xr(t,i,r,a,s,n,o,l,c)}}else if(e<12){let c=Fe[ae++],u=Fe[ae++];if((c&128)>0||(u&128)>0){ae-=10;return}if(e<11)return xr(t,i,r,a,s,n,o,l,c,u);let h=Fe[ae++];if((h&128)>0){ae-=11;return}return xr(t,i,r,a,s,n,o,l,c,u,h)}else{let c=Fe[ae++],u=Fe[ae++],h=Fe[ae++],d=Fe[ae++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){ae-=12;return}if(e<14){if(e===12)return xr(t,i,r,a,s,n,o,l,c,u,h,d);{let p=Fe[ae++];if((p&128)>0){ae-=13;return}return xr(t,i,r,a,s,n,o,l,c,u,h,d,p)}}else{let p=Fe[ae++],f=Fe[ae++];if((p&128)>0||(f&128)>0){ae-=14;return}if(e<15)return xr(t,i,r,a,s,n,o,l,c,u,h,d,p,f);let m=Fe[ae++];if((m&128)>0){ae-=15;return}return xr(t,i,r,a,s,n,o,l,c,u,h,d,p,f,m)}}}}}function Tb(e){return Oa.copyBuffers?Uint8Array.prototype.slice.call(Fe,ae,ae+=e):Fe.subarray(ae,ae+=e)}function xc(e){let t=Fe[ae++];if(xa[t])return xa[t](Fe.subarray(ae,ae+=e));throw new Error("Unknown extension type "+t)}var WP=new Array(4096);function _z(){let e=Fe[ae++];if(e>=160&&e<192){if(e=e-160,jn>=ae)return zl.slice(ae-vs,(ae+=e)-vs);if(!(jn==0&&tc<180))return d2(e)}else return ae--,Ii();let t=(e<<5^(e>1?Xt.getUint16(ae):e>0?Fe[ae]:0))&4095,i=WP[t],r=ae,a=ae+e-3,s,n=0;if(i&&i.bytes==e){for(;r<a;){if(s=Xt.getUint32(r),s!=i[n++]){r=1879048192;break}r+=4}for(a+=3;r<a;)if(s=Fe[r++],s!=i[n++]){r=1879048192;break}if(r===a)return ae=r,i.string;a-=3,r=ae}for(i=[],WP[t]=i,i.bytes=e;r<a;)s=Xt.getUint32(r),i.push(s),r+=4;for(a+=3;r<a;)s=Fe[r++],i.push(s);let o=e<16?WE(e):wz(e);return o!=null?i.string=o:i.string=d2(e)}var qP=(e,t)=>{var i=Ii();let r=e;t!==void 0&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let a=jt[e];return a&&a.isShared&&((jt.restoreStructures||(jt.restoreStructures=[]))[e]=a),jt[e]=i,i.read=HE(i,r),i.read()},Sz=typeof self=="object"?self:global;xa[0]=()=>{};xa[0].noBuffer=!0;xa[101]=()=>{let e=Ii();return(Sz[e[0]]||Error)(e[1])};xa[105]=e=>{let t=Xt.getUint32(ae-4);Ho||(Ho=new Map);let i=Fe[ae],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let a={target:r};Ho.set(t,a);let s=Ii();return a.used?Object.assign(r,s):(a.target=s,s)};xa[112]=e=>{let t=Xt.getUint32(ae-4),i=Ho.get(t);return i.used=!0,i.target};xa[115]=()=>new Set(Ii());var Az=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(e=>e+"Array");xa[116]=e=>{let t=e[0],i=Az[t];if(!i)throw new Error("Could not find typed array for code "+t);return new Sz[i](Uint8Array.prototype.slice.call(e,1).buffer)};xa[120]=()=>{let e=Ii();return new RegExp(e[0],e[1])};xa[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=ae;ae+=t-4,Xa=[Ii(),Ii()],Xa.position0=0,Xa.position1=0;let r=ae;ae=i;try{return Ii()}finally{ae=r}};xa[255]=e=>e.length==4?new Date((e[0]*16777216+(e[1]<<16)+(e[2]<<8)+e[3])*1e3):e.length==8?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+((e[3]&3)*4294967296+e[4]*16777216+(e[5]<<16)+(e[6]<<8)+e[7])*1e3):e.length==12?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+((e[4]&128?-281474976710656:0)+e[6]*1099511627776+e[7]*4294967296+e[8]*16777216+(e[9]<<16)+(e[10]<<8)+e[11])*1e3):new Date("invalid");function Ez(e){let t=tc,i=ae,r=vs,a=jn,s=zl,n=Ho,o=Xa,l=new Uint8Array(Fe.slice(0,tc)),c=jt,u=jt.slice(0,jt.length),h=Oa,d=Od,p=e();return tc=t,ae=i,vs=r,jn=a,zl=s,Ho=n,Xa=o,Fe=l,Od=d,jt=c,jt.splice(0,jt.length,...u),Oa=h,Xt=new DataView(Fe.buffer,Fe.byteOffset,Fe.byteLength),p}function p2(){Fe=null,Ho=null,jt=null}function kte(e){e.unpack?xa[e.type]=e.unpack:xa[e.type]=e}var qE=new Array(147);for(let e=0;e<256;e++)qE[e]=+("1e"+Math.floor(45.15-e*.30103));var z1=new gy({useRecords:!1});z1.unpack;z1.unpackMultiple;z1.unpack;var zte=new Float32Array(1);new Uint8Array(zte.buffer,0,4);var c0;try{c0=new TextEncoder}catch{}var vy,XE,N1=typeof Buffer<"u",Pb=N1?Buffer.allocUnsafeSlow:Uint8Array,Cz=N1?Buffer:Uint8Array,XP=N1?4294967296:2144337920,ye,Ni,he=0,vn,yn=null,Nte=/[\u0080-\uFFFF]/,Ip=Symbol("record-id"),Mz=class extends gy{constructor(e){super(e),this.offset=0;let t,i,r,a,s,n=0,o=Cz.prototype.utf8Write?function(_,A,E){return ye.utf8Write(_,A,E)}:c0&&c0.encodeInto?function(_,A){return c0.encodeInto(_,ye.subarray(A)).written}:!1,l=this;e||(e={});let c=e&&e.sequential,u=e.structures||e.saveStructures,h=e.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=e.maxOwnStructures;d==null&&(d=u?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=h>32||d+h>64,f=h+64,m=h+d+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(_,A){if(ye||(ye=new Pb(8192),Ni=new DataView(ye.buffer,0,8192),he=0),vn=ye.length-10,vn-he<2048?(ye=new Pb(ye.length),Ni=new DataView(ye.buffer,0,ye.length),vn=ye.length-10,he=0):he=he+7&2147483640,t=he,s=l.structuredClone?new Map:null,l.bundleStrings?(yn=["",""],ye[he++]=214,ye[he++]=98,yn.position=he-t,he+=4):yn=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let E=i.sharedLength||0;if(E>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let M=0;M<E;M++){let C=i[M];if(!C)continue;let T,D=i.transitions;for(let I=0,O=C.length;I<O;I++){let B=C[I];T=D[B],T||(T=D[B]=Object.create(null)),D=T}D[Ip]=M+64}n=E}c||(i.nextId=E+64)}r&&(r=!1),a=i||[];try{if(x(_),yn){Ni.setUint32(yn.position+t,he-yn.position-t);let E=yn;yn=null,x(E[0]),x(E[1])}if(l.offset=he,s&&s.idsToInsert){he+=s.idsToInsert.length*6,he>vn&&S(he),l.offset=he;let E=jte(ye.subarray(t,he),s.idsToInsert);return s=null,E}return A&Fte?(ye.start=t,ye.end=he,ye):ye.subarray(t,he)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let E=0,M=g.length;E<M;E++)g[E][Ip]=0;g=[]}if(r&&l.saveStructures){let E=i.sharedLength||h;i.length>E&&(i=i.slice(0,E));let M=ye.subarray(t,he);return l.saveStructures(i,n)===!1?(l._mergeStructures(l.getStructures()),l.pack(_)):(n=E,M)}}A&Ute&&(he=t)}};let x=_=>{he>vn&&(ye=S(he));var A=typeof _,E;if(A==="string"){let M=_.length;if(yn&&M>=8&&M<4096){let D=Nte.test(_);yn[D?0:1]+=_,ye[he++]=193,x(D?-M:M);return}let C;M<32?C=1:M<256?C=2:M<65536?C=3:C=5;let T=M*3;if(he+T>vn&&(ye=S(he+T)),M<64||!o){let D,I,O,B=he+C;for(D=0;D<M;D++)I=_.charCodeAt(D),I<128?ye[B++]=I:I<2048?(ye[B++]=I>>6|192,ye[B++]=I&63|128):(I&64512)===55296&&((O=_.charCodeAt(D+1))&64512)===56320?(I=65536+((I&1023)<<10)+(O&1023),D++,ye[B++]=I>>18|240,ye[B++]=I>>12&63|128,ye[B++]=I>>6&63|128,ye[B++]=I&63|128):(ye[B++]=I>>12|224,ye[B++]=I>>6&63|128,ye[B++]=I&63|128);E=B-he-C}else E=o(_,he+C,T);E<32?ye[he++]=160|E:E<256?(C<2&&ye.copyWithin(he+2,he+1,he+1+E),ye[he++]=217,ye[he++]=E):E<65536?(C<3&&ye.copyWithin(he+3,he+2,he+2+E),ye[he++]=218,ye[he++]=E>>8,ye[he++]=E&255):(C<5&&ye.copyWithin(he+5,he+3,he+3+E),ye[he++]=219,Ni.setUint32(he,E),he+=4),he+=E}else if(A==="number")if(_>>>0===_)_<64?ye[he++]=_:_<256?(ye[he++]=204,ye[he++]=_):_<65536?(ye[he++]=205,ye[he++]=_>>8,ye[he++]=_&255):(ye[he++]=206,Ni.setUint32(he,_),he+=4);else if(_>>0===_)_>=-32?ye[he++]=256+_:_>=-128?(ye[he++]=208,ye[he++]=_+256):_>=-32768?(ye[he++]=209,Ni.setInt16(he,_),he+=2):(ye[he++]=210,Ni.setInt32(he,_),he+=4);else{let M;if((M=this.useFloat32)>0&&_<4294967296&&_>=-2147483648){ye[he++]=202,Ni.setFloat32(he,_);let C;if(M<4||(C=_*qE[(ye[he]&127)<<1|ye[he+1]>>7])>>0===C){he+=4;return}else he--}ye[he++]=203,Ni.setFloat64(he,_),he+=8}else if(A==="object")if(!_)ye[he++]=192;else{if(s){let C=s.get(_);if(C){if(!C.id){let T=s.idsToInsert||(s.idsToInsert=[]);C.id=T.push(C)}ye[he++]=214,ye[he++]=112,Ni.setUint32(he,C.id),he+=4;return}else s.set(_,{offset:he-t})}let M=_.constructor;if(M===Object)w(_,!0);else if(M===Array){E=_.length,E<16?ye[he++]=144|E:E<65536?(ye[he++]=220,ye[he++]=E>>8,ye[he++]=E&255):(ye[he++]=221,Ni.setUint32(he,E),he+=4);for(let C=0;C<E;C++)x(_[C])}else if(M===Map){E=_.size,E<16?ye[he++]=128|E:E<65536?(ye[he++]=222,ye[he++]=E>>8,ye[he++]=E&255):(ye[he++]=223,Ni.setUint32(he,E),he+=4);for(let[C,T]of _)x(C),x(T)}else{for(let C=0,T=vy.length;C<T;C++){let D=XE[C];if(_ instanceof D){let I=vy[C];if(I.write){I.type&&(ye[he++]=212,ye[he++]=I.type,ye[he++]=0),x(I.write.call(this,_));return}let O=ye,B=Ni,q=he;ye=null;let F;try{F=I.pack.call(this,_,L=>(ye=O,O=null,he+=L,he>vn&&S(he),{target:ye,targetView:Ni,position:he-L}),x)}finally{O&&(ye=O,Ni=B,he=q,vn=ye.length-10)}F&&(F.length+he>vn&&S(F.length+he),he=Bte(F,ye,he,I.type));return}}w(_,!_.hasOwnProperty)}}else if(A==="boolean")ye[he++]=_?195:194;else if(A==="bigint"){if(_<BigInt(1)<<BigInt(63)&&_>=-(BigInt(1)<<BigInt(63)))ye[he++]=211,Ni.setBigInt64(he,_);else if(_<BigInt(1)<<BigInt(64)&&_>0)ye[he++]=207,Ni.setBigUint64(he,_);else if(this.largeBigIntToFloat)ye[he++]=203,Ni.setFloat64(he,Number(_));else throw new RangeError(_+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");he+=8}else if(A==="undefined")this.encodeUndefinedAsNil?ye[he++]=192:(ye[he++]=212,ye[he++]=0,ye[he++]=0);else if(A==="function")x(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+A)},w=this.useRecords===!1?this.variableMapSize?_=>{let A=Object.keys(_),E=A.length;E<16?ye[he++]=128|E:E<65536?(ye[he++]=222,ye[he++]=E>>8,ye[he++]=E&255):(ye[he++]=223,Ni.setUint32(he,E),he+=4);let M;for(let C=0;C<E;C++)x(M=A[C]),x(_[M])}:(_,A)=>{ye[he++]=222;let E=he-t;he+=2;let M=0;for(let C in _)(A||_.hasOwnProperty(C))&&(x(C),x(_[C]),M++);ye[E+++t]=M>>8,ye[E+t]=M&255}:_=>{let A=Object.keys(_),E,M=a.transitions||(a.transitions=Object.create(null)),C=0;for(let D=0,I=A.length;D<I;D++){let O=A[D];E=M[O],E||(E=M[O]=Object.create(null),C++),M=E}let T=M[Ip];if(T)T>=96&&p?(ye[he++]=((T-=96)&31)+96,ye[he++]=T>>5):ye[he++]=T;else{T=a.nextId,T||(T=64),T<f&&this.shouldShareStructure&&!this.shouldShareStructure(A)?(T=a.nextOwnId,T<m||(T=f),a.nextOwnId=T+1):(T>=m&&(T=f),a.nextId=T+1);let D=A.highByte=T>=96&&p?T-96>>5:-1;M[Ip]=T,a[T-64]=A,T<f?(A.isShared=!0,a.sharedLength=T-63,r=!0,D>=0?(ye[he++]=(T&31)+96,ye[he++]=D):ye[he++]=T):(D>=0?(ye[he++]=213,ye[he++]=114,ye[he++]=(T&31)+96,ye[he++]=D):(ye[he++]=212,ye[he++]=114,ye[he++]=T),C&&(v+=y*C),g.length>=d&&(g.shift()[Ip]=0),g.push(M),x(A))}for(let D=0,I=A.length;D<I;D++)x(_[A[D]])},S=_=>{let A;if(_>16777216){if(_-t>XP)throw new Error("Packed buffer would be larger than maximum buffer size");A=Math.min(XP,Math.round(Math.max((_-t)*(_>67108864?1.25:2),4194304)/4096)*4096)}else A=(Math.max(_-t<<2,ye.length-1)>>12)+1<<12;let E=new Pb(A);return Ni=new DataView(E.buffer,0,A),ye.copy?ye.copy(E,0,t,_):E.set(ye.slice(t,_)),he-=t,t=0,vn=E.length-10,ye=E}}useBuffer(e){ye=e,Ni=new DataView(ye.buffer,ye.byteOffset,ye.byteLength),he=0}};XE=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,yz];vy=[{pack(e,t,i){let r=e.getTime()/1e3;if((this.useTimestamp32||e.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:a,targetView:s,position:n}=t(6);a[n++]=214,a[n++]=255,s.setUint32(n,r)}else if(r>0&&r<17179869184){let{target:a,targetView:s,position:n}=t(10);a[n++]=215,a[n++]=255,s.setUint32(n,e.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(n+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:a,targetView:s,position:n}=t(3);a[n++]=212,a[n++]=255,a[n++]=255}else{let{target:a,targetView:s,position:n}=t(15);a[n++]=199,a[n++]=12,a[n++]=255,s.setUint32(n,e.getMilliseconds()*1e6),s.setBigInt64(n+4,BigInt(Math.floor(r)))}}},{pack(e,t,i){let r=Array.from(e),{target:a,position:s}=t(this.structuredClone?3:0);this.structuredClone&&(a[s++]=212,a[s++]=115,a[s++]=0),i(r)}},{pack(e,t,i){let{target:r,position:a}=t(this.structuredClone?3:0);this.structuredClone&&(r[a++]=212,r[a++]=101,r[a++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:r,position:a}=t(this.structuredClone?3:0);this.structuredClone&&(r[a++]=212,r[a++]=120,r[a++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?YP(e,16,t):QP(N1?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==Cz&&this.structuredClone?YP(e,Az.indexOf(i.name),t):QP(e,t)}},{pack(e,t){let{target:i,position:r}=t(1);i[r]=193}}];function YP(e,t,i,r){let a=e.byteLength;if(a+1<256){var{target:s,position:n}=i(4+a);s[n++]=199,s[n++]=a+1}else if(a+1<65536){var{target:s,position:n}=i(5+a);s[n++]=200,s[n++]=a+1>>8,s[n++]=a+1&255}else{var{target:s,position:n,targetView:o}=i(7+a);s[n++]=201,o.setUint32(n,a+1),n+=4}s[n++]=116,s[n++]=t,s.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),n)}function QP(e,t){let i=e.byteLength;var r,a;if(i<256){var{target:r,position:a}=t(i+2);r[a++]=196,r[a++]=i}else if(i<65536){var{target:r,position:a}=t(i+3);r[a++]=197,r[a++]=i>>8,r[a++]=i&255}else{var{target:r,position:a,targetView:s}=t(i+5);r[a++]=198,s.setUint32(a,i),a+=4}r.set(e,a)}function Bte(e,t,i,r){let a=e.length;switch(a){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:a<256?(t[i++]=199,t[i++]=a):a<65536?(t[i++]=200,t[i++]=a>>8,t[i++]=a&255):(t[i++]=201,t[i++]=a>>24,t[i++]=a>>16&255,t[i++]=a>>8&255,t[i++]=a&255)}return t[i++]=r,t.set(e,i),i+=a,i}function jte(e,t){let i,r=t.length*6,a=e.length-r;for(t.sort((s,n)=>s.offset>n.offset?1:-1);i=t.pop();){let s=i.offset,n=i.id;e.copyWithin(s+r,s,a),r-=6;let o=s+r;e[o++]=214,e[o++]=105,e[o++]=n>>24,e[o++]=n>>16&255,e[o++]=n>>8&255,e[o++]=n&255,a=s}return e}function sp(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");XE.unshift(e.Class),vy.unshift(e)}kte(e)}var Tz=new Mz({useRecords:!1});Tz.pack;Tz.pack;var Fte=512,Ute=1024,ZP=new Mz({structuredClone:!0});sp({Class:ft.prototype.constructor,type:1,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,ft.prototype),e}});sp({Class:Je.prototype.constructor,type:2,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,Je.prototype),e}});sp({Class:jr.prototype.constructor,type:3,write(e){return[...e]},read(e){return Object.setPrototypeOf(e,jr.prototype),e}});sp({Class:BP.prototype.constructor,type:4,write(e){return e.id},read(e){return new BP(e)}});sp({Class:jP.prototype.constructor,type:5,write(e){return e.data},read(e){return new jP(e)}});sp({Class:rr.prototype.constructor,type:6,write(e){return{...e}},read(e){return Object.setPrototypeOf(e,rr.prototype),e}});function Vte(e){var t=0;if(e.length===0)return t;for(let i=0;i<e.length;i++){let r=e[i];t=(t<<5)-t+r,t=t&t}return t}function f2(e){if(jE(e))return e;if(Array.isArray(e))return e.map(f2);if(typeof e=="object"&&e!==null){let t={};for(let i of Object.keys(e).sort())t[i]=f2(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}else return e}var m2;(e=>{function t(a){return ZP.pack(a)}e.serialize=t;function i(a){return ZP.unpack(a)}e.deserialize=i;function r(a){return Vte(t(f2(a))).toString()}e.checksum=r})(m2||(m2={}));var KP;(e=>{function t(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}e.toEventUIType=t;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}e.fromEventUIType=i})(KP||(KP={}));var Ca={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]},$P;(e=>{function t(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}e.is=t;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,runMode:"Once",actions:new Je}:{type:r,disabled:!1,key:void 0,runMode:"Once",actions:new Je}}e.defaultData=i})($P||($P={}));var yy;(e=>{function t(i){return{type:"Property",value:[i??null,"position","x"]}}e.propertyDefaultData=t,e.valueDefaultData={type:"Literal",value:0}})(yy||(yy={}));var g2;(e=>{function t(a){return{type:"Comparison",operator:"==",lOperand:yy.propertyDefaultData(a),rOperand:{...yy.valueDefaultData}}}e.comparisonDefaultData=t;function i(a){return{type:"Distance",toObject:a??null,fromObject:a??null,distance:200}}e.distanceDefaultData=i;function r(a,s){return{type:"State",object:a??null,state:s??null}}e.stateDefaultData=r})(g2||(g2={}));var JP;(e=>{function t(r){return r.type==="Conditional"}e.is=t;function i(r){return{type:"Conditional",disabled:!1,inActions:new Je,outActions:new Je,condition:g2.distanceDefaultData(r)}}e.defaultData=i})(JP||(JP={}));var eD;(e=>e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new Je,drop:new Je}})(eD||(eD={}));var v2;(e=>e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new Je})(v2||(v2={}));var y2;(e=>e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(y2||(y2={}));var tD;(e=>{function t(r){return r.type==="MouseHover"}e.is=t;function i(){return{type:"MouseHover",disabled:!1,actions:new Je}}e.defaultData=i})(tD||(tD={}));var iD;(e=>{function t(r){return r.type==="Scroll"}e.is=t;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new Je}}e.defaultData=i})(iD||(iD={}));var rD;(e=>{function t(r){return r.type==="Start"}e.is=t;function i(){return{type:"Start",disabled:!1,actions:new Je}}e.defaultData=i})(rD||(rD={}));var aD;(e=>{function t(r){return r.type==="Collision"}e.is=t;function i(){return{type:"Collision",disabled:!1,runMode:"Once",target:"character",actions:new Je}}e.defaultData=i})(aD||(aD={}));var sD;(e=>{function t(r){return r.type==="Trigger"}e.is=t;function i(r,a){return{type:"Trigger",disabled:!1,runMode:"Once",target:"all",triggeringObjects:[],actions:new Je,triggerZone:"box",position:a.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}e.defaultData=i})(sD||(sD={}));var x2;(e=>{e.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function t(n){return n.type==="Resize"}e.is=t;function i(n){return typeof n=="string"?n:"custom"}e.sizeToDevice=i;function r(n){return typeof n=="string"?[...e.defaultSizes[n]]:[...n]}e.deviceToSize=r;function a(){let n={size:"mobile",operator:"<",actions:new Je},o={size:"tablet",operator:"<",actions:new Je},l={size:[...e.defaultSizes.custom],operator:"<>",actions:new Je},c=new Je;return c.push({id:Ge.generateUUID(),fi:0,data:n},{id:Ge.generateUUID(),fi:1,data:o},{id:Ge.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}e.defaultData=a;function s(){return{size:[...e.defaultSizes.custom],operator:"<>",actions:new Je}}e.defaultBreakpointData=s})(x2||(x2={}));var b2;(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function t(r){return r.type==="VariableChange"}e.is=t;function i(){return{disabled:!1,type:"VariableChange",actions:new Je,variableId:"",objectId:null,property:"Position X"}}e.defaultData=i})(b2||(b2={}));var np="personal camera",Df="a218fcc3-276b-49b9-b485-49037fd14f5f",Gte=2960946,as=5526619,Nl;(e=>{function t(d,p){return d[0]===p[0]&&d[1]===p[1]}e.isEqual=t;function i(d,p,f){return[d[0]+(p[0]-d[0])*f,d[1]+(p[1]-d[1])*f]}e.lerp=i;function r(d,p){return[d[0]+p[0],d[1]+p[1]]}e.add=r;function a(d,p){return[d[0]-p[0],d[1]-p[1]]}e.sub=a;function s(d,p){return Math.pow(p[0]-d[0],2)+Math.pow(p[1]-d[1],2)}e.distanceSquared=s;function n(d,p){return Math.sqrt(s(d,p))}e.distance=n;function o(d,p){return d[0]*p[0]+d[1]*p[1]}e.dot=o;function l(d,p){return[d[0]*p,d[1]*p]}e.scalarMultiply=l;function c(d,p,f){let m=e.sub(p,d),g=e.sub(f,d),v=e.dot(m,g)/e.dot(m,m),y=e.scalarMultiply(m,v);return e.add(d,y)}e.projectionOnto=c;function u(d,p,f){return n(d,c(d,p,f))}e.projectionOntoDistance=u;function h(d,p){return[(d[0]+p[0])*.5,(d[1]+p[1])*.5]}e.center=h})(Nl||(Nl={}));var ih;(e=>{function t(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}e.isEqual=t;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}e.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}e.sub=r;function a(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}e.div=a;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}e.mul=s;function n(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}e.dist=n;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}e.lerp=o})(ih||(ih={}));var xy;(e=>{function t(r,a){return r[0]===a[0]&&r[1]===a[1]&&r[2]===a[2]&&r[3]===a[3]}e.isEqual=t;function i(r,a,s){return[r[0]+(a[0]-r[0])*s,r[1]+(a[1]-r[1])*s,r[2]+(a[2]-r[2])*s,r[3]+(a[3]-r[3])*s]}e.lerp=i})(xy||(xy={}));var Id;(e=>{e.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function t(a,s){for(let n=0;n<16;n++)if(a[n]!==s[n])return!1;return!0}e.isEqual=t;function i(a){return a??e.identity}e.simplify=i;function r(a,s){let n=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=a[3]*s[o]+a[7]*s[o+1]+a[11]*s[o+2]+a[15];n[o]=(a[0]*s[o]+a[4]*s[o+1]+a[8]*s[o+2]+a[12])/c,n[o+1]=(a[1]*s[o]+a[5]*s[o+1]+a[9]*s[o+2]+a[13])/c,n[o+2]=(a[2]*s[o]+a[6]*s[o+1]+a[10]*s[o+2]+a[14])/c}return n}e.applyMatrix4=r})(Id||(Id={}));var Zr;(e=>{function t(c){return typeof c=="object"&&typeof c.r=="number"&&typeof c.g=="number"&&typeof c.b=="number"}e.isRGB=t,e.white={r:1,g:1,b:1},e.red={r:1,g:0,b:0},e.black={r:0,g:0,b:0};function i(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:1}}e.toRgb255a1=i;function r(c){return{r:c.r,g:c.g,b:c.b}}e.clone=r;function a(c){return c=Math.floor(c),{r:(c>>16&255)/255,g:(c>>8&255)/255,b:(c&255)/255}}e.fromHex=a;function s(c){return Math.round(c.r*255)*65536+Math.round(c.g*255)*256+Math.round(c.b*255)}e.toHex=s;function n(c,u){return c.r===u.r&&c.g===u.g&&c.b===u.b}e.equals=n;function o(c,u){return c.r.toFixed(2)===u.r.toFixed(2)&&c.g.toFixed(2)===u.g.toFixed(2)&&c.b.toFixed(2)===u.b.toFixed(2)}e.equalsFixed=o;function l(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h}}e.lerp=l})(Zr||(Zr={}));var Jt;(e=>{e.white={...Zr.white,a:1},e.transparent={...Zr.white,a:0};function t(l){return{r:l[0],g:l[1],b:l[2],a:l[3]}}e.from0to1=t;function i(l,c){return{...Zr.fromHex(l),a:c}}e.fromHexAndA=i;function r(l){return{r:Math.round(l.r*255),g:Math.round(l.g*255),b:Math.round(l.b*255),a:l.a}}e.toRgb255a1=r;function a(l,c){return Zr.equals(l,c)&&l.a===c.a}e.equals=a;function s(l,c){return Zr.equalsFixed(l,c)&&l.a.toFixed(2)===c.a.toFixed(2)}e.equalsFixed=s;function n(l,c,u){return{r:l.r+(c.r-l.r)*u,g:l.g+(c.g-l.g)*u,b:l.b+(c.b-l.b)*u,a:l.a+(c.a-l.a)*u}}e.lerp=n;function o({r:l,g:c,b:u,a:h}=e.white){return`rgba(${l*255}, ${c*255}, ${u*255}, ${h})`}e.toStyle=o})(Jt||(Jt={}));var w2;(e=>e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(w2||(w2={}));var nD;(e=>e.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(nD||(nD={}));var oD;(e=>e.defaultData={control1:[.5,0],control2:[.5,1]})(oD||(oD={}));var El;(e=>(e.linear=[0,0,1,1],e.ease=[.25,.1,.25,1],e.easeIn=[.42,0,1,1],e.easeOut=[0,0,.58,1],e.easeInOut=[.42,0,.58,1]))(El||(El={}));function lD(e){return typeof e=="string"&&e.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e):!1}var gh;(e=>{e.all=["PerspectiveCamera","OrthographicCamera"];function t(i){return e.all.includes(i)}e.is=t})(gh||(gh={}));var Rd;(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset};function t(i){return i.type==="PerspectiveCamera"?i.perspective.zoom:i.orthographic.zoom}e.getZoom=t})(Rd||(Rd={}));var Bl;(e=>{function t(r,a=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(r[0],r[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[r[0]+r[0]*a,0,0]},grid:{count:[2,2,2],size:r.map(s=>s*(1+a)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}e.defaultData=t;function i(r,a){let s={...r};if(Pz.forEach(n=>{Object.assign(s,{[n]:a[n]??r[n]})}),s.radial={...r.radial},a.radial){let n=r.radial,o=a.radial;Dz.forEach(l=>{Object.assign(s.radial,{[l]:o[l]??n[l]})})}if(s.linear={...r.linear},a.linear){let n=r.linear,o=a.linear;Oz.forEach(l=>{Object.assign(s.linear,{[l]:o[l]??n[l]})})}if(s.grid={...r.grid},a.grid){let n=r.grid,o=a.grid;Iz.forEach(l=>{Object.assign(s.grid,{[l]:o[l]??n[l]})})}if(s.toObject={...r.toObject},a.toObject){let n=r.toObject,o=a.toObject;Rz.forEach(l=>{Object.assign(s.toObject,{[l]:o[l]??n[l]})})}if(s.randomnessObject={...r.randomnessObject},a.randomnessObject){let n=r.randomnessObject,o=a.randomnessObject;Lz.forEach(l=>{Object.assign(s.randomnessObject,{[l]:o[l]??n[l]})})}return s}e.merge=i})(Bl||(Bl={}));var _2;(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];function i(r,a){let s=[];r.count!==void 0&&s.push({type:0,path:a,props:{count:r.count}});for(let n of t){let o=r[n];o&&Object.keys(o).length>0&&s.push({type:0,path:[...a,n],props:o})}return s}e.toOps=i})(_2||(_2={}));var Pz=["count"],Dz=["radius","start","end","position","scale","rotation"],Oz=["position","scale","rotation"],Iz=["count","size"],Rz=["count","position","scale","rotation"],Lz=["strength","scale","rotation","position","movement","seed","freqScale"],S2;(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function t(i){return e.all.includes(i)}e.is=t})(S2||(S2={}));var A2;(e=>{function t(r){return i(r)}e.defaultData=t;function i(r){if(r==="PointLight")return{type:r,color:Jt.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:Jt.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Jt.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(A2||(A2={}));var by;(e=>(e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeLoopDelayStart:"end",emitTimeDuration:1,...e.defaultCollisionData}))(by||(by={}));var Ld;(e=>e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(Ld||(Ld={}));var E2;(e=>{e.defaultData={castShadow:!0,receiveShadow:!0};function t(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}e.equals=t})(E2||(E2={}));var C2;(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0};function t(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}e.equals=t})(C2||(C2={}));var M2;(e=>e.defaultData={...C2.defaultData,...E2.defaultData})(M2||(M2={}));var cD;(e=>{function t(i,r){var s,n;let a=[];if("material"in i){let o=typeof i.material=="string"?r.materials[i.material]??((s=r.lib.materials[i.material])==null?void 0:s.asset):i.material;o&&a.push(o)}else if("materials"in i)for(let o of i.materials){let l=typeof o=="string"?r.materials[o]??((n=r.lib.materials[o])==null?void 0:n.asset):o;l&&a.push(l)}return a}e.getMaterialData=t})(cD||(cD={}));var wy;(e=>(e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7))(wy||(wy={}));var hD;(e=>{function t(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}e.is=t})(hD||(hD={}));function Hte(e){return e.type!=="displace"}var uD;(e=>{function t(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}e.is=t})(uD||(uD={}));var kz=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],Wte=["wrapping","image","video","name","minFilter"],br;(e=>{function t(s,n){let{texture:o,...l}=n;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}e.patch=t;function i(s,n){return s==="light"&&n?r(n):a(s)}e.defaultData=i;function r(s){let n={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...n,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...n,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...n,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...n,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function a(s){let n={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...n,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],minFilter:1008},crop:!1};case"video":return{...n,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:wy.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],minFilter:1008},crop:!1};case"color":return{...n,type:"color",color:Zr.fromHex(as)};case"depth":return{...n,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...n,type:"normal",cnormal:[1,1,1]};case"gradient":return{...n,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...n,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...Zr.fromHex(6710886),a:1},colorB:{...Zr.fromHex(6710886),a:1},colorC:{...Zr.fromHex(16777215),a:1},colorD:{...Zr.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...n,type:"fresnel",color:Jt.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...n,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...n,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Jt.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...n,type:"outline",outlineColor:Jt.fromHexAndA(0,1),contourColor:Jt.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...n,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],minFilter:1008}};case"transmission":return{...n,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...n,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...Zr.fromHex(0),a:1},colorB:{...Zr.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(br||(br={}));var ra;(e=>{function t(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}e.isMergable=t;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([p,f])=>{h+=`${p}${f}`,Array.isArray(f)?f.forEach(m=>h+=`${m}`):typeof f=="object"?Object.values(f).forEach(m=>{typeof m=="number"?h+=`${m.toFixed(4)}`:h+=`${m}`}):h+=`${f}`})}),h}e.getHash=i;function r(){return{layers:new Je}}e.defaultEmptyData=r;function a(u="layer1",h="layer2"){return n("phong",u,h)}e.defaultData=a;function s(u,h){return{...u,name:h}}e.withName=s;function n(u,h="layer1",d="layer2"){let p=new Je;return p.push({fi:0,data:br.defaultData("light",u),id:h}),p.push({fi:1,data:br.defaultData("color"),id:d}),{layers:p}}e.defaultTwoLayerData=n;function o(u){let h=br.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new Je;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...br.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...br.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}e.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",p="layer2"){let f=br.defaultData("texture");Object.assign(f.texture,{image:u});let m=new Je;return m.push({fi:0,data:f,id:d}),m.push({fi:1,data:br.defaultData("light",h),id:p}),{layers:m}}e.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",p="layer2"){let f=br.defaultData("video");Object.assign(f.texture,{video:u});let m=new Je;return m.push({fi:0,data:f,id:d}),m.push({fi:1,data:br.defaultData("light",h),id:p}),{layers:m}}e.defaultTwoLayerVideoTextureData=c})(ra||(ra={}));var _y;(e=>{function t(){return{points:new Je,roundness:0,shapeHoles:[],isClosed:!1}}e.defaultData=t})(_y||(_y={}));var Sy;(e=>{function t(){return{points:new Je,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}e.defaultData=t})(Sy||(Sy={}));var zz={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},T2;(e=>{function t(i,r){let a={...i};return Bz.forEach(s=>{Object.assign(a,{[s]:r[s]??i[s]})}),a}e.merge=t})(T2||(T2={}));var Nz={shape:zz,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},Bz=["depth","offset","angle","twist","startScale","endScale"],Ay;(e=>{function t(r){return r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="UIGeometry"}e.is2DParametricMesh=t;function i(r){return r==="PolygonGeometry"||r==="PolygonGeometry"||r==="RectangleGeometry"||r==="StarGeometry"||r==="TriangleGeometry"||r==="EllipseGeometry"||r==="PathGeometry"||r==="VectorGeometry"||r==="ConeGeometry"||r==="CubeGeometry"||r==="CylinderGeometry"||r==="DodecahedronGeometry"||r==="HelixGeometry"||r==="IcosahedronGeometry"||r==="LatheGeometry"||r==="PyramidGeometry"||r==="SphereGeometry"||r==="PlaneGeometry"||r==="BackdropGeometry"||r==="TorusGeometry"||r==="TorusKnotGeometry"||r==="BooleanGeometry"||r==="TextGeometry"}e.isParametricMesh=i})(Ay||(Ay={}));var P2;(e=>{function t(i,r){let a={...i};return Object.assign(a,r),a.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(a.extrusion={...i.extrusion},Object.assign(a.extrusion,T2.merge(a.extrusion,r.extrusion))),a}e.merge=t})(P2||(P2={}));var id;(e=>{function t(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:Sy.defaultData(),extrusion:Nz};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:_y.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}e.defaultData=t})(id||(id={}));var dD=["width","height","depth"],D2;(e=>e.defaultData={enabled:!1,useBackgroundColor:!1,color:Zr.white,near:.1,far:2e3})(D2||(D2={}));var Ey;(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focalLength:2,focusDistance:2,bokehScale:2},noise:{...t,blendFunction:16}}})(Ey||(Ey={}));var O2;(e=>e.defaultData={softShadowQuality:"low"})(O2||(O2={}));var I2;(e=>e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(I2||(I2={}));var R2;(e=>e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(R2||(R2={}));var kd;(e=>e.defaultData={usePhysics:!1,gravity:-10})(kd||(kd={}));var L2;(e=>e.defaultData={playCamera:np,gameControlObject:null})(L2||(L2={}));var k2;(e=>e.defaultData={backgroundColor:Jt.fromHexAndA(Gte,1),postprocessing:Ey.defaultData,fog:D2.defaultData,globalPhysics:kd.defaultData,ambient:I2.defaultData,ao:R2.defaultData,shadow:O2.defaultData,publish:L2.defaultData})(k2||(k2={}));var z2;(e=>e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(z2||(z2={}));var pD;(e=>{function t(r){return r==="Component"||r==="Instance"}e.isComponentRelated=t;function i(r){return r==="Empty"||r==="Instance"}e.isEmptyOrComponent=i})(pD||(pD={}));var zd;(e=>{e.identity={...w2.identity,hiddenMatrix:Id.identity};function t(a){return{position:a.position,rotation:a.rotation,scale:a.scale,hiddenMatrix:a.hiddenMatrix}}e.fromObject=t;function i(a,s){return{position:(s==null?void 0:s.position)||a.position,rotation:(s==null?void 0:s.rotation)||a.rotation,scale:(s==null?void 0:s.scale)||a.scale,hiddenMatrix:(s==null?void 0:s.hiddenMatrix)||a.hiddenMatrix}}e.merge=i;function r(a,s){return tz({position:ih.isEqual(a.position,s.position)?void 0:s.position,rotation:ih.isEqual(a.rotation,s.rotation)?void 0:s.rotation,scale:ih.isEqual(a.scale,s.scale)?null:s.scale,hiddenMatrix:Id.isEqual(a.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}e.diff=r})(zd||(zd={}));var Ur;(e=>e.defaultData={states:new Je,events:new Je,visible:!0,raycastLock:!1,physics:Ld.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...zd.identity,cloner:null})(Ur||(Ur={}));var N2;(e=>e.defaultData={type:"Empty",...Ur.defaultData})(N2||(N2={}));var fD;(e=>e.defaultData={type:"ParticleCollider",...z2.defaultData,...Ur.defaultData})(fD||(fD={}));var mD;(e=>e.defaultData={type:"Component",...Ur.defaultData})(mD||(mD={}));var gD;(e=>e.defaultData={type:"Particle",...Ur.defaultData,...by.defaultData})(gD||(gD={}));var rd;(e=>e.defaultData={type:"Mesh",...Ur.defaultData,...M2.defaultData})(rd||(rd={}));var mm;(e=>e.defaultData={...Ur.defaultData,...zd.identity,position:[0,0,Rd.DefaultTargetOffset],...Rd.defaultData})(mm||(mm={}));var B2;(e=>{function t(i){return{...Ur.defaultData,...A2.defaultData(i)}}e.defaultData=t,e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(B2||(B2={}));var Cy;(e=>{function t(r,a,s=0){for(;s<a.length;){let n=r?r[a[s]]:void 0;if(a.length===s+1)return n;if(n)r=n.descendants,s+=1;else return}}e.resolveWithDes=t;function i(r,a,s=0){let n=t(r,a,s);if(n){let o=Object.keys(n);if(o.length===1&&o[0]==="descendants")return}return n}e.resolve=i})(Cy||(Cy={}));var jl;(e=>{e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"];function t(r,a){return{...Ur.defaultData,...a,component:r,overrides:new rr,physics:void 0,events:void 0,type:"Instance"}}e.ofComponent=t;function i(r){let a=zd.fromObject(r.data);return t(r.id,a)}e.fromComponentData=i})(jl||(jl={}));var Nd;(e=>{e.defaultData={type:"Page",...Ur.defaultData,physics:{...Ld.defaultData,fusedBody:!1},...k2.defaultData,camera:mm.defaultData};function t(i){return i.uiScene!==void 0}e.isUIPage=t})(Nd||(Nd={}));var j2;(e=>(e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:Id.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:Ld.defaultData,states:new Je,events:new Je,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...Rd.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...Ur.defaultData,...rd.defaultData,geometry:id.defaultData("RectangleGeometry"),material:ra.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...Ur.defaultData,...rd.defaultData,geometry:id.defaultData("BooleanGeometry"),material:ra.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...Ur.defaultData,...rd.defaultData,geometry:id.defaultData("TextGeometry"),material:ra.defaultTwoLayerData("phong","layer1","layer2")}))(j2||(j2={}));var Vc;(e=>{function t(s,n){let o={name:n};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new rr}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new rr})))):gh.is(s.type)&&(o.perspective={},o.orthographic={}),o}e.newEmpty=t;function i(s,n){if(n===void 0)return s;let o={...s};return"material"in o&&"material"in n&&n.material&&(o.material=fm(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(n.material.layers)){let h=l.layers.data(c);h&&br.patch(h,u)}}).data),o.materials&&n.materials&&(o.materials=fm(o.materials,l=>{var c,u;for(let h=0;h<o.materials.length;h++){let d=n.materials[h];if(typeof d!="string")for(let[p,f]of Object.entries(d.layers)){let m=(u=(c=l[h])==null?void 0:c.layers)==null?void 0:u.data(p);m&&br.patch(m,f)}}}).data),o}function r(s,n){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[p,f]of Object.entries(d.layers)){let{texture:m,...g}=f;if(m!==void 0&&Object.keys(m).length>0){let v={path:[...h,"layers",p,"texture"],props:m,type:0};l.push(v)}if(Object.keys(g).length>0){let v={path:[...h,"layers",p],props:g,type:0};l.push(v)}}}for(let[h,d]of Object.entries(n))if(h!=="name")if(h==="cloner")l.push(..._2.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[p,f]of Object.entries(d))u(["materials",p],f);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let p={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(p),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let p={path:[h],props:d,type:0};l.push(p)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}e.toOps=r;function a(s,n){var l,c,u,h,d,p;if(n===void 0)return s;let o={...s};if(Object.assign(o,zd.merge(o,n)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:((l=n.pathSnapping)==null?void 0:l.slide)??((c=o.pathSnapping)==null?void 0:c.slide)??0,offset:((u=n.pathSnapping)==null?void 0:u.offset)??((h=o.pathSnapping)==null?void 0:h.offset)??0})}),gh.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let f=n;((d=f.orthographic)==null?void 0:d.zoom)!==void 0&&(o.orthographic.zoom=f.orthographic.zoom),((p=f.perspective)==null?void 0:p.zoom)!==void 0&&(o.perspective.zoom=f.perspective.zoom),f.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=f.isUpVectorFlipped),f.targetOffset!==void 0&&(o.targetOffset=f.targetOffset)}else if(s.type==="Mesh")"geometry"in n&&Object.assign(o,{geometry:P2.merge(o.geometry,n.geometry)}),(n.material||n.materials)&&(o=i(o,n)),o.cloner&&"cloner"in n&&Object.assign(o,{cloner:Bl.merge(o.cloner,n.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in n&&Object.assign(o,{cloner:Bl.merge(o.cloner,n.cloner)});else if(S2.is(s.type)){let f=n;f.intensity!==void 0&&(o.intensity=f.intensity),f.color!==void 0&&(typeof f.color=="string"?o.color=f.color:o.color=Zr.clone(f.color))}return o}e.patch=a})(Vc||(Vc={}));var My;(e=>e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(My||(My={}));var Fl;(e=>e.defaultData={orbitControls:My.defaultData,playPage:Df,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((t,i)=>{let r=0,a=0;return i<5?a=-30:i<10&&(a=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,a],"show"]}),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1})(Fl||(Fl={}));var F2;(e=>e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(F2||(F2={}));var U2;(e=>e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(U2||(U2={}));var Gc;(e=>(e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...F2.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:U2.defaultData}),e.generateSeed=()=>Math.round(Math.random()*1e5)))(Gc||(Gc={}));var gm;(e=>{function t(r){return r.find(a=>a.data.type==="Page"&&a.data.globalPhysics.usePhysics)!==void 0}e.physicsEnabled=t;function i(r,a,s){r.scene.objects.traverseFrom(a,(n,o)=>{var l;if(o.type==="Instance"){let c=(l=Oy.getComponentData(r,o.component))==null?void 0:l.data;c&&s(n,o,c.events)}else s(n,o,o.events)})}e.traverseModuleInstances=i})(gm||(gm={}));var Hc;(e=>{e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222";function t(a={withLight:!0,withSquare:!0}){let s=[],n=j2.defaultMeshObject;a.withLight===!0&&s.push({fi:-1,data:B2.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]}),a.withSquare===!0&&s.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:n,children:[]});let o=new jr;return o.push({fi:1,id:Df,data:{...Nd.defaultData,name:"Scene 1"},children:s}),o}e.defaultData={objects:t(),publish:Fl.defaultData,styles:Gc.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new jr,publish:Fl.defaultData,styles:Gc.defaultData()}},e.emptyDataWithPage=function(a){return{objects:t(a),publish:Fl.defaultData,styles:Gc.defaultData()}},e.emptyData=function(){return{objects:new jr,publish:{...Fl.defaultData},styles:Gc.defaultData()}};function i(a){return{...e.defaultData,objects:$n(a,jr.prototype)}}e.withObjs=i;function r(a,s){return i([{id:a,data:s,children:[],fi:0}])}e.withObj=r})(Hc||(Hc={}));var Of;(e=>e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(Of||(Of={}));var Ty;(e=>e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(Ty||(Ty={}));var $a;(e=>{function t(n){return n.textValue!==void 0}e.isTextValue=t;function i(n){return typeof n=="number"}e.isNumber=i;function r(n){return typeof n=="boolean"}e.isBoolean=r;function a(n){return t(n)?"string":r(n)?"boolean":"number"}e.typeOfVariable=a;function s(n){return e.isTextValue(n)?Array.isArray(n.textValue)?n.textValue.map(o=>o.toString().padStart(n.padding??2,"0")).join(n.deliminator??":")+(n.suffix!==void 0?" "+n.suffix:""):n.textValue.toString():e.isBoolean(n)?n?"True":"False":e.isNumber(n)?parseFloat(n.toFixed(3)).toString():n.toString()}e.getDisplayedValue=s})($a||($a={}));var V2;(e=>e.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(V2||(V2={}));var vD;(e=>e.all=[...V2.all,"components"])(vD||(vD={}));var yD;(e=>{function t(){return{images:new ft,videos:new ft,colors:new ft,audios:new ft,particles:new ft,fonts:new ft,materials:new ft,components:new ft,variables:new ft}}e.defaultData=t})(yD||(yD={}));var vh;(e=>{function t(){return{images:new ft,videos:new ft,colors:new ft,audios:new ft,particles:new ft,fonts:new ft,materials:new ft,components:new ft,variables:new ft}}e.defaultData=t})(vh||(vh={}));var ys;(e=>{function t(){let n={};return n["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},$n(n,ft.prototype)}e.defaultColors=t;function i(n){let o={};return n!=null&&n.withAITexture&&(o["a1b10010-844c-a8a3-11ec-0242ac2011ec"]={...Ty.emptyImage,name:"AI generated image"}),$n(o,ft.prototype)}e.defaultImages=i;function r(){return{catelogs:new ft,materials:new ft,images:new ft,videos:new ft,colors:new ft,audios:new ft,particles:new ft,fonts:new ft,variables:new Je,lib:vh.defaultData()}}e.emptyData=r;function a(n){switch(n){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",n)}}e.defaultVariables=a;function s(n,o){if(o.format==="HH:mm:ss"){let l=Math.floor(n/3600),c=Math.floor((n-l*3600)/60),u=Math.round(n-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(n/60),c=Math.round(n-l*60);return{textValue:[l,c]}}else return o.format==="number"?n=Math.round(n):n=Math.round(n*1e3)/1e3,n}e.getFormattedTimerTime=s})(ys||(ys={}));var Py;(e=>e.list=["idle","move","jump","run"])(Py||(Py={}));var Dy;(e=>(e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","▲"],["rotPosY","◀"],["rotNegX","▼"],["rotNegY","▶"],["jump","Space"],["run","⇧"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new Je,move:new Je,jump:new Je,run:new Je},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Jt.fromHexAndA(3728051,1)}}))(Dy||(Dy={}));function xD(e){e.layers.forEach(t=>{if(t.type==="depth"&&t.colorA!==void 0){let i=t.colorA,r=t.colorB,a=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)a.push(a[1]),s.push(1);let n={...Go(Vi(t),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,t.near),far:Math.max(0,t.far),colors:a,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(t,n)}else if(t.type==="depth"&&t.gradientType===1&&(t.near<0||t.far<0)){let i={...Vi(t),near:Math.max(t.near,0),far:Math.max(t.far,0)};Object.assign(t,i)}})}function Tl(e,t){Object.values(e.shared.materials).forEach(i=>t(i))}function Pl(e,t){e.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((a,s)=>{a===void 0&&(r.materials[s]=ra.defaultData(),a=r.materials[s]),typeof a!="string"&&t(a)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=ra.defaultData()),t(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=ra.defaultData()),t(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(a=>{a.material&&typeof a.material!="string"&&Object.getPrototypeOf(a.material)!==rr.prototype&&t(a.material)})})}function qte(e){Object.assign(e.scene.publish,{orbitControls:{...My.defaultData,...Vi(e.scene.publish.orbitControls)}})}function Xte(e){Object.assign(e.scene.publish.settings,{video:{...Fl.defaultData.settings.video,...Vi(e.scene.publish.settings.video)}})}function Yte(e){function t(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[a,s]of Object.entries(r))if((kz.includes(a)||typeof s=="boolean")&&delete r[a],a==="texture")for(let[n,o]of Object.entries(s))(Wte.includes(n)||typeof o=="boolean")&&delete s[n]}}}e.scene.objects.traverse((i,r)=>{r.states.forEach(a=>{let s=a;s.material?t(s.material):s.materials&&s.materials.forEach(n=>{t(n)})})})}function Qte(e){e.scene.publish.withBackground=!0}function Zte(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function Kte(e){e.scene.objects.traverse((t,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(a=>a+1),r.linear.scale=r.linear.scale.map(a=>a+1))})}function $te(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function Jte(e){e.scene.objects.traverse((t,i)=>{let r=e.scene.objects.unproxy().parent(t);if(r){let a=Vi(e.scene.objects.data(r));a&&a.type==="Mesh"&&a.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=Vi(i).booleanExclude!==!0)}})}function eie(e){e.scene.objects.traverse((t,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function tie(e){function t(r){Object.setPrototypeOf(r,rr.prototype),r.texture&&Object.setPrototypeOf(r.texture,rr.prototype)}function i(r){Object.setPrototypeOf(r,rr.prototype);for(let a in r)t(r[a])}e.scene.objects.traverse((r,a)=>{a.states.forEach(s=>{let n=s;if(n.material){let o=Vi(n.material).layers;i(o),n.material.layers=o}if(n.materials)for(let o=0;o<n.materials.length;o++){let l=n.materials[o],c=Vi(l).layers;i(c),l.layers=c}})})}function bD(e){e.layers===void 0&&Object.assign(e,ra.defaultTwoLayerData("lambert"))}function Db(e){!e.layers||e.layers.forEach(t=>{if(t.type==="depth"&&t.colors.length===10){let i=[...t.colors];i.push(t.colors[9]);let r=[...t.steps];r.push(t.steps[9]);let a={...Vi(t),colors:i,steps:r};Object.assign(t,a)}})}function iie(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function wD(e){e.scene.objects.traverse((t,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&Db(r)}):"material"in i&&typeof i.material!="string"&&Db(i.material)}),Object.values(e.shared.materials).forEach(t=>Db(t))}function rie(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse((t,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),e.shared.penumbraSize=new Array(5).fill(.5)}function aie(e){e.shared.audios=$n({},ft.prototype)}function sie(e){e.shared.videos=$n({},ft.prototype)}function nie(e){let t=e.shared.materials;Object.entries(t).forEach(([i,r])=>{if(!r.layers){let a={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:a})}})}function oie(e){Object.entries(Vi(e.shared.images)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.images[t]}),Object.entries(Vi(e.shared.audios)).filter(t=>t[1].asset===!1).map(t=>t[0]).forEach(t=>{delete e.shared.audios[t]})}function lie(e){e.scene.publish.settings.web.preload=!1}function _D(e){e.layers&&e.layers.forEach(t=>{t.type==="depth"&&t.num!==void 0&&(t.colors=t.colors.slice(0,t.num),t.steps=t.steps.slice(0,t.num),delete t.num)})}function SD(e){e.layers&&e.layers.forEach(t=>{Hte(t)&&t.isMask===void 0&&(t.isMask=!1),(t.type==="texture"||t.type==="video")&&t.blending===void 0&&(t.blending=0),(t.type==="noise"||t.type==="displace"&&t.displacementType==="noise")&&(t.voronoiStyle===void 0&&(t.voronoiStyle=0),t.highCut===void 0&&(t.highCut=1),t.lowCut===void 0&&(t.lowCut=0),t.smoothness===void 0&&(t.smoothness=.3),t.seed===void 0&&(t.seed=0),t.quality===void 0&&(t.quality=1))})}function cie(e){e.shared.fonts=$n({},ft.prototype)}function hie(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function uie(e){let t=[];e.scene.objects.traverse((i,r)=>{let a=r;if(a.type==="TextFrame"){let s=ra.defaultTwoLayerData("phong"),n=typeof a.color=="string"?e.shared.colors[a.color]:a.color;s.layers[1].data.color={r:n.r,g:n.g,b:n.b},s.layers[1].data.alpha=a.alpha;let o=hie(a.font);e.shared.fonts[o]===void 0&&(e.shared.fonts[o]={name:o});let l={name:a.name,...Ur.defaultData,...rd.defaultData,flatShading:!1,wireframe:!1,geometry:{...id.defaultData("TextGeometry"),width:a.width,height:a.height,font:o,depth:0,horizontalAlign:a.horizontalAlign,verticalAlign:a.verticalAlign,fontSize:a.fontSize*1.40625,lineHeight:a.lineHeight/1.40625,letterSpacing:a.letterSpacing-1,text:a.text,textTransform:a.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:Vi(a.states),events:Vi(a.events),visible:a.visible,raycastLock:a.raycastLock,position:a.position,rotation:a.rotation,scale:a.scale,hiddenMatrix:a.hiddenMatrix},c=Vi(e.scene.objects).parent(i);e.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),t.push(i)}}),t.forEach(i=>{e.scene.objects.delete(i)})}function die(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse((i,r)=>{r.events.forEach(a=>{if(t[Number(a.type)])if(Object.assign(a,{type:t[Number(a.type)]}),a.type==="Audio"&&"audioEvent"in a&&(Object.assign(a,{playAudio:a.audioEvent}),delete a.audioEvent),a.type==="GameControl")Object.assign(a,{gameActions:{idle:new Je,move:new Je,jump:new Je}});else{let s=new Je;Object.assign(a,{actions:s}),(a.type==="MouseDown"||a.type==="MouseUp"||a.type==="KeyDown"||a.type==="KeyUp")&&"url"in a&&s.push({fi:0,id:Ge.generateUUID(),data:{type:"Link",url:a.url,delay:0}}),"targets"in a&&(a.targets.forEach((n,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:n.easing,duration:n.duration};n.easing===6?Object.assign(u,Go(n,"mass","stiffness","damping","velocity")):n.easing===5&&Object.assign(u,{control1:{...n.control1},control2:{...n.control2}});let h={repeat:n.repeat?-1:0,delay:n.delay,delayDirection:n.delayDirection,direction:n.cycle&&n.rewind?"pingpong-rewind":n.cycle?"pingpong":"normal"},d={state:n.state,...h,...u},p={allowSlerp:!0,type:"Transition",object:n.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new Je({fi:0,id:Ge.generateUUID(),data:c},{fi:1,id:Ge.generateUUID(),data:d})};s.push({fi:l,id:o,data:p})}),delete a.targets)}})})}function pie(e){e.scene.objects.traverse((t,i)=>{function r(a,s){var l;let n=new Je,o=[];if(i.events.forEach((c,u,h)=>{if(c.type==="Audio"&&c.trigger===s){let d;o.push(u),c.interaction==="play"?d={...Go(c,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in c?c.after:void 0,toggle:"after"in c?c.toggle:void 0,type:"Audio"}:(c.interaction==="pause"||c.interaction==="stop")&&(d={...Go(c,"interaction","delay","object","playAudio"),type:"Audio"}),d&&n.push({fi:h,id:u,data:d})}}),o.forEach(c=>i.events.delete(c)),n.length){let c=(l=i.events.find(u=>u.type===a))==null?void 0:l.data;c?"actions"in c&&c.actions.insertBefore(null,n):i.events.insertBefore(null,[{id:Ge.generateUUID(),data:{type:a,actions:n}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function AD(e){var i;let t=(i=e.layers.find(r=>r.type==="light"))==null?void 0:i.data;if((t==null?void 0:t.category)==="basic"){let r=br.defaultData("light","phong"),a=t;Object.assign(a,r),a.visible=!1}}function ED(e){Tl(e,AD),Pl(e,AD)}function fie(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function mie(e){e.scene.objects.traverse((t,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function gie(e){e.scene.objects.traverse((t,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=ra.defaultTwoLayerData("phong"))})}function vie(e){e.scene.publish.orbitControls.autoZoom===void 0&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse((t,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function yie(e){e.scene.objects.traverse((t,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function xie(e){e.scene.publish.mouseEventTarget===void 0&&(e.scene.publish.mouseEventTarget="canvas"),e.scene.publish.settings.web.hint===void 0&&(e.scene.publish.settings.web.hint=!1)}function bie(e){let{video:t}=e.scene.publish.settings;t.format==="gif"&&t.fps>48&&(t.fps=15)}function wie(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function _ie(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse((i,r)=>{t&&r.physics===null?r.collision=!1:r.collision="visibility"})}function Sie(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=Dy.defaultDataThirdPerson.navmesh)})})}function Aie(e){e.scene.styles||(e.scene.styles=Gc.defaultData())}function CD(e){e.layers.forEach(t=>{t.type==="light"&&t.category!=="toon"&&t.occlusion===void 0&&(t.occlusion=!0)})}function Eie(e){e.scene.environment.ambientLight.occlusion===void 0&&(e.scene.environment.ambientLight.occlusion=!1),e.scene.environment.ambientLight.aoFullRes===void 0&&(e.scene.environment.ambientLight.aoFullRes=!1),e.scene.environment.ambientLight.radius===void 0&&(e.scene.environment.ambientLight.radius=256),e.scene.environment.ambientLight.bias===void 0&&(e.scene.environment.ambientLight.bias=.5),e.scene.environment.ambientLight.aoColor===void 0&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),Pl(e,CD),Tl(e,CD)}function Cie(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new Je})})})}function Mie(e){e.scene.objects.traverse((t,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run","⇧"],["none","Ctrl"]])})})}function MD(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.bumpMapIntensity===void 0&&(t.bumpMapIntensity=5)})}function Tie(e,t){if(t<1&&(Pl(e,xD),Tl(e,xD),e.schema=1),t<2&&(qte(e),e.schema=2),t<3&&(Yte(e),e.schema=3),t<4&&(Qte(e),e.schema=4),t<5&&(Zte(e),e.schema=5),t<6&&(Kte(e),e.schema=6),t<7&&($te(e),e.schema=7),t<8&&(e.schema=8),t<9&&(wD(e),e.schema=9),t<10&&(iie(e),e.schema=10),t<11&&(rie(e),e.schema=11),t<12&&(wD(e),e.schema=12),t<13&&(aie(e),e.schema=13),t<14&&(nie(e),e.schema=14),t<15&&(oie(e),e.schema=15),t<16&&(lie(e),e.schema=16),t<17&&(Pl(e,_D),Tl(e,_D),e.schema=17),t<18&&(Pl(e,bD),Tl(e,bD),e.schema=18),t<19&&(Xte(e),e.schema=19),t<20&&(cie(e),uie(e),e.schema=20),t<21&&(die(e),pie(e),e.schema=21),t<22&&(ED(e),e.schema=22),t<23&&(fie(e),e.schema=23),t<24&&(mie(e),e.schema=24),(t<25||e.shared.videos===void 0)&&(sie(e),t<25&&(e.schema=25)),t<26&&(Jte(e),e.schema=26),t<27&&(eie(e),e.schema=27),t<28&&(ED(e),e.schema=28),t<29&&(tie(e),e.schema=29),t<30&&(gie(e),e.schema=30),t<31&&(vie(e),e.schema=31),t<33&&(yie(e),e.schema=33),t<34&&(xie(e),e.schema=34),t<35&&(bie(e),e.schema=35),t<36&&(wie(e),e.schema=36),t<37&&(_ie(e),e.schema=37),t<38&&(Pl(e,SD),Tl(e,SD),e.schema=38),t<39&&(Sie(e),e.schema=39),t<40&&(Aie(e),e.schema=40),t<41&&(Eie(e),e.schema=41),t<42&&(Cie(e),e.schema=42),t<43&&(Mie(e),e.schema=43),t<99){Pl(e,MD),Tl(e,MD),e.scene.publish.playCamera===null&&(e.scene.publish.playCamera=np);let i=Vi(e.scene.objects),r=e.scene.objects;e.scene.publish.playPage=Df,r.insertBefore(null,null,[{id:Df,data:{...Nd.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:Go(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:Go(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...kd.defaultData,...Go(e.scene.environment,"usePhysics","gravity")},camera:Vi(e.scene.ownerCamera)??Nd.defaultData.camera,name:"Scene"},children:[]}]);for(let n of i)n.id!==Hc.TRASH_CAN_ID&&r.move(Df,n.fi,n.id);let a=0,s=0;e.shared.penumbraSize&&e.scene.objects.traverse((n,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=e.shared.penumbraSize[Math.min(a,2)],a+=1):o.type==="SpotLight"&&(o.penumbraSize=e.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,Ld.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),e.schema=99}}function TD(e){e.layers&&e.layers.forEach(t=>{t.type==="light"&&t.alphaOverride===void 0&&(t.alphaOverride=1)})}function Pie(e){e.scene.objects.traverse((t,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function Die(e){var t;Array.isArray(Vi(e.events))&&((t=e.events)==null||t.forEach(i=>{"disabled"in i||(i.disabled=!1),(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress")&&(i.mode=i.mode||"Object")}))}var wu=180/Math.PI;function PD(e){e.rotation=e.rotation.slice(0,3).map(t=>t*wu)}function jz(e){var i,r;PD(e),e.type==="Page"&&PD(e.camera),(i=e.states)==null||i.forEach(a=>{a.rotation===void 0||a.rotation===null||(a.rotation=a.rotation.slice(0,3).map(s=>s*wu))});let t=e.geometry;t&&t.type==="SphereGeometry"&&(t.thetaLength=(t.thetaLength??180)*wu),t&&t.type==="TorusGeometry"&&(t.arc=t.arc*wu),t&&t.type==="PathGeometry"&&(t.extrusion.angle*=wu,t.extrusion.twist*=wu),e.type==="Mesh"&&e.geometry.type==="TextGeometry"&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(Vi(e.events))&&((r=e.events)==null||r.forEach(a=>{(a.type==="MouseDown"||a.type==="MouseUp"||a.type==="MousePress"||a.type==="KeyDown"||a.type==="KeyUp"||a.type==="KeyPress"||a.type==="Collision"||a.type==="Trigger")&&(a.runMode=a.toggle?"Toggle":"Repeat")}))}function Oie(e){e.shared.variables=$n({},ft.prototype)}function Iie(e){let t=Vi(e.shared.variables);e.shared.variables=$n(Object.entries(t??{}).map(([i,r],a)=>({fi:a,id:i,data:r})),Je.prototype)}var Po=111;function Fz(e,t){t(e.data);for(let i of e.children)Fz(i,t)}function Rie(e){let t=e.schema??104;t!==Po&&t<105&&(Fz(e.asset,jz),e.schema=105)}function Lie(e){e.shared.particles=$n({},ft.prototype),e.shared.lib&&(e.shared.lib.particles=vh.defaultData().particles)}function kie(e){e.scene.objects.traverse((t,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function Uz(e){let t=e.schema??0;if(t!==Po){console.warn("updating from ",t,"to ",Po),Tie(e,t),t<100&&(e.scene.publish.joystickSizeAndXYOffset===void 0&&(e.scene.publish.joystickSizeAndXYOffset=Fl.defaultData.joystickSizeAndXYOffset),e.schema=100),t<101&&(Pl(e,TD),Tl(e,TD),e.schema=101),t<102&&(Pie(e),e.schema=102),t<104&&(e.shared.catelogs=new ft,e.shared.lib=vh.defaultData(),e.schema=104),t<105&&(Oie(e),e.scene.objects.traverse((i,r)=>{jz(r)}),e.schema=105);for(let i of Object.values(e.shared.lib.components))Rie(i);t<106&&(Iie(e),e.schema=106),t<107&&(e.shared.lib.variables=vh.defaultData().variables,e.schema=107),t<109&&(Lie(e),e.schema=109),t<110&&(kie(e),e.schema=110),t<111&&(e.scene.objects.traverse((i,r)=>{Die(r)}),e.schema=111)}}var Oy;(e=>{e.defaultData={schema:Po,scene:Hc.defaultData,frames:new ft().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Of.defaultData),shared:{...ys.emptyData(),colors:ys.defaultColors()}},e.emptyDataForImports=function(a){let s=Hc.emptyDataWithPage(a);return{schema:Po,scene:s,frames:new ft().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Of.defaultData),shared:{...ys.emptyData(),colors:ys.defaultColors(),images:ys.defaultImages(a)}}},e.emptyData=function(){return{schema:Po,scene:Hc.emptyDataWithPage(),frames:new ft().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",Of.defaultData),shared:ys.emptyData()}},e.clipboard2dData=function(){return{schema:Po,scene:Hc.emptyData(),frames:new ft,shared:ys.emptyData()}},e.collabHelper={...h2,updateSchema(a){return(a.schema??0)<Po?fm(a,Uz):(a.schema??0)-Po}};function t(a){let s=e.collabHelper.updateSchema(a);return typeof s=="number"?s===0?a:null:s.data}e.updateSchemaDirectly=t;function i(a){return{...a,shared:{...a.shared,lib:vh.defaultData()}}}e.withoutLib=i;function r(a,s){let n=a.scene.objects.get(s);if(n&&n.data.type==="Component")return n;{let o=a.shared.lib.components[s];if(o)return o.asset}}e.getComponentData=r})(Oy||(Oy={}));var DD;(e=>{function t(i){return!0}e.is=t})(DD||(DD={}));var Iy;(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0};function t(r,a){return{position:(a==null?void 0:a.position)??r.position,rotation:(a==null?void 0:a.rotation)??r.rotation,scale:(a==null?void 0:a.scale)??r.scale}}e.merge=t;function i(r,a){return tz({position:Nl.isEqual(r.position,a.position)?void 0:a.position,rotation:r.rotation===a.rotation?void 0:a.rotation,scale:Nl.isEqual(r.scale,a.scale)?void 0:a.scale})}e.diff=i})(Iy||(Iy={}));var G2;(e=>e.defaultData={horizontalConstraint:0,verticalConstraint:0})(G2||(G2={}));var Ry;(e=>e.defaultData={opacity:1,fill:{color:Jt.white,enabled:!0},stroke:{color:Jt.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:Jt.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:Jt.from0to1([0,0,0,1]),enabled:!1,spread:0}})(Ry||(Ry={}));var Wc;(e=>{function t(n,o){return{name:o}}e.newEmpty=t;function i(n,o){if(o===void 0)return n;let l={...n},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(n,o){if(o===void 0)return n;let l={...n};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function a(n,o){if(o===void 0)return n;let l={...n};return Object.assign(l,Iy.merge(l,o)),l=i(l,o),l=r(l,o),l}e.patch=a;function s(n,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}e.toOps=s})(Wc||(Wc={}));var vm;(e=>e.defaultData={...Iy.defaultData,...G2.defaultData,states:new Je,events:new Je,visible:!0,raycastLock:!1})(vm||(vm={}));var Bd;(e=>e.defaultData={...vm.defaultData,...Ry.defaultData})(Bd||(Bd={}));var Ly;(e=>e.defaultData={cornerRadius:[0,0,0,0]})(Ly||(Ly={}));var H2;(e=>e.defaultData={...Bd.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(H2||(H2={}));var ym;(e=>e.defaultData={...Bd.defaultData,...Ly.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(ym||(ym={}));var W2;(e=>e.defaultData={...Bd.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(W2||(W2={}));var q2;(e=>e.defaultData={...Bd.defaultData,type:"path2d",path:"",name:"Path"})(q2||(q2={}));var OD;(e=>{function t(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}e.is=t})(OD||(OD={}));var ky;(e=>e.defaultData={...vm.defaultData,name:"Group",type:"group2d"})(ky||(ky={}));var X2;(e=>e.defaultData={...vm.defaultData,...Ly.defaultData,...Ry.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:Jt.fromHexAndA(as,1),enabled:!0},stroke:{color:Jt.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})(X2||(X2={}));var rh;(e=>{function t(s){switch(s){case"rectangle2d":return{...ym.defaultData};case"ellipse2d":return{...H2.defaultData};case"text2d":return{...W2.defaultData};case"vector2d":return{...ym.defaultData};case"path2d":return{...q2.defaultData};case"frame2d":return{...X2.defaultData};case"group2d":return{...ky.defaultData}}}e.defaultData=t;function i(s){return"width"in s&&"height"in s?[typeof s.width=="number"?s.width*.5:0,typeof s.height=="number"?s.height*.5:0]:[0,0]}e.getPivot=i;function r(s){return s.type==="rectangle2d"||s.type==="ellipse2d"||s.type==="text2d"||s.type==="frame2d"}e.isResizeable=r;function a(s){return s.type==="rectangle2d"||s.type==="frame2d"}e.hasCorners=a})(rh||(rh={}));var Y2;(e=>(e.defaultData={name:"UI",type:"scene2d",objects:new jr},e.emptyData=function(){return{type:"scene2d",objects:new jr}}))(Y2||(Y2={}));function qc(e,t=!1){let i=e[0].index!==null,r=new Set(Object.keys(e[0].attributes)),a=new Set(Object.keys(e[0].morphAttributes)),s={},n={},o=e[0].morphTargetsRelative,l=new Qe,c=0;for(let u=0;u<e.length;++u){let h=e[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!r.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;s[p]===void 0&&(s[p]=[]),s[p].push(h.attributes[p]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!a.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;n[p]===void 0&&(n[p]=[]),n[p].push(h.morphAttributes[p])}if(t){let p;if(i)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,p,u),c+=p}}if(i){let u=0,h=[];for(let d=0;d<e.length;++d){let p=e[d].index;for(let f=0;f<p.count;++f)h.push(p.getX(f)+u);u+=e[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=ID(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in n){let h=n[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let m=0;m<n[u].length;++m)p.push(n[u][m][d]);let f=ID(p);if(!f)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(f)}}return l}function ID(e){let t,i,r,a=0;for(let o=0;o<e.length;++o){let l=e[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(t===void 0&&(t=l.array.constructor),t!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=l.array.length}let s=new t(a),n=0;for(let o=0;o<e.length;++o)s.set(e[o].array,n),n+=e[o].array.length;return new ht(s,i,r)}var zie=Math.pow(2,-24),iv=class{constructor(){}};function Fn(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function RD(e){let t=-1,i=-1/0;for(let r=0;r<3;r++){let a=e[r+3]-e[r];a>i&&(i=a,t=r)}return t}function LD(e,t){t.set(e)}function kD(e,t,i){let r,a;for(let s=0;s<3;s++){let n=s+3;r=e[s],a=t[s],i[s]=r<a?r:a,r=e[n],a=t[n],i[n]=r>a?r:a}}function rv(e,t,i){for(let r=0;r<3;r++){let a=t[e+2*r],s=t[e+2*r+1],n=a-s,o=a+s;n<i[r]&&(i[r]=n),o>i[r+3]&&(i[r+3]=o)}}function Rp(e){let t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2];return 2*(t*i+i*r+r*t)}function Nie(e,t){if(!e.index){let i=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,a;i>65535?a=new Uint32Array(new r(4*i)):a=new Uint16Array(new r(2*i)),e.setIndex(new ht(a,1));for(let s=0;s<i;s++)a[s]=s}}function Bie(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let a of e.groups)i.add(a.start),i.add(a.start+a.count);let r=Array.from(i.values()).sort((a,s)=>a-s);for(let a=0;a<r.length-1;a++){let s=r[a],n=r[a+1];t.push({offset:s/3,count:(n-s)/3})}return t}function Ob(e,t,i,r,a=null){let s=1/0,n=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=a!==null;for(let y=t*6,x=(t+i)*6;y<x;y+=6){let w=e[y+0],S=e[y+1],_=w-S,A=w+S;_<s&&(s=_),A>l&&(l=A),v&&w<h&&(h=w),v&&w>f&&(f=w);let E=e[y+2],M=e[y+3],C=E-M,T=E+M;C<n&&(n=C),T>c&&(c=T),v&&E<d&&(d=E),v&&E>m&&(m=E);let D=e[y+4],I=e[y+5],O=D-I,B=D+I;O<o&&(o=O),B>u&&(u=B),v&&D<p&&(p=D),v&&D>g&&(g=D)}r[0]=s,r[1]=n,r[2]=o,r[3]=l,r[4]=c,r[5]=u,v&&(a[0]=h,a[1]=d,a[2]=p,a[3]=f,a[4]=m,a[5]=g)}function jie(e,t,i,r){let a=1/0,s=1/0,n=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=t*6,h=(t+i)*6;u<h;u+=6){let d=e[u+0];d<a&&(a=d),d>o&&(o=d);let p=e[u+2];p<s&&(s=p),p>l&&(l=p);let f=e[u+4];f<n&&(n=f),f>c&&(c=f)}r[0]=a,r[1]=s,r[2]=n,r[3]=o,r[4]=l,r[5]=c}function Fie(e,t,i,r,a){let s=i,n=i+r-1,o=a.pos,l=a.axis*2;for(;;){for(;s<=n&&t[s*6+l]<o;)s++;for(;s<=n&&t[n*6+l]>=o;)n--;if(s<n){for(let c=0;c<3;c++){let u=e[s*3+c];e[s*3+c]=e[n*3+c],e[n*3+c]=u;let h=t[s*6+c*2+0];t[s*6+c*2+0]=t[n*6+c*2+0],t[n*6+c*2+0]=h;let d=t[s*6+c*2+1];t[s*6+c*2+1]=t[n*6+c*2+1],t[n*6+c*2+1]=d}s++,n--}else return s}}var _o=32,Uie=(e,t)=>e.candidate-t.candidate,dl=new Array(_o).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),av=new Float32Array(6);function Vie(e,t,i,r,a,s){let n=-1,o=0;if(s===0)n=RD(t),n!==-1&&(o=(t[n]+t[n+3])/2);else if(s===1)n=RD(e),n!==-1&&(o=Gie(i,r,a,n));else if(s===2){let l=Rp(e),c=1.25*a,u=r*6,h=(r+a)*6;for(let d=0;d<3;d++){let p=t[d],f=(t[d+3]-p)/_o;if(a<_o/4){let m=[...dl];m.length=a;let g=0;for(let y=u;y<h;y+=6,g++){let x=m[g];x.candidate=i[y+2*d],x.count=0;let{bounds:w,leftCacheBounds:S,rightCacheBounds:_}=x;for(let A=0;A<3;A++)_[A]=1/0,_[A+3]=-1/0,S[A]=1/0,S[A+3]=-1/0,w[A]=1/0,w[A+3]=-1/0;rv(y,i,w)}m.sort(Uie);let v=a;for(let y=0;y<v;y++){let x=m[y];for(;y+1<v&&m[y+1].candidate===x.candidate;)m.splice(y+1,1),v--}for(let y=u;y<h;y+=6){let x=i[y+2*d];for(let w=0;w<v;w++){let S=m[w];x>=S.candidate?rv(y,i,S.rightCacheBounds):(rv(y,i,S.leftCacheBounds),S.count++)}}for(let y=0;y<v;y++){let x=m[y],w=x.count,S=a-x.count,_=x.leftCacheBounds,A=x.rightCacheBounds,E=0;w!==0&&(E=Rp(_)/l);let M=0;S!==0&&(M=Rp(A)/l);let C=1+1.25*(E*w+M*S);C<c&&(n=d,c=C,o=x.candidate)}}else{for(let v=0;v<_o;v++){let y=dl[v];y.count=0,y.candidate=p+f+v*f;let x=y.bounds;for(let w=0;w<3;w++)x[w]=1/0,x[w+3]=-1/0}for(let v=u;v<h;v+=6){let y=~~((i[v+2*d]-p)/f);y>=_o&&(y=_o-1);let x=dl[y];x.count++,rv(v,i,x.bounds)}let m=dl[_o-1];LD(m.bounds,m.rightCacheBounds);for(let v=_o-2;v>=0;v--){let y=dl[v],x=dl[v+1];kD(y.bounds,x.rightCacheBounds,y.rightCacheBounds)}let g=0;for(let v=0;v<_o-1;v++){let y=dl[v],x=y.count,w=y.bounds,S=dl[v+1].rightCacheBounds;x!==0&&(g===0?LD(w,av):kD(w,av,av)),g+=x;let _=0,A=0;g!==0&&(_=Rp(av)/l);let E=a-g;E!==0&&(A=Rp(S)/l);let M=1+1.25*(_*g+A*E);M<c&&(n=d,c=M,o=y.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:n,pos:o}}function Gie(e,t,i,r){let a=0;for(let s=t,n=t+i;s<n;s++)a+=e[s*6+r*2];return a/i}function Hie(e,t){let i=e.attributes.position,r=e.index.array,a=r.length/3,s=new Float32Array(a*6),n=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<a;h++){let d=h*3,p=h*6,f,m,g;n?(f=r[d+0],m=r[d+1],g=r[d+2]):(f=r[d+0]*c+l,m=r[d+1]*c+l,g=r[d+2]*c+l);for(let v=0;v<3;v++){let y,x,w;n?(y=i[u[v]](f),x=i[u[v]](m),w=i[u[v]](g)):(y=o[f+v],x=o[m+v],w=o[g+v]);let S=y;x<S&&(S=x),w<S&&(S=w);let _=y;x>_&&(_=x),w>_&&(_=w);let A=(_-S)/2,E=v*2;s[p+E+0]=S+A,s[p+E+1]=A+(Math.abs(S)+A)*zie,S<t[v]&&(t[v]=S),_>t[v+3]&&(t[v+3]=_)}}return s}function Wie(e,t){function i(v){d&&d(v/p)}function r(v,y,x,w=null,S=0){if(!f&&S>=l&&(f=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(e))),x<=u||S>=l)return i(y+x),v.offset=y,v.count=x,v;let _=Vie(v.boundingData,w,n,y,x,h);if(_.axis===-1)return i(y+x),v.offset=y,v.count=x,v;let A=Fie(o,n,y,x,_);if(A===y||A===y+x)i(y+x),v.offset=y,v.count=x;else{v.splitAxis=_.axis;let E=new iv,M=y,C=A-y;v.left=E,E.boundingData=new Float32Array(6),Ob(n,M,C,E.boundingData,s),r(E,M,C,s,S+1);let T=new iv,D=A,I=x-C;v.right=T,T.boundingData=new Float32Array(6),Ob(n,D,I,T.boundingData,s),r(T,D,I,s,S+1)}return v}Nie(e,t);let a=new Float32Array(6),s=new Float32Array(6),n=Hie(e,a),o=e.index.array,l=t.maxDepth,c=t.verbose,u=t.maxLeafTris,h=t.strategy,d=t.onProgress,p=e.index.count/3,f=!1,m=[],g=Bie(e);if(g.length===1){let v=g[0],y=new iv;y.boundingData=a,jie(n,v.offset,v.count,s),r(y,v.offset,v.count,s),m.push(y)}else for(let v of g){let y=new iv;y.boundingData=new Float32Array(6),Ob(n,v.offset,v.count,y.boundingData,s),r(y,v.offset,v.count,s),m.push(y)}return m}function qie(e,t){let i=Wie(e,t),r,a,s,n=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),p=new o(32*d);r=new Float32Array(p),a=new Uint32Array(p),s=new Uint16Array(p),c(0,h),n.push(p)}return n;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,p=u/2,f=!!h.count,m=h.boundingData;for(let g=0;g<6;g++)r[d+g]=m[g];if(f){let g=h.offset,v=h.count;return a[d+6]=g,s[p+14]=v,s[p+15]=65535,u+32}else{let g=h.left,v=h.right,y=h.splitAxis,x;if(x=c(u+32,g),x/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return a[d+6]=x/4,x=c(x,v),a[d+7]=y,x}}}var Ko=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,r=-1/0;for(let a=0,s=e.length;a<s;a++){let n=e[a][t];i=n<i?n:i,r=n>r?n:r}this.min=i,this.max=r}setFromPoints(e,t){let i=1/0,r=-1/0;for(let a=0,s=t.length;a<s;a++){let n=t[a],o=e.dot(n);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}};Ko.prototype.setFromBox=function(){let e=new P;return function(t,i){let r=i.min,a=i.max,s=1/0,n=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){e.x=r.x*o+a.x*(1-o),e.y=r.y*l+a.y*(1-l),e.z=r.z*c+a.z*(1-c);let u=t.dot(e);s=Math.min(u,s),n=Math.max(u,n)}this.min=s,this.max=n}}();var Xie=function(){let e=new P,t=new P,i=new P;return function(r,a,s){let n=r.start,o=e,l=a.start,c=t;i.subVectors(n,l),e.subVectors(r.end,r.start),t.subVectors(a.end,a.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),p=i.dot(o),f=o.dot(o)*d-h*h,m,g;f!==0?m=(u*h-p*d)/f:m=0,g=(u+m*h)/d,s.x=m,s.y=g}}(),YE=function(){let e=new Q,t=new P,i=new P;return function(r,a,s,n){Xie(r,a,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),a.at(l,n);return}else if(o>=0&&o<=1){l<0?a.at(0,n):a.at(1,n),r.closestPointToPoint(n,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),a.closestPointToPoint(s,!0,n);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=a.start:u=a.end;let h=t,d=i;if(r.closestPointToPoint(u,!0,t),a.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),n.copy(u);return}else{s.copy(c),n.copy(d);return}}}}(),Yie=function(){let e=new P,t=new P,i=new Ya,r=new Ms;return function(a,s){let{radius:n,center:o}=a,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,e).distanceTo(o)<=n||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=n)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,e).distanceTo(o)<=n))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=n){let d=h.projectPoint(o,t);if(s.containsPoint(d))return!0}return!1}}(),Qie=1e-15;function Xh(e){return Math.abs(e)<Qie}var $o=class extends Nr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new P),this.satBounds=new Array(4).fill().map(()=>new Ko),this.points=[this.a,this.b,this.c],this.sphere=new Fa,this.plane=new Ya,this.needsUpdate=!0}intersectsSphere(e){return Yie(e,this)}update(){let e=this.a,t=this.b,i=this.c,r=this.points,a=this.satAxes,s=this.satBounds,n=a[0],o=s[0];this.getNormal(n),o.setFromPoints(n,r);let l=a[1],c=s[1];l.subVectors(e,t),c.setFromPoints(l,r);let u=a[2],h=s[2];u.subVectors(t,i),h.setFromPoints(u,r);let d=a[3],p=s[3];d.subVectors(i,e),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(n,e),this.needsUpdate=!1}};$o.prototype.closestPointToSegment=function(){let e=new P,t=new P,i=new Ms;return function(r,a=null,s=null){let{start:n,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),YE(i,r,e,t),c=e.distanceToSquared(t),c<u&&(u=c,a&&a.copy(e),s&&s.copy(t))}return this.closestPointToPoint(n,e),c=n.distanceToSquared(e),c<u&&(u=c,a&&a.copy(e),s&&s.copy(n)),this.closestPointToPoint(o,e),c=o.distanceToSquared(e),c<u&&(u=c,a&&a.copy(e),s&&s.copy(o)),Math.sqrt(u)}}();$o.prototype.intersectsTriangle=function(){let e=new $o,t=new Array(3),i=new Array(3),r=new Ko,a=new Ko,s=new P,n=new P,o=new P,l=new P,c=new Ms,u=new Ms,h=new Ms;return function(d,p=null,f=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(e.copy(d),e.update(),d=e);let m=this.plane,g=d.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let v=this.satBounds,y=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let S=0;S<4;S++){let _=v[S],A=y[S];if(r.setFromPoints(A,i),_.isSeparated(r))return!1}let x=d.satBounds,w=d.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let S=0;S<4;S++){let _=x[S],A=w[S];if(r.setFromPoints(A,t),_.isSeparated(r))return!1}for(let S=0;S<4;S++){let _=y[S];for(let A=0;A<4;A++){let E=w[A];if(s.crossVectors(_,E),r.setFromPoints(s,t),a.setFromPoints(s,i),r.isSeparated(a))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{let v=this.points,y=!1,x=0;for(let I=0;I<3;I++){let O=v[I],B=v[(I+1)%3];c.start.copy(O),c.end.copy(B),c.delta(n);let q=y?u.start:u.end,F=Xh(g.distanceToPoint(O));if(Xh(g.normal.dot(n))&&F){u.copy(c),x=2;break}if((g.intersectLine(c,q)||F)&&!Xh(q.distanceTo(B))){if(x++,y)break;y=!0}}if(x===1&&d.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(x!==2)return!1;let w=d.points,S=!1,_=0;for(let I=0;I<3;I++){let O=w[I],B=w[(I+1)%3];c.start.copy(O),c.end.copy(B),c.delta(o);let q=S?h.start:h.end,F=Xh(m.distanceToPoint(O));if(Xh(m.normal.dot(o))&&F){h.copy(c),_=2;break}if((m.intersectLine(c,q)||F)&&!Xh(q.distanceTo(B))){if(_++,S)break;S=!0}}if(_===1&&this.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(_!==2)return!1;if(u.delta(n),h.delta(o),n.dot(o)<0){let I=h.start;h.start=h.end,h.end=I}let A=u.start.dot(n),E=u.end.dot(n),M=h.start.dot(n),C=h.end.dot(n),T=E<M,D=A<C;return A!==C&&M!==E&&T===D?!1:(p&&(l.subVectors(u.start,h.start),l.dot(n)>0?p.start.copy(u.start):p.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(n)<0?p.end.copy(u.end):p.end.copy(h.end)),!0)}}}();$o.prototype.distanceToPoint=function(){let e=new P;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();$o.prototype.distanceToTriangle=function(){let e=new P,t=new P,i=["a","b","c"],r=new Ms,a=new Ms;return function(s,n=null,o=null){let l=n||o?r:null;if(this.intersectsTriangle(s,l))return(n||o)&&(n&&l.getCenter(n),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],p=s[d];this.closestPointToPoint(p,e),h=p.distanceToSquared(e),h<c&&(c=h,n&&n.copy(e),o&&o.copy(p));let f=this[d];s.closestPointToPoint(f,e),h=f.distanceToSquared(e),h<c&&(c=h,n&&n.copy(f),o&&o.copy(e))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let p=0;p<3;p++){let f=i[p],m=i[(p+1)%3];a.set(s[f],s[m]),YE(r,a,e,t);let g=e.distanceToSquared(t);g<c&&(c=g,n&&n.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var Jn=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new P,this.max=new P,this.matrix=new Se,this.invMatrix=new Se,this.points=new Array(8).fill().map(()=>new P),this.satAxes=new Array(3).fill().map(()=>new P),this.satBounds=new Array(3).fill().map(()=>new Ko),this.alignedSatBounds=new Array(3).fill().map(()=>new Ko),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};Jn.prototype.update=function(){return function(){let e=this.matrix,t=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:t.x,d.y=c?i.y:t.y,d.z=u?i.z:t.z,d.applyMatrix4(e)}let a=this.satBounds,s=this.satAxes,n=r[0];for(let l=0;l<3;l++){let c=s[l],u=a[l],h=1<<l,d=r[h];c.subVectors(n,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Jn.prototype.intersectsBox=function(){let e=new Ko;return function(t){this.needsUpdate&&this.update();let i=t.min,r=t.max,a=this.satBounds,s=this.satAxes,n=this.alignedSatBounds;if(e.min=i.x,e.max=r.x,n[0].isSeparated(e)||(e.min=i.y,e.max=r.y,n[1].isSeparated(e))||(e.min=i.z,e.max=r.z,n[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let l=s[o],c=a[o];if(e.setFromBox(l,t),c.isSeparated(e))return!1}return!0}}();Jn.prototype.intersectsTriangle=function(){let e=new $o,t=new Array(3),i=new Ko,r=new Ko,a=new P;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(e.copy(s),e.update(),s=e);let n=this.satBounds,o=this.satAxes;t[0]=s.a,t[1]=s.b,t[2]=s.c;for(let h=0;h<3;h++){let d=n[h],p=o[h];if(i.setFromPoints(p,t),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],p=c[h];if(i.setFromPoints(p,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let p=0;p<4;p++){let f=c[p];if(a.crossVectors(d,f),i.setFromPoints(a,t),r.setFromPoints(a,u),i.isSeparated(r))return!1}}return!0}}();Jn.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Jn.prototype.distanceToPoint=function(){let e=new P;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}();Jn.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map(()=>new Ms),i=new Array(12).fill().map(()=>new Ms),r=new P,a=new P;return function(s,n=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(a),this.closestPointToPoint(a,r),s.closestPointToPoint(r,a),o&&o.copy(r),l&&l.copy(a)),0;let c=n*n,u=s.min,h=s.max,d=this.points,p=1/0;for(let m=0;m<8;m++){let g=d[m];a.copy(g).clamp(u,h);let v=g.distanceToSquared(a);if(v<p&&(p=v,o&&o.copy(g),l&&l.copy(a),v<c))return Math.sqrt(v)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){let y=(m+1)%3,x=(m+2)%3,w=g<<y|v<<x,S=1<<m|g<<y|v<<x,_=d[w],A=d[S];t[f].set(_,A);let E=e[m],M=e[y],C=e[x],T=i[f],D=T.start,I=T.end;D[E]=u[E],D[M]=g?u[M]:h[M],D[C]=v?u[C]:h[M],I[E]=h[E],I[M]=g?u[M]:h[M],I[C]=v?u[C]:h[M],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let v=0;v<=1;v++){a.x=m?h.x:u.x,a.y=g?h.y:u.y,a.z=v?h.z:u.z,this.closestPointToPoint(a,r);let y=a.distanceToSquared(r);if(y<p&&(p=y,o&&o.copy(r),l&&l.copy(a),y<c))return Math.sqrt(y)}for(let m=0;m<12;m++){let g=t[m];for(let v=0;v<12;v++){let y=i[v];YE(g,y,r,a);let x=r.distanceToSquared(a);if(x<p&&(p=x,o&&o.copy(r),l&&l.copy(a),x<c))return Math.sqrt(x)}}return Math.sqrt(p)}}();var Yh=new P,Qh=new P,Zh=new P,sv=new Q,nv=new Q,ov=new Q,zD=new P,ND=new P,BD=new P,lv=new P;function Zie(e,t,i,r,a,s){let n;return s===Er?n=e.intersectTriangle(r,i,t,!0,a):n=e.intersectTriangle(t,i,r,s!==La,a),n===null?null:{distance:e.origin.distanceTo(a),point:a.clone()}}function Kie(e,t,i,r,a,s,n,o,l){Yh.fromBufferAttribute(t,s),Qh.fromBufferAttribute(t,n),Zh.fromBufferAttribute(t,o);let c=Zie(e,Yh,Qh,Zh,lv,l);if(c){r&&(sv.fromBufferAttribute(r,s),nv.fromBufferAttribute(r,n),ov.fromBufferAttribute(r,o),c.uv=Nr.getInterpolation(lv,Yh,Qh,Zh,sv,nv,ov,new Q)),a&&(sv.fromBufferAttribute(a,s),nv.fromBufferAttribute(a,n),ov.fromBufferAttribute(a,o),c.uv1=Nr.getInterpolation(lv,Yh,Qh,Zh,sv,nv,ov,new Q)),i&&(zD.fromBufferAttribute(i,s),ND.fromBufferAttribute(i,n),BD.fromBufferAttribute(i,o),c.normal=Nr.getInterpolation(lv,Yh,Qh,Zh,zD,ND,BD,new P),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:n,c:o,normal:new P,materialIndex:0};Nr.getNormal(Yh,Qh,Zh,u.normal),c.face=u,c.faceIndex=s}return c}function Vz(e,t,i,r,a){let s=r*3,n=e.index.getX(s),o=e.index.getX(s+1),l=e.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=e.attributes,p=Kie(i,c,u,h,d,n,o,l,t);return p?(p.faceIndex=r,a&&a.push(p),p):null}function $ie(e,t,i,r,a,s){for(let n=r,o=r+a;n<o;n++)Vz(e,t,i,n,s)}function Jie(e,t,i,r,a){let s=1/0,n=null;for(let o=r,l=r+a;o<l;o++){let c=Vz(e,t,i,o);c&&c.distance<s&&(n=c,s=c.distance)}return n}function Ln(e,t,i,r){let a=e.a,s=e.b,n=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),a.x=r.getX(o),a.y=r.getY(o),a.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),n.x=r.getX(c),n.y=r.getY(c),n.z=r.getZ(c)}function jD(e,t,i,r,a,s,n){let o=i.index,l=i.attributes.position;for(let c=e,u=t+e;c<u;c++)if(Ln(n,c*3,o,l),n.needsUpdate=!0,r(n,c,a,s))return!0;return!1}var Gz=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function Dl(e,t){return t[e+15]===65535}function ad(e,t){return t[e+6]}function xm(e,t){return t[e+14]}function bm(e){return e+8}function wm(e,t){return t[e+6]}function ere(e,t){return t[e+7]}var Gu=new Hi,zy=new P,tre=["x","y","z"];function Q2(e,t,i,r,a){let s=e*2,n=op,o=ic,l=rc;if(Dl(s,o)){let c=ad(e,l),u=xm(s,o);$ie(t,i,r,c,u,a)}else{let c=bm(e);Ny(c,n,r,zy)&&Q2(c,t,i,r,a);let u=wm(e,l);Ny(u,n,r,zy)&&Q2(u,t,i,r,a)}}function Z2(e,t,i,r){let a=e*2,s=op,n=ic,o=rc;if(Dl(a,n)){let l=ad(e,o),c=xm(a,n);return Jie(t,i,r,l,c)}else{let l=ere(e,o),c=tre[l],u=r.direction[c]>=0,h,d;u?(h=bm(e),d=wm(e,o)):(h=wm(e,o),d=bm(e));let p=Ny(h,s,r,zy)?Z2(h,t,i,r):null;if(p){let m=p.point[c];if(u?m<=s[d+l]:m>=s[d+l+3])return p}let f=Ny(d,s,r,zy)?Z2(d,t,i,r):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var ire=function(){let e,t,i=[],r=new Gz(()=>new Hi);return function(...s){e=r.getPrimitive(),t=r.getPrimitive(),i.push(e,t);let n=a(...s);r.releasePrimitive(e),r.releasePrimitive(t),i.pop(),i.pop();let o=i.length;return o>0&&(t=i[o-1],e=i[o-2]),n};function a(s,n,o,l,c=null,u=0,h=0){function d(y){let x=y*2,w=ic,S=rc;for(;!Dl(x,w);)y=bm(y),x=y*2;return ad(y,S)}function p(y){let x=y*2,w=ic,S=rc;for(;!Dl(x,w);)y=wm(y,S),x=y*2;return ad(y,S)+xm(x,w)}let f=s*2,m=op,g=ic,v=rc;if(Dl(f,g)){let y=ad(s,v),x=xm(f,g);return Fn(s,m,e),l(y,x,!1,h,u+s,e)}else{let y=bm(s),x=wm(s,v),w=y,S=x,_,A,E,M;if(c&&(E=e,M=t,Fn(w,m,E),Fn(S,m,M),_=c(E),A=c(M),A<_)){w=x,S=y;let q=_;_=A,A=q,E=M}E||(E=e,Fn(w,m,E));let C=Dl(w*2,g),T=o(E,C,_,h+1,u+w),D;if(T===2){let q=d(w),F=p(w)-q;D=l(q,F,!0,h+1,u+w,E)}else D=T&&a(w,n,o,l,c,u,h+1);if(D)return!0;M=t,Fn(S,m,M);let I=Dl(S*2,g),O=o(M,I,A,h+1,u+S),B;if(O===2){let q=d(S),F=p(S)-q;B=l(q,F,!0,h+1,u+S,M)}else B=O&&a(S,n,o,l,c,u,h+1);return!!B}}}(),rre=function(){let e=new $o,t=new $o,i=new Se,r=new Jn,a=new Jn;return function s(n,o,l,c,u=null){let h=n*2,d=op,p=ic,f=rc;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),Dl(h,p)){let m=o,g=m.index,v=m.attributes.position,y=l.index,x=l.attributes.position,w=ad(n,f),S=xm(h,p);if(i.copy(c).invert(),l.boundsTree)return Fn(n,d,a),a.matrix.copy(i),a.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:_=>a.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(c),_.b.applyMatrix4(c),_.c.applyMatrix4(c),_.needsUpdate=!0;for(let A=w*3,E=(S+w)*3;A<E;A+=3)if(Ln(t,A,g,v),t.needsUpdate=!0,_.intersectsTriangle(t))return!0;return!1}});for(let _=w*3,A=S+w*3;_<A;_+=3){Ln(e,_,g,v),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let E=0,M=y.count;E<M;E+=3)if(Ln(t,E,y,x),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}else{let m=n+8,g=f[n+6];return Fn(m,d,Gu),!!(u.intersectsBox(Gu)&&s(m,o,l,c,u)||(Fn(g,d,Gu),u.intersectsBox(Gu)&&s(g,o,l,c,u)))}}}();function Ny(e,t,i,r){return Fn(e,t,Gu),i.intersectBox(Gu,r)}var K2=[],h0,op,ic,rc;function cf(e){h0&&K2.push(h0),h0=e,op=new Float32Array(e),ic=new Uint16Array(e),rc=new Uint32Array(e)}function cv(){h0=null,op=null,ic=null,rc=null,K2.length&&cf(K2.pop())}var Ib=Symbol("skip tree generation"),Rb=new Hi,Lb=new Hi,Kh=new Se,bc=new Jn,Lp=new Jn,kp=new P,hv=new P,are=new P,sre=new P,nre=new P,FD=new Hi,xn=new Gz(()=>new $o),If=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),If.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let i=e.geometry,r=e._roots,a=i.getIndex(),s;return t.cloneBuffers?s={roots:r.map(n=>n.slice()),index:a.array.slice()}:s={roots:r,index:a.array},s}static deserialize(e,t,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),If.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:a}=e,s=new If(t,{...i,[Ib]:!0});if(s._roots=a,i.setIndex){let n=t.getIndex();if(n===null){let o=new ht(e.index,1,!1);t.setIndex(o)}else n.array!==r&&(n.array.set(r),n.needsUpdate=!0)}return s}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Ib]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Ib]||(this._roots=qie(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Hi))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,i=t.index.array,r=t.attributes.position,a,s,n,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)a=c[h],s=new Uint32Array(a),n=new Uint16Array(a),o=new Float32Array(a),u(0,l),l+=a.byteLength;function u(h,d,p=!1){let f=h*2;if(n[f+15]===65535){let m=s[h+6],g=n[f+14],v=1/0,y=1/0,x=1/0,w=-1/0,S=-1/0,_=-1/0;for(let A=3*m,E=3*(m+g);A<E;A++){let M=i[A],C=r.getX(M),T=r.getY(M),D=r.getZ(M);C<v&&(v=C),C>w&&(w=C),T<y&&(y=T),T>S&&(S=T),D<x&&(x=D),D>_&&(_=D)}return o[h+0]!==v||o[h+1]!==y||o[h+2]!==x||o[h+3]!==w||o[h+4]!==S||o[h+5]!==_?(o[h+0]=v,o[h+1]=y,o[h+2]=x,o[h+3]=w,o[h+4]=S,o[h+5]=_,!0):!1}else{let m=h+8,g=s[h+6],v=m+d,y=g+d,x=p,w=!1,S=!1;e?x||(w=e.has(v),S=e.has(y),x=!w&&!S):(w=!0,S=!0);let _=x||w,A=x||S,E=!1;_&&(E=u(m,d,x));let M=!1;A&&(M=u(g,d,x));let C=E||M;if(C)for(let T=0;T<3;T++){let D=m+T,I=g+T,O=o[D],B=o[D+3],q=o[I],F=o[I+3];o[h+T]=O<q?O:q,o[h+T+3]=B>F?B:F}return C}}}traverse(e,t=0){let i=this._roots[t],r=new Uint32Array(i),a=new Uint16Array(i);s(0);function s(n,o=0){let l=n*2,c=a[l+15]===65535;if(c){let u=r[n+6],h=a[l+14];e(o,c,new Float32Array(i,n*4,6),u,h)}else{let u=n+8,h=r[n+6],d=r[n+7];e(o,c,new Float32Array(i,n*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(e,t=on){let i=this._roots,r=this.geometry,a=[],s=t.isMaterial,n=Array.isArray(t),o=r.groups,l=s?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=n?t[o[c].materialIndex].side:l,d=a.length;if(cf(i[c]),Q2(0,r,h,e,a),cv(),n){let p=o[c].materialIndex;for(let f=d,m=a.length;f<m;f++)a[f].face.materialIndex=p}}return a}raycastFirst(e,t=on){let i=this._roots,r=this.geometry,a=t.isMaterial,s=Array.isArray(t),n=null,o=r.groups,l=a?t.side:t;for(let c=0,u=i.length;c<u;c++){let h=s?t[o[c].materialIndex].side:l;cf(i[c]);let d=Z2(0,r,h,e);cv(),d!=null&&(n==null||d.distance<n.distance)&&(n=d,s&&(d.face.materialIndex=o[c].materialIndex))}return n}intersectsGeometry(e,t){let i=this.geometry,r=!1;for(let a of this._roots)if(cf(a),r=rre(0,i,e,t),cv(),r)break;return r}shapecast(e,t,i){let r=this.geometry;if(e instanceof Function){if(t){let h=t;t=(d,p,f,m)=>{let g=p*3;return h(d,g,g+1,g+2,f,m)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let a=xn.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:n,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let h=o;o=(d,p,f,m,g)=>h(d,p,f,m,g)?!0:jD(d,p,r,l,f,m,a)}else o||(l?o=(h,d,p,f)=>jD(h,d,r,l,p,f,a):o=(h,d,p)=>p);let c=!1,u=0;for(let h of this._roots){if(cf(h),c=ire(0,r,n,o,s,u),cv(),c)break;u+=h.byteLength}return xn.releasePrimitive(a),c}bvhcast(e,t,i){let{intersectsRanges:r,intersectsTriangles:a}=i,s=this.geometry.index,n=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;Kh.copy(t).invert();let c=xn.getPrimitive(),u=xn.getPrimitive();if(a){let d=function(p,f,m,g,v,y,x,w){for(let S=m,_=m+g;S<_;S++){Ln(u,S*3,o,l),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let A=p,E=p+f;A<E;A++)if(Ln(c,A*3,s,n),c.needsUpdate=!0,a(c,u,A,S,v,y,x,w))return!0}return!1};if(r){let p=r;r=function(f,m,g,v,y,x,w,S){return p(f,m,g,v,y,x,w,S)?!0:d(f,m,g,v,y,x,w,S)}}else r=d}e.getBoundingBox(Lb),Lb.applyMatrix4(t);let h=this.shapecast({intersectsBounds:d=>Lb.intersectsBox(d),intersectsRange:(d,p,f,m,g,v)=>(Rb.copy(v),Rb.applyMatrix4(Kh),e.shapecast({intersectsBounds:y=>Rb.intersectsBox(y),intersectsRange:(y,x,w,S,_)=>r(d,p,y,x,m,g,S,_)}))});return xn.releasePrimitive(c),xn.releasePrimitive(u),h}intersectsBox(e,t){return bc.set(e.min,e.max,t),bc.needsUpdate=!0,this.shapecast({intersectsBounds:i=>bc.intersectsBox(i),intersectsTriangle:i=>bc.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},r={},a=0,s=1/0){e.boundingBox||e.computeBoundingBox(),bc.set(e.boundingBox.min,e.boundingBox.max,t),bc.needsUpdate=!0;let n=this.geometry,o=n.attributes.position,l=n.index,c=e.attributes.position,u=e.index,h=xn.getPrimitive(),d=xn.getPrimitive(),p=hv,f=are,m=null,g=null;r&&(m=sre,g=nre);let v=1/0,y=null,x=null;return Kh.copy(t).invert(),Lp.matrix.copy(Kh),this.shapecast({boundsTraverseOrder:w=>bc.distanceToBox(w),intersectsBounds:(w,S,_)=>_<v&&_<s?(S&&(Lp.min.copy(w.min),Lp.max.copy(w.max),Lp.needsUpdate=!0),!0):!1,intersectsRange:(w,S)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:_=>Lp.distanceToBox(_),intersectsBounds:(_,A,E)=>E<v&&E<s,intersectsRange:(_,A)=>{for(let E=_*3,M=(_+A)*3;E<M;E+=3){Ln(d,E,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let C=w*3,T=(w+S)*3;C<T;C+=3){Ln(h,C,l,o),h.needsUpdate=!0;let D=h.distanceToTriangle(d,p,m);if(D<v&&(f.copy(p),g&&g.copy(m),v=D,y=C/3,x=E/3),D<a)return!0}}}});{let _=u?u.count:c.count;for(let A=0,E=_;A<E;A+=3){Ln(d,A,u,c),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let M=w*3,C=(w+S)*3;M<C;M+=3){Ln(h,M,l,o),h.needsUpdate=!0;let T=h.distanceToTriangle(d,p,m);if(T<v&&(f.copy(p),g&&g.copy(m),v=T,y=M/3,x=A/3),T<a)return!0}}}}}),xn.releasePrimitive(h),xn.releasePrimitive(d),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,r&&(r.point?r.point.copy(g):r.point=g.clone(),r.point.applyMatrix4(Kh),f.applyMatrix4(Kh),r.distance=f.sub(r.point).length(),r.faceIndex=x),i)}closestPointToPoint(e,t={},i=0,r=1/0){let a=i*i,s=r*r,n=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(kp.copy(e).clamp(c.min,c.max),kp.distanceToSquared(e)),intersectsBounds:(c,u,h)=>h<n&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(e,kp);let h=e.distanceToSquared(kp);return h<n&&(hv.copy(kp),n=h,o=u),h<a}}),n===1/0)return null;let l=Math.sqrt(n);return t.point?t.point.copy(hv):t.point=hv.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Fn(0,new Float32Array(t),FD),e.union(FD)}),e}},zp=ar(a8()),ore=.5*(Math.sqrt(3)-1),Np=(3-Math.sqrt(3))/6,lre=1/3,bn=1/6,Rf=e=>Math.floor(e)|0,UD=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),kb=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function zb(e=Math.random){let t=Hz(e),i=new Float64Array(t).map(a=>UD[a%12*2]),r=new Float64Array(t).map(a=>UD[a%12*2+1]);return function(a,s){let n=0,o=0,l=0,c=(a+s)*ore,u=Rf(a+c),h=Rf(s+c),d=(u+h)*Np,p=u-d,f=h-d,m=a-p,g=s-f,v,y;m>g?(v=1,y=0):(v=0,y=1);let x=m-v+Np,w=g-y+Np,S=m-1+2*Np,_=g-1+2*Np,A=u&255,E=h&255,M=.5-m*m-g*g;if(M>=0){let D=A+t[E],I=i[D],O=r[D];M*=M,n=M*M*(I*m+O*g)}let C=.5-x*x-w*w;if(C>=0){let D=A+v+t[E+y],I=i[D],O=r[D];C*=C,o=C*C*(I*x+O*w)}let T=.5-S*S-_*_;if(T>=0){let D=A+1+t[E+1],I=i[D],O=r[D];T*=T,l=T*T*(I*S+O*_)}return 70*(n+o+l)}}function cre(e=Math.random){let t=Hz(e),i=new Float64Array(t).map(s=>kb[s%12*3]),r=new Float64Array(t).map(s=>kb[s%12*3+1]),a=new Float64Array(t).map(s=>kb[s%12*3+2]);return function(s,n,o){let l,c,u,h,d=(s+n+o)*lre,p=Rf(s+d),f=Rf(n+d),m=Rf(o+d),g=(p+f+m)*bn,v=p-g,y=f-g,x=m-g,w=s-v,S=n-y,_=o-x,A,E,M,C,T,D;w>=S?S>=_?(A=1,E=0,M=0,C=1,T=1,D=0):w>=_?(A=1,E=0,M=0,C=1,T=0,D=1):(A=0,E=0,M=1,C=1,T=0,D=1):S<_?(A=0,E=0,M=1,C=0,T=1,D=1):w<_?(A=0,E=1,M=0,C=0,T=1,D=1):(A=0,E=1,M=0,C=1,T=1,D=0);let I=w-A+bn,O=S-E+bn,B=_-M+bn,q=w-C+2*bn,F=S-T+2*bn,L=_-D+2*bn,X=w-1+3*bn,G=S-1+3*bn,U=_-1+3*bn,H=p&255,$=f&255,Y=m&255,J=.6-w*w-S*S-_*_;if(J<0)l=0;else{let ie=H+t[$+t[Y]];J*=J,l=J*J*(i[ie]*w+r[ie]*S+a[ie]*_)}let Z=.6-I*I-O*O-B*B;if(Z<0)c=0;else{let ie=H+A+t[$+E+t[Y+M]];Z*=Z,c=Z*Z*(i[ie]*I+r[ie]*O+a[ie]*B)}let ne=.6-q*q-F*F-L*L;if(ne<0)u=0;else{let ie=H+C+t[$+T+t[Y+D]];ne*=ne,u=ne*ne*(i[ie]*q+r[ie]*F+a[ie]*L)}let re=.6-X*X-G*G-U*U;if(re<0)h=0;else{let ie=H+1+t[$+1+t[Y+1]];re*=re,h=re*re*(i[ie]*X+r[ie]*G+a[ie]*U)}return 32*(l+c+u+h)}}function Hz(e){let t=new Uint8Array(512);for(let i=0;i<512/2;i++)t[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(e()*(256-i)),a=t[i];t[i]=t[r],t[r]=a}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var js=new Nr,hre=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let a=1;js.a.fromBufferAttribute(e,r),js.b.fromBufferAttribute(e,r+1),js.c.fromBufferAttribute(e,r+2),a*=js.getArea(),t[r/3]=a}this.distribution=new Float32Array(e.count/3);let i=0;for(let r=0;r<t.length;r++)i+=t[r],this.distribution[r]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,r=t.length-1,a=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){a=s;break}else e<t[s]?r=s-1:i=s+1}return a}sampleFace(e,t,i){let r=this.randomFunction(),a=this.randomFunction();return r+a>1&&(r=1-r,a=1-a),js.a.fromBufferAttribute(this.positionAttribute,e*3),js.b.fromBufferAttribute(this.positionAttribute,e*3+1),js.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(js.a,r).addScaledVector(js.b,a).addScaledVector(js.c,1-(r+a)),js.getNormal(i),this}},ure=ar(Ek()),dre=new Se,pre=new Se,fre=new Se,_m;(e=>{function t(i){return i&&i.__isSPEObject}e.is=t})(_m||(_m={}));var QE=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new Se,this.copyPreviousMatrix=!0,this.hiddenMatrix=new Se,this.matrixWorldRigid=new Se,this.shearScale=new Se,this.shearScaleInv=new Se}get __isSPEObject(){return!0}isDescendantOf(t){t instanceof Yt&&(t=t.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===t)return!0;i=i.parent}return!1}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);for(let i of this.children)i.updateMatrixWorld(t)}updateWorldMatrix(t,i){let r=this.parent;if(t&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let a of this.children)a.updateWorldMatrix(!1,!0)}traverseChildren(t,i=0){for(let r of this.children)_m.is(r)&&r.traverseObject(t,i+1)}traverseObject(t,i=0){if(t(this,i)!==!0)for(let r of this.children)_m.is(r)&&r.traverseObject(t,i+1)}updateMatrixWorldSVD(){let t=this.matrixWorld.elements,i=[[t[0],t[4],t[8]],[t[1],t[5],t[9]],[t[2],t[6],t[10]]],{u:r,v:a,q:s}=(0,ure.SVD)(i),n=dre.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=pre.set(a[0][0],a[0][1],a[0][2],0,a[1][0],a[1][1],a[1][2],0,a[2][0],a[2][1],a[2][2],0,0,0,0,1),l=fre.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(n,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(t,i){this.updateWorldMatrix(!0,!1);let r=new Se().copy(this.matrixWorld).invert();return t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),r.multiply(t.parent.matrixWorld)),"hiddenMatrix"in t&&t.hiddenMatrix instanceof Se?t.hiddenMatrix.premultiply(r):t.applyMatrix4(r),t.updateWorldMatrix(!1,!1),this.add(t),i!==void 0&&(this.children.pop(),this.children.splice(i,0,t)),this}copy(t,i=!1){return super.copy(t,i),this.hasNonUniformScale=t.hasNonUniformScale,this}onAfterRender(t,i,r,a,s,n){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},mre=class extends QE(Yt){},gre=e=>e.type==="Mesh",ta=class extends mre{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){let i=this.children[e];(i==null?void 0:i.object)!==t&&(i&&this.remove(i),i=new ta(t),this.add(i),this.children.splice(e,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=t.matrix,i.hiddenMatrix=t.hiddenMatrix),i.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&((e=this.object.dataPatched.cloner)==null?void 0:e.hideBase)===!0}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return gre(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},Ic=new P,Rc=new P,sd=new Se,Wz=[new P(-1,1,1),new P(-1,-1,1),new P(1,-1,1),new P(1,1,1),new P(-1,1,-1),new P(-1,-1,-1),new P(1,-1,-1),new P(1,1,-1)],vre=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],yre=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],VD=(e,t,i)=>{e.updateEntityBoxSize(Ic,Rc),sd.copy(t).multiply(e.matrixWorld),Rc.x===0&&Rc.y===0&&Rc.z===0?i.push(new P(Ic.x,Ic.y,Ic.z).applyMatrix4(sd)):Wz.forEach(r=>{i.push(r.clone().multiply(Rc).add(Ic).applyMatrix4(sd))})},GD=class extends Hi{constructor(){super(...arguments),this.matrix=new Se,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map(t=>t.clone()),this.faces=e.faces.map(t=>t.clone()),this.edges=e.edges.map(t=>t.clone()),this.centerEdges=e.centerEdges.map(t=>t.clone()),this}setFromObjectSize(e,t=!1){e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=new Se().copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];return i===!0?e.traverseEntity(a=>{if(a.visible||a.cloner&&a.data.visible){if(!("geometry"in a)){r.push(new P);return}VD(a,t,r)}}):VD(e,t,r),this.setFromPoints(r)}getCenter(e){return e=super.getCenter(e),e.applyMatrix4(this.matrix),e}getPositionToCenter(e){return e=super.getCenter(e),e.applyMatrix4(sd.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(Rc).multiplyScalar(.5),this.getCenter(Ic),sd.copy(this.matrix).setPosition(Ic),this.vertices=Wz.map(e=>e.clone().multiply(Rc).applyMatrix4(sd))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=vre.map(([e,t])=>new Ms(this.vertices[e],this.vertices[t])),this.centerEdges=this.edges.map(e=>e.getCenter(new P))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=yre.map(([e,t])=>this.vertices[e].clone().add(this.vertices[t]).multiplyScalar(.5))}},Ul={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},xre=class extends e5{constructor(){super()}getPoints(e=12){let t=[],i,r=this.getCurveLengths(),a=r[r.length-1]/r.length;for(let s=0,n=this.curves;s<n.length;s++){let o=n[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(e*l/a),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(t.push(d),i=d)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}},$2=.001;function J2(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=$2}function Nb(e,t){let i=new P(...e.position),r=new P(...e.controlNext.position),a=new P(...t.controlPrevious.position),s=new P(...t.position);return J2(i,r,s)&&J2(i,a,s)}function qz(e){let t=e.points.map(u=>new P(...u.data.position)),i=[e.points[0]],r=new P(...i[0].data.position);for(let u=0;u<e.points.length-1;u++)J2(r,t[u],t[u+1])||(i.push(e.points[u]),r=t[u]);i.push(e.points[e.points.length-1]);let a=e.isClosed,s=i.length-(a?0:1),n=i.length,o=[];for(let u=0;u<n;u++){let h=i[u].data,d=new P(...h.position),p=new P(...h.controlPrevious.position),f=new P(...h.controlNext.position),m={position:d,baseRoundness:h.roundness,controlPrevious:p,controlNext:f};if(h.roundness===0||!e.isClosed&&(u===0||u===n-1)){o[u]={...m,removedLength:0};continue}let g=a&&u==0?n-1:u-1,v=a&&u==n-1?0:u+1,y=i[g].data,x=i[v].data,w=new P(...y.position),S=new P(...x.position),_=w.clone().sub(d).normalize(),A=S.clone().sub(d).normalize();Object.assign(m,{prevDir:_,nextDir:A});let E=Nb(y,h),M=Nb(h,x);if(!E||!M)o[u]={...m,removedLength:0};else{let C=_.clone().add(A).normalize(),T=C.clone().cross(_).length()/_.dot(C);o[u]={...m,tan:T,removedLength:h.roundness/T}}}for(let u=0;u<s;u++){let h=u,d=a&&u===n-1?0:u+1,p=o[h],f=o[d];if(p.removedLength!==0||f.removedLength!==0){let m=p.position.distanceTo(f.position);p.removedLength=Math.min(p.removedLength,m/2),f.removedLength=Math.min(f.removedLength,m/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=a&&u===n-1?0:u+1,p=o[h],f=o[d],m=null;if(!Nb(i[h].data,i[d].data))p.position.distanceTo(f.position)>$2&&(m=new s0(p.position,p.controlNext,f.controlPrevious,f.position));else{let g=p.position.clone(),v=f.position.clone();(p.removedLength!==0||f.removedLength!==0)&&(p.nextDir&&g.add(p.nextDir.clone().setLength(p.removedLength)),f.prevDir&&v.add(f.prevDir.clone().setLength(f.removedLength))),g.distanceTo(v)>$2&&(m=new s0(g,g.clone().lerp(v,.3),v.clone().lerp(g,.3),v))}l[2*u+1]=m}for(let u=0;u<n;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,p=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),f=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),m=h.tan*h.removedLength,g=h.prevDir.clone().add(h.nextDir).normalize(),v=p.clone().lerp(f,.5),y=p.distanceTo(f)/2,x=g.clone().multiplyScalar(Math.sqrt(Math.pow(m,2)-Math.pow(y,2))).add(v),w=g.clone().multiplyScalar(-m).add(x),S=d.distanceTo(w)/d.distanceTo(v),_=h.prevDir.clone().multiplyScalar(S*d.distanceTo(p)).add(d),A=_.clone().lerp(w,2),E=p.clone().lerp(_,4/3),M=f.clone().lerp(A,4/3);l[2*u]=new s0(p,E,M,f)}let c=new xre;return l.forEach(u=>{u&&c.add(u)}),c}var Ot;(e=>{function t(i){return i&&i.__isEntity}e.is=t})(Ot||(Ot={}));var Do=e=>Ot.is(e),bre={type:"completeState",isfromEntity:!0},wre=["x","y","z"],Bb=new P,_re=new P().set(0,1,0),ZE=e=>class extends QE(e){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new GD,this._recursiveBBox=new GD,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(t){let i=this.children[t];if(Ot.is(i))return i}entityChildrenCount(){let t=this.children.length;for(;t--;)if(Ot.is(this.children[t]))return t+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let t=this;for(;t.data.type!=="Instance";){let i=t.parent;if(Ot.is(i))t=i;else return}return t}forInstancesRec(t){this.instances.forEach(i=>{i.disposed||t(i),i.forInstancesRec(t)})}super_Entity(t,i){typeof t=="string"&&(this.uuid=t),this.identity=t,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(t,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let a of this.data.states)Vc.toOps(this.data,a.data).forEach(s=>{let n=my.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(n,this.data,i)});if(t!==null){let a=this.data.states.data(t);a&&(this.dataPatched=Vc.patch(this.data,a),Vc.toOps(this.data,a).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=t,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(t,i){t.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{Do(t)&&t.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(t=>{t.resetBBoxNeedsUpdateSelf()})}find(t){let i;return this.traverseEntity(r=>{r.uuid===t&&(i=r)}),i}traverseSortNextHelper(){let t=this.parent;if(t){let i=t.children,r=i.indexOf(this)+1;if(Ot.is(i[r]))return i[r];if(Ot.is(t))return t.traverseSortNextHelper()}}sortNext(){let t=this.children;return this.children.length>0&&Ot.is(this.children[0])?t[0]:this.traverseSortNextHelper()}goUp(t){let i=this;for(;t>0&&i!==null;)i=i.parent,t-=1;return i}hasAnccestorOrSelf(t){return this===t||this.hasAnccestor(t)}hasAnccestor(t){let i=this.parent;for(;i;){if(t===i)return!0;i=i.parent}return!1}countToAccestor(t){let i=0,r=this;for(;r!==t;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(t){for(let i of this.children)Do(i)&&t(i)}traverseEntityAncestors(t){this.traverseAncestors(i=>{Ot.is(i)&&t(i)})}traverseConcreteEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Do(r)&&r.isConcreteEntity&&r.traverseEntity(t,i+1)}traverseEntity(t,i=0){if(t(this,i)!==!0)for(let r of this.children)Do(r)&&r.traverseEntity(t,i+1)}traverseVisibleEntity(t){t(this);for(let i of this.children)Do(i)&&i.visible&&i.traverseVisibleEntity(t)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(t){super.updateMatrixWorld(t),this.dispatchEvent({type:"updateMatrixWorld"})}copy(t,i=!1){return super.copy(t,i),this.dataPatched=t.dataPatched,this.raycastLock=t.raycastLock,this.scaleLock=t.scaleLock,this.hiddenMatrix.copy(t.hiddenMatrix),this}hasEntityChild(){return this.children.some(t=>Do(t))}isAncestorOf(t){if(this.uuid===t)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===t&&(i=!0)}),i}toObjectTransformState(t=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Ge.RAD2DEG,this.rotation.y*Ge.RAD2DEG,this.rotation.z*Ge.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return c2(i,t)}getTransformValues(t,i,r){return i[t].map((a,s)=>(r==null?void 0:r.shared.getVariable(a,[this.uuid,t,wre[s]]))??a)}updateTransformState(t,i){let r=!1;return t.position&&(this.position.fromArray(this.getTransformValues("position",t,i)),r=!0),t.rotation&&(Bb.fromArray(this.getTransformValues("rotation",t,i)).multiplyScalar(Ge.DEG2RAD),this.rotation.setFromVector3(Bb),r=!0),t.scale&&(this.scale.fromArray(this.getTransformValues("scale",t,i)),r=!0),t.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(t.hiddenMatrix??Id.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(a=>{a.invalidateClonerTransform(this)})),t.position&&t.rotation&&t.scale&&t.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(t=!1){if(t){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let t of this.children)Ot.is(t)&&t.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(t=>{Ot.is(t)&&t.disposeRecursively()})}toState(t=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(t)};return c2(i,t)}updateByObjUpdateOp(t,i){t!==void 0&&this.updateByOp({type:0,props:t,path:[]},{...this.data,...t},i,!1)}updateByOp(t,i,r,a){let s=this.data;this.data=i;let n=t,o=si(t.path,["states","*"]);if(o!==null){if(t.type===0){let[l]=o;if((this==null?void 0:this.stateSelection)===l){let c={...t.props};if(delete c.name,Object.values(t.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=Br.zoom(u,t.path.slice(2));if(h)for(let d in t.props)t.props[d]===void 0&&d in h&&(c[d]=h[d])}}n={...t,props:c,path:t.path.slice(2)}}}}else if(t.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(t.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(t.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=Br.removeOverridden(t.path,t.props,l);n={...t,props:c}}}if(this.updateByPatchedOpBase(n,Vc.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),si(t.path,["overrides"])){let l=[],c=[...t.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(t.type===0)for(let u of Object.keys(t.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=t.props[u],h.updateState(ec.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=Br.zoom(u.component.data,c);if(t={...t,path:c},t.type===0){let d=t.props;if(h)for(let[p,f]of Object.entries(t.props))f===void 0&&(d===t.props&&(d={...t.props}),d[p]=h[p]);t={...t,props:d}}u.overrideData=Cy.resolve(i.overrides,l),u.updateByOp(t,Ar.applySimple(u.data,t),r,!1)}}}else if(this.instances.length>0){let l;if(t.path.length===0&&t.type===0){let c;for(let u of jl.rootOverrideProps)u in t.props&&(c===void 0&&(c={}),c[u]=t.props[u]);c&&(l={...t,props:c})}else for(let c of jl.rootOverrideProps)if(si(t.path,[c])){l=t;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=ec.filterOp(c.overrideData,l);u&&c.updateByOp(u,Ar.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=ec.filterOp(c.overrideData,t);if(u){let h;s===c.data&&t===u?h=i:h=Ar.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(t,i,r){if(this.dataPatched=i,t.path.length===0&&t.type===0)t.props.type!==void 0&&!gh.is(t.props.type)&&Ul.changeEntityProptotype(this,i,r);else if(t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&"type"in t.props){Ul.changeEntityProptotype(this,i,r);for(let a of this.children)Ot.is(a)&&a.updateVisible(r.scene)}this.updateByPatchedOp(t,i,r)}updateByPatchedOp(t,i,r){if(t.path.length===0&&t.type===0&&this.updateState(t.props,r),si(t.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),si(t.path,["cloner"])!==null){let a=Ar.drop(t,1);a.path.length===0&&a.type===0&&a.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(t=this.dataPatched.pathSnapping){this._updatedPathSnapping=t,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(t){var f,m,g,v,y;let i=((f=this._updatedPathSnapping)==null?void 0:f.pathId)??this.dataPatched.pathSnapping.pathId,r=((m=this._updatedPathSnapping)==null?void 0:m.slide)??this.dataPatched.pathSnapping.slide??0,a=((g=this._updatedPathSnapping)==null?void 0:g.offset)??this.dataPatched.pathSnapping.offset??0,s=((v=this._updatedPathSnapping)==null?void 0:v.orientation)??this.dataPatched.pathSnapping.orientation;if(i===null)return;let n=t.find(i);if(!n||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=n.data;if(o.geometry.path.points.length<=1)return;let l=qz(o.geometry.path),c=(r+a)%1;r+a===1&&c===0&&(c=1);let u=l.getPointAt(c);if(u===null)return;let h=this.parent?(y=this.parent)==null?void 0:y.matrixWorld:new Se;n.updateMatrixWorld();let d=new Se().multiplyMatrices(h.clone().invert(),n.matrixWorld);u.applyMatrix4(d);let p={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let x=new Se().extractRotation(n.matrixWorld),w=l.getTangentAt(c).applyMatrix4(x).add(u),S=new Se().lookAt(u,w,_re),_=Bb.setFromEuler(new hr().setFromRotationMatrix(S)).multiplyScalar(Ge.RAD2DEG);p={...p,rotation:_.toArray()}}this.updateTransformState(p),this.traverseEntity(x=>{x._cameraType&&x.dispatchEvent(bre)})}updateVisible(t){var r;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||((r=this.dataPatched.cloner)==null?void 0:r.hideBase)!==!0),!t)return;let i=!1;this.traverseEntity(a=>{if(a.data.type==="Splat")return i=!0,!0}),i&&t.reloadSplats()}updateState_Entity(t,i){t.name!==void 0&&(this.name=t.name),t.raycastLock!==void 0&&(this.raycastLock=t.raycastLock),t.visible!==void 0&&(this.updateVisible(i==null?void 0:i.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in t&&t.cloner!==void 0&&(this.setFromClonerState(t.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(t,i)}get attachedSurfaceCloners(){return this.children.filter(t=>t instanceof Ul.Cloner&&t.parameters.type==="toObject")}setFromClonerState(t,i){this.disposed||(t===null||t.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new Ul.Cloner(this,t),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(t,i.scene))}expandCloner(t){!this.disposed&&this.cloner&&this.cloner.expandClones(t)}invalidateClonerTransform(t){this.cloner&&this.cloner.invalidateTransform(t)}requestRender(){this.dispatchEvent({type:"requestRender"})}},Xz=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);i.thetaLength=Ge.clamp(i.thetaLength,0,360);let r=i.width/2,a=i.radiusTop??r,s=i.radiusBottom??r;return a===s?(a=r,s=r):a>s?(a=r,s=s*r/a):(a=a*r/s,s=r),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),radiusTop:a,radiusBottom:s})}}static build(e){let{width:t,depth:i,height:r,radialSegments:a,heightSegments:s,openEnded:n,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:p}=e.parameters,f;return l===0?(f=new Qe,f.setAttribute("position",new Re([],3))):h||p?f=new Yz(c,u,r,a,s,n,o,l*Math.PI/180,h,h,d,p):f=new fE(c,u,r,a,s,n,o,l*Math.PI/180),f.scale(1,1,i/t),Object.assign(f,{userData:{...e,type:"CylinderGeometry"}})}};function pl(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function HD(e){return new Q(e.y,-e.x)}var Yz=class extends Qe{constructor(e,t,i,r,a,s,n,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,r=Math.floor(r)||8,a=Math.floor(a)||1,s=s!==void 0?s:!1,n=n!==void 0?n:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,x=new P,w=new P;d&&e==0&&(e=l),d&&t==0&&(t=c);let S=new Q(e,y),_=new Q(t,-y),A=null,E=null,M=null,C=null,T=S.clone().sub(_),D=0,I=0,O=0;h>0&&(D=Math.min(e,t)*(1-h),I=e-D,O=t-D);let B=S.clone();B.x-=D;let q=Math.PI-T.angle(),F=T.angle(),L=Math.tan(F/2),X=Math.tan(q/2),G=L+X,U=h?G:X,H=h?G:L;if(l=Math.min(l,(e-I)/U,T.length()/G),c=Math.min(c,(t-O)/H,T.length()/G),l>0){let re=l/L;A=S.clone().sub(new Q(re,l)),h&&(M=A.clone(),M.x-=D-G*l),S.sub(T.clone().setLength(re))}if(c>0){let re=c/X;E=_.clone().sub(new Q(re,-c)),_.add(T.clone().setLength(re)),h&&(C=E.clone(),C.x-=D-G*c,B.sub(T.clone().setLength(re)))}T=S.clone().sub(_);let $=T.length()<.5,Y=[];for(let re=0;re<=r;re++){let ie=[],le=re/r,ue=le*o+n,fe=new Q(Math.sin(ue),Math.cos(ue));C&&E?(J(ie,le,fe,q,c,C,-1,!0),J(ie,le,fe,F,c,E,-1,!1)):E?(Z(ie,fe,E.x,0,-1),J(ie,le,fe,F,c,E,-1,!1)):s||Z(ie,fe,t,O,-1);let be=HD(T).normalize();if(pl(be,fe,x),!$)for(let ke=0;ke<=a;ke++){let Ce=ke/a,Ve=T.clone().multiplyScalar(Ce).add(_);pl(Ve,fe,w),f.push(w.x,w.y,w.z),m.push(x.x,x.y,x.z),g.push(le,.5+w.y/i),ie.push(v++)}if(M&&A?(J(ie,le,fe,q,l,A,1,!1),J(ie,le,fe,F,l,M,1,!0)):A?(J(ie,le,fe,q,l,A,1,!1),Z(ie,fe,A.x,0,1)):s||Z(ie,fe,e,I,1),h&&!$){let ke=HD(T).multiplyScalar(-1).normalize();pl(ke,fe,x);for(let Ce=0;Ce<=a;Ce++){let Ve=Ce/a,je=T.clone().multiplyScalar(-Ve).add(B);pl(je,fe,w),f.push(w.x,w.y,w.z),m.push(x.x,x.y,x.z),g.push(le,.5+w.y/i),ie.push(v++)}}h&&!s&&ie.push(ie[0]),Y.push(ie)}for(let re=0;re<Y.length-1;re++)for(let ie=0;ie<Y[0].length-1;ie++){if(s&&h&&ie==a)continue;let le=Y[re][ie],ue=Y[re+1][ie],fe=Y[re+1][ie+1],be=Y[re][ie+1],ke=f[fe*3+0],Ce=f[fe*3+2];p.push(le,ue,be),(ke!=0||Ce!=0)&&p.push(ue,fe,be)}o<Math.PI*2&&(ne(-1,Y[0],n),ne(1,Y[Y.length-1],n+o)),this.setIndex(p),this.setAttribute("position",new Re(f,3)),this.setAttribute("normal",new Re(m,3)),this.setAttribute("uv",new Re(g,2));function J(re,ie,le,ue,fe,be,ke,Ce){for(let Ve=0;Ve<u+1;Ve++){let je=Ve/u,Pe=ke<0?je:1-je;Ce&&(Pe-=1),Pe*=ue;let Me=new Q(Math.sin(Pe),Math.cos(Pe)*ke),Ze=Me.clone().multiplyScalar(fe).add(be);pl(Ze,le,w),f.push(w.x,w.y,w.z),pl(Me,le,x),m.push(x.x,x.y,x.z),g.push(ie,.5+w.y/i),re.push(v++)}}function Z(re,ie,le,ue,fe){let be=new P,ke=new Q,Ce=[le,ue];fe<0&&Ce.reverse();for(let Ve of Ce)ke.set(Ve,y*fe),pl(ke,ie,be),f.push(be.x,be.y,be.z),m.push(0,fe,0),g.push(.5,.5),re.push(v++)}function ne(re,ie,le){let ue=new Q(Math.sin(le),Math.cos(le)),fe=new Q(-Math.cos(le),Math.sin(le)),be=new P,ke=re<0?(je,Pe,Me)=>p.push(je,Pe,Me):(je,Pe,Me)=>p.push(je,Me,Pe),Ce=new Q((e+t+I+O)/4,0);pl(Ce,ue,be),f.push(be.x,be.y,be.z),m.push(fe.x,0,fe.y),g.push(.5,.5);let Ve=v++;for(let je of ie){let Pe=f.slice(je*3,je*3+3);f.push(...Pe),m.push(fe.x,0,fe.y);let Me=g.slice(je*2,je*2+2);g.push(...Me),v++}for(let je=Ve+1;je<v-1;je++)ke(Ve,je,je+1);ke(Ve,v-1,Ve+1)}}},Sre=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return i.thetaLength=Ge.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,depth:i,height:r,radialSegments:a,heightSegments:s,openEnded:n,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=e.parameters,d;return l===0?(d=new Qe,d.setAttribute("position",new Re([],3))):c>0||u>0||l<360?d=new Yz(0,t/2,r,a,s,n,o,l*Math.PI/180,c,u,h,0,!0):d=new mE(t/2,r,a,s,n),d.scale(1,1,i/t),Object.assign(d,{userData:{...e,type:"ConeGeometry"}})}},Are=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,widthSegments:a,heightSegments:s,depthSegments:n,cornerRadius:o,cornerSegments:l}=e.parameters,c;return o==0?c=new cn(t,i,r,a,s,n):c=new Ere(t,i,r,a,s,n,o,l),Object.assign(c,{userData:{...e,type:"CubeGeometry"}})}},jb=Math.PI/2,Ere=class extends Qe{constructor(e=1,t=1,i=1,r=1,a=1,s=1,n=0,o=4){super(),this.type="BoxGeometry";let l=this;r=Math.floor(r),a=Math.floor(a),s=Math.floor(s),o=Math.floor(o),n=Math.min(n,e/2,t/2,i/2);let c=[],u=[],h=[],d=[],p=0,f=0;m("z","y","x",-1,-1,i,t,e,s,a,0),m("z","y","x",1,-1,i,t,-e,s,a,1),m("x","z","y",1,1,e,i,t,r,s,2),m("x","z","y",1,-1,e,i,-t,r,s,3),m("x","y","z",1,-1,e,t,i,r,a,4),m("x","y","z",-1,-1,e,t,-i,r,a,5),n>0&&(g("z","y","x",-1,-1,1,i,t,e,s,0),g("z","y","x",1,-1,-1,i,t,e,s,1),g("z","y","x",-1,1,-1,i,t,e,s,1),g("z","y","x",1,1,1,i,t,e,s,0),g("x","y","z",-1,-1,-1,e,t,i,r,0),g("x","y","z",1,-1,1,e,t,i,r,1),g("x","y","z",-1,1,1,e,t,i,r,0),g("x","y","z",1,1,-1,e,t,i,r,1),g("y","x","z",-1,-1,1,t,e,i,a,0),g("y","x","z",1,-1,-1,t,e,i,a,1),g("y","x","z",1,1,1,t,e,i,a,1),g("y","x","z",-1,1,-1,t,e,i,a,0),v(1,1,1),v(-1,1,1),v(1,-1,1),v(-1,-1,1),v(1,1,-1),v(-1,1,-1),v(1,-1,-1),v(-1,-1,-1)),this.setIndex(c),this.setAttribute("position",new Re(u,3)),this.setAttribute("normal",new Re(h,3)),this.setAttribute("uv",new Re(d,2));function m(y,x,w,S,_,A,E,M,C,T,D){let I=(A-2*n)/C,O=(E-2*n)/T,B=A/2-n,q=E/2-n,F=M/2,L=C+1,X=T+1,G=0,U=0,H=new P;for(let $=0;$<X;$++){let Y=$*O-q;for(let J=0;J<L;J++){let Z=J*I-B;H[y]=Z*S,H[x]=Y*_,H[w]=F,u.push(H.x,H.y,H.z),H[y]=0,H[x]=0,H[w]=M>0?1:-1,h.push(H.x,H.y,H.z),d.push(J/C),d.push(1-$/T),G+=1}}for(let $=0;$<T;$++)for(let Y=0;Y<C;Y++){let J=p+Y+L*$,Z=p+Y+L*($+1),ne=p+(Y+1)+L*($+1),re=p+(Y+1)+L*$;c.push(J,Z,re),c.push(Z,ne,re),U+=6}l.addGroup(f,U,D),f+=U,p+=G}function g(y,x,w,S,_,A,E,M,C,T,D){let I=(E-2*n)/T,O=E/2-n,B=M/2-n,q=C/2,F=T+1,L=0,X=0,G=new P,U=new P;for(let H=0;H<o+1;H++){let $=H/o*jb,Y=Math.sin($)*n,J=(1-Math.cos($))*n,Z=Math.sin($),ne=Math.cos($);G[x]=(B+Y)*_,G[w]=(q-J)*A,U[y]=0,U[x]=Z*Math.sign(G[x]),U[w]=ne*Math.sign(G[w]);for(let re=0;re<F;re++){let ie=re*I-O;G[y]=ie*S,u.push(G.x,G.y,G.z),h.push(U.x,U.y,U.z),d.push(re/T),d.push(0),L+=1}}for(let H=0;H<o;H++)for(let $=0;$<T;$++){let Y=p+$+F*H,J=p+$+F*(H+1),Z=p+($+1)+F*(H+1),ne=p+($+1)+F*H;c.push(Y,J,ne),c.push(J,Z,ne),X+=6}l.addGroup(f,X,D),f+=X,p+=L}function v(y,x,w){let S=new P,_=new P(e/2,t/2,i/2);_.subScalar(n);let A=[],E=y*x*w>0?(C,T,D)=>c.push(C,T,D):(C,T,D)=>c.push(C,D,T);for(let C=0;C<=o;C++){let T=[],D=jb*(1-C/o),I=Math.cos(D),O=Math.sin(D),B=0;for(let q=0;q<=C;q++){let F=Math.cos(B),L=Math.sin(B);S.x=I*F,S.y=O,S.z=I*L;let X=_.clone().addScaledVector(S,n);u.push(y*X.x,x*X.y,w*X.z),h.push(y*S.x,x*S.y,w*S.z),d.push(0,0),T.push(p++),B+=jb/C}A.push(T)}let M=A.length-1;for(let C=0;C<M;C++){let T=A[C],D=A[C+1],I=T.length-1;E(T[0],D[1],D[0]);for(let O=1;O<=I;O++)E(T[O-1],T[O],D[O]),E(T[O],D[O+1],D[O])}}}},KE=class extends Qe{constructor(e=[],t=[],i="",r=1,a=.2,s=4){super(),this.type="PolyhedronGeometryRound";let n=[],o=[],l=[];c(),u(),this.setAttribute("position",new Re(n,3)),this.setAttribute("normal",new Re(l,3)),this.setAttribute("uv",new Re(o,2));return;function c(){var F;a=Math.min(1-1e-5,a),a==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new P,p=d.clone(),f=new Nr,m=a*r,g=r-m,v=s+1,y=new P,x=(L,X)=>y.subVectors(L,X).normalize(),w=(L,X)=>Array(L).fill(void 0).map(X),S=w(e.length/3,(L,X)=>new P().fromArray(e,X*3).setLength(r)),_=[],A=1e6;for(let L=0;L<S.length;L++){let X=S[L],G=[],U,H,$,Y=1e10,J=-1;for(;(J=t.indexOf(L,J+1))!=-1;){let ie=J-J%3;U=t[ie+(J+1)%3],H=t[ie+(J+2)%3],$=X.distanceToSquared(S[U]),Y=Math.min(Y,$),G.push([U,H,$])}Y+=1e-6;let Z=[],ne=0,re=G.length;for(let ie=0;ie<re;ie++){[U,H,$]=G[ne];let le=((F=_[U])==null?void 0:F.includes(L))==!0;$<=Y&&Z.push(U+ +le*A),ne=G.findIndex(ue=>ue[0]==H)}_.push(Z)}let E=[];{let L=0,X=0,G,U,H=h==3;for(let $=0;$<=s;$++){G=$*($+1)/2,U=($+1)*($+2)/2;for(let Y=0;Y<s-$;Y++)[L,X]=[G+Y+$+2,U+Y+$+3],E.push(G,U,...H?[X,G]:[L,U],X,L),[G,U]=[L,X];E.push(G,U,G+s+2)}}let M=d.clone(),C=d.clone(),T=d.clone(),D=d.clone(),I=d.clone(),O=[],B=w(S.length,()=>w(h,()=>d.clone()));for(let L=0;L<S.length;L++){d.copy(S[L]).normalize(),M.copy(d).multiplyScalar(g);let X=_[L];for(let Z=0;Z<X.length;Z++){let ne=X[Z],re=X[(Z+1)%h];f.setFromPointsAndIndices(S,L,ne%A,re%A),f.b.sub(f.a).setLength(1e10).add(f.a),f.c.sub(f.a).setLength(1e10).add(f.a),f.closestPointToPoint(M,B[L][Z])}let G=[],U=[],H=[],$=new P;s==0&&[...B[L]].reduce((Z,ne)=>Z.add(ne),$).multiplyScalar(1/h);for(let Z=0;Z<h;Z++){let ne=[],re=(Z-1+h)%h,ie=B[L][re],le=B[L][Z];d.copy(ie).sub(M),p.copy(le).sub(M);let ue=M.angleTo(d),fe=d.angleTo(p),be=Math.cos(ue)*m;s==0?C.copy($):C.copy(M).setLength(g+be),U.push(be);let ke=[C,ie,le];for(let Ce=0;Ce<2;Ce++){let Ve=ke[Ce],je=ke[Ce+1];D.subVectors(Ve,M),I.subVectors(je,M),T.crossVectors(D,I).normalize();for(let Pe=0;Pe<v;Pe++){let Me=[ue,fe][Ce]*Pe/v;d.copy(D).applyAxisAngle(T,Me).add(M),G.push(d.clone()),Ce&&(x(d,M),ne.push([Pe==0?Ve:d.clone(),y.clone()]))}Ce&&(x(je,M),ne.push([je,y.clone()]))}H.push(ne)}O.push(H);let Y=2*v,J=2;for(let Z=0;Z<h;Z++){let ne=Y*Z,re=Y*((Z+1)%h),ie=[G[ne]];for(let ue=1;ue<v;ue++){D=G[ne+ue],I=G[re+ue],ie.push(D);for(let fe=1,be=ue-J+1;fe<=be;fe++)d.lerpVectors(D,I,fe/(be+1)),d.sub(M).setLength(U[Z]).add(M),ie.push(d.clone());ie.push(I)}for(let ue=0;ue<v;ue++)ie.push(G[ue+v+ne]);ie.push(G[re+v]);let le=E.map(ue=>ie[ue]);n.push(...le.map(ue=>[ue.x,ue.y,ue.z]).flat()),l.push(...le.map(ue=>(x(ue,M),[y.x,y.y,y.z])).flat())}}let q=[];for(let L=0;L<_.length;L++)for(let X=0;X<h;X++){let G=_[L][X];if(G<A){let U=_[G].findIndex(Y=>Y%A==L),H=O[L][X],$=O[G][U];for(let Y=0;Y<v;Y++){let J=H[Y],Z=$[v-Y],ne=H[Y+1],re=$[v-(Y+1)];[J,Z,ne,ne,Z,re].forEach(ie=>{n.push(ie[0].x,ie[0].y,ie[0].z),l.push(ie[1].x,ie[1].y,ie[1].z)})}q.push(H[0][0],$[v][0],H[v][0],$[0][0])}}for(;q.length;){let L,X,G,U;[L,X]=q.splice(0,2);let H=[L];for(;L!=X;)H.push(X),G=q.indexOf(X),U=G%2,X=q.splice(G-U,2)[1-U];y.subVectors(H[0],H[1]).cross(d.subVectors(H[0],H[2])).normalize();let $=y.dot(H[0])<0;$&&y.negate();for(let Y=1;Y<=H.length-2;Y++)[H[Y+ +$],H[Y+1-+$],H[0]].forEach(J=>{n.push(J.x,J.y,J.z),l.push(y.x,y.y,y.z)})}}function u(){let h=new P;for(let _=0;_<n.length;_+=3){h.x=n[_+0],h.y=n[_+1],h.z=n[_+2];let A=w(h)/2/Math.PI+.5,E=S(h)/Math.PI+.5;o.push(A,1-E)}let d=new P,p=new P,f=new P,m=new P,g=new Q,v=new Q,y=new Q,x=(_,A,E,M)=>{M<0&&_.x===1&&(o[A]=_.x-1),E.x===0&&E.z===0&&(o[A]=M/2/Math.PI+.5)};for(let _=0,A=0;_<n.length;_+=9,A+=6){d.set(n[_+0],n[_+1],n[_+2]),p.set(n[_+3],n[_+4],n[_+5]),f.set(n[_+6],n[_+7],n[_+8]),g.set(o[A+0],o[A+1]),v.set(o[A+2],o[A+3]),y.set(o[A+4],o[A+5]),m.copy(d).add(p).add(f).divideScalar(3);let E=w(m);x(g,A+0,d,E),x(v,A+2,p,E),x(y,A+4,f,E)}for(let _=0;_<o.length;_+=6){let A=o[_+0],E=o[_+2],M=o[_+4],C=Math.max(A,E,M),T=Math.min(A,E,M);C>.9&&T<.1&&(A<.2&&(o[_+0]+=1),E<.2&&(o[_+2]+=1),M<.2&&(o[_+4]+=1))}function w(_){return Math.atan2(_.z,-_.x)}function S(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}}static fromJSON(e){return new KE(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},Cre=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:a,corner:s,cornerSides:n}=e.parameters,o=a===0&&s!==0?new Qz(t*.5,s,n):new i5(t*.5,a);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},Qz=class extends KE{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,a=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-r,0,-a,r,0,a,-r,0,a,r,-a,-r,0,-a,r,0,a,-r,0,a,r,0,-r,0,-a,r,0,-a,-r,0,a,r,0,a],n=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,n,o,e,t,i),this.type=o}static fromJSON(e){return new Qz(e.radius,e.corner,e.cornerSides)}},Bp=1e-12,$E=class{constructor(e){this.position=new Q,this.startPosition=new Q,this.uuid=Ge.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new $E(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},eS=class extends $E{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new eS(this.parent).copy(this)}},nd=class extends $E{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new eS(this),new eS(this))}static create(e,t){let i=new nd(e,new Q(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return t===0?this.controls[1]:t===1?this.controls[0]:null}applyOffsetToControls(e,t=1){for(let i=0,r=this.controls.length;i<r;i++){let a=this.controls[i];this.position.distanceTo(a.position)<=t?a.position.copy(this.position):a.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new nd(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var i,r;let e=(i=this.curveBefore)==null?void 0:i.getTangentAt(1),t=(r=this.curveAfter)==null?void 0:r.getTangentAt(0);return[e,t]}computeNormals(e=new Q,t=new Q){let[i,r]=this.computeTangents();return i&&r&&(WD(i,e),WD(r,t)),[e,t]}computeTangent(e=new Q){let[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(e=new Q){let[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function WD(e,t=new Q){let i=e.length();return t.set(-e.y/i,e.x/i)}var JE=e=>e,lp=new Q,B1=new Q,Mre=new Q,Tre=new Q,Pre=new Q,Dre=new Q,Zz=new P,Kz=new P;function Ore(e){let t=new Q;t.addVectors(e.v0,lp.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new Q;return i.addVectors(e.v2,B1.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Ks(e.v0,t,i,e.v2)}function hf(e,t,i=Number.EPSILON){return Math.abs(e-t)<i}function Ire(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function Rre(e,t,i=Number.EPSILON){return e.distanceTo(t)<i}function $z(e,t,i){let r=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),a=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((a*a+r*r-s*s)/(2*a*r))}function Lre(e,t,i){return XD(e,t)&&XD(t,i)&&tS(e.position,t.position,i.position)}function tS(e,t,i){return lp.copy(t).sub(e).cross(B1.copy(i).sub(e))===0}function kre(e,t,i,r,a){let s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),n=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.y-t.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.x-e.x)/s;return r.set(o+l,n+c),a.set(o-l,n-c),[r,a]}function zre(e,t,i){let r=e.distanceTo(i),a=t.distanceTo(i);return r<a?t:e}function Nre(e,t,i,r,a,s){let n=t.x-e.x,o=t.y-e.y,l=i.x-e.x,c=i.y-e.y,u=Math.sqrt((n+l)*(n+l)+(o+c)*(o+c)),h;return $z(t,e,i)>Math.PI&&(u*=-1),hf(c,o)?h=(o+c)*(r/u-.5)*8/3/(n-l):h=(n+l)*(r/u-.5)*8/3/(c-o),a.set(t.x-h*o,t.y+h*n),s.set(i.x+h*c,i.y-h*l),[a,s]}function qD(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function XD(e,t){return tS(e.position,e.controls[1].position,t.position)&&tS(e.position,t.controls[0].position,t.position)}function Bre(e,t,i,r,a=.5){let s=lp.subVectors(t,e).multiplyScalar(a).add(e),n=B1.subVectors(i,t).multiplyScalar(a).add(t),o=Mre.subVectors(r,i).multiplyScalar(a).add(i),l=s,c=Tre.subVectors(n,s).multiplyScalar(a).add(s),u=Pre.subVectors(o,n).multiplyScalar(a).add(n),h=o,d=Dre.subVectors(u,c).multiplyScalar(a).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function jre(e,t,i=12,r=!0){let a=Kz.set(0,0,0),s,n=0;for(let o=0;o<t.length;o++){let l=JE(t[o]),c=lp,u=ah(l,i);for(let h=0;h<=u;h++)if(l instanceof Ks||l instanceof nc||l instanceof an){if(l.getPoint(h/u,c),a.set(c.x,c.y,0),s!==void 0&&Rre(s,a))continue;s===void 0&&(s=Zz),s.copy(a),e.setXYZ(n,a.x,a.y,a.z),n++}}return r&&n>1&&!(e.getX(n-1)===e.getX(0)&&e.getY(n-1)===e.getY(0)&&e.getZ(n-1)===e.getZ(0))&&(e.setXYZ(n,e.getX(0),e.getY(0),e.getZ(0)),n++),e}function Fre(e,t,i,r=12,a=!0){let s=Kz.set(0,0,0),n=0,o=[];for(let l=0;l<t.length;l++){if(i[l]===!1)continue;let c,u=JE(t[l]),h=lp,d=ah(u,r);o.push(d);for(let p=0;p<=d;p++)if(u instanceof Ks||u instanceof nc||u instanceof an){if(u.getPoint(p/d,h),s.set(h.x,h.y,0),c==null?void 0:c.equals(s))continue;c===void 0?c=Zz:(e.setXYZ(n,c.x,c.y,c.z),n++,e.setXYZ(n,s.x,s.y,s.z),n++),c.copy(s)}}return a&&n>1&&!(e.getX(n-1)===e.getX(0)&&e.getY(n-1)===e.getY(0)&&e.getZ(n-1)===e.getZ(0))&&(e.setXYZ(n,e.getX(0),e.getY(0),e.getZ(0)),n++),o}function YD(e,t=12,i=!1){let r=[];for(let a=0,s=e.length;a<s;a++){let n=e[a],o=0;if(i&&n.roundedCurveCorner!==void 0){let l=ah(n.roundedCurveCorner,t)*.5;a>0&&(r[a-1]+=l),o+=l}n.curveAfter!==void 0&&(o+=ah(n.curveAfter,t)),r.push(o)}return e.length>0&&i&&e[0].roundedCurveCorner!==void 0&&(r[e.length-1]+=ah(e[0].roundedCurveCorner,t)*.5),r}function ah(e,t=12){return e&&e instanceof _1?t*2:e&&(e instanceof an||e instanceof Jk)?1:e&&e instanceof pE?t*e.points.length:t}function Ure(e,t,i=12,r=!0){let a,s=0;for(let n=0;n<t.length;n++){let o=JE(t[n]),l=ah(o,i),c=lp;for(let u=0;u<=l;u++)if(o instanceof Ks||o instanceof nc||o instanceof an){if(o.getPoint(u/l,c),a!==void 0&&Ire(a,c,Bp))continue;a===void 0&&(a=B1),a.copy(c),e.push(c.x,c.y),s++}}return hf(e[0],e[e.length-2],Bp)&&hf(e[1],e[e.length-1],Bp)&&(e.pop(),e.pop()),r&&s>1&&!(hf(e[s-1],e[1],Bp)&&hf(e[s-2],e[0],Bp))&&(e.push(e[0],e[1]),s++),e}var Fb=new Q,Vre=new Q,Gre=new Q,Hre=new Q,Wre=new Q,qre=new Q,Ri=class extends ey{constructor(e=100,t=100){super(),this.points=[],this.shapeHoles=[],this.plane=new Ya(new P(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Ge.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let r=new Ri;return r.isClosed=e.isClosed,r.points=e.points.map(a=>nd.create(a.id,a.data)),typeof e.roundness=="number"&&(r.roundness=e.roundness),r.shapeHoles=e.shapeHoles.map(a=>Ri.createFromState(a)),t!==void 0&&i!==void 0&&r.applySize(t,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map(t=>this.getPointIndexById(t)).filter(t=>t>=0)}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex(r=>r.uuid===e);if(i<0){let r=t;for(let a=0,s=this.shapeHoles.length;a<s;a++){let n=this.shapeHoles[a],o=n.points.length,l=n.getPointIndexById(e);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let a=this.shapeHoles[i],s=e-t;if(s<=a.points.length-1)return a.points[s];t+=a.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let a=this.shapeHoles[i],s=a.points.indexOf(e);if(s>=0)return t+s;t+=a.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map(t=>t.points));return[...this.points,...e]}applySize(e,t){e===0&&(e=.001),t===0&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=Fb.set(e,t);for(let r=0,a=this.points.length;r<a;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,a=this.shapeHoles.length;r<a;r++)this.shapeHoles[r].applyScale(e,t);this._update()}createPoint(e,t=0,i=Ge.generateUUID()){let r;e instanceof Q?r=e:r=new Q(e,t);let a=new nd(i,r);return a.roundness=this.roundness,a}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(r.uuid===e)return r}for(let t=0,i=this.shapeHoles.length;t<i;t++){let r=this.shapeHoles[t].getPointByUuid(e);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find(i=>i.uuid===e);t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e,t=12,i=!1){this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t);let r=i?this.roundedCurveDivisions:this.curveDivisions;return jre(e,i?this.roundedCurves:this.curves,t,this.autoClose),r.reduce((a,s)=>a+s,0)+1}computeCurveDivisions(e=12){return this.curveDivisions=YD(this.points,e,!1),this.roundedCurveDivisions=YD(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t,i=12){return Fre(e,this.curves,t,i,this.autoClose).reduce((r,a)=>r+a,0)*2}extractShapePointsToFlatArray(e,t=12){return this.subdivision=t,this.curveDivisions===void 0&&this.computeCurveDivisions(t),Ure(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e,t=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=t?this.roundedCurveDivisions:this.curveDivisions,a=0;t&&this.points[0].roundedCurveCorner!==void 0&&(a=ah(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=e-a;s<0&&(s+=r.reduce((n,o)=>n+o,0));for(let n=0,o=r.length;n<o;n++){let l=r[n];if(s<i+l)return[n,(s-i+1)/l];i+=l}return[0,1]}getCurveT(e,t,i){let r=this.points[e],a=this.points[e>=this.points.length-1?0:e+1],s=this.curveDivisions,n=s[e];if(qD(r,a)){let l=r.position.distanceTo(a.position);return r.position.distanceTo(Fb.set(i.x,i.y))/l}let o=0;for(let l=0;l<e;l++)o+=s[l];return(t-o)/n}dispose(){}_applyCurveForPoint(e,t){qD(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let r=i.clone();e.roundedCurveBefore=r,t.roundedCurveAfter=r,e.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let t=0,i=this.points.length;t<i;t++){let r=this.points[t];if(t===0)this.moveTo(r.position.x,r.position.y);else{let a=this.points[t-1];this._applyCurveForPoint(r,a)}}let e=this.getLastPoint();if(e!=null&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let t=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(t,i)}if(this.points.length>2){let t=0;for(let i=0,r=this.points.length;i<r;i++){let a=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],n=this.points[i+1]??this.points[0],o=a.roundness,l=s&&n&&Lre(s,a,n);if(!a.controlsMoved()&&o>0&&!l){let c=a.curveBefore,u=a.curveAfter;if(c===void 0||u===void 0)continue;let h=a.roundedCurveBefore,d=a.roundedCurveAfter,p=c.getLength(),f=u.getLength(),m=Math.min(o,p*.499),g=Math.min(o,f*.499),v=Math.min(m,g),y=1-v/p,x=v/f,w=c.getPointAt(y,Fb),S=u.getPointAt(x,Vre);this._subSplitCurve(c,h,y,w,void 0),this._subSplitCurve(u,d,x,void 0,S);let _;if(this.useCubicForRoundedCorners){let A=$z(w,a.position,S)/2,E=Math.tan(A)*w.distanceTo(a.position),[M,C]=kre(w,S,E,Gre,Hre),T=zre(M,C,a.position),[D,I]=Nre(T,w,S,E,Wre,qre);_=new Ks(w.clone(),D.clone(),I.clone(),S.clone())}else _=new nc(w.clone(),a.position.clone(),S.clone());a.roundedCurveCorner=_,this.roundedCurves.splice(i+t,0,_),t++}}}}_subSplitCurve(e,t,i,r,a){if(e instanceof an)r!==void 0&&t.v2.copy(r),a!==void 0&&t.v1.copy(a);else{let s=e,n=t,o=s.getUtoTmapping(i,0),l=Bre(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(n.v0.set(l[0],l[1]),n.v1.set(l[2],l[3]),n.v2.set(l[4],l[5]),n.v3.set(l[6],l[7])),a!==void 0&&(n.v0.set(l[6],l[7]),n.v1.set(l[8],l[9]),n.v2.set(l[10],l[11]),n.v3.set(l[12],l[13])),n}return t}clone(){let e=new Ri(this._width,this._height);return e.points=this.points.map(t=>t.clone()),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map(t=>t.clone()),e}toJSON(){return{points:this.points.reduce((e,t)=>e.concat(t.toJSON()),[]),shapeHoles:this.shapeHoles.map(e=>e.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var i;this.points=[],this.pointIDs=0;let t=e.points.length/7;for(let r=0;r<t;r++){let a=r*7,s=e.points[a+0],n=e.points[a+1],o=e.points[a+2],l=e.points[a+3],c=e.points[a+4],u=e.points[a+5],h=e.points[a+6],d=new nd(Ge.generateUUID(),new Q(s,n));d.controls[0].position.set(o,l),d.controls[1].position.set(c,u),d.roundness=h,this.points.push(d)}return this.shapeHoles=(i=e.shapeHoles)!=null&&i.length?e.shapeHoles.map(r=>{let a=new Ri;return a.fromJSON(r),a}):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e,t=!1){this.isText=t;let i=(a,s)=>{s instanceof Ks&&s.v3.equals(a.position)&&a.controls[0].position.copy(s.v2)},r=a=>{let s=[],n,o;for(n=0,o=a.length;n<o;n++)a[n]instanceof nc&&(a[n]=Ore(a[n]));for(n=0,o=a.length;n<o;n++){let u=a[n],h=n>0?a[n-1]:null,d;u instanceof Ks?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof an&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=a[a.length-1],c=!1;return l instanceof Ks?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof an&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(e.curves),e instanceof ey&&(this.shapeHoles=e.holes.map(a=>{let s=new Ri;return s.fromShape(a),s})),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(t.position!==void 0&&i.position.fromArray(t.position),t.roundness!==void 0&&(i.roundness=t.roundness),t.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[0];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var r;let i=(r=this.getPointByUuid(e))==null?void 0:r.controls[1];i&&(t.position&&i.position.fromArray(t.position),this.needsUpdate=!0)}},iS=Math.PI*2;function Ub({x:e,y:t},i,r,a,s){return{x:e*i+a,y:t*r+s}}function Xre(e,t){let i=t===1.5707963267948966?.551915024494:t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=Math.cos(e),a=Math.sin(e),s=Math.cos(e+t),n=Math.sin(e+t);return[{x:r-a*i,y:a+r*i},{x:s+n*i,y:n-s*i},{x:s,y:n}]}function QD(e,t,i,r){let a=e*r-t*i<0?-1:1,s=Math.min(1,Math.max(-1,e*i+t*r));return a*Math.acos(s)}function Yre(e,t,i,r,a,s,n,o,l,c){let u=Math.pow(a,2),h=Math.pow(s,2),d=Math.pow(n,2),p=Math.pow(o,2),f=u*h-u*p-h*d;f<0&&(f=0),f/=u*p+h*d,f=Math.sqrt(f)*(l===c?-1:1);let m=f*a/s*o,g=f*-s/a*n,v=m+(e+i)/2,y=g+(t+r)/2,x=(n-m)/a,w=(o-g)/s,S=(-n-m)/a,_=(-o-g)/s,A=QD(1,0,x,w),E=QD(x,w,S,_);return!c&&E>0&&(E-=iS),c&&E<0&&(E+=iS),{centerx:v,centery:y,ang1:A,ang2:E}}function Qre({px:e,py:t,cx:i,cy:r,rx:a,ry:s,largeArcFlag:n,sweepFlag:o}){let l=[];if(a===0||s===0)return[];let c=(e-i)/2,u=(t-r)/2;if(c===0&&u===0)return[];a=Math.abs(a),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(a,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(a*=Math.sqrt(h),s*=Math.sqrt(h));let d=Yre(e,t,i,r,a,s,c,u,n,o),{ang1:p,ang2:f}=d,{centerx:m,centery:g}=d,v=Math.abs(f)/(iS/4);Math.abs(1-v)<1e-7&&(v=1);let y=Math.max(Math.ceil(v),1);f/=y;for(let x=0;x<y;x++)l.push(Xre(p,f)),p+=f;return l.map(x=>{let{x:w,y:S}=Ub(x[0],a,s,m,g),{x:_,y:A}=Ub(x[1],a,s,m,g),{x:E,y:M}=Ub(x[2],a,s,m,g);return{x1:w,y1:S,x2:_,y2:A,x:E,y:M}})}var $t;(function(e){e[e.ODD=0]="ODD",e[e.NONZERO=1]="NONZERO",e[e.POSITIVE=2]="POSITIVE",e[e.NEGATIVE=3]="NEGATIVE",e[e.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})($t||($t={}));var Ji;(function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(Ji||(Ji={}));function lt(e,t){if(!e)throw t||"Assertion Failed!"}var $e=function(){function e(){}return e.vertEq=function(t,i){return t.s===i.s&&t.t===i.t},e.vertLeq=function(t,i){return t.s<i.s||t.s===i.s&&t.t<=i.t},e.transLeq=function(t,i){return t.t<i.t||t.t===i.t&&t.s<=i.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(t,i){return Math.abs(t.s-i.s)+Math.abs(t.t-i.t)},e.edgeEval=function(t,i,r){lt(e.vertLeq(t,i)&&e.vertLeq(i,r));var a=i.s-t.s,s=r.s-i.s;return a+s>0?a<s?i.t-t.t+(t.t-r.t)*(a/(a+s)):i.t-r.t+(r.t-t.t)*(s/(a+s)):0},e.edgeSign=function(t,i,r){lt(e.vertLeq(t,i)&&e.vertLeq(i,r));var a=i.s-t.s,s=r.s-i.s;return a+s>0?(i.t-r.t)*a+(i.t-t.t)*s:0},e.transEval=function(t,i,r){lt(e.transLeq(t,i)&&e.transLeq(i,r));var a=i.t-t.t,s=r.t-i.t;return a+s>0?a<s?i.s-t.s+(t.s-r.s)*(a/(a+s)):i.s-r.s+(r.s-t.s)*(s/(a+s)):0},e.transSign=function(t,i,r){lt(e.transLeq(t,i)&&e.transLeq(i,r));var a=i.t-t.t,s=r.t-i.t;return a+s>0?(i.s-r.s)*a+(i.s-t.s)*s:0},e.vertCCW=function(t,i,r){return t.s*(i.t-r.t)+i.s*(r.t-t.t)+r.s*(t.t-i.t)>=0},e.interpolate=function(t,i,r,a){return t=t<0?0:t,r=r<0?0:r,t<=r?r===0?(i+a)/2:i+(a-i)*(t/(t+r)):a+(i-a)*(r/(t+r))},e.intersect=function(t,i,r,a,s){var n,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(r,a)||(l=r,r=a,a=l),e.vertLeq(t,r)||(l=t,t=r,r=l,l=i,i=a,a=l),e.vertLeq(r,i)?e.vertLeq(i,a)?(n=e.edgeEval(t,r,i),o=e.edgeEval(r,i,a),n+o<0&&(n=-n,o=-o),s.s=e.interpolate(n,r.s,o,i.s)):(n=e.edgeSign(t,r,i),o=-e.edgeSign(t,a,i),n+o<0&&(n=-n,o=-o),s.s=e.interpolate(n,r.s,o,a.s)):s.s=(r.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(r,a)||(l=r,r=a,a=l),e.transLeq(t,r)||(l=t,t=r,r=l,l=i,i=a,a=l),e.transLeq(r,i)?e.transLeq(i,a)?(n=e.transEval(t,r,i),o=e.transEval(r,i,a),n+o<0&&(n=-n,o=-o),s.t=e.interpolate(n,r.t,o,i.t)):(n=e.transSign(t,r,i),o=-e.transSign(t,a,i),n+o<0&&(n=-n,o=-o),s.t=e.interpolate(n,r.t,o,a.t)):s.t=(r.t+i.t)/2},e}(),jp=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return e}(),uv=function(){function e(t){this.side=t,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(t){this.Sym.Lface=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(t){this.Sym.Org=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(t){this.Sym.Lnext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(t){this.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(t){this.Lnext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(t){this.Sym.Onext=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(t){this.Sym.Onext.Sym=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(t){this.Sym.Lnext.Sym=t},enumerable:!0,configurable:!0}),e}(),_u=function(){function e(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return e}(),ZD=function(){function e(){var t=new _u,i=new jp,r=new uv(0),a=new uv(1);t.next=t.prev=t,t.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=a,a.next=a,a.Sym=r,this.vHead=t,this.fHead=i,this.eHead=r,this.eHeadSym=a}return e.prototype.makeEdge_=function(t){var i=new uv(0),r=new uv(1);t.Sym.side<t.side&&(t=t.Sym);var a=t.Sym.next;return r.next=a,a.Sym.next=i,i.next=t,t.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},e.prototype.splice_=function(t,i){var r=t.Onext,a=i.Onext;r.Sym.Lnext=i,a.Sym.Lnext=t,t.Onext=a,i.Onext=r},e.prototype.makeVertex_=function(t,i,r){var a=t;lt(a,"Vertex can't be null!");var s=r.prev;a.prev=s,s.next=a,a.next=r,r.prev=a,a.anEdge=i;var n=i;do n.Org=a,n=n.Onext;while(n!==i)},e.prototype.makeFace_=function(t,i,r){var a=t;lt(a,"Face can't be null");var s=r.prev;a.prev=s,s.next=a,a.next=r,r.prev=a,a.anEdge=i,a.trail=null,a.marked=!1,a.inside=r.inside;var n=i;do n.Lface=a,n=n.Lnext;while(n!==i)},e.prototype.killEdge_=function(t){t.Sym.side<t.side&&(t=t.Sym);var i=t.next,r=t.Sym.next;i.Sym.next=r,r.Sym.next=i},e.prototype.killVertex_=function(t,i){var r=t.anEdge,a=r;do a.Org=i,a=a.Onext;while(a!==r);var s=t.prev,n=t.next;n.prev=s,s.next=n},e.prototype.killFace_=function(t,i){var r=t.anEdge,a=r;do a.Lface=i,a=a.Lnext;while(a!==r);var s=t.prev,n=t.next;n.prev=s,s.next=n},e.prototype.makeEdge=function(){var t=new _u,i=new _u,r=new jp,a=this.makeEdge_(this.eHead);return this.makeVertex_(t,a,this.vHead),this.makeVertex_(i,a.Sym,this.vHead),this.makeFace_(r,a,this.fHead),a},e.prototype.splice=function(t,i){var r=!1,a=!1;if(t!==i){if(i.Org!==t.Org&&(a=!0,this.killVertex_(i.Org,t.Org)),i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(i,t),!a){var s=new _u;this.makeVertex_(s,i,t.Org),t.Org.anEdge=t}if(!r){var n=new jp;this.makeFace_(n,i,t.Lface),t.Lface.anEdge=t}}},e.prototype.delete=function(t){var i=t.Sym,r=!1;if(t.Lface!==t.Rface&&(r=!0,this.killFace_(t.Lface,t.Rface)),t.Onext===t)this.killVertex_(t.Org,null);else if(t.Rface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev),!r){var a=new jp;this.makeFace_(a,t,t.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(t.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(t)},e.prototype.addEdgeVertex=function(t){var i=this.makeEdge_(t),r=i.Sym;this.splice_(i,t.Lnext),i.Org=t.Dst;var a=new _u;return this.makeVertex_(a,r,i.Org),i.Lface=r.Lface=t.Lface,i},e.prototype.splitEdge=function(t){var i=this.addEdgeVertex(t),r=i.Sym;return this.splice_(t.Sym,t.Sym.Oprev),this.splice_(t.Sym,r),t.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=t.Rface,r.winding=t.winding,r.Sym.winding=t.Sym.winding,r.idx=t.idx,r.Sym.idx=t.Sym.idx,r},e.prototype.connect=function(t,i){var r=!1,a=this.makeEdge_(t),s=a.Sym;if(i.Lface!==t.Lface&&(r=!0,this.killFace_(i.Lface,t.Lface)),this.splice_(a,t.Lnext),this.splice_(s,i),a.Org=t.Dst,s.Org=i.Org,a.Lface=s.Lface=t.Lface,t.Lface.anEdge=s,!r){var n=new jp;this.makeFace_(n,a,t.Lface)}return a},e.prototype.zapFace=function(t){var i=t.anEdge,r,a,s,n,o;a=i.Lnext;do r=a,a=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);n=t.prev,o=t.next,o.prev=n,n.next=o},e.prototype.countFaceVerts_=function(t){var i=t.anEdge,r=0;do r++,i=i.Lnext;while(i!==t.anEdge);return r},e.prototype.mergeConvexFaces=function(t){var i,r,a,s,n,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,n=r.Org;a=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=t&&$e.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&$e.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(a=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===n);)r=a;return!0},e.prototype.check=function(){var t=this.fHead,i=this.vHead,r=this.eHead,a,s,n,o,l,c;for(s=t,s=t;(a=s.next)!==t;s=a){lt(a.prev===s),l=a.anEdge;do lt(l.Sym!==l),lt(l.Sym.Sym===l),lt(l.Lnext.Onext.Sym===l),lt(l.Onext.Sym.Lnext===l),lt(l.Lface===a),l=l.Lnext;while(l!==a.anEdge)}for(lt(a.prev===s&&a.anEdge===null),o=i,o=i;(n=o.next)!==i;o=n){lt(n.prev===o),l=n.anEdge;do lt(l.Sym!==l),lt(l.Sym.Sym===l),lt(l.Lnext.Onext.Sym===l),lt(l.Onext.Sym.Lnext===l),lt(l.Org===n),l=l.Onext;while(l!==n.anEdge)}for(lt(n.prev===o&&n.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)lt(l.Sym.next===c.Sym),lt(l.Sym!==l),lt(l.Sym.Sym===l),lt(l.Org!==null),lt(l.Dst!==null),lt(l.Lnext.Onext.Sym===l),lt(l.Onext.Sym.Lnext===l);lt(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},e}(),KD=function(){function e(){this.handle=null}return e}(),$D=function(){function e(){this.key=null,this.node=0}return e}(),Zre=function(){function e(t,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=t,this.nodes=[],this.handles=[];for(var r=0;r<t+1;r++)this.nodes[r]=new KD,this.handles[r]=new $D;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(t){var i=this.nodes,r=this.handles,a,s,n;for(a=i[t].handle;;){if(n=t<<1,n<this.size&&this.leq(r[i[n+1].handle].key,r[i[n].handle].key)&&++n,lt(n<=this.max),s=i[n].handle,n>this.size||this.leq(r[a].key,r[s].key)){i[t].handle=a,r[a].node=t;break}i[t].handle=s,r[s].node=t,t=n}},e.prototype.floatUp_=function(t){var i=this.nodes,r=this.handles,a,s,n;for(a=i[t].handle;;){if(n=t>>1,s=i[n].handle,n===0||this.leq(r[s].key,r[a].key)){i[t].handle=a,r[a].node=t;break}i[t].handle=s,r[s].node=t,t=n}},e.prototype.init=function(){for(var t=this.size;t>=1;--t)this.floatDown_(t);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(t){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var a,s;for(s=this.nodes.length,this.nodes.length=this.max+1,a=s;a<this.nodes.length;a++)this.nodes[a]=new KD;for(s=this.handles.length,this.handles.length=this.max+1,a=s;a<this.handles.length;a++)this.handles[a]=new $D}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=t,this.initialized&&this.floatUp_(i),r},e.prototype.extractMin=function(){var t=this.nodes,i=this.handles,r=t[1].handle,a=i[r].key;return this.size>0&&(t[1].handle=t[this.size].handle,i[t[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),a},e.prototype.delete=function(t){var i=this.nodes,r=this.handles,a;lt(t>=1&&t<=this.max&&r[t].key!==null),a=r[t].node,i[a].handle=i[this.size].handle,r[i[a].handle].node=a,--this.size,a<=this.size&&(a<=1||this.leq(r[i[a>>1].handle].key,r[i[a].handle].key)?this.floatDown_(a):this.floatUp_(a)),r[t].key=null,r[t].node=this.freeList,this.freeList=t},e}(),Vb=function(){function e(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return e}(),JD=function(){function e(){this.key=null,this.next=null,this.prev=null}return e}(),Kre=function(){function e(t,i){this.frame=t,this.leq=i,this.head=new JD,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(t){return this.insertBefore(this.head,t)},e.prototype.search=function(t){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,t,i.key));return i},e.prototype.insertBefore=function(t,i){do t=t.prev;while(t.key!==null&&!this.leq(this.frame,t.key,i));var r=new JD;return r.key=i,r.next=t.next,t.next.prev=r,r.prev=t,t.next=r,r},e.prototype.delete=function(t){t.next.prev=t.prev,t.prev.next=t.next},e}(),$re=function(){function e(){}return e.regionBelow=function(t){return t.nodeUp.prev.key},e.regionAbove=function(t){return t.nodeUp.next.key},e.debugEvent=function(t){},e.addWinding=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.edgeLeq=function(t,i,r){var a=t.event,s=i.eUp,n=r.eUp;if(s.Dst===a)return n.Dst===a?$e.vertLeq(s.Org,n.Org)?$e.edgeSign(n.Dst,s.Org,n.Org)<=0:$e.edgeSign(s.Dst,n.Org,s.Org)>=0:$e.edgeSign(n.Dst,a,n.Org)<=0;if(n.Dst===a)return $e.edgeSign(s.Dst,a,s.Org)>=0;var o=$e.edgeEval(s.Dst,a,s.Org),l=$e.edgeEval(n.Dst,a,n.Org);return o>=l},e.deleteRegion=function(t,i){i.fixUpperEdge&&lt(i.eUp.winding===0),i.eUp.activeRegion=null,t.dict.delete(i.nodeUp)},e.fixUpperEdge=function(t,i,r){lt(i.fixUpperEdge),t.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},e.topLeftRegion=function(t,i){var r=i.eUp.Org,a;do i=e.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(a=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext),a===null)return null;e.fixUpperEdge(t,i,a),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do t=e.regionAbove(t);while(t.eUp.Dst===i);return t},e.addRegionBelow=function(t,i,r){var a=new Vb;return a.eUp=r,a.nodeUp=t.dict.insertBefore(i.nodeUp,a),a.fixUpperEdge=!1,a.sentinel=!1,a.dirty=!1,r.activeRegion=a,a},e.isWindingInside=function(t,i){switch(t.windingRule){case $t.ODD:return(i&1)!==0;case $t.NONZERO:return i!==0;case $t.POSITIVE:return i>0;case $t.NEGATIVE:return i<0;case $t.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var r=i.eUp,a=r.Lface;a.inside=i.inside,a.anEdge=r,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,r){for(var a,s=null,n=i,o=i.eUp;n!==r;){if(n.fixUpperEdge=!1,s=e.regionBelow(n),a=s.eUp,a.Org!=o.Org){if(!s.fixUpperEdge){e.finishRegion(t,n);break}a=t.mesh.connect(o.Lprev,a.Sym),e.fixUpperEdge(t,s,a)}o.Onext!==a&&(t.mesh.splice(a.Oprev,a),t.mesh.splice(o,a)),e.finishRegion(t,n),o=s.eUp,n=s}return o},e.addRightEdges=function(t,i,r,a,s,n){var o,l,c,u,h=!0;c=r;do lt($e.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext;while(c!==a);for(s===null&&(s=e.regionBelow(i).eUp.Rprev),l=i,u=s;o=e.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!h&&e.checkForRightSplice(t,l)&&(e.addWinding(c,u),e.deleteRegion(t,l),t.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,lt(l.windingNumber-c.winding===o.windingNumber),n&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(t,i,r){t.mesh.splice(i,r)},e.vertexWeights=function(t,i,r){var a=$e.vertL1dist(i,t),s=$e.vertL1dist(r,t),n=.5*s/(a+s),o=.5*a/(a+s);t.coords[0]+=n*i.coords[0]+o*r.coords[0],t.coords[1]+=n*i.coords[1]+o*r.coords[1],t.coords[2]+=n*i.coords[2]+o*r.coords[2]},e.getIntersectData=function(t,i,r,a,s,n){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,r,a),e.vertexWeights(i,s,n)},e.checkForRightSplice=function(t,i){var r=e.regionBelow(i),a=i.eUp,s=r.eUp;if($e.vertLeq(a.Org,s.Org)){if($e.edgeSign(s.Dst,a.Org,s.Org)>0)return!1;$e.vertEq(a.Org,s.Org)?a.Org!==s.Org&&(t.pq.delete(a.Org.pqHandle),e.spliceMergeVertices(t,s.Oprev,a)):(t.mesh.splitEdge(s.Sym),t.mesh.splice(a,s.Oprev),i.dirty=r.dirty=!0)}else{if($e.edgeSign(a.Dst,s.Org,a.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(a.Sym),t.mesh.splice(s.Oprev,a)}return!0},e.checkForLeftSplice=function(t,i){var r=e.regionBelow(i),a=i.eUp,s=r.eUp,n;if(lt(!$e.vertEq(a.Dst,s.Dst)),$e.vertLeq(a.Dst,s.Dst)){if($e.edgeSign(a.Dst,s.Dst,a.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,n=t.mesh.splitEdge(a),t.mesh.splice(s.Sym,n),n.Lface.inside=i.inside}else{if($e.edgeSign(s.Dst,a.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,n=t.mesh.splitEdge(s),t.mesh.splice(a.Lnext,s.Sym),n.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var r=e.regionBelow(i),a=i.eUp,s=r.eUp,n=a.Org,o=s.Org,l=a.Dst,c=s.Dst,u,h,d=new _u,p,f;if(lt(!$e.vertEq(c,l)),lt($e.edgeSign(l,t.event,n)<=0),lt($e.edgeSign(c,t.event,o)>=0),lt(n!==t.event&&o!==t.event),lt(!i.fixUpperEdge&&!r.fixUpperEdge),n===o||(u=Math.min(n.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if($e.vertLeq(n,o)){if($e.edgeSign(c,n,o)>0)return!1}else if($e.edgeSign(l,o,n)<0)return!1;return e.debugEvent(t),$e.intersect(l,n,c,o,d),lt(Math.min(n.t,l.t)<=d.t),lt(d.t<=Math.max(o.t,c.t)),lt(Math.min(c.s,l.s)<=d.s),lt(d.s<=Math.max(o.s,n.s)),$e.vertLeq(d,t.event)&&(d.s=t.event.s,d.t=t.event.t),p=$e.vertLeq(n,o)?n:o,$e.vertLeq(p,d)&&(d.s=p.s,d.t=p.t),$e.vertEq(d,n)||$e.vertEq(d,o)?(e.checkForRightSplice(t,i),!1):!$e.vertEq(l,t.event)&&$e.edgeSign(l,t.event,d)>=0||!$e.vertEq(c,t.event)&&$e.edgeSign(c,t.event,d)<=0?c===t.event?(t.mesh.splitEdge(a.Sym),t.mesh.splice(s.Sym,a),i=e.topLeftRegion(t,i),a=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),r),e.addRightEdges(t,i,a.Oprev,a,a,!0),!0):l===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(a.Lnext,s.Oprev),r=i,i=e.topRightRegion(i),f=e.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=e.finishLeftRegions(t,r,null),e.addRightEdges(t,i,s.Onext,a.Rprev,f,!0),!0):($e.edgeSign(l,t.event,d)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(a.Sym),a.Org.s=t.event.s,a.Org.t=t.event.t),$e.edgeSign(c,t.event,d)<=0&&(i.dirty=r.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),!1):(t.mesh.splitEdge(a.Sym),t.mesh.splitEdge(s.Sym),t.mesh.splice(s.Oprev,a),a.Org.s=d.s,a.Org.t=d.t,a.Org.pqHandle=t.pq.insert(a.Org),e.getIntersectData(t,a.Org,n,l,o,c),e.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var r=e.regionBelow(i),a,s;;){for(;r.dirty;)i=r,r=e.regionBelow(r);if(!i.dirty&&(r=i,i=e.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,a=i.eUp,s=r.eUp,a.Dst!==s.Dst&&e.checkForLeftSplice(t,i)&&(r.fixUpperEdge?(e.deleteRegion(t,r),t.mesh.delete(s),r=e.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(a),i=e.regionAbove(r),a=i.eUp)),a.Org!==s.Org)if(a.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(a.Dst===t.event||s.Dst===t.event)){if(e.checkForIntersect(t,i))return}else e.checkForRightSplice(t,i);a.Org===s.Org&&a.Dst===s.Dst&&(e.addWinding(s,a),e.deleteRegion(t,i),t.mesh.delete(a),i=e.regionAbove(r))}},e.connectRightVertex=function(t,i,r){var a,s=r.Onext,n=e.regionBelow(i),o=i.eUp,l=n.eUp,c=!1;if(o.Dst!==l.Dst&&e.checkForIntersect(t,i),$e.vertEq(o.Org,t.event)&&(t.mesh.splice(s.Oprev,o),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),n),c=!0),$e.vertEq(l.Org,t.event)&&(t.mesh.splice(r,l.Oprev),r=e.finishLeftRegions(t,n,null),c=!0),c){e.addRightEdges(t,i,r.Onext,s,s,!0);return}$e.vertLeq(l.Org,o.Org)?a=l.Oprev:a=o,a=t.mesh.connect(r.Lprev,a),e.addRightEdges(t,i,a,a.Onext,a.Onext,!1),a.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i)},e.connectLeftDegenerate=function(t,i,r){var a,s,n,o,l;if(a=i.eUp,$e.vertEq(a.Org,r)){lt(!1),e.spliceMergeVertices(t,a,r.anEdge);return}if(!$e.vertEq(a.Dst,r)){t.mesh.splitEdge(a.Sym),i.fixUpperEdge&&(t.mesh.delete(a.Onext),i.fixUpperEdge=!1),t.mesh.splice(r.anEdge,a),e.sweepEvent(t,r);return}lt(!1),i=e.topRightRegion(i),l=e.regionBelow(i),n=l.eUp.Sym,s=o=n.Onext,l.fixUpperEdge&&(lt(s!==n),e.deleteRegion(t,l),t.mesh.delete(n),n=s.Oprev),t.mesh.splice(r.anEdge,n),$e.edgeGoesLeft(s)||(s=null),e.addRightEdges(t,i,n.Onext,o,s,!0)},e.connectLeftVertex=function(t,i){var r,a,s,n,o,l,c=new Vb;if(c.eUp=i.anEdge.Sym,r=t.dict.search(c).key,a=e.regionBelow(r),!!a){if(n=r.eUp,o=a.eUp,$e.edgeSign(n.Dst,i,n.Org)===0){e.connectLeftDegenerate(t,r,i);return}if(s=$e.vertLeq(o.Dst,n.Dst)?r:a,r.inside||s.fixUpperEdge){if(s===r)l=t.mesh.connect(i.anEdge.Sym,n.Lnext);else{var u=t.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?e.fixUpperEdge(t,s,l):e.computeWinding(t,e.addRegionBelow(t,r,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,r,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){e.connectLeftVertex(t,i);return}var a=e.topLeftRegion(t,r.activeRegion);lt(a!==null);var s=e.regionBelow(a),n=s.eUp,o=e.finishLeftRegions(t,s,null);o.Onext===n?e.connectRightVertex(t,a,o):e.addRightEdges(t,a,o.Onext,n,n,!0)},e.addSentinel=function(t,i,r,a){var s=new Vb,n=t.mesh.makeEdge();n.Org.s=r,n.Org.t=a,n.Dst.s=i,n.Dst.t=a,t.event=n.Dst,s.eUp=n,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=t.dict.insert(s)},e.initEdgeDict=function(t){t.dict=new Kre(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],r=t.bmax[1]-t.bmin[1],a=t.bmin[0]-i,s=t.bmax[0]+i,n=t.bmin[1]-r,o=t.bmax[1]+r;e.addSentinel(t,a,s,n),e.addSentinel(t,a,s,o)},e.doneEdgeDict=function(t){for(var i,r=0;(i=t.dict.min().key)!==null;)i.sentinel||(lt(i.fixUpperEdge),lt(++r===1)),lt(i.windingNumber===0),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,r,a,s=t.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,a=i.Lnext,$e.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,a,i),t.mesh.delete(i),i=a,a=i.Lnext),a.Lnext===i&&(a!==i&&((a===r||a===r.Sym)&&(r=r.next),t.mesh.delete(a)),(i===r||i===r.Sym)&&(r=r.next),t.mesh.delete(i))},e.initPriorityQ=function(t){var i,r,a,s=0;for(a=t.mesh.vHead,r=a.next;r!==a;r=r.next)s++;for(s+=8,i=t.pq=new Zre(s,$e.vertLeq),a=t.mesh.vHead,r=a.next;r!==a;r=r.next)r.pqHandle=i.insert(r);return r!==a?!1:(i.init(),!0)},e.donePriorityQ=function(t){t.pq=null},e.removeDegenerateFaces=function(t,i){var r,a,s;for(r=i.fHead.next;r!==i.fHead;r=a)a=r.next,s=r.anEdge,lt(s.Lnext!==s),s.Lnext.Lnext===s&&(e.addWinding(s.Onext,s),t.mesh.delete(s));return!0},e.computeInterior=function(t,i){i===void 0&&(i=!0);var r,a;if(e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);(r=t.pq.extractMin())!==null;){for(;a=t.pq.min(),!(a===null||!$e.vertEq(a,r));)a=t.pq.extractMin(),e.spliceMergeVertices(t,r.anEdge,a.anEdge);e.sweepEvent(t,r)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),e.removeDegenerateFaces(t,t.mesh)?(i&&t.mesh.check(),!0):!1},e}(),Jre=function(){function e(){this.mesh=new ZD,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=$t.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},e.prototype.normalize_=function(t){var i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),t[0]/=i,t[1]/=i,t[2]/=i},e.prototype.longAxis_=function(t){var i=0;return Math.abs(t[1])>Math.abs(t[0])&&(i=1),Math.abs(t[2])>Math.abs(t[i])&&(i=2),i},e.prototype.computeNormal_=function(t){var i,r,a,s,n,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],p=[null,null,null],f=[null,null,null],m=this.mesh.vHead;i=m.next;for(var g=0;g<3;++g)s=i.coords[g],c[g]=s,f[g]=i,l[g]=s,p[g]=i;for(i=m.next;i!==m;i=i.next)for(var v=0;v<3;++v)s=i.coords[v],s<c[v]&&(c[v]=s,f[v]=i),s>l[v]&&(l[v]=s,p[v]=i);var y=0;if(l[1]-c[1]>l[0]-c[0]&&(y=1),l[2]-c[2]>l[y]-c[y]&&(y=2),c[y]>=l[y]){t[0]=0,t[1]=0,t[2]=1;return}for(o=0,r=f[y],a=p[y],u[0]=r.coords[0]-a.coords[0],u[1]=r.coords[1]-a.coords[1],u[2]=r.coords[2]-a.coords[2],i=m.next;i!==m;i=i.next)h[0]=i.coords[0]-a.coords[0],h[1]=i.coords[1]-a.coords[1],h[2]=i.coords[2]-a.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],n=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],n>o&&(o=n,t[0]=d[0],t[1]=d[1],t[2]=d[2]);o<=0&&(t[0]=t[1]=t[2]=0,t[this.longAxis_(u)]=1)},e.prototype.checkOrientation_=function(){for(var t=this.mesh.fHead,i,r=this.mesh.vHead,a,s=0,n=t.next;n!==t;n=n.next)if(a=n.anEdge,!(a.winding<=0))do s+=(a.Org.s-a.Dst.s)*(a.Org.t+a.Dst.t),a=a.Lnext;while(a!==n.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var t=this.mesh.vHead,i=[0,0,0],r,a,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,a=this.tUnit;var n=this.longAxis_(i);r[n]=0,r[(n+1)%3]=1,r[(n+2)%3]=0,a[n]=0,a[(n+1)%3]=0,a[(n+2)%3]=i[n]>0?1:-1;for(var o=t.next;o!==t;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,a);s&&this.checkOrientation_();for(var l=!0,c=t.next;c!==t;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},e.prototype.addWinding_=function(t,i){t.winding+=i.winding,t.Sym.winding+=i.Sym.winding},e.prototype.tessellateMonoRegion_=function(t,i){var r,a;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;$e.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;$e.vertLeq(r.Org,r.Dst);r=r.Lnext);a=r.Lprev;for(var s=void 0;r.Lnext!==a;)if($e.vertLeq(r.Dst,a.Org)){for(;a.Lnext!==r&&($e.edgeGoesLeft(a.Lnext)||$e.edgeSign(a.Org,a.Dst,a.Lnext.Dst)<=0);)s=t.connect(a.Lnext,a),a=s.Sym;a=a.Lprev}else{for(;a.Lnext!==r&&($e.edgeGoesRight(r.Lprev)||$e.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=t.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(a.Lnext===r)throw"Mono region invalid";for(;a.Lnext.Lnext!==r;)s=t.connect(a.Lnext,a),a=s.Sym;return!0},e.prototype.tessellateInterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(t,r))return!1;return!0},e.prototype.discardExterior_=function(t){for(var i,r=t.fHead.next;r!==t.fHead;r=i)i=r.next,r.inside||t.zapFace(r)},e.prototype.setWindingNumber_=function(t,i,r){for(var a,s=t.eHead.next;s!==t.eHead;s=a)a=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?t.delete(s):s.winding=0},e.prototype.getNeighbourFace_=function(t){return!t.Rface||!t.Rface.inside?-1:t.Rface.n},e.prototype.outputPolymesh_=function(t,i,r,a){var s,n=0,o=0,l;r>3&&t.mergeConvexFaces(r);for(var c=t.vHead.next;c!==t.vHead;c=c.next)c.n=-1;for(var u=t.fHead.next;u!==t.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=n,++n}this.elementCount=n,i===Ji.CONNECTED_POLYGONS&&(n*=2),this.elements=[],this.elements.length=n*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*a,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=t.vHead.next;c!==t.vHead;c=c.next)if(c.n!==-1){var h=c.n*a;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],a>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=t.fHead.next;u!==t.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1;if(i===Ji.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1}}},e.prototype.outputContours_=function(t,i){var r,a,s=0,n=0;this.vertexCount=0,this.elementCount=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){a=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==a);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=t.fHead.next;o!==t.fHead;o=o.next)if(o.inside){n=0,a=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,n++,r=r.Lnext;while(r!==a);this.elements[u++]=s,this.elements[u++]=n,s+=n}},e.prototype.addContour=function(t,i){this.mesh===null&&(this.mesh=new ZD),t<2&&(t=2),t>3&&(t=3);for(var r=null,a=0;a<i.length;a+=t)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[a+0],r.Org.coords[1]=i[a+1],t>2?r.Org.coords[2]=i[a+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},e.prototype.tesselate=function(t,i,r,a,s,n){if(t===void 0&&(t=$t.ODD),i===void 0&&(i=Ji.POLYGONS),n===void 0&&(n=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=t,a<2&&(a=2),a>3&&(a=3),!this.mesh)return!1;this.projectPolygon_(),$re.computeInterior(this,n);var o=this.mesh;return i===Ji.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),n&&o.check(),i===Ji.BOUNDARY_CONTOURS?this.outputContours_(o,a):this.outputPolymesh_(o,i,r,a),!0},e}();function Vl(e){var t=e.windingRule,i=t===void 0?$t.ODD:t,r=e.elementType,a=r===void 0?Ji.POLYGONS:r,s=e.polySize,n=s===void 0?3:s,o=e.vertexSize,l=o===void 0?2:o,c=e.normal,u=c===void 0?[0,0,1]:c,h=e.contours,d=h===void 0?[]:h,p=e.strict,f=p===void 0?!0:p,m=e.debug,g=m===void 0?!1:m;if(!d&&f)throw new Error("Contours can't be empty");if(d){var v=new Jre;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<d.length;y++)v.addContour(l||2,d[y]);return v.tesselate(i,a,n,l,u,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}$t.ODD;$t.NONZERO;$t.POSITIVE;$t.NEGATIVE;$t.ABS_GEQ_TWO;Ji.POLYGONS;Ji.CONNECTED_POLYGONS;Ji.BOUNDARY_CONTOURS;var rS=class{constructor(e=256,t=!1){this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log(`allocating with cap ${e}`);let i=e*rS.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,a=0;this.positions=new Float32Array(this.buffer,a*r,3*e),a+=3*e,this.normals=new Float32Array(this.buffer,a*r,3*e),a+=3*e,this.uvs=new Float32Array(this.buffer,a*r,2*e)}realloc(e,t=!1){if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log(`resizing from ${this.capacity} → ${e}`);let i=e*rS.eSize,r=new ArrayBuffer(i),a=Float32Array.BYTES_PER_ELEMENT,s=0,n=new Float32Array(r,s*a,3*e);s+=3*e;let o=new Float32Array(r,s*a,3*e);s+=3*e;let l=new Float32Array(r,s*a,2*e);t?(n.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(n.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=n,this.normals=o,this.uvs=l,this.capacity=e}get(e=1){let t=this.size+e;if(t>this.capacity){let r=this.capacity;for(;t>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log(`shrinking ${this.capacity} → ${this.size}`),this.realloc(this.size,!0)}},Jz=rS;Jz.eSize=8*Float32Array.BYTES_PER_ELEMENT;var eae=ar(n8()),eC={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},eN={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},tN={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},Gb=(e,t)=>([i,r])=>(r<i&&(r+=t),(e>=i?e:e+t)<=r),tC=class extends Qe{constructor(e,t,i=0,r=12,a=3,s=$t.ODD,n=!1){super(),this.forPathBevel=n,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=r,this._bevelSegmentsInput=a;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(M=>{let C=M.extractShapePointsToFlatArray([],r),T=[];for(let D=C.length-1;D>=1;D-=2){let I=C[D-1],O=C[D-0];T.push(I,O)}return T}),c=[],u=[];for(let M=0;M<o.length;M+=2)u.push([o[M],o[M+1]]);c.push(u);for(let M=0;M<l.length;M++){let C=l[M],T=[];for(let D=0;D<C.length;D+=2)T.push([C[D],C[D+1]]);c.push(T)}let h;e.isText?h=new y5().setFromPoints(e.points.map(M=>M.position)).getSize(new Q).length()*.1:c[0].length===0?h=i:h=(0,eae.default)(c).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,t/2),this._bevelSegments=Math.floor(a));let d;try{d=Vl({windingRule:s,elementType:Ji.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=eC}let p;try{p=Vl({windingRule:$t.ODD,elementType:Ji.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{p=eN}if(!d)throw new Error("error generating geometry");let f=d.elementCount;if(p){d.elementCount+=p.elementCount;for(let M=0;M<p.elements.length;M++){let C=p.elements[M],T=M%2===0?d.vertexCount:0;d.elements.push(C+T)}for(let M=0;M<p.vertexIndices.length;M++){let C=p.vertexIndices[M],T=d.vertexCount;d.vertexIndices.push(C+T)}for(let M=0;M<p.vertices.length;M++){let C=p.vertices[M];d.vertices.push(C)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let M=0,C=d.vertexCount;M<C;M++){let T=M*2,D=d.vertices[T+0],I=d.vertices[T+1];D<m&&(m=D),D>g&&(g=D),I<v&&(v=I),I>y&&(y=I)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new Jz(this._computeBufferEstimatedSize(d));let x=[],w=[];for(let M=d.elementCount-1;M>=0;M--){let C=M>=f,T=M*2,D=d.elements[T+0],I=d.elements[T+1],O=D+I,B={start:D,count:I,normals:[],continuous:[],concave:[]},q=D,F=O-1,L=D+1,X=this._shape.roundedCurves.length;do{let Y=q-D,J=d.vertices[F*2+0],Z=d.vertices[F*2+1],ne=d.vertices[q*2+0],re=d.vertices[q*2+1],ie=d.vertices[L*2+0],le=d.vertices[L*2+1],ue=ne-J,fe=re-Z,be=Math.sqrt(ue*ue+fe*fe);ue/=be,fe/=be;let ke=ne-ie,Ce=re-le,Ve=Math.sqrt(ke*ke+Ce*Ce);ke/=Ve,Ce/=Ve,B.normals[Y*2+0]=-Ce,B.normals[Y*2+1]=ke,B.concave[Y]=ue*Ce-fe*ke>0;let je=d.vertexIndices[q];if(Array.isArray(je))B.continuous[Y]=!1;else{let[Pe,Me]=this._shape.getCurveIndexFromVertexId(je-1,!0);if(Me>0&&Me<1)B.continuous[Y]=!0;else{let Ze=Me===1?Pe+1:Pe-1;Ze=(Ze+X)%X;let qe=Me===1?0:1,W=this._shape.roundedCurves[Pe].getTangent(Me),N=this._shape.roundedCurves[Ze].getTangent(qe);B.continuous[Y]=W.dot(N)>.95}}C&&(B.normals[Y*2+0]*=-1,B.normals[Y*2+1]*=-1),[F,q,L]=[q,L,L+1],L>=O&&(L-=I)}while(L!==D+1);let G=[];G.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(D*2,O*2),vertexCount:I,vertexIndices:new Array(I).fill(!0).map((Y,J)=>[J,J]),elements:[0,I],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(D*2,O*2)});let U=0;for(let Y=1;Y<=this._bevelSegments;Y++){let J=Y/this._bevelSegments*Math.PI/2,Z=(1-Math.cos(J))*this._bevel,ne=[],re=[],ie=0;for(let ue=0;ue<I;ue++){let fe=ue*2,be=(ue-1+I)%I*2,ke=d.vertices[B.start*2+fe+0],Ce=d.vertices[B.start*2+fe+1],Ve=-B.normals[be+0]*Z,je=-B.normals[be+1]*Z,Pe=-B.normals[fe+0]*Z,Me=-B.normals[fe+1]*Z;if(B.concave[ue]||!B.concave[ue]&&C){let Ze=Math.atan2(je,Ve),qe=Math.atan2(Me,Pe);qe>Ze&&(qe-=Math.PI*2);let W=qe-Ze;if(B.continuous[ue]||C){let N=Ze+W/2,oe=Math.cos(N)*Z,Ae=Math.sin(N)*Z;ne[2*ie+0]=ke+oe*(C?-1:1),ne[2*ie+1]=Ce+Ae*(C?-1:1),re[ie]=ue,ie++}else{let N=Math.max(1,Math.floor(r/4*Math.abs(W)/Math.PI));for(let oe=0;oe<=N;oe++){let Ae=Ze+W*(oe/N),k=Math.cos(Ae)*Z,De=Math.sin(Ae)*Z;ne[2*ie+0]=ke+k,ne[2*ie+1]=Ce+De,re[ie]=ue,ie++}}}else ne[2*ie+0]=ke+Ve,ne[2*ie+1]=Ce+je,re[ie]=ue,ie++,ne[2*ie+0]=ke,ne[2*ie+1]=Ce,re[ie]=ue,ie++,ne[2*ie+0]=ke+Pe,ne[2*ie+1]=Ce+Me,re[ie]=ue,ie++}let le=Vl({windingRule:$t.POSITIVE,elementType:Ji.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[ne],edgeCreateCallback:ue=>{let fe=ue.Org.idx,be=re[fe],ke=re[(fe+1)%re.length];ue.idx=[be,ke],ue.Sym.idx=[ke,be]},vertexIdCallback:ue=>{let fe=ue.Lprev.idx;return[fe?fe[1]:0,ue.idx?ue.idx[0]:0]}});if(!le)throw console.log("Error"),new Error(`error generating bevel geometry for ${Y}'th loop`);if(!le.vertexCount){let ue=(Y-1)/this._bevelSegments*Math.PI/2;U=(1-Math.sin(ue))*this._bevel;break}for(let ue=0;ue<le.vertexIndices.length;ue++){let[fe,be]=le.vertexIndices[ue];if(fe===be)continue;let ke=be;be<fe&&(ke+=I);for(let Ce=fe;Ce<ke;Ce++){let Ve=Ce%I,je=(Ce+1)%I;if(!B.continuous[Ve]||!B.continuous[je]){le.vertexIndices[ue]=[fe,Ve],le.vertexIndices.splice(ue+1,0,[je,be]),le.vertices.splice((ue+1)*2,0,le.vertices[ue*2],le.vertices[ue*2+1]);break}}}G.push({bevelI:Y,angle:J,size:Z,boundary:le,reverseMap:re,insetPoints:ne})}let H=(Y,J,Z)=>{let ne=0,re=Y.boundary.vertexIndices.length;for(;ne<re&&Z(Y.boundary.vertexIndices[J]);)J=(J+1)%re,ne++;return ne},$=x.length;for(let Y=1;Y<G.length;Y++){let J=G[Y-1],Z=G[Y],ne=J.boundary.vertexIndices.length,re=Z.boundary.vertexIndices.length;if(!ne||!re)break;let ie=B.concave.length,le=0,ue=Gb(le,I);for(;!J.boundary.vertexIndices.filter(ue).length||!Z.boundary.vertexIndices.filter(ue).length;)le++,ue=Gb(le,I);let fe=J.boundary.vertexIndices.findIndex(ue),be=Z.boundary.vertexIndices.findIndex(ue);do fe=(fe+1)%ne;while(ue(J.boundary.vertexIndices[fe]));do be=(be+1)%re;while(ue(Z.boundary.vertexIndices[be]));le=(le+1)%I;let ke=le,Ce=0,Ve=this._buildBevelVert(B,J,(fe-1+ne)%ne,void 0,Ce),je=this._buildBevelVert(B,Z,(be-1+re)%re,void 0,Ce),Pe=Ve,Me=je,Ze,qe,W=!1;do{Ce=(le||ie)/ie,ue=Gb(le,I);let N=H(J,fe,ue),oe=H(Z,be,ue),Ae=W;if(W=!1,N&&!oe){for(let k=0;k<N;k++)Ze=this._buildBevelVert(B,J,(fe+k)%ne,k/(N-1),Ce),x.push(Pe.topN,Ze.topP,Me.topN),n===!1&&x.push(Ze.bottomP,Pe.bottomN,Me.bottomN),Pe=Ze;W=!0}else if(!N&&oe)for(let k=0;k<oe;k++)qe=this._buildBevelVert(B,Z,(be+k)%re,k/(oe-1),Ce),x.push(Me.topN,Pe.topP,qe.topP),n===!1&&x.push(Pe.bottomP,Me.bottomN,qe.bottomP),Me=qe;else if(N&&oe)if(Ze=this._buildBevelVert(B,J,fe,0,Ce),qe=this._buildBevelVert(B,Z,be,0,Ce),Ae?(x.push(Pe.topN,qe.topP,Me.topN),x.push(Pe.topN,Ze.topP,qe.topP),n===!1&&(x.push(qe.bottomP,Pe.bottomN,Me.bottomN),x.push(qe.bottomP,Ze.bottomP,Pe.bottomN))):(x.push(Me.topN,Pe.topN,Ze.topP),x.push(Me.topN,Ze.topP,qe.topP),n===!1&&(x.push(Ze.bottomP,Pe.bottomN,Me.bottomN),x.push(Ze.bottomP,Me.bottomN,qe.bottomP))),Pe=Ze,Me=qe,N===oe)for(let k=1;k<N;k++)Ze=this._buildBevelVert(B,J,(fe+k)%ne,k/(N-1),Ce),qe=this._buildBevelVert(B,Z,(be+k)%re,k/(oe-1),Ce),x.push(Pe.topN,Ze.topP,Me.topN),x.push(Me.topN,Ze.topP,qe.topP),n===!1&&(x.push(Ze.bottomP,Pe.bottomN,Me.bottomN),x.push(Ze.bottomP,Me.bottomN,qe.bottomP)),Pe=Ze,Me=qe;else if(N>oe){let k=N/oe,De=0;for(let Ue=1;Ue<N;Ue++)Ze=this._buildBevelVert(B,J,(fe+Ue)%ne,Ue/(N-1),Ce),x.push(Pe.topN,Ze.topP,Me.topN),n===!1&&x.push(Ze.bottomP,Pe.bottomN,Me.bottomN),Pe=Ze,Ue>(De+1)*k&&(De++,qe=this._buildBevelVert(B,Z,(be+De)%re,De/(oe-1),Ce),x.push(Me.topN,Ze.topP,qe.topP),n===!1&&x.push(Ze.bottomP,Me.bottomN,qe.bottomP),Me=qe)}else{let k=oe/N,De=0;for(let Ue=1;Ue<oe;Ue++)qe=this._buildBevelVert(B,Z,(be+Ue)%re,Ue/(oe-1),Ce),x.push(Me.topN,Ze.topP,qe.topP),n===!1&&x.push(Ze.bottomP,Me.bottomN,qe.bottomP),Me=qe,Ue>(De+1)*k&&(De++,Ze=this._buildBevelVert(B,J,(fe+De)%ne,De/(N-1),Ce),x.push(Pe.topN,Ze.topP,Me.topN),n===!1&&x.push(Ze.bottomP,Pe.bottomN,Me.bottomN),Pe=Ze)}fe=(fe+N)%ne,be=(be+oe)%re,le=(le+1)%ie}while(le!==ke)}if(n===!1&&this._depth>this._bevel*2&&this._buildWall(G,B,x),C){let Y=[];for(let J=x.length-1;J>=$+2;J-=3){let Z=x[J-2],ne=x[J-1],re=x[J-0];Y.push(re,ne,Z)}x.splice($,x.length-$,...Y)}if(C){let Y=[];for(let J=G[G.length-1].boundary.vertices.length-1;J>=1;J-=2){let Z=G[G.length-1].boundary.vertices[J-1],ne=G[G.length-1].boundary.vertices[J-0];Y.push(Z,ne)}w.push(Y)}if(!C){let Y=G[G.length-1],J;try{J=Vl({windingRule:G.length>1?$t.POSITIVE:$t.ODD,elementType:Ji.POLYGONS,vertexSize:2,strict:!0,contours:[Y.insetPoints,...w]})}catch{J=tN}if(!J)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let Z=0;Z<J.elementCount*3;Z+=3){let ne=this._buildSurfaceVert(J,J.elements[Z+0],U),re=this._buildSurfaceVert(J,J.elements[Z+1],U),ie=this._buildSurfaceVert(J,J.elements[Z+2],U);x.push(ne.top,re.top,ie.top),n===!1&&x.push(ie.bottom,re.bottom,ne.bottom)}}this.vertexCache={}}this._buffer.shrink();let S=new ht(Uint32Array.from(x),1),_=new ht(this._buffer.positions,3),A=new ht(this._buffer.normals,3),E=new ht(this._buffer.uvs,2);_.needsUpdate=!0,A.needsUpdate=!0,E.needsUpdate=!0,S.needsUpdate=!0,this.setAttribute("position",_),this.setAttribute("normal",A),this.setAttribute("uv",E),this.setIndex(S)}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let a=0,s=r.boundary.vertexCount;a<s;a++){let n=this._buildBevelVert(t,r,a),o=this._buildBevelVert(t,r,(a+1)%s);i.push(o.topP,n.topN,n.bottomN),i.push(o.topP,n.bottomN,o.bottomP)}}_buildSurfaceVert(e,t,i){let r=t.toString();if(r in this.vertexCache)return this.vertexCache[r];let a=e.vertices[t*2+0],s=e.vertices[t*2+1],n=(a-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=a,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=n,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=a,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=n,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(e,t,i,r=1,a){let s=`${t.bevelI}:${i}`;if(s in this.vertexCache&&a!==0&&a!==1&&(!a||a===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[n,o]=t.boundary.vertexIndices[i],l,c,u,h;n!==o?(c=n,l=o,h=!1,u=e.continuous[c]&&e.continuous[l]):(l=n,c=(l-1+e.count)%e.count,h=e.concave[l]&&t.bevelI>0,u=e.continuous[l]||h);let d=Math.cos(t.angle),p=Math.sin(t.angle),f=i*2,m=l*2,g=c*2,v=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],x=(1-p)*this._bevel,w=(v-this._minX)/this._width,S=(y-this._minY)/this._height;this.forPathBevel&&(a!==void 0&&(w=a),S=1);let _=e.normals[m+0],A=e.normals[m+1],E=e.normals[g+0],M=e.normals[g+1];if(h){let O=E-_,B=M-A;_=_+O*(1-r),A=A+B*(1-r);let q=Math.sqrt(_*_+A*A);_/=q,A/=q}let C=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),T=C*3,D=C*2,I={i,fi:l,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:a};return this._buffer.positions[T+0]=v,this._buffer.positions[T+1]=y,this._buffer.positions[T+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[T+0]=_*d,this._buffer.normals[T+1]=A*d,this._buffer.normals[T+2]=p,this._buffer.uvs[D+0]=w,this._buffer.uvs[D+1]=S,this.forPathBevel===!1&&(this._buffer.positions[T+3]=v,this._buffer.positions[T+4]=y,this._buffer.positions[T+5]=x,this._buffer.normals[T+3]=_*d,this._buffer.normals[T+4]=A*d,this._buffer.normals[T+5]=-p,this._buffer.uvs[D+2]=S,this._buffer.uvs[D+3]=w),u||(this.forPathBevel?(C+=1,T+=3,D+=2):(C+=2,T+=6,D+=4),I.topP=C+0,I.bottomP=C+1,this._buffer.positions[T+0]=v,this._buffer.positions[T+1]=y,this._buffer.positions[T+2]=(this.forPathBevel?this._bevel:this._depth)-x,this._buffer.normals[T+0]=E*d,this._buffer.normals[T+1]=M*d,this._buffer.normals[T+2]=p,this._buffer.uvs[D+0]=w,this._buffer.uvs[D+1]=S,this.forPathBevel===!1&&(this._buffer.positions[T+3]=v,this._buffer.positions[T+4]=y,this._buffer.positions[T+5]=x,this._buffer.normals[T+3]=E*d,this._buffer.normals[T+4]=M*d,this._buffer.normals[T+5]=-p,this._buffer.uvs[D+2]=S,this._buffer.uvs[D+3]=w)),this.vertexCache[s]=I,I}clone(){let e=new tC(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=O1(this.userData),e}},iN=class extends Qe{constructor(e,t=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=$t.ODD,this.elementType=Ji.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=t,this._triangulationOptions=Object.assign({windingRule:$t.ODD,elementType:Ji.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),a=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,n=!0,o=!0,l,c;for(let d=0,p=r.length/2;d<p;d++){let f=d*2,m=r[f+0],g=r[f+1];if(l!==void 0&&m!==l&&(n=!1),c!==void 0&&g!==c&&(o=!1),l=m,c=g,!n&&!o)break}if(!n&&!o)try{s=Vl({contours:[r,...a],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=eC}let u=(s==null?void 0:s.vertexCount)??1,h=(s==null?void 0:s.elementCount)??1;if(this._positionAttribute=new ht(new Float32Array(u*3),3),this._normalAttribute=new ht(new Float32Array(u*3),3),this._uvAttribute=new ht(new Float32Array(u*2),2),this._indexAttribute=new ht(new Uint32Array(h*3),1),s){let d=1/0,p=-1/0,f=1/0,m=-1/0;for(let y=0,x=u;y<x;y++){let w=y*2,S=s.vertices[w+0],_=s.vertices[w+1];S<d&&(d=S),S>p&&(p=S),_<f&&(f=_),_>m&&(m=_)}let g=p-d,v=m-f;for(let y=0,x=u;y<x;y++){let w=y*2,S=s.vertices[w+0],_=s.vertices[w+1],A=(S-d)/g,E=(_-f)/v;this._positionAttribute.setXYZ(y,S,_,0),this._normalAttribute.setXYZ(y,0,0,1),this._uvAttribute.setXY(y,A,E)}for(let y=0,x=h;y<x;y++){let w=y*3,S=s.elements[w+0],_=s.elements[w+1],A=s.elements[w+2];this._indexAttribute.setX(w+0,S),this._indexAttribute.setX(w+1,_),this._indexAttribute.setX(w+2,A)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,((s==null?void 0:s.elementCount)??1)*3)}clone(){let e=new iN(this._shape,this._curveSegments);return e.userData=O1(this.userData),e}},rN=class extends tC{constructor(e,t,i=0,r=12,a=3,s=$t.ODD){super(e,t,i,r,a,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return e.vertexCount*2*(2+this._bevelSegments)}_buildWall(e,t,i){let r=e[0];for(let a=0,s=r.boundary.vertexCount;a<s;a++){let n=this._buildBevelVert(t,r,a),o=this._buildBevelVert(t,r,(a+1)%s);i.push(o.topP,n.topN,n.bottomN),i.push(o.topP,n.bottomN,o.bottomP)}}clone(){let e=new rN(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=O1(this.userData),e}},Th=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var c,u;let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:$t.ODD},e.parameters),r=Math.abs(i.width),a=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),n=e.shape??(t==null?void 0:t.shape),o=(n==null?void 0:n.roundness)??i.roundness;n!==void 0&&(n instanceof Ri?(n.width!==r||n.height!==a)&&n.applySize(r,a):n=new Ri(r,a).fromJSON(n),((c=e.parameters)==null?void 0:c.roundness)!==void 0&&((u=e.parameters)==null?void 0:u.roundness)>0&&n.update());let l=n??new Ri(r,a);return{parameters:Object.assign(i,{width:r,height:a,depth:s,roundness:o}),shape:l}}static build(e){let{depth:t,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:a,roundness:s,windingRule:n}=e.parameters;e.shape.roundness=s;let o;return t<=0?o=new iN(e.shape,a,{windingRule:n}):o=new rN(e.shape,t,i,a,r,n),Object.assign(o,{userData:{...e,type:"VectorGeometry"}})}},aN=Math.PI*2,iC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return i.angle=Ge.clamp(i.angle,0,360),{shape:e.shape&&e.shape instanceof Ri?e.shape:new Ri,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,angle:a,innerRadius:s,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c=e.shape,u=t*.5,h=i*.5,d=tae(c,u,h,a*Math.PI/180,r,s);c.isClosed=!0,c.update();let p;return a===0?(p=new Qe,p.setAttribute("position",new Re([],3))):p=Th.create({shape:c,parameters:{subdivisions:d,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(p,{userData:{...e,type:"EllipseGeometry"}})}};function tae(e,t,i,r,a,s){if(r>=aN)return a>30||a%4===0?(rae(e,t,i,s),Math.round(a/4)):eO(e,r,a,t,i,s);r=Math.max(r,.001);let n={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=Qre({px:n.x,py:n.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return a>30||a%c.length===0?iae(e,n.x,n.y,c,a,t,i,s):eO(e,r,a,t,i,s)}function iae(e,t,i,r,a,s,n,o){let l=Math.round(a/r.length);e.addPoint(od(t,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=e.points[c],p=od(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),p.controls[0].position.set(h.x2,h.y2),e.addPoint(p)}return o>0?sN(e,s,n,o):e.addPoint(od(0,0)),l}function eO(e,t,i,r,a,s){let n=-t/i;for(let o=0;o<=i;o++){let l=n*o,c=Math.sin(l)*r,u=Math.cos(l)*a;e.addPoint(od(c,u))}return t<aN?s>0?sN(e,r,a,s):e.addPoint(od(0,0)):(e.removePoint(e.points[e.points.length-1]),s>0&&nN(e,r,a,s)),1}function rae(e,t,i,r=0,a=0,s=0){let n=.5522847498,o=t*n,l=i*n;e.addPoint(dv(a-t,s,a-t,s-l,a-t,s+l)),e.addPoint(dv(a,s+i,a-o,s+i,a+o,s+i)),e.addPoint(dv(a+t,s,a+t,s+l,a+t,s-l)),e.addPoint(dv(a,s-i,a+o,s-i,a-o,s-i)),r>0&&nN(e,t,i,r)}function od(e,t){return new nd(Ge.generateUUID(),new Q(e,t))}function dv(e,t,i,r,a,s){let n=od(e,t);return n.controls[0].position.set(i,r),n.controls[1].position.set(a,s),n}function sN(e,t,i,r){oN(e,t,i,r).forEach(a=>e.addPoint(a))}function nN(e,t,i,r){let a=oN(e,t,i,r),s=new Ri;a.forEach(n=>s.addPoint(n)),s.isClosed=!0,e.shapeHoles.push(s)}function oN(e,t,i,r){let a=r*t/100,s=a*(Math.abs(i)/Math.abs(t)),n=new Q(a/t,s/i),o=e.points.map(l=>{let c=l.clone();return c.uuid=Ge.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(n);let c=l.controls[0].position.clone().multiply(n),u=l.controls[1].position.clone().multiply(n);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var aae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),r=Math.abs(i.width),a=Math.abs(i.height??r),s=Math.abs(i.depth??r),n=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:a,depth:s,radius:n,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(e){let{width:t,height:i,depth:r,radius:a,revolutions:s,segments:n,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=e.parameters,d=new lN(!1,t,i,r,a,s,n,o,l,c,u,h);return Object.assign(d,{userData:{...e,type:"HelixGeometry"}})}},Hb=new Ju([0,0,0],1),lN=class extends Qe{constructor(e=!0,t=1,i=1,r=1,a=1,s=1,n=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=e&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let p=()=>new P,f=new P,m=p(),g=p(),v=p(),y,x,w,S,_,A,E,M,C=p(),T=p(),D=p(),I=p(),O=p(),B=p(),q=p(),F=p(),L=i-2*o+.001,X=L/s,G=Math.ceil(n*s),U=G+1,H=L/G,$=-L/2,Y=c+1,J=2*Math.PI/c,Z=Math.PI/2/h,ne=.01,re=Math.min((1-u/100)*o,o-ne),ie=o-re,le=0,ue=2,fe=h*ue+ue,be=Y*fe/ue,ke=be+Y*U,Ce=Math.max(0,Y*(U+fe)),[Ve,je,Pe]=[3,3,2].map(de=>Array(Ce*de).fill(0)),Me=[],Ze=a-o;function qe(de,We){let ze=Math.PI/2;A=We*H,M=2*Math.PI*(A%X)/X+ze,A+=$,E=Math.sin(M)*Ze,_=Math.cos(M)*Ze,e?de.set(_,E,A):de.set(_,A,E)}qe(f,-1e-10),qe(m,0),C.copy(f),qe(f,1);let W=f.distanceTo(m),N=d?0:ie+re,oe=W*G+2*N,Ae=re,k=oe-N;for(let de=0;de<=G;de++){qe(g,de),F.subVectors(g,C).normalize(),C.copy(g),B.copy(g).setComponent(+e+1,0).normalize(),q.crossVectors(F,B).normalize();let We=de===0,ze=de===G,Xe=We?3*Math.PI/2:Z,it=We?Ae:k,Ke=We?Y:ke,et=We?0:Ce-Y,ii=F.clone().multiplyScalar(We?-ie:ie).add(g),vi=F.clone().multiplyScalar(We?-1:1).normalize();for(let ee=0;ee<Y;ee++){let me=ee*J;if(T.addVectors(f.copy(B).multiplyScalar(o*Math.cos(me)),m.copy(q).multiplyScalar(o*Math.sin(me))),D.copy(T).normalize(),We||ze){d||(le=et+ee,[0,1,2].forEach(_e=>{Ve[le*3+_e]=ii.getComponent(_e),je[le*3+_e]=vi.getComponent(_e)}),Pe[le*2]=+ze,Pe[le*2+1]=ee/c),m.copy(D).multiplyScalar(re),v.addVectors(g,m);for(let _e=0;_e<h;_e++){let Ne=_e*Z+Xe;I.addVectors(f.copy(F).multiplyScalar(ie*Math.sin(Ne)),m.copy(D).multiplyScalar(ie*Math.cos(Ne))),O.copy(I).normalize(),m.addVectors(v,I),I.normalize(),le=Ke+_e*Y+ee,[0,1,2].forEach(Pt=>{Ve[le*3+Pt]=m.getComponent(Pt),je[le*3+Pt]=O.getComponent(Pt)});let st=+We+Math.sin(Ne);Pe[le*2]=(it+ie*st)/oe,Pe[le*2+1]=ee/c}}m.addVectors(g,T),le=be+de*Y+ee,[0,1,2].forEach(_e=>{Ve[le*3+_e]=m.getComponent(_e),je[le*3+_e]=D.getComponent(_e)}),Pe[le*2]=(N+de*W)/oe,Pe[le*2+1]=ee/c}}let De=U+2*h+ue,[Ue,Le]=[+d,De-1];for(let de=Ue;de<=Le-1;de++){let We=d&&de===Le-1;for(let ze=0;ze<Y-1;ze++)y=de*Y+ze,x=y+1,w=(We?ze:y)+Y,S=(We?ze+1:x)+Y,de===0?Me.push(x,S,w):de===De-2?Me.push(y,x,w):Me.push(y,x,w,x,S,w)}this.setIndex(Me),this.setAttribute("position",new Re(Ve,3)),this.setAttribute("normal",new Re(je,3)),this.setAttribute("uv",new Re(Pe,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e=this.userData.parameters,t=Math.ceil(e.tubularSegments),i=e.radialSegments+1,r=Array.from(this.getIndex().array),a,s,n,o,l=6*(t-1)*e.radialSegments,c=t,u=c===t;for(let h=0;h<e.radialSegments;h++)a=c*i+h,s=a+1,n=(u?h:a)+i,o=(u?h+1:s)+i,r[l++]=a,r[l++]=s,r[l++]=n,r[l++]=s,r[l++]=o,r[l++]=n;return r.length=l,Hb.array=r,Hb.count=r.length,Hb}},sae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,detail:a,corner:s,cornerSides:n}=e.parameters,o=a===0&&s!==0?new cN(t*.5,s,n):new o5(t*.5,a);return o.scale(1,i/t,r/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},cN=class extends KE{constructor(e=1,t=.2,i=4){let r=(1+Math.sqrt(5))/2,a=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],n="IcosahedronGeometry";super(a,s,n,e,t,i),this.type=n}static fromJSON(e){return new cN(e.radius,e.corner,e.cornerSides)}},nae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var r;(((r=e.parameters)==null?void 0:r.points)??[]).forEach(a=>{Array.isArray(a)&&(a.x=a[0],a.y=a[1])});let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{points:t,segments:i,verticalSegments:r}=e.parameters,a=new ey;a.moveTo(t[0].x,t[0].y),a.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let s=new t5(a.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...e,type:"LatheGeometry"}})}},wn=new Se,Wb=new Yt,pv=new P,By=class extends Hr{constructor(){super(),this.uuid=Ge.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=new Ui().getNormalMatrix(e);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(e);for(let i=0,r=this.faces.length;i<r;i++){let a=this.faces[i];a.normal.applyMatrix3(t).normalize();for(let s=0,n=a.vertexNormals.length;s<n;s++)a.vertexNormals[s].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return wn.makeRotationX(e),this.applyMatrix4(wn),this}rotateY(e){return wn.makeRotationY(e),this.applyMatrix4(wn),this}rotateZ(e){return wn.makeRotationZ(e),this.applyMatrix4(wn),this}translate(e,t,i){return wn.makeTranslation(e,t,i),this.applyMatrix4(wn),this}scale(e,t,i){return wn.makeScale(e,t,i),this.applyMatrix4(wn),this}lookAt(e){return Wb.lookAt(e),Wb.updateMatrix(),this.applyMatrix4(Wb.matrix),this}fromBufferGeometry(e){let t=this,i=e.index!==null?e.index:void 0,r=e.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let a=r.position,s=r.normal,n=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<a.count;h++)t.vertices.push(new P().fromBufferAttribute(a,h)),n!==void 0&&t.colors.push(new tt().fromBufferAttribute(n,h));function c(h,d,p,f){let m=n===void 0?[]:[t.colors[h].clone(),t.colors[d].clone(),t.colors[p].clone()],g=s===void 0?[]:[new P().fromBufferAttribute(s,h),new P().fromBufferAttribute(s,d),new P().fromBufferAttribute(s,p)],v=new aS(h,d,p,g,m,f);t.faces.push(v),o!==void 0&&t.faceVertexUvs[0].push([new Q().fromBufferAttribute(o,h),new Q().fromBufferAttribute(o,d),new Q().fromBufferAttribute(o,p)]),l!==void 0&&t.faceVertexUvs[1].push([new Q().fromBufferAttribute(l,h),new Q().fromBufferAttribute(l,d),new Q().fromBufferAttribute(l,p)])}let u=e.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],p=d.start,f=d.count;for(let m=p,g=p+f;m<g;m+=3)i!==void 0?c(i.getX(m),i.getX(m+1),i.getX(m+2),d.materialIndex):c(m,m+1,m+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<a.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pv).negate(),this.translate(pv.x,pv.y,pv.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,r=new Se;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let e=new P,t=new P;for(let i=0,r=this.faces.length;i<r;i++){let a=this.faces[i],s=this.vertices[a.a],n=this.vertices[a.b],o=this.vertices[a.c];e.subVectors(o,n),t.subVectors(s,n),e.cross(t),e.normalize(),a.normal.copy(e)}}computeVertexNormals(e=!0){let t=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)t[i]=new P;if(e){let i=new P,r=new P;for(let a=0,s=this.faces.length;a<s;a++){let n=this.faces[a],o=this.vertices[n.a],l=this.vertices[n.b],c=this.vertices[n.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),t[n.a].add(i),t[n.b].add(i),t[n.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let a=this.faces[i];t[a.a].add(a.normal),t[a.b].add(a.normal),t[a.c].add(a.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)t[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let a=this.faces[i],s=a.vertexNormals;s.length===3?(s[0].copy(t[a.a]),s[1].copy(t[a.b]),s[2].copy(t[a.c])):(s[0]=t[a.a].clone(),s[1]=t[a.b].clone(),s[2]=t[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let i=this.faces[e],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let a=0,s=r.vertexNormals.length;a<s;a++)r.__originalVertexNormals[a]?r.__originalVertexNormals[a].copy(r.vertexNormals[a]):r.__originalVertexNormals[a]=r.vertexNormals[a].clone()}let e=new By;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(let n=0,o=this.faces.length;n<o;n++){let l=new P,c={a:new P,b:new P,c:new P};a.push(l),s.push(c)}}let r=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let a=0,s=this.faces.length;a<s;a++){let n=this.faces[a],o=r.faceNormals[a],l=r.vertexNormals[a];o.copy(n.normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let r=this.faces[t];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Hi),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Fa),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t,i=0){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}let r,a=this.vertices.length,s=this.vertices,n=e.vertices,o=this.faces,l=e.faces,c=this.colors,u=e.colors;t!==void 0&&(r=new Ui().getNormalMatrix(t));for(let h=0,d=n.length;h<d;h++){let p=n[h].clone();t!==void 0&&p.applyMatrix4(t),s.push(p)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let p=l[h],f,m,g=p.vertexNormals,v=p.vertexColors,y=new aS(p.a+a,p.b+a,p.c+a);y.normal.copy(p.normal),r!==void 0&&y.normal.applyMatrix3(r).normalize();for(let x=0,w=g.length;x<w;x++)f=g[x].clone(),r!==void 0&&f.applyMatrix3(r).normalize(),y.vertexNormals.push(f);y.color.copy(p.color);for(let x=0,w=v.length;x<w;x++)m=v[x],y.vertexColors.push(m.clone());y.materialIndex=p.materialIndex+i,o.push(y)}for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,x=g.length;y<x;y++)v.push(g[y].clone());this.faceVertexUvs[h].push(v)}}}mergeMesh(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)}mergeVertices(e=4){let t={},i=[],r=[],a=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*a)+"_"+Math.round(c.y*a)+"_"+Math.round(c.z*a);t[u]===void 0?(t[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[t[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let n=this.vertices.length-i.length;return this.vertices=i,n}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let r=e[t];this.vertices.push(new P(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let o=0;o<t;o++)e[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}e.sort(i);let r=this.faceVertexUvs[0],a=this.faceVertexUvs[1],s,n;r&&r.length===t&&(s=[]),a&&a.length===t&&(n=[]);for(let o=0;o<t;o++){let l=e[o]._id;s&&s.push(r[l]),n&&n.push(a[l])}s&&(this.faceVertexUvs[0]=s),n&&(this.faceVertexUvs[1]=n)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){let p=this.parameters;for(let f in p)p[f]!==void 0&&(e[f]=p[f]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let f=this.vertices[p];t.push(f.x,f.y,f.z)}let i=[],r=[],a={},s=[],n={},o=[],l={};for(let p=0;p<this.faces.length;p++){let f=this.faces[p],m=!0,g=!1,v=this.faceVertexUvs[0][p]!==void 0,y=f.normal.length()>0,x=f.vertexNormals.length>0,w=f.color.r!==1||f.color.g!==1||f.color.b!==1,S=f.vertexColors.length>0,_=0;if(_=c(_,0,0),_=c(_,1,m),_=c(_,2,g),_=c(_,3,v),_=c(_,4,y),_=c(_,5,x),_=c(_,6,w),_=c(_,7,S),i.push(_),i.push(f.a,f.b,f.c),i.push(f.materialIndex),v){let A=this.faceVertexUvs[0][p];i.push(d(A[0]),d(A[1]),d(A[2]))}if(y&&i.push(u(f.normal)),x){let A=f.vertexNormals;i.push(u(A[0]),u(A[1]),u(A[2]))}if(w&&i.push(h(f.color)),S){let A=f.vertexColors;i.push(h(A[0]),h(A[1]),h(A[2]))}}function c(p,f,m){return m?p|1<<f:p&~(1<<f)}function u(p){let f=p.x.toString()+p.y.toString()+p.z.toString();return a[f]!==void 0||(a[f]=r.length/3,r.push(p.x,p.y,p.z)),a[f]}function h(p){let f=p.r.toString()+p.g.toString()+p.b.toString();return n[f]!==void 0||(n[f]=s.length,s.push(p.getHex())),n[f]}function d(p){let f=p.x.toString()+p.y.toString();return l[f]!==void 0||(l[f]=o.length/2,o.push(p.x,p.y)),l[f]}return e.data={},e.data.vertices=t,e.data.normals=r,s.length>0&&(e.data.colors=s),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return new By().copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let h=0,d=t.length;h<d;h++)this.vertices.push(t[h].clone());let i=e.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=e.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=e.faceVertexUvs.length;h<d;h++){let p=e.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let f=0,m=p.length;f<m;f++){let g=p[f],v=[];for(let y=0,x=g.length;y<x;y++){let w=g[y];v.push(w.clone())}this.faceVertexUvs[h].push(v)}}let a=e.morphTargets;for(let h=0,d=a.length;h<d;h++){let p={};if(p.name=a[h].name,a[h].vertices!==void 0){p.vertices=[];for(let f=0,m=a[h].vertices.length;f<m;f++)p.vertices.push(a[h].vertices[f].clone())}if(a[h].normals!==void 0){p.normals=[];for(let f=0,m=a[h].normals.length;f<m;f++)p.normals.push(a[h].normals[f].clone())}this.morphTargets.push(p)}let s=e.morphNormals;for(let h=0,d=s.length;h<d;h++){let p={};if(s[h].vertexNormals!==void 0){p.vertexNormals=[];for(let f=0,m=s[h].vertexNormals.length;f<m;f++){let g=s[h].vertexNormals[f],v={};v.a=g.a.clone(),v.b=g.b.clone(),v.c=g.c.clone(),p.vertexNormals.push(v)}}if(s[h].faceNormals!==void 0){p.faceNormals=[];for(let f=0,m=s[h].faceNormals.length;f<m;f++)p.faceNormals.push(s[h].faceNormals[f].clone())}this.morphNormals.push(p)}let n=e.skinWeights;for(let h=0,d=n.length;h<d;h++)this.skinWeights.push(n[h].clone());let o=e.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=e.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=new oae().fromGeometry(this),t=new Qe,i=new Float32Array(e.vertices.length*3);if(t.setAttribute("position",fv.call(new ht(i,3),e.vertices)),e.normals.length>0){let r=new Float32Array(e.normals.length*3);t.setAttribute("normal",fv.call(new ht(r,3),e.normals))}if(e.colors.length>0){let r=new Float32Array(e.colors.length*3);t.setAttribute("color",tO.call(new ht(r,3),e.colors))}if(e.uvs.length>0){let r=new Float32Array(e.uvs.length*2);t.setAttribute("uv",iO.call(new ht(r,2),e.uvs))}if(e.uvs2.length>0){let r=new Float32Array(e.uvs2.length*2);t.setAttribute("uv2",iO.call(new ht(r,2),e.uvs2))}t.groups=e.groups;for(let r in e.morphTargets){let a=[],s=e.morphTargets[r];for(let n=0,o=s.length;n<o;n++){let l=s[n],c=new Re(l.data.length*3,3);c.name=l.name,a.push(fv.call(c,l.data))}t.morphAttributes[r]=a}if(e.skinIndices.length>0){let r=new Re(e.skinIndices.length*4,4);t.setAttribute("skinIndex",rO.call(r,e.skinIndices))}if(e.skinWeights.length>0){let r=new Re(e.skinWeights.length*4,4);t.setAttribute("skinWeight",rO.call(r,e.skinWeights))}return e.boundingSphere!==null&&(t.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Qe,i=e.geometry;if(e.isPoints||e.isLine){let r=new Re(i.vertices.length*3,3),a=new Re(i.colors.length*3,3);if(t.setAttribute("position",fv.call(r,i.vertices)),t.setAttribute("color",tO.call(a,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Re(i.lineDistances.length,1);t.setAttribute("lineDistance",lae.call(s,i.lineDistances))}i.boundingSphere!==null&&(t.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};By.prototype.isGeometry=!0;var oae=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t=[],i,r,a,s=e.faces;for(r=0;r<s.length;r++){let n=s[r];n.materialIndex!==a&&(a=n.materialIndex,i!==void 0&&(i.count=r*3-i.start,t.push(i)),i={start:r*3,materialIndex:a})}i!==void 0&&(i.count=r*3-i.start,t.push(i)),this.groups=t}fromGeometry(e){let t=e.faces,i=e.vertices,r=e.faceVertexUvs,a=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,n=e.morphTargets,o=n.length,l;if(o>0){l=[];for(let g=0;g<o;g++)l[g]={name:n[g].name,data:[]};this.morphTargets.position=l}let c=e.morphNormals,u=c.length,h;if(u>0){h=[];for(let g=0;g<u;g++)h[g]={name:c[g].name,data:[]};this.morphTargets.normal=h}let d=e.skinIndices,p=e.skinWeights,f=d.length===i.length,m=p.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<t.length;g++){let v=t[g];this.vertices.push(i[v.a],i[v.b],i[v.c]);let y=v.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{let w=v.normal;this.normals.push(w,w,w)}let x=v.vertexColors;if(x.length===3)this.colors.push(x[0],x[1],x[2]);else{let w=v.color;this.colors.push(w,w,w)}if(a===!0){let w=r[0][g];w!==void 0?this.uvs.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new Q,new Q,new Q))}if(s===!0){let w=r[1][g];w!==void 0?this.uvs2.push(w[0],w[1],w[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new Q,new Q,new Q))}for(let w=0;w<o;w++){let S=n[w].vertices;l[w].data.push(S[v.a],S[v.b],S[v.c])}for(let w=0;w<u;w++){let S=c[w].vertexNormals[g];h[w].data.push(S.a,S.b,S.c)}f&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),m&&this.skinWeights.push(p[v.a],p[v.b],p[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}},aS=class{constructor(e,t,i,r,a,s=0){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new P,this.vertexNormals=Array.isArray(r)?r:[],this.color=a&&a.isColor?a:new tt,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function lae(e){return this.array.set(e),this}function tO(e){let t=this.array,i=0;for(let r=0,a=e.length;r<a;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new tt),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}function iO(e){let t=this.array,i=0;for(let r=0,a=e.length;r<a;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Q),t[i++]=s.x,t[i++]=s.y}return this}function fv(e){let t=this.array,i=0;for(let r=0,a=e.length;r<a;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new P),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}function rO(e){let t=this.array,i=0;for(let r=0,a=e.length;r<a;r++){let s=e[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new dt),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}var cae=["a","b","c"];function hae(e,t){switch(t){case"c":return e.c;case"b":return e.b;case"a":default:return e.a}}function qb(e,t,i){let r=Math.min(e,t),a=Math.max(e,t),s=r+"_"+a;return i.get(s)}function Xb(e,t,i,r,a,s){let n=Math.min(e,t),o=Math.max(e,t),l=n+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[n],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(a),s[e].edges.push(c),s[t].edges.push(c)}function uae(e,t,i,r){let a,s,n;for(a=0,s=e.length;a<s;a++)i[a]={edges:[]};for(a=0,s=t.length;a<s;a++)n=t[a],Xb(n.a,n.b,e,r,n,i),Xb(n.b,n.c,e,r,n,i),Xb(n.c,n.a,e,r,n,i)}function mv(e,t,i,r,a){e.push(new aS(t,i,r,void 0,void 0,a))}function $h(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function gv(e,t,i,r){e.push([t.clone(),i.clone(),r.clone()])}var dae=class{constructor(e=1){this.subdivisions=e}modify(e){e instanceof Qe?e=new By().fromBufferGeometry(e):e=e.clone(),e.mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t=new P,i,r,a,s,n,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;uae(o,l,h,d);let p=[],f,m,g,v,y,x,w;for(let ne of Array.from(d.keys())){for(m=d.get(ne),g=new P,y=3/8,x=1/8,w=m.faces.length,w!=2&&(y=.5,x=0,w!=1),g.addVectors(m.a,m.b).multiplyScalar(y),t.set(0,0,0),s=0;s<w;s++){for(v=m.faces[s],n=0;n<3&&(f=o[hae(v,cae[n])],!(f!==m.a&&f!==m.b));n++);f&&t.add(f)}t.multiplyScalar(x),g.add(t),m.newEdge=p.length,p.push(g)}let S,_,A,E,M,C,T,D=[];for(r=0,a=o.length;r<a;r++){for(C=o[r],M=h[r].edges,i=M.length,i==3?S=3/16:i>3&&(S=3/(8*i)),_=1-i*Number(S),A=S,i<=2&&(i==2?(_=3/4,A=1/8):i==1||i==0),T=C.clone().multiplyScalar(_),t.set(0,0,0),s=0;s<i;s++)E=M[s],f=E.a!==C?E.a:E.b,t.add(f);t.multiplyScalar(Number(A)),T.add(t),D.push(T)}let I=D.concat(p),O=D.length,B,q,F,L=[],X=[],G,U,H,$,Y=new Q,J=new Q,Z=new Q;for(r=0,a=l.length;r<a;r++)v=l[r],B=Number(qb(v.a,v.b,d).newEdge)+O,q=Number(qb(v.b,v.c,d).newEdge)+O,F=Number(qb(v.c,v.a,d).newEdge)+O,mv(L,B,q,F,v.materialIndex),mv(L,v.a,B,F,v.materialIndex),mv(L,v.b,q,B,v.materialIndex),mv(L,v.c,F,q,v.materialIndex),u&&(G=c[r],U=G[0],H=G[1],$=G[2],Y.set($h(U.x,H.x),$h(U.y,H.y)),J.set($h(H.x,$.x),$h(H.y,$.y)),Z.set($h(U.x,$.x),$h(U.y,$.y)),gv(X,Y,J,Z),gv(X,U,Y,Z),gv(X,H,J,Y),gv(X,$,Z,J));e.vertices=I,e.faces=L,u&&(e.faceVertexUvs[0]=X)}},nr=new P,pae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=e.geometry??(t==null?void 0:t.geometry)??new Qe().copy(new cn(100,100,100)),r;t===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(nr),r={width:nr.x,height:nr.y,depth:nr.z,subdivisions:0}):r=t.parameters;let a={...r,...e.parameters};return{parameters:{width:Math.abs(a.width),height:Math.abs(a.height),depth:Math.abs(a.depth),subdivisions:Math.abs(a.subdivisions)},geometry:i}}static build(e){let{width:t,height:i,depth:r,subdivisions:a}=e.parameters,s=e.geometry??new Qe().copy(new cn(100,100,100)),n=s.userData.parameters;n===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(nr)):nr.set(n.width,n.height,n.depth),(t!==nr.x||i!==nr.y||r!==nr.z)&&s.scale(nr.x===0?1:t/nr.x,nr.y===0?1:i/nr.y,nr.z===0?1:r/nr.z);let o=s.originalGeometry;try{a>0?(o===void 0||(n==null?void 0:n.subdivisions)!==a)&&(o===void 0&&(o=s),s=new dae(a).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new g5(i).load(e,r=>{let a=this.normalizeInputs({geometry:r});r.boundingBox.getSize(nr);let s=100/nr.x;Object.assign(a.parameters,{width:100,height:nr.y*s,depth:nr.z*s}),t(this.build(a))})}},hN=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof Ri?e.shape:new Ri,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,spikes:r,cornerRadius:a,depth:s,extrudeBevelSize:n,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5,h=0,d=0,p=2*Math.PI/r;for(let m=0;m<r;m++){let g=p*m,v=h+Math.sin(g)*c,y=d+Math.cos(g)*u;l.addPoint(l.createPoint(v,y))}l.isClosed=!0;for(let m=0,g=l.points.length;m<g;m++)l.points[m].roundness=a;l.roundness=a,l.update();let f=Th.create({shape:l,parameters:{roundness:a,depth:s,extrudeBevelSize:n,extrudeBevelSegments:o}});return Object.assign(f,{userData:{...e,type:"PolygonGeometry"}})}},fae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,radialSegments:a,heightSegments:s,openEnded:n,cornerRadius:o,cornerSegments:l}=e.parameters,c=new gae(t*.5,i,a,s,n,o,l);return c.scale(1,1,r/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}};function Fp(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function Yb(e,t,i,r,a,s){let n=t.clone().sub(e),o=i.clone().sub(e),l=n.angleTo(o);if(n.normalize(),o.normalize(),r===a){let c=n.add(o).normalize();s.copy(e).addScaledVector(c,r/Math.sin(l/2))}else{let c=n.angleTo(o);s.copy(e),s.addScaledVector(n,a/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function mae(e,t,i){let r=e.clone().sub(t),a=i.clone().sub(t);return r.projectOnVector(a),r.add(t)}var gae=class extends Qe{constructor(e=.5,t=1,i=4,r=1,a=!1,s=0,n=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),n=Math.floor(n);let o=[],l=[],c=[],u=[],h=0,d=t/2,p=Math.PI/i,f=e*Math.cos(Math.PI/i),m=2*Math.PI/i,g=(i-2)*Math.PI/i,v=Math.PI-g,y=new P(0,-d,0),x=new P(0,d,0),w=new Q(e,-d),S=new Q(f,-d),_=new Q(0,x.y).sub(S),A=new Q(0,x.y).sub(w),E=new Q(_.y,-_.x).normalize(),M=new Q(A.y,-A.x).normalize(),C=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-_.angle())/2)-1e-8;s=Math.min(s,C);let T;{let F=new P(E.x,E.y,0),L=new P(Math.cos(m)*F.x,F.y,Math.sin(m)*F.x);T=F.angleTo(L)}let D=s/Math.tan((Math.PI-_.angle())/2),I=s/Math.tan((Math.PI-T)/2),O=new P;if(!a){l.push(y.x,y.y,y.z),c.push(0,-1,0),u.push(0,0);let F=h++,L=[],X=w.clone(),G=D/Math.cos(Math.PI/i);X.x-=G;for(let U=0;U<i;U++){let H=U/i*Math.PI*2+p,$=new Q(Math.sin(H),Math.cos(H));Fp(X,$,O),l.push(O.x,O.y,O.z),c.push(0,-1,0),u.push(0,0),L.push(h++)}for(let U=0;U<L.length;U++)o.push(L[U],F,L[(U+1)%L.length])}{let F=new P,L=new P,X=new P,G=new P,U=new P,H=new P;for(let $=0;$<i;$++){let Y=$/i*Math.PI*2+p,J=($+.5)/i*Math.PI*2+p,Z=($+1)/i*Math.PI*2+p,ne=new Q(Math.sin(Y),Math.cos(Y)),re=new Q(Math.sin(J),Math.cos(J)),ie=new Q(Math.sin(Z),Math.cos(Z));Fp(w,ne,L),Fp(w,ie,X),Fp(E,re,F),Yb(x,L,X,I,I,G),l.push(G.x,G.y,G.z),Yb(L,x,X,I,D,U),l.push(U.x,U.y,U.z),Yb(X,L,x,D,I,H),l.push(H.x,H.y,H.z),c.push(F.x,F.y,F.z),c.push(F.x,F.y,F.z),c.push(F.x,F.y,F.z),u.push(0,0),u.push(0,0),u.push(0,0);let le=h++,ue=h++,fe=h++;if(o.push(le,ue,fe),s>0){{let Ce=L.clone().add(X).multiplyScalar(.5),Ve=x.clone().sub(Ce).normalize(),je=y.clone().sub(Ce).normalize().add(Ve).normalize().multiplyScalar(-1),Pe=H.clone().sub(U);B(Ce,Pe,je,_.angle())}let be,ke;{let Ce=new P;Fp(M,ie,Ce);let Ve=H.clone().add(G).multiplyScalar(.5);Ve=mae(Ve,X,x);let je=H.clone().sub(G);[be,ke]=B(Ve,je,Ce,T,G.y)}{let Ce=be,Ve=Ce.clone().setY(0).normalize(),je=new P(0,-1,0),Pe=Ve.clone().cross(je);q(Ce,Ve,je,Pe)}{let Ce=_.angle(),Ve=Math.PI-Ce,je=x.clone();je.y-=s/Math.sin(Ce-Math.PI/2);let Pe=new P,Me=[];for(let qe=0;qe<n;qe++){let W=[],N=Math.PI/2-Ve*qe/n,oe=Math.cos(N),Ae=Math.sin(N),k=J;for(let De=0;De<=qe;De++){let Ue=Math.cos(k),Le=Math.sin(k);F.x=oe*Le,F.y=Ae,F.z=oe*Ue,Pe.copy(je).addScaledVector(F,s),l.push(Pe.x,Pe.y,Pe.z),c.push(F.x,F.y,F.z),u.push(0,0),W.push(h++),k+=Math.PI*2/qe/i}Me.push(W)}ke.reverse(),Me.push(ke);let Ze=Me.length-1;for(let qe=0;qe<Ze;qe++){let W=Me[qe],N=Me[qe+1],oe=W.length-1;o.push(N[1],W[0],N[0]);for(let Ae=1;Ae<=oe;Ae++)o.push(W[Ae],W[Ae-1],N[Ae]),o.push(N[Ae+1],W[Ae],N[Ae])}}}}}this.setIndex(o),this.setAttribute("position",new Re(l,3)),this.setAttribute("normal",new Re(c,3)),this.setAttribute("uv",new Re(u,2));function B(F,L,X,G,U){let H=-G/2,$=(Math.PI-G)/2,Y=L.clone().normalize().cross(X);F.addScaledVector(X,-s/Math.sin($));let J=new P,Z=new P,ne=1,re=h,ie=[];for(let le=0;le<=n;le++){let ue=H+le/n*G;Z.set(0,0,0),Z.addScaledVector(Y,Math.sin(ue)),Z.addScaledVector(X,Math.cos(ue));for(let fe=0;fe<=ne;fe++){let be=fe/ne-.5;if(J.copy(F),J.addScaledVector(L,be),J.addScaledVector(Z,s),U!=null){let ke=Math.max(0,J.y-U);J.addScaledVector(L,-ke/L.y)}l.push(J.x,J.y,J.z),c.push(Z.x,Z.y,Z.z),u.push(0,0),fe===0&&ie.push(h),h++}}for(let le=0;le<n;le++)for(let ue=0;ue<ne;ue++){let fe=re+ue+(ne+1)*le,be=fe+(ne+1),ke=be+1,Ce=fe+1;o.push(fe,be,Ce),o.push(be,ke,Ce)}return[F.clone().addScaledVector(L,.5),ie]}function q(F,L,X,G){let U=Math.PI/2,H=A.angle()-U,$=[],Y=new P,J=new P;for(let ne=0;ne<=n;ne++){let re=[],ie=ne/n;for(let le=0;le<=ne;le++){let ue=((ne?le/ne:0)-.5)*v,fe=Math.cos(ue),be=Math.sin(ue),ke=Math.atan(Math.tan(H)*fe),Ce=(U+ke)*ie,Ve=Math.cos(Ce),je=Math.sin(Ce);Y.set(0,0,0),Y.addScaledVector(L,je*fe),Y.addScaledVector(X,Ve),Y.addScaledVector(G,je*be),J.copy(F).addScaledVector(Y,s),l.push(J.x,J.y,J.z),c.push(Y.x,Y.y,Y.z),u.push(0,0),re.push(h++)}$.push(re)}let Z=$.length-1;for(let ne=0;ne<Z;ne++){let re=$[ne],ie=$[ne+1],le=re.length-1;o.push(re[0],ie[1],ie[0]);for(let ue=1;ue<=le;ue++)o.push(re[ue-1],re[ue],ie[ue]),o.push(re[ue],ie[ue+1],ie[ue])}}}},rC=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),r=Object.assign((t==null?void 0:t.ui)??{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof Ri?e.shape:new Ri,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(e){let t=e.shape,{width:i,height:r,cornerRadius:a,cornerType:s,depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(w,S,_){return S>i&&_>r?Math.min(w*i/S,w*r/_):S>i?w*i/S:_>r?w*r/_:w}let p=[];p[0]=a[0]===0?0:d(a[0],a[0]+a[3],a[0]+a[1]),p[1]=a[1]===0?0:d(a[1],a[1]+a[2],a[1]+a[0]),p[2]=a[2]===0?0:d(a[2],a[2]+a[1],a[2]+a[3]),p[3]=a[3]===0?0:d(a[3],a[3]+a[0],a[3]+a[2]);let f=u.x,m=h.x,g=h.y,v=u.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let y=!0;for(let w=0,S=t.points.length;w<S;w++)t.points[w].roundness=p[w],w>0&&p[w]!==p[w-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=s!==1,t.update();let x=Th.create({shape:t,parameters:{depth:n,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(x,{userData:{...e,type:"RectangleGeometry"}})}},vae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return i.thetaLength=Ge.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t=100,height:i=t,depth:r=t,widthSegments:a=64,heightSegments:s=64,phiStart:n,phiLength:o,thetaStart:l,thetaLength:c}=e.parameters,u;return c===0?(u=new Qe,u.setAttribute("position",new Re([],3))):u=new ed(.5*t,a,s,n,o,l,c*Ge.DEG2RAD),u.scale(1,i/t,r/t),Object.assign(u,{userData:{...e,type:"SphereGeometry"}})}},yae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:r=8,heightSegments:a=8}=e.parameters,s=new Ah(t,i,r,a);return s.scale(1,1,1),Object.assign(s,{userData:{...e,type:"PlaneGeometry"}})}},xae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(e){let{width:t,height:i,depth:r,angle:a,cornerRadius:s,cornerSegments:n}=e.parameters,o=new bae(t,i,r,a,s,n);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},bae=class extends Qe{constructor(e=1,t=1,i=1,r=90,a=10,s=24){super(),this.type="BackdropGeometry";let n=[],o=[],l=[],c=.001;a==0&&(s=1),s=Math.max(1,Math.floor(s)),a=Math.min(a,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(ne=0,re=0,ie=0)=>new P(ne,re,ie),p=d(),f=d(),[m,g,v]=[t/2,e/2,i/2],y=-g,x=+g,[w,S,_]=[d(y,-m,+v),d(y,-m,-v),d(y,+m,-v)],A=(ne,re=!1)=>Math.sin(ne-Math.PI/(1+ +re)),E=(ne,re=!1)=>Math.cos(ne-Math.PI/(1+ +re));_.y=Math.sin(r)*t-m;let M=Math.cos(r)*t-v,C=w.z-c;r<=h?(_.z=Math.min(M,C),_.z==C&&(_.y-=(M-C)/Math.tan(h-r))):S.z=Math.min(S.z-M-v,w.z-c),p.subVectors(w,S),f.subVectors(_,S);let T=Math.min(p.length(),f.length())*a/100,D=T*Math.tan(r/2),I=T/Math.cos(r/2),O=p.clone().normalize().add(f.normalize()).setLength(I).add(S);p.set(0,A(r,!0),E(r,!0)),u.push([_,p.clone()]);let B=(Math.PI-r)/s;for(let ne=0;ne<=s;ne++){let re=h+r+ne*B;p.set(0,Math.sin(re)*D,Math.cos(re)*D),p.add(O),f.set(0,A(re),E(re)),u.push([p.clone(),f.clone()])}u.push([w,d(0,1,0)]);let q=Math.sin(B/2)*D*2,F=u.length-1,L=u[0][0].distanceTo(u[1][0]),X=u[F-1][0].distanceTo(u[F][0]),G=L+q*s+X;u[0].push(1);for(let ne=0;ne<=s;ne++)u[ne+1].push(1-(L+ne*q)/G);u[F].push(0);let[U,H,$]=u[0],Y,J,Z;for(let ne=1;ne<u.length;ne++)[Y,J,Z]=u[ne],n.push(y,U.y,U.z,y,Y.y,Y.z,x,U.y,U.z,x,U.y,U.z,y,Y.y,Y.z,x,Y.y,Y.z),o.push(0,H.y,H.z,0,J.y,J.z,0,H.y,H.z,0,H.y,H.z,0,J.y,J.z,0,J.y,J.z),l.push(0,$,0,Z,1,$,1,$,0,Z,1,Z),[U,H,$]=[Y,J,Z];this.setAttribute("position",new Re(n,3)),this.setAttribute("normal",new Re(o,3)),this.setAttribute("uv",new Re(l,2))}},uN=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof Ri?e.shape:new Ri,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:r,spikes:a,cornerRadius:s,angle:n,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,u=e.shape,h=t*.5,d=i*.5,p=0,f=0,m=n*Math.PI/360/a,g=Math.PI/2*3*-1,v=h*r/100,y=d*r/100;if(a===3&&r===50){m=2*Math.PI/a;for(let w=0;w<a;w++){let S=m*w,_=p+Math.sin(S)*h,A=f+Math.cos(S)*d;u.addPoint(u.createPoint(_,A))}}else for(let w=0;w<a;w++){let S=p+Math.cos(g)*h,_=f+Math.sin(g)*d;u.addPoint(u.createPoint(S,_)),g+=m,S=p+Math.cos(g)*v,_=f+Math.sin(g)*y,u.addPoint(u.createPoint(S,_)),g+=m}u.isClosed=!0;for(let w=0,S=u.points.length;w<S;w++)u.points[w].roundness=s;u.roundness=s,u.update();let x=Th.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(x,{userData:{...e,type:"StarGeometry"}})}},wae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t,height:i}=e.parameters,r=new Ah(t,i);return Object.assign(r,{userData:{...e,type:"TextFrameGeometry"}})}},_ae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),r=Math.abs(i.width),a=Math.abs(i.height??i.width),s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:a,depth:s})}}static build(e){let{width:t,height:i,depth:r,radialSegments:a,tubularSegments:s,arc:n,cornerRadius:o,cornerSegments:l}=e.parameters,c=Sae(t,i,r,t*.5,n,s,0,0,a,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}};function Sae(e,t,i,r,a,s,n,o,l,c,u){[t,i]=[i,t],n=t/2;let h=Ge.clamp(a/360,0,1);if(h===0){let d=new Qe;return d.setAttribute("position",new Re([],3)),d}return h===1&&(c=0),new lN(!0,e,t,i,r,h,s,n,o,l,c,u)}var Aae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(e){let{width:t,tube:i,tubularSegments:r,radialSegments:a,p:s,q:n}=e.parameters,o=t*.5;o!==i&&(o-=i);let l=new c5(o,i,r,a,s,n);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},Eae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof Ri?e.shape:new Ri,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(e){let{width:t=100,height:i,cornerRadius:r,depth:a,extrudeBevelSize:s,extrudeBevelSegments:n,isRect:o}=e.parameters,l=e.shape,c=t*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,p=l.points.length;d<p;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=Th.create({shape:l,parameters:{roundness:r,depth:a,extrudeBevelSize:s,extrudeBevelSegments:n}});return Object.assign(h,{userData:{...e,type:"TriangleGeometry"}})}};function Cae(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}var Mae=class{add(e,t,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(r){this[r]=this[r]||[],t&&this[r][i?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(i){i.call(t&&t.context?t.context:t,t)})}},Tae=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},pe=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+pe.version}static addUnaryOp(t){return pe.max_unop_len=Math.max(t.length,pe.max_unop_len),pe.unary_ops[t]=1,pe}static addBinaryOp(t,i,r){return pe.max_binop_len=Math.max(t.length,pe.max_binop_len),pe.binary_ops[t]=i,r?pe.right_associative.add(t):pe.right_associative.delete(t),pe}static addIdentifierChar(t){return pe.additional_identifier_chars.add(t),pe}static addLiteral(t,i){return pe.literals[t]=i,pe}static removeUnaryOp(t){return delete pe.unary_ops[t],t.length===pe.max_unop_len&&(pe.max_unop_len=pe.getMaxKeyLen(pe.unary_ops)),pe}static removeAllUnaryOps(){return pe.unary_ops={},pe.max_unop_len=0,pe}static removeIdentifierChar(t){return pe.additional_identifier_chars.delete(t),pe}static removeBinaryOp(t){return delete pe.binary_ops[t],t.length===pe.max_binop_len&&(pe.max_binop_len=pe.getMaxKeyLen(pe.binary_ops)),pe.right_associative.delete(t),pe}static removeAllBinaryOps(){return pe.binary_ops={},pe.max_binop_len=0,pe}static removeLiteral(t){return delete pe.literals[t],pe}static removeAllLiterals(){return pe.literals={},pe}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new pe(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(i=>i.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return pe.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!pe.binary_ops[String.fromCharCode(t)]||pe.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return pe.isIdentifierStart(t)||pe.isDecimalDigit(t)}throwError(t){let i=new Error(t+" at character "+this.index);throw i.index=this.index,i.description=t,i}runHook(t,i){if(pe.hooks[t]){let r={context:this,node:i};return pe.hooks.run(t,r),r.node}return i}searchHook(t){if(pe.hooks[t]){let i={context:this};return pe.hooks[t].find(function(r){return r.call(i.context,i),i.node}),i.node}}gobbleSpaces(){let t=this.code;for(;t===pe.SPACE_CODE||t===pe.TAB_CODE||t===pe.LF_CODE||t===pe.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),i=t.length===1?t[0]:{type:pe.COMPOUND,body:t};return this.runHook("after-all",i)}gobbleExpressions(t){let i=[],r,a;for(;this.index<this.expr.length;)if(r=this.code,r===pe.SEMCOL_CODE||r===pe.COMMA_CODE)this.index++;else if(a=this.gobbleExpression())i.push(a);else if(this.index<this.expr.length){if(r===t)break;this.throwError('Unexpected "'+this.char+'"')}return i}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,pe.max_binop_len),i=t.length;for(;i>0;){if(pe.binary_ops.hasOwnProperty(t)&&(!pe.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!pe.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=i,t;t=t.substr(0,--i)}return!1}gobbleBinaryExpression(){let t,i,r,a,s,n,o,l,c;if(n=this.gobbleToken(),!n||(i=this.gobbleBinaryOp(),!i))return n;for(s={value:i,prec:pe.binaryPrecedence(i),right_a:pe.right_associative.has(i)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+i),a=[n,s,o];i=this.gobbleBinaryOp();){if(r=pe.binaryPrecedence(i),r===0){this.index-=i.length;break}s={value:i,prec:r,right_a:pe.right_associative.has(i)},c=i;let u=h=>s.right_a&&h.right_a?r>h.prec:r<=h.prec;for(;a.length>2&&u(a[a.length-2]);)o=a.pop(),i=a.pop().value,n=a.pop(),t={type:pe.BINARY_EXP,operator:i,left:n,right:o},a.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+c),a.push(s,t)}for(l=a.length-1,t=a[l];l>1;)t={type:pe.BINARY_EXP,operator:a[l-1].value,left:a[l-2],right:t},l-=2;return t}gobbleToken(){let t,i,r,a;if(this.gobbleSpaces(),a=this.searchHook("gobble-token"),a)return this.runHook("after-token",a);if(t=this.code,pe.isDecimalDigit(t)||t===pe.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===pe.SQUOTE_CODE||t===pe.DQUOTE_CODE)a=this.gobbleStringLiteral();else if(t===pe.OBRACK_CODE)a=this.gobbleArray();else{for(i=this.expr.substr(this.index,pe.max_unop_len),r=i.length;r>0;){if(pe.unary_ops.hasOwnProperty(i)&&(!pe.isIdentifierStart(this.code)||this.index+i.length<this.expr.length&&!pe.isIdentifierPart(this.expr.charCodeAt(this.index+i.length)))){this.index+=r;let s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:pe.UNARY_EXP,operator:i,argument:s,prefix:!0})}i=i.substr(0,--r)}pe.isIdentifierStart(t)?(a=this.gobbleIdentifier(),pe.literals.hasOwnProperty(a.name)?a={type:pe.LITERAL,value:pe.literals[a.name],raw:a.name}:a.name===pe.this_str&&(a={type:pe.THIS_EXP})):t===pe.OPAREN_CODE&&(a=this.gobbleGroup())}return a?(a=this.gobbleTokenProperty(a),this.runHook("after-token",a)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let i=this.code;for(;i===pe.PERIOD_CODE||i===pe.OBRACK_CODE||i===pe.OPAREN_CODE||i===pe.QUMARK_CODE;){let r;if(i===pe.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==pe.PERIOD_CODE)break;r=!0,this.index+=2,this.gobbleSpaces(),i=this.code}this.index++,i===pe.OBRACK_CODE?(t={type:pe.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),i=this.code,i!==pe.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):i===pe.OPAREN_CODE?t={type:pe.CALL_EXP,arguments:this.gobbleArguments(pe.CPAREN_CODE),callee:t}:(i===pe.PERIOD_CODE||r)&&(r&&this.index--,this.gobbleSpaces(),t={type:pe.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),r&&(t.optional=!0),this.gobbleSpaces(),i=this.code}return t}gobbleNumericLiteral(){let t="",i,r;for(;pe.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===pe.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);pe.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(i=this.char,i==="e"||i==="E"){for(t+=this.expr.charAt(this.index++),i=this.char,(i==="+"||i==="-")&&(t+=this.expr.charAt(this.index++));pe.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);pe.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return r=this.code,pe.isIdentifierStart(r)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(r===pe.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===pe.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:pe.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",i=this.index,r=this.expr.charAt(this.index++),a=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===r){a=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=s}else t+=s}return a||this.throwError('Unclosed quote after "'+t+'"'),{type:pe.LITERAL,value:t,raw:this.expr.substring(i,this.index)}}gobbleIdentifier(){let t=this.code,i=this.index;for(pe.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,pe.isIdentifierPart(t));)this.index++;return{type:pe.IDENTIFIER,name:this.expr.slice(i,this.index)}}gobbleArguments(t){let i=[],r=!1,a=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===t){r=!0,this.index++,t===pe.CPAREN_CODE&&a&&a>=i.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(s===pe.COMMA_CODE){if(this.index++,a++,a!==i.length){if(t===pe.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===pe.CBRACK_CODE)for(let n=i.length;n<a;n++)i.push(null)}}else if(i.length!==a&&a!==0)this.throwError("Expected comma");else{let n=this.gobbleExpression();(!n||n.type===pe.COMPOUND)&&this.throwError("Expected comma"),i.push(n)}}return r||this.throwError("Expected "+String.fromCharCode(t)),i}gobbleGroup(){this.index++;let t=this.gobbleExpressions(pe.CPAREN_CODE);if(this.code===pe.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:pe.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:pe.ARRAY_EXP,elements:this.gobbleArguments(pe.CBRACK_CODE)}}},Pae=new Mae;Object.assign(pe,{hooks:Pae,plugins:new Tae(pe),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});pe.max_unop_len=pe.getMaxKeyLen(pe.unary_ops);pe.max_binop_len=pe.getMaxKeyLen(pe.binary_ops);var jd=e=>new pe(e).parse(),Dae=Object.getOwnPropertyNames(pe);Dae.forEach(e=>{jd[e]===void 0&&e!=="prototype"&&(jd[e]=pe[e])});jd.Jsep=pe;var Oae="ConditionalExpression",Iae={name:"ternary",init(e){e.hooks.add("after-expression",function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let a=this.gobbleExpression();if(a||this.throwError("Expected expression"),t.node={type:Oae,test:i,consequent:r,alternate:a},i.operator&&e.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=i}}else this.throwError("Expected :")}})}};jd.plugins.register(Iae);var Rae=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],Lae=["0","1","2","3","4","5","6","7","8","9","."],kae=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function zae(e){return typeof e!="string"?!1:!isNaN(e)&&!isNaN(parseFloat(e))}jd.addBinaryOp("^",11,!0);function dN(e,t,i="number"){let r="";for(let n=0;n<e.length;n++){let o=e[n];if("id"in o){let l=e[n-1];if(n>0&&"id"in l){console.error("Two variables in a row",e);return}let c=t.getVariable(o.id),u=$a.getDisplayedValue(c);i==="number"&&$a.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&$a.isBoolean(c)?u=c?"true":"false":i==="boolean"&&$a.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&o.name!=="+"&&(r+=o.name),o.name==="+"&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!zae(o.name)&&!Lae.includes(o.name)&&!Rae.includes(o.name)&&!kae.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(e.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let a;try{a=jd(r)}catch(n){console.error(r,n);return}let s;try{s=Nt(a)}catch(n){console.error(r,a,n)}return s}function Nt(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return+(Nt(e.left)===Nt(e.right));case"!=":return+(Nt(e.left)!==Nt(e.right));case">":return+(Nt(e.left)>Nt(e.right));case">=":return+(Nt(e.left)>=Nt(e.right));case"<":return+(Nt(e.left)<Nt(e.right));case"<=":return+(Nt(e.left)<=Nt(e.right));case"+":return Nt(e.left)+Nt(e.right);case"-":return Nt(e.left)-Nt(e.right);case"*":return Nt(e.left)*Nt(e.right);case"/":return Nt(e.left)/Nt(e.right);case"%":return Nt(e.left)%Nt(e.right);case"&&":return Nt(e.left)&&Nt(e.right);case"||":return Nt(e.left)||Nt(e.right);case"^":return Math.pow(Nt(e.left),Nt(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-Nt(e.argument);case"!":return+!Nt(e.argument);default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if(e.callee.type==="Identifier"){if(e.callee.name==="random"){let t=0,i=1;if(e.arguments.length>=1)try{t=Nt(e.arguments[0])}catch(r){console.warn(r)}if(e.arguments.length>=2)try{i=Nt(e.arguments[1])}catch(r){console.warn(r)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(Nt))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}var Nae=new Se,Bae=new Se;function jae(e,t,i){let r=[new P,new P,new P],a=[new P,new P,new P];return e.extractBasis(r[0],r[1],r[2]),t.extractBasis(a[0],a[1],a[2]),r.forEach((s,n)=>{let o=a[n],l=Ge.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new Se().makeBasis(r[0],r[1],r[2])}var Fae=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){let i=Object.assign({},(t==null?void 0:t.parameters)??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),r=Math.abs(i.width),a=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),n=(t==null?void 0:t.shapeData)??iC.create({parameters:zz}).userData.shape;return{path:e.path??Sy.defaultData(),parameters:Object.assign(i,{width:r,height:a,depth:s,extrusion:{...Nz,...i.extrusion}}),shapeData:n}}static build(e){if(e.path.points.length>=2){let t=new Uae(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}else return Object.assign(new Qe,{userData:{...e,type:"PathGeometry"}})}},Uae=class extends Qe{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&e.depth===1)||!Cae(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let a=this.inputs.path.isClosed?e.length:e.length-1,s=Math.floor(r*a),n=this.inputs.path.isClosed?Math.ceil((i+r)*a):Math.ceil(Math.min(1,i+r)*a),o=Math.min(Math.max(2,n-s+1),a+2),l=[],c=[];for(let F=0;F<o;F++){let L=this.inputs.path.isClosed?(F+s)%e.length:Math.min(F+s,e.length-1);l.push(e[L].clone()),c.push(t[L].clone())}let u=(F,L,X)=>{l[F]=l[F].clone().lerp(l[L],X),c[F]=jae(c[F],c[L],X)},h=0,d=r*a%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let p=0,f=(r+i)*a%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&f&&(p=f,u(l.length-1,l.length-2,1-p)),i===0){let F=l.length-1;l[F].copy(l[0]),c[F].copy(c[0])}this._applyPathModifiers(c,h,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(y=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:x,infos:w,vertices:S}=this._computeShapePoints(y),_=0,A;v==="round"&&(A=new tC(this.inputs.shapeData,2*m,m,y,g,void 0,!0),_=A.getAttribute("position").count);let E=0,M=0;w.sort((F,L)=>F.start-L.start),w.forEach(F=>{F.verticesStart=E,F.verticesCount=F.continuous.reduce((L,X,G)=>L+(G===0||!X?2:1),0),M+=F.verticesCount,E=M});let C=M*o,T,D=0;if(this._isOpenEnded()&&v==="flat"){try{T=Vl({windingRule:$t.ODD,elementType:Ji.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{T=tN}D=T.vertexCount}let I=C+2*D+_*2,O=C+2*D,B={positions:new Float32Array(I*3),normals:new Float32Array(I*3),uvs:new Float32Array(I*2)},q=[];if(w.forEach(F=>{this._extrudeRegion(F,S,c,l,B,q,this._isGeometryClosed()&&!this._isOpenEnded())}),T&&(this._closeEnd(T,C,q,B,c[0],l[0],!1),this._closeEnd(T,C+D,q,B,c[c.length-1],l[l.length-1],!0)),A){B.positions.set(A.getAttribute("position").array,O*3),B.normals.set(A.getAttribute("normal").array,O*3),B.uvs.set(A.getAttribute("uv").array,O*2);let F=q.length;q.push(...A.getIndex().array.map(G=>G+O)),O+=_,B.positions.set(A.getAttribute("position").array,O*3),B.normals.set(A.getAttribute("normal").array,O*3),B.uvs.set(A.getAttribute("uv").array,O*2);let L=q.length;q.push(...A.getIndex().array.map(G=>G+O)),this.setAttribute("position",new ht(B.positions,3)),this.setAttribute("normal",new ht(B.normals,3)),this.setAttribute("uv",new ht(B.uvs,2)),this.setIndex(q);let X=Nae;X.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(X,O,I),X.copy(c[0]).setPosition(l[0]).multiply(Bae.makeScale(1,1,-1)),this.applyMatrix4OnRange(X,O-_,O),this.reverseIndicesOnRange(F,L)}else this.setAttribute("position",new ht(B.positions,3)),this.setAttribute("normal",new ht(B.normals,3)),this.setAttribute("uv",new ht(B.uvs,2)),this.setIndex(q)}_extractPathPoints(){let e=qz(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach(i=>{t[t.length-1].distanceToSquared(i)>.001&&t.push(i)}),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,r=this.inputs.path.isClosed,a=new P,s=new P,n=new P,o=new P,l=new P(0,1,0);for(let f=0;f<i;f++){let m=e[f],g;f===0?g=r?e[e.length-2]:m.clone().multiplyScalar(2).sub(e[1]):g=e[f-1];let v;f===i-1?v=r?e[1]:m.clone().multiplyScalar(2).sub(e[f-1]):v=e[f+1];let y=m.clone().sub(g).normalize(),x=v.clone().sub(m).normalize(),w=y.clone().add(x).normalize();n.copy(w),f===0&&(w.equals(l)||w.clone().negate().equals(l))&&l.set(0,0,1);let S=l.clone().cross(w).normalize(),_=w.clone().cross(S).normalize();l.copy(_),o.copy(S),f===0&&(a.copy(_),s.copy(w));let A=new Se().makeBasis(S,_,w);t.push(A)}let c=r?s:n,u=r?a:new P(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return t;let p=u.clone().cross(h);c.dot(p)>0&&(d*=-1);for(let f=1;f<t.length;f++){let m=new Se().makeRotationZ(d*f/t.length);t[f].multiply(m)}return t}_applyPathModifiers(e,t,i){let r=e.length,{angle:a,twist:s,startScale:n,endScale:o}=this.inputs.parameters.extrusion,l=new Se,c=new Se;return e.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-t)/(r-(i===0?0:1)-(t+(1-i)));l.makeRotationZ(Ge.lerp(a,a+s,d)*Ge.DEG2RAD);let p=Ge.lerp(n,o,d);c.makeScale(p,p,p),u.multiply(l).multiply(c)}),e}_computeShapePoints(e=12,t=$t.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],e),a=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],e),h=[];for(let d=u.length-1;d>=1;d-=2){let p=u[d-1],f=u[d-0];h.push(p,f)}return h}),s;try{s=Vl({windingRule:t,elementType:Ji.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=eC}let n;try{n=Vl({windingRule:$t.ODD,elementType:Ji.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...a]})}catch{n=eN}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(n){s.elementCount+=n.elementCount;for(let c=0;c<n.elements.length;c++){let u=n.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<n.vertexIndices.length;c++){let u=n.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<n.vertices.length;c++){let u=n.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],p=s.elements[h+1],f=d+p,m={start:d,count:p,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(m);let g=d,v=f-1,y=d+1,x=i.roundedCurves.length;do{let w=g-d;s.vertices[v*2+0],s.vertices[v*2+1];let S=s.vertices[g*2+0],_=s.vertices[g*2+1],A=s.vertices[y*2+0],E=s.vertices[y*2+1],M=S-A,C=_-E,T=Math.sqrt(M*M+C*C);M/=T,C/=T,m.normals[w*2+0]=-C,m.normals[w*2+1]=M;let D=s.vertexIndices[g];if(Array.isArray(D))m.continuous[w]=!1;else{let[I,O]=i.getCurveIndexFromVertexId(D-1,!0);if(O>0&&O<1)m.continuous[w]=!0;else{let B=O===1?I+1:I-1;B=(B+x)%x;let q=O===1?0:1,F=i.roundedCurves[I].getTangent(O),L=i.roundedCurves[B].getTangent(q);m.continuous[w]=F.dot(L)>.95}}u&&(m.normals[w*2+0]*=-1,m.normals[w*2+1]*=-1),[v,g,y]=[g,y,y+1],y>=f&&(y-=p)}while(y!==d+1)}return{regions:[r,...a],infos:l,vertices:s.vertices}}_insertVertex(e,t,i,r,a){let s=t*2,n=t*3;e.positions[n+0]=i.x,e.positions[n+1]=i.y,e.positions[n+2]=i.z,e.normals[n+0]=r.x,e.normals[n+1]=r.y,e.normals[n+2]=r.z,e.uvs[s+0]=a.x,e.uvs[s+1]=a.y}_extrudeRegion(e,t,i,r,a,s,n){let o=new P,l=new P,c=new P,u=new P,h=new Q;i.forEach((p,f)=>{let m=r[f],g=e.verticesStart*i.length+e.verticesCount*f;for(let v=0;v<e.count;v++){let y=(e.start+v)*2;if(o.set(t[y+0],t[y+1],0),c.copy(o).applyMatrix4(p).add(m),e.continuous[v])u.set(e.normals[v*2+0],e.normals[v*2+1],0);else{let x=v===0?(e.start+e.count-1)*2:y-2;l.set(t[x+0],t[x+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),e.isHole||u.negate()}if(u.applyMatrix4(p).normalize(),h.set(v===0?1:v/e.count,f/(i.length-1)),this._insertVertex(a,g,c,u,h),g++,!e.continuous[v]||v===0){if(v===0)u.set(e.normals[v*2+0],e.normals[v*2+1],0),h.set(0,f/(i.length-1));else{let x=v===e.count-1?e.start*2:y+2;l.set(t[x+0],t[x+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),e.isHole||u.negate()}u.applyMatrix4(p).normalize(),this._insertVertex(a,g,c,u,h),g++}}});let d=i.length-1;for(let p=0;p<d;p++){let f=e.verticesStart*i.length+e.verticesCount*p,m=e.verticesStart*i.length+e.verticesCount*(p+1),g=0;for(let v=0;v<e.count;v++){(!e.continuous[v]||v===0)&&g++;let y=v===e.count-1?0:g+1,x=f+g,w=f+y,S=m+y,_=m+g;e.isHole?s.push(x,S,w,x,_,S):s.push(x,w,S,x,S,_),g++}}}_closeEnd(e,t,i,r,a,s,n){let o=e.vertexCount,l=new P(0,0,n?-1:1).applyMatrix4(a),c=new P,u=new Q;for(let d=0;d<o;d++){let p=2*d;c.set(e.vertices[p+0],e.vertices[p+1],0).applyMatrix4(a).add(s),this._insertVertex(r,t+d,c,l,u)}let h=e.elements;for(let d=0;d<e.elementCount;d++){let p=3*d,f=h[p+0]+t,m=h[p+(n?1:2)]+t,g=h[p+(n?2:1)]+t;i.push(f,m,g)}}applyMatrix4OnRange(e,t,i){let r=e.elements,a=new Ui().getNormalMatrix(e).elements,s,n,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,p=c.itemSize;for(let f=t*p,m=i*p;f<m;f+=p){if(f===t)debugger;s=h[f+0],n=h[f+1],o=h[f+2],l=1/(r[3]*s+r[7]*n+r[11]*o+r[15]),h[f+0]=(r[0]*s+r[4]*n+r[8]*o+r[12])*l,h[f+1]=(r[1]*s+r[5]*n+r[9]*o+r[13])*l,h[f+2]=(r[2]*s+r[6]*n+r[10]*o+r[14])*l,s=d[f+0],n=d[f+1],o=d[f+2],d[f+0]=a[0]*s+a[3]*n+a[6]*o,d[f+1]=a[1]*s+a[4]*n+a[7]*o,d[f+2]=a[2]*s+a[5]*n+a[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let r=e;r<t;r+=3){let a=i.getX(r),s=i.getX(r+1),n=i.getX(r+2);i.setXYZ(r,n,s,a)}i.needsUpdate=!0}}};function pN(){let e=new Qe;return e.setAttribute("position",new ht(new Float32Array([]),3)),e.setIndex(new ht(new Uint16Array([]),1)),e}var Vae=pN().attributes,Gae=12,Hae=1,fN=class extends Qe{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,Vae),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);i!=null&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then(()=>{this.update(e),t==null||t.requestRender()})}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},!(t!=null&&t.isLoaded)){console.warn("Cannot update text because its font is not loaded");return}let{width:i,height:r,depth:a,extrudeBevelSize:s,extrudeBevelSegments:n,text:o,textTransform:l}=e,c=$a.getDisplayedValue(o),u=l===2?c.toUpperCase():l===3?c.toLowerCase():c,h=Wae(e,t,u),{shapes:d,charWidths:p,charCoords:f}=t.generateShapes(h,e),m=(typeof i=="number"?i:1)*.5,g=(typeof r=="number"?r:1)*.5,v=d.map(w=>new Ri().fromShape(w,!0));this.vectorShapes=v;let y=v.map(w=>Th.create({shape:w,parameters:{depth:a,extrudeBevelSegments:n,extrudeBevelSize:s,windingRule:a<=0?$t.NONZERO:$t.ODD,subdivisions:this.isLowResolution&&a>0?Hae:Gae}})),x=y.length?qc(y):pN();x.translate(-m,g,0),this.dispose(),this.wrappedText=h,this.charCoords=f,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(x.attributes).forEach(([w,S])=>{this.setAttribute(w,S)}),this.setIndex(x.index),this.computeBoundingSphere()}clone(){let e=$n(new Qe,fN.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach(([t,i])=>{this.setAttribute(t,i)}),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){return this.userData.parameters.text??""}};function Wae(e,t,i){let r=[""],a="";for(let s of i)a+=s,s===" "||s===`
`?(r[r.length-1]+=a,a="",s===`
`&&r.push("")):t.getTextWidth(r[r.length-1]+a,e)>e.width&&(r[r.length-1].length&&r.push(""),t.getTextWidth(r[r.length-1]+a,e)>e.width&&(a.length===1?(r[r.length-1]+=a,a=""):(r[r.length-1]+=a.slice(0,-1),a=a[a.length-1],r.push(""))));return r[r.length-1]+=a,r}var mN,gN=new Promise(e=>{mN=e}),aO=!1,vv;function qae(){if(aO)return;if(vv)return vv;async function e(){let t="https://unpkg.com/@splinetool/modelling-wasm@1.0.26/build",i=Xd(()=>import("./process-BcW0pGnR.js"),__vite__mapDeps([])),[r,a]=await Promise.all([i,fetch(`${t}/process.wasm`).then(o=>o.arrayBuffer())]),s=r.default,n=await s({wasmBinary:a});mN(n),aO=!0}return vv=e(),vv}var Xae=["font"];function Sm(e,t,i,r){var c;let a,s,n;e.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(e)),n=[[],["extrusion"]]):(s={...e},n=[[]]);for(let u of n){let h=s;for(let d of u)h=h[d];for(a in h){let d=h[a];lD(d)&&!Xae.includes(a)&&(h[a]=t.getVariable(d,[r.uuid,"geometry",...u,a]),lD(h[a])&&(h[a]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let u=Ri.createFromState(s.shape,s.width,s.height);o.shape=u}else if(s.type==="NonParametricGeometry")s.data.groups&&((c=s.data.groups)==null||c.forEach(u=>u.materialIndex=Math.max(u.materialIndex??0,0))),o.geometry=new g5().parse(s);else if(s.type==="SubdivGeometry"){let u=new fa(s,i);return u.data=e,u}else{if(s.type==="TextGeometry")return new fN(s,t);if(s.type==="UIGeometry")return rC.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=cO(o)}catch(u){console.error(u)}if(!l){let u=Ri.createFromState(_y.defaultData(),100,100);o.shape=u,l=cO(o)}return l}var Yae=new Se;function sS(e,t,i,r){let a=e.position.array,s=e.normal.array,n=Yae.makeScale(t,i,r).invert().elements,o,l,c;for(var u=0,h=a.length;u<h;u+=3)a[u]*=t,a[u+1]*=i,a[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=n[0]*o+n[4]*l+n[8]*c,s[u+1]=n[1]*o+n[5]*l+n[9]*c,s[u+2]=n[2]*o+n[6]*l+n[10]*c;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var yv=new Hi,Jh=new P,rt;gN.then(e=>{rt=e});var sO=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),nO=new Uint32Array([0,1,2,3]),oO=new Uint8Array([4]),fa=class extends Qe{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,r=ih.div(t,i);this.subdividedGeometry&&sS(this.subdividedGeometry.attributes,...r),this.originalGeometry&&sS(this.originalGeometry.attributes,...r),this.data=e;let a=this.userData.parameters;this.userData.parameters={width:a.width*r[0],height:a.height*r[1],depth:a.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(Jh.fromArray(r));let s=Jh.set(a.width,a.height,a.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let e,t,i;try{({originalGeometry:e,subdividedGeometry:t,subdivPointer:i}=fa.build(this.data,void 0,!this.flatShading,void 0))}catch{e=new cn(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=e,this.subdividedGeometry=t??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(fa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Fa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;yv.setFromBufferAttribute(t),yv.getCenter(i),e.boundingSphere.radius=i.distanceTo(yv.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),yv.getSize(Jh);let r={width:Jh.x,height:Jh.y,depth:Jh.z};return this.userData.parameters=r,r}static build(e,t,i,r){let a,s,n,o=(e==null?void 0:e.phongAngle)??35;i===!1&&(o=-1),t&&(rt.free_bvh(t),rt.free_subdivision_surface(t));try{a=fa.allocate(e,r)}catch(l){console.error(l,e),a=fa.allocate({positionWASM:sO,indexWASM:nO,verticesPerFaceWASM:oO},r)}if(rt.set_destination_refinement_level(a,0),s=fa.buildLevel(a,!0,o),e.subdivisions>0)try{rt.set_destination_refinement_level(a,e.subdivisions),n=fa.buildLevel(a,!1,o)}catch{try{rt.set_destination_refinement_level(a,e.subdivisions-1),n=fa.buildLevel(a,!1,o)}catch{n=null}}else n=null;return{subdivPointer:a,originalGeometry:s,subdividedGeometry:n}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),e.type==="DodecahedronGeometry"&&(e.detail=0);let r=e.shape!==void 0||e.path!==void 0?t.geometry:Sm(e,i,!1),a;e.type==="TorusGeometry"&&e.arc===Math.PI*2?a=r.getClosedTorusIndicesForBooleanOrSubdiv():a=r.getIndex();let s,n,o,l;({positions:s,triIndices:l}=j1(r.getAttribute("position"),a));let c;if(e.type==="CylinderGeometry"&&e.cornerRadius===0&&e.hollow===0&&e.openEnded===!1){let u=e.radialSegments*e.heightSegments*3*2,h=u+e.radialSegments*3;c=[u,h]}return{indices:n,verticesPerFace:o}=vN(s,l,r,c),{positions:s,indices:n,verticesPerFace:o}}static allocate(e,t){var x;let i,r,a,s=[],n=[];e.positionWASM&&e.positionWASM.length>0?(i=e.positionWASM,r=e.indexWASM,a=e.verticesPerFaceWASM):(i=sO,r=nO,a=oO);let o=i.length,l=r.length,c=a.length,u=i.length+s.length+n.length,h=r.length+a.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,p=u*Float32Array.BYTES_PER_ELEMENT,f=rt._malloc(d),m=new Float32Array(rt.HEAPF32.buffer,f,u),g=new Uint32Array(rt.HEAPU32.buffer,f+p,h);m.set(i,0),m.set(s,i.length),m.set(n,i.length+s.length),g.set(r,0),g.set(a,r.length);let v;(x=e==null?void 0:e.scaleBaked)!=null&&x.some(w=>w!==1)&&(v=new Se().makeScale(...e.scaleBaked)),t&&(v?v.premultiply(t):v=t);let y=v?rt.alloc_subdivision_surface2(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c,v.elements):rt.alloc_subdivision_surface(f,o,f+p,l,f+p+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return rt._free(f),y}static buildLevel(e,t,i,r,a){let s=a?rt.get_mesh_data2(e,t?rt.Level.CONTROL:rt.Level.REFINED,i,a.elements):rt.get_mesh_data(e,t?rt.Level.CONTROL:rt.Level.REFINED,i),n=8,o=rt.HEAPU32.subarray(s>>2,(s>>2)+n),l=o.subarray(4,8),c=0,u=rt.HEAPU32[o[c]>>2],h=rt.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=rt.HEAPU32[o[c]>>2],p=rt.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=rt.HEAPU32[o[c]>>2],m=rt.HEAPU32.subarray(f>>2,(f>>2)+l[c]);c++;let g=rt.HEAPU32[o[c]>>2],v=rt.HEAPU32.subarray(g>>2,(g>>2)+l[c]);if(c++,r===void 0){let y=new Qe;if(y.setIndex(new Ju(v,1)),y.setAttribute("position",new Re(h,3)),y.setAttribute("normal",new Re(p,3)),t){y.setAttribute("faceMap",new Ju(m,1));let x=new Float32Array(p.length/3*4).fill(0);y.setAttribute("color",new ht(x,4))}return rt.free_mesh_data(s),y.userData.type="SubdivGeometry",y}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(p),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,rt.free_mesh_data(s)}static freeSubdivPointer(e){rt.free_bvh(e),rt.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let r=rt.get_wireframe_data_for_base_level(e),a=4,s=rt.HEAPU32.subarray(r>>2,(r>>2)+a),n=s.subarray(2,4),o=0,l=rt.HEAPU32[s[o]>>2],c=rt.HEAPF32.subarray(l>>2,(l>>2)+n[o]);o++;let u=rt.HEAPU32[s[o]>>2],h=rt.HEAPU32.subarray(u>>2,(u>>2)+n[o]);if(t===void 0){let d=new Qe;d.setAttribute("position",new Re(c,3));let p=new Float32Array(c.length);for(let f=0,m=c.length;f<m;)p[f++]=i.r,p[f++]=i.g,p[f++]=i.b;return d.setAttribute("color",new ht(p,3)),d.setIndex(new Ju(h,1)),rt.free_wireframe_data_for_base_level(r),d}t.getAttribute("position").copyArray(c),t.attributes.position.needsUpdate=!0,rt.free_wireframe_data_for_base_level(r)}static updateCollabMesh(e,t,i){let r=t===0;r||rt.set_destination_refinement_level(e,t);let a=i?rt.get_topological_data2(e,r?rt.Level.CONTROL:rt.Level.REFINED,i.elements):rt.get_topological_data(e,r?rt.Level.CONTROL:rt.Level.REFINED),s=6,n=rt.HEAPU32.subarray(a>>2,(a>>2)+s),o=n.subarray(3,6),l=0,c=rt.HEAPU32[n[l]>>2],u=new Float32Array(rt.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=rt.HEAPU32[n[l]>>2],d=new Uint32Array(rt.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let p=rt.HEAPU32[n[l]>>2],f=new Uint8Array(rt.HEAPU32.subarray(p>>2,(p>>2)+o[l]));return rt.free_topological_data(a),{positions:u,indices:d,verticesPerFace:f}}},lO=["getX","getY","getZ"];function j1(e,t){let i={},r=t?t.count:e.count,a=0,s=[],n=[],o=1e4;for(let c=0;c<r;c++){let u=t?t.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(e[lO[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)n.push(e[lO[d]](u));i[h]=a,s.push(a),a++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:n,triIndices:l}}var xv=new P,Qb=new P,Zb=new P,Kb=new P;function vN(e,t,i,r){let a=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((p,f)=>Math.floor(f/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);e.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)e.push(l[d],l[d+1],0),a.push(h++);else for(let d=l.length-2;d>=0;d-=2)e.push(l[d],l[d+1],0),a.push(h++);return s.push(h),{indices:a,verticesPerFace:s}}let n=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((e[t[o]*3+2]===n||e[t[o]*3+2]===0)&&l++,(e[t[o+1]*3+2]===n||e[t[o+1]*3+2]===0)&&l++,(e[t[o+2]*3+2]===n||e[t[o+2]*3+2]===0)&&l++,l===3)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){xv.set(e[t[o]*3],e[t[o]*3+1],e[t[o]*3+2]),Qb.set(e[t[o+1]*3],e[t[o+1]*3+1],e[t[o+1]*3+2]),Zb.set(e[t[o+4]*3],e[t[o+4]*3+1],e[t[o+4]*3+2]),Kb.set(e[t[o+5]*3],e[t[o+5]*3+1],e[t[o+5]*3+2]),Qb.sub(xv).normalize(),Zb.sub(xv).normalize(),Kb.sub(xv).normalize();let l=Qb.cross(Zb).dot(Kb);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(a.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3):(a.push(t[o],t[o+1],t[o+4],t[o+5]),s.push(4),o+=6)}else a.push(t[o],t[o+1],t[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<e.length;h+=3,d++)e[h+2]===0&&(l.push(d),u++),e[h+2]===n&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),a.push(...l,...c),s.push(u,u)}return{indices:a,verticesPerFace:s}}var Co={};i8(Co,{calcBoolean:()=>Jae,calcBooleanTopological:()=>$ae,freeMeshSet:()=>rse,getMeshSet:()=>ese,hasOpenEdges:()=>tse,transformMeshSet:()=>ise});var yN,Qae=new Promise(e=>{yN=e}),bv;function Zae(){if(bv)return bv;async function e(){let t="https://unpkg.com/@splinetool/boolean-wasm@1.0.26/build",i=Xd(()=>import("./boolean-w3KXAzn1.js"),__vite__mapDeps([])),[r,a]=await Promise.all([i,fetch(`${t}/boolean.wasm`).then(o=>o.arrayBuffer())]),s=r.default,n=await s({wasmBinary:a});yN(n)}return bv=e(),bv}var Et,ld;Qae.then(e=>Et=e);function Kae(e,t,i){let r,a;e.userData.parameters.type==="TorusGeometry"&&e.userData.parameters.arc===Math.PI*2?a=e.getClosedTorusIndicesForBooleanOrSubdiv():a=e.getIndex();let{positions:s,triIndices:n}=j1(e.getAttribute("position"),a),o;if(t&&i){let{indices:l,verticesPerFace:c}=vN(s,n,e);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=n.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=n[c++],r[u++]=n[c++],r[u++]=n[c++]}return{positions:s,faceIndices:r,nFaces:o}}function xN(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,r=t*Float32Array.BYTES_PER_ELEMENT,a=Number.isInteger(e[0])?i:r,s=Et._malloc(a);return(Number.isInteger(e[0])?new Uint32Array(Et.HEAPU32.buffer,s,t):new Float32Array(Et.HEAPF32.buffer,s,t)).set(e,0),s}function bN(e){switch(e){case 0:return Et.OP.UNION;case 1:return Et.OP.INTERSECTION;case 2:return Et.OP.A_MINUS_B;case 3:return Et.OP.B_MINUS_A;case 4:return Et.OP.SYMMETRIC_DIFFERENCE;case 5:return Et.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function $ae(e,t){ld===void 0&&(ld=Et.init_csg());let i=xN(e),r=Et.csg_calc_topological(ld,i,e.length,bN(t));Et._free(i);let a=6,s=Et.HEAPU32.subarray(r>>2,(r>>2)+a),n=s.subarray(3,6),o=0,l=Et.HEAPU32[s[o]>>2],c=new Float32Array(Et.HEAPF32.subarray(l>>2,(l>>2)+n[o]));o++;let u=Et.HEAPU32[s[o]>>2],h=new Uint32Array(Et.HEAPU32.subarray(u>>2,(u>>2)+n[o]));o++;let d=Et.HEAPU32[s[o]>>2],p=new Uint8Array(Et.HEAPU32.subarray(d>>2,(d>>2)+n[o]));return Et.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:p}}function Jae(e,t,i,r){ld===void 0&&(ld=Et.init_csg());let a=xN(e),s=Et.csg_calc(ld,a,e.length,r,bN(t));Et._free(a);let n=5,o=Et.HEAPU32.subarray(s>>2,(s>>2)+n),l=o.subarray(2,5),c=0,u=Et.HEAPU32[o[c]>>2],h=Et.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Et.HEAPU32[o[c]>>2],p=Et.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let f=l[c];i.setAttribute("position",new Re(h,3)),i.setAttribute("normal",new Re(p,3));let m=Et.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new Fa),i.boundingSphere.radius=-1,i.userData.parameters={width:m[3]*2,height:m[4]*2,depth:m[5]*2},Et.free_mesh_data(s),f}function ese(e,t,i){if(Et===void 0)return-1;let r,a,s;if(t&&e.userData.positions!==void 0){let g=e.userData;s=g.verticesPerFace.length,r=g.positions,a=Array(g.verticesPerFace.reduce((v,y)=>v+y,0)+s);for(let v=0,y=0,x=0;v<g.verticesPerFace.length;v++){a[x++]=g.verticesPerFace[v];for(let w=0;w<g.verticesPerFace[v];w++)a[x++]=g.indices[y++]}}else({positions:r,faceIndices:a,nFaces:s}=Kae(e,t,i));let n=r.length,o=a.length,l=r.length,c=a.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Et._malloc(u),p=new Float32Array(Et.HEAPF32.buffer,d,l),f=new Uint32Array(Et.HEAPU32.buffer,d+h,c);p.set(r,0),f.set(a,0);let m=Et.get_csg_mesh(d,n,d+h,o,s);return Et._free(d),m}function tse(e){return Et.has_open_edges(e)}function ise(e,t){Et.transform_csg_mesh(e,t.elements)}function rse(e){Et.free_csg_mesh(e)}var ase={ConeGeometry:Sre,CubeGeometry:Are,CylinderGeometry:Xz,DodecahedronGeometry:Cre,EllipseGeometry:iC,HelixGeometry:aae,IcosahedronGeometry:sae,LatheGeometry:nae,NonParametricGeometry:pae,PolygonGeometry:hN,PyramidGeometry:fae,RectangleGeometry:rC,SphereGeometry:vae,PlaneGeometry:yae,BackdropGeometry:xae,StarGeometry:uN,TextFrameGeometry:wae,TorusGeometry:_ae,TorusKnotGeometry:Aae,TriangleGeometry:Eae,PathGeometry:Fae,VectorGeometry:Th},cO=e=>ase[e.type].create(e);function eu(e){return e!==null&&"booleanOp"in e}var wN=class extends ZE(tr){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new Se}updateVisible(e){super.updateVisible(e),this.visible=!eu(this.parent)&&this.visible,eu(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(Co.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(e=!1){return e?this.booleanWasTransformed=!0:this.freeBooleanPointer(),eu(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof wN&&(e.freeBooleanPointer(),eu(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&eu(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(e=!1){super.onVariableUpdate(e),eu(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},wv=new Hi;function aC(e,t=0,i=e.count,r,a){let s=1/0,n=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=t;h<i;h++){let d=e.getX(h),p=e.getY(h),f=e.getZ(h);d<s&&(s=d),p<n&&(n=p),f<o&&(o=f),d>l&&(l=d),p>c&&(c=p),f>u&&(u=f)}wv.min.set(s,n,o),wv.max.set(l,c,u),wv.getCenter(r),wv.getSize(a).multiplyScalar(.5)}var sse=new Qe,nse=new _h,ba=class extends wN{constructor(e,t){super(sse,nse),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?aC(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},hO=class{constructor(e){e=e??{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},pc=class{constructor(e){this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},this.uuid=Ge.generateUUID(),this.type=e,this.name=""}analyze(e,t){t=t??{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){return i=i??{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){i=i??{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){t=t??this.getType(e,t);let r=e.getNodeData(i??this);return e.analyzing&&this.appendDepsNode(e,r,t),e.nodes.indexOf(this)===-1&&e.nodes.push(this),this.updateFrame!==void 0&&e.updaters.indexOf(this)===-1&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,r,a,s){return""}generate(e,t,i,r,a){return""}parse(e,t,i,r){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let r=e.getTypeLength(i);(r>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=r,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return t==="sampler2D"||t==="samplerCube"?t:this.type}getHash(){let e="{",t,i;for(t in this)i=this[t],i instanceof pc&&(e+='"'+t+'":'+i.getHash()+",");if(this.hashProperties)for(let r=0;r<this.hashProperties.length;r++)t=this.hashProperties[r],i=this[t],e+='"'+t+'":"'+String(i)+'",';return e+='"id":"'+this.uuid+'"}',e}},ose=class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=i!==void 0?i:!0,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return this.nodes[e]!==void 0}containsKeyword(e){return this.keywords[e]!==void 0}},Ia=new ose,ti=class extends pc{constructor(e,t){super(e),this.scope="",t=t??{},this.shared=t.shared!==void 0?t.shared:!0,this.unique=t.unique!==void 0?t.unique:!1}build(e,t,i,r){if(t=t??this.getType(e),this.getShared(e,t)){let a=this.getUnique(e,t);a&&this.uuid===void 0&&(this.uuid=Ge.generateUUID()),i=e.getUUID(i??this.getUUID(),!a);let s=e.getNodeData(i),n=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(a)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,n)||e.context.ignoreCache||s.deps===1))return super.build(e,t,i);i=this.getUUID(!1);let o=this.getTemp(e,i);if(o)return e.format(o,n,t);{o=super.generate(e,t,i,s.output,r);let l=this.generate(e,n,i);return e.addNodeCode(o+" = "+l+";"),e.format(o,n,t)}}return super.build(e,t,i)}getShared(e,t){return t!=="sampler2D"&&t!=="samplerCube"&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return typeof this.scope=="string"&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,r,a){return this.getShared(e,t)||console.error("TempNode is not shared"),i=i??this.uuid,e.getTempVar(i,r??this.getType(e),a,this.getLabel()).name}},Ga=class extends ti{constructor(e,t){t=t??{},t.shared=t.shared!==void 0?t.shared:!1,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,r,a,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let n=e.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(e,t,i,r,a,s):e.isShader("vertex")?(n.vertex||(n.vertex=e.createVertexUniform(r,this,a,s,this.getLabel())),e.format(n.vertex.name,r,t)):(n.fragment||(n.fragment=e.createFragmentUniform(r,this,a,s,this.getLabel())),e.format(n.fragment.name,r,t))}},Rr=class extends Ga{constructor(e=0,t){super("v2"),this.nodeType="Vector2",this.value=e instanceof Q?e:new Q(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,r,a,s){return e.format("vec2("+this.value.x+", "+this.value.y+")",r,t)}},ms=class extends Ga{constructor(e=0,t,i){super("v3"),this.nodeType="Vector3",this.value=e instanceof P?e:new P(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,r,a,s){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,t)}},Vr=class extends tt{constructor(t,i,r,a){super(t,i,r),this.isColorA=!0,this.a=a}setRGBA(t,i,r,a){super.setRGB(t,i,r),this.a=a}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(t){return super.equals(t)&&this.a===t.a}setStyle(t,i="srgb"){let r;if(t==="transparent")return this.setRGBA(0,0,0,0),this;if(r=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let a,s=r[1],n=r[2];switch(s){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.a=s==="rgba"?parseFloat(a[4]):1,super.setStyle(t,i);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return this.a=s==="hsla"?parseFloat(a[4]):1,super.setStyle(t,i);break}}return super.setStyle(t,i)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},Mo=class extends Ga{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof Vr?e:new Vr(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,r,a,s){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,t)}},lse=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,uO=/[a-z_0-9]+/gi,Ie=class extends ti{constructor(e,t,i,r,a){super(a),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=a===void 0,this.isInterface=!1,this.parse(e,t,i,r)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,r,a){let s,n=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;s=uO.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,p=h;if(this.keywords[h]||this.useKeywords&&d&&Ia.containsKeyword(h)){let f=this.keywords[h];if(!f){let m=Ia.getKeywordData(h);m.cache&&(f=e.keywords[h]),f=f||Ia.getKeyword(h,e),m.cache&&(e.keywords[h]=f)}p=f.build(e)}h!==p&&o[u.index+n-1]!=="."&&(o=o.substring(0,u.index+n)+p+o.substring(u.index+h.length+n),n+=p.length-h.length),this.getIncludeByName(p)===void 0&&Ia.contains(p)&&e.include(Ia.get(p))}return t==="source"?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,r){if(this.src=e||"",this.includes=t??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let a=lse.exec(this.src);if(this.inputs=[],a&&a.length==4){this.type=a[1],this.name=a[2];let s=a[3].match(uO);if(s){let n=0;for(;n<s.length;){let o=s[n++],l;o==="in"||o==="out"||o==="inout"?l=s[n++]:(l=o,o="");let c=s[n++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},cse=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,_N=class extends ti{constructor(e="",t){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||_N.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,r,a){this.src=e||"";let s,n,o="",l=cse.exec(e);this.useDefine=a??this.src.charAt(0)==="#",l&&l.length>1?(n=l[1],s=l[2],o=l[3]):(s=this.src,n="f"),this.name=s,this.type=n,this.value=o}build(e,t){if(t==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,r,a){return e.format(this.name,this.getType(e),t)}},Zt=_N;Zt.PI="PI",Zt.PI2="PI2",Zt.RECIPROCAL_PI="RECIPROCAL_PI",Zt.RECIPROCAL_PI2="RECIPROCAL_PI2",Zt.LOG2="LOG2",Zt.EPSILON="EPSILON";var hse=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),use=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),SN=class extends ti{constructor(e=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,r,a){return t==="source"?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(e=""){this.src=e,this.inputs=[];let t=hse.exec(e);if(t){let i=t[2],r;for(;r=use.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=t[1]}else this.name="";this.type=this.name}},sC=class extends ti{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=e??0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(r,this.getType(e),t)}};Ia.addKeyword("uv",function(){return new sC});Ia.addKeyword("uv2",function(){return new sC(1)});var Su=class extends ti{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=t??Su.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case ln:return["Linear"];case yt:return["sRGB"];default:return[]}}generate(e,t){var n;let i=this.input.build(e,"v4"),r=this.getType(e),a=Su.Nodes[this.method],s=e.include(a);if(s===Su.LINEAR_TO_LINEAR)return e.format(i,r,t);if(((n=a.inputs)==null?void 0:n.length)===2){let o=this.factor.build(e,"f");return e.format(s+"( "+i+", "+o+" )",r,t)}else return e.format(s+"( "+i+" )",r,t)}fromEncoding(e){let t=Su.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=Su.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},Un=Su;Un.Nodes={LinearToLinear:new Ie(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new Ie(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new Ie(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Un.LINEAR_TO_LINEAR="LinearToLinear",Un.SRGB_TO_LINEAR="sRGBToLinear",Un.LINEAR_TO_SRGB="LinearTosRGB";var ci=class extends Ie{constructor(e="",t,i,r,a){super(e,a,r,i,t),this.nodeType="Expression"}},Lo=class extends Ga{constructor(e=new Si,t,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=t??new sC,this.bias=i,this.project=r!==void 0?r:!1}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){if(t==="sampler2D")return this.getTexture(e,t);let i=this.getTexture(e,t),r=this.uv.build(e,this.project?"v4":"v2"),a=this.bias?this.bias.build(e,"f"):void 0;a===void 0&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f"));let s,n;this.project?s="texture2DProj":s=a?"tex2DBias":"tex2D",a?n=s+"( "+i+", "+r+", "+a+" )":n=s+"( "+i+", "+r+" )";let o={include:e.isShader("vertex"),ignoreCache:!0},l=this.getType(e);return e.addContext(o),this.colorSpace=this.colorSpace??new Un(new ci("",l)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(n),n=this.colorSpace.build(e,l),e.removeContext(),e.format(n,l,t)}},Be=class extends Ga{constructor(e){super("f"),this.nodeType="Float",this.value=e??0}generateReadonly(e,t,i,r,a,s){return e.format(this.value+(this.value%1?"":".0"),r,t)}},dO=class extends ti{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=t??[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,r,a){r=this.getType(e);let s=this.value,n=s.build(e,t)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(e,e.getTypeByFormat(c.type)))}n+=o.join(", ")+" )"}return e.format(n,r,t)}},AN=class extends ti{constructor(e,t,i=AN.ADD){super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let r=this.a.build(e,i),a=this.b.build(e,i);return e.format("( "+r+" "+this.op+" "+a+" )",i,t)}},Ta=AN;Ta.ADD="+",Ta.SUB="-",Ta.MUL="*",Ta.DIV="/";var Qt=class extends ti{constructor(e,t=Qt.ABS,i,r){super(),this.nodeType="Math",this.a=e,typeof t!="string"?this.b=t:r=t,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case Qt.MIX:case Qt.CLAMP:case Qt.REFRACT:case Qt.SMOOTHSTEP:case Qt.FACEFORWARD:return 3;case Qt.MIN:case Qt.MAX:case Qt.MOD:case Qt.STEP:case Qt.REFLECT:case Qt.DISTANCE:case Qt.DOT:case Qt.CROSS:case Qt.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,r=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>r?this.a.getType(e):i>r?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case Qt.LENGTH:case Qt.DISTANCE:case Qt.DOT:return"f";case Qt.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,r,a,s=this.a?e.getTypeLength(this.a.getType(e)):0,n=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case Qt.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case Qt.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case Qt.CROSS:i=this.a.build(e,"v3"),r=this.b.build(e,"v3");break;case Qt.STEP:i=this.a.build(e,s===1?"f":l),r=this.b.build(e,l);break;case Qt.MIN:case Qt.MAX:case Qt.MOD:i=this.a.build(e,l),r=this.b.build(e,n===1?"f":l);break;case Qt.REFRACT:i=this.a.build(e,l),r=this.b.build(e,l),a=this.c.build(e,"f");break;case Qt.MIX:i=this.a.build(e,l),r=this.b.build(e,l),a=this.c.build(e,o===1?"f":l);break;default:i=this.a.build(e,l),this.b&&(r=this.b.build(e,l)),this.c&&(a=this.c.build(e,l));break}let u=[];u.push(i),r&&u.push(r),a&&u.push(a);let h=this.getNumInputs(e);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return e.format(this.method+"( "+u.join(", ")+" )",c,t)}},mt=Qt;mt.RAD="radians",mt.DEG="degrees",mt.EXP="exp",mt.EXP2="exp2",mt.LOG="log",mt.LOG2="log2",mt.SQRT="sqrt",mt.INV_SQRT="inversesqrt",mt.FLOOR="floor",mt.CEIL="ceil",mt.NORMALIZE="normalize",mt.FRACT="fract",mt.SATURATE="saturate",mt.SIN="sin",mt.COS="cos",mt.TAN="tan",mt.ASIN="asin",mt.ACOS="acos",mt.ARCTAN="atan",mt.ABS="abs",mt.SIGN="sign",mt.LENGTH="length",mt.NEGATE="negate",mt.INVERT="invert",mt.MIN="min",mt.MAX="max",mt.MOD="mod",mt.STEP="step",mt.REFLECT="reflect",mt.DISTANCE="distance",mt.DOT="dot",mt.CROSS="cross",mt.POW="pow",mt.MIX="mix",mt.CLAMP="clamp",mt.REFRACT="refract",mt.SMOOTHSTEP="smoothstep",mt.FACEFORWARD="faceforward";var uf=class extends ti{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,r){let a=new dO(uf.Nodes.bilinearCubeUV,[t,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Un(new ci("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(a.build(e)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Un(new ci("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(a.build(e)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Un(new ci("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(a.build(e)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Un(new ci("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(a.build(e)+".br");let s={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(s),this.colorSpaceTLExp=new ci(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new ci(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new ci(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new ci(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let n=new ci("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return n.keywords.cubeUV_TL=this.colorSpaceTLExp,n.keywords.cubeUV_TR=this.colorSpaceTRExp,n.keywords.cubeUV_BL=this.colorSpaceBLExp,n.keywords.cubeUV_BR=this.colorSpaceBRExp,n.keywords.cubeUV=a,n}generate(e,t){if(e.isShader("fragment")){let i=this.uv,r=this.bias||e.context.roughness,a=new dO(uf.Nodes.roughnessToMip,[r]),s=new mt(a,uf.Nodes.m0,uf.Nodes.cubeUV_maxMipLevel,mt.CLAMP),n=new mt(s,mt.FLOOR),o=new mt(s,mt.FRACT),l=this.bilinearCubeUV(e,this.value,i,n),c=this.bilinearCubeUV(e,this.value,i,new Ta(n,new Be(1).setReadonly(!0),Ta.ADD)),u=new mt(l,c,o,mt.MIX);return e.format(u.build(e),"v4",t)}else return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},nS=uf;nS.Nodes=function(){let e=new SN(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),t=new Zt("float cubeUV_maxMipLevel 8.0",!0),i=new Zt("float cubeUV_minMipLevel 4.0",!0),r=new Zt("float cubeUV_maxTileSize 256.0",!0),a=new Zt("float cubeUV_minTileSize 16.0",!0),s=new Ie(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let n=new Ie(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);n.useKeywords=!1;let o=new Ie(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[e,s,n,t,i,r,a]);o.useKeywords=!1;let l=new Zt("float r0 1.0",!0),c=new Zt("float v0 0.339",!0),u=new Zt("float m0 -2.0",!0),h=new Zt("float r1 0.8",!0),d=new Zt("float v1 0.276",!0),p=new Zt("float m1 -1.0",!0),f=new Zt("float r4 0.4",!0),m=new Zt("float v4 0.046",!0),g=new Zt("float m4 2.0",!0),v=new Zt("float r5 0.305",!0),y=new Zt("float v5 0.016",!0),x=new Zt("float m5 3.0",!0),w=new Zt("float r6 0.21",!0),S=new Zt("float v6 0.0038",!0),_=new Zt("float m6 4.0",!0),A=[l,c,u,h,d,p,f,m,g,v,y,x,w,S,_],E=new Ie(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,A);return{bilinearCubeUV:o,roughnessToMip:E,m0:u,cubeUV_maxMipLevel:t}}();var Au=class extends ti{constructor(e){super("v3"),this.nodeType="Normal",this.scope=e??Au.VIEW}getShared(){return this.scope===Au.WORLD}build(e,t,i,r){let a=e.context[this.scope+"Normal"];return a?a.build(e,t,i,r):super.build(e,t,i)}generate(e,t,i,r,a){let s;switch(this.scope){case Au.VIEW:e.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Au.LOCAL:e.isShader("vertex")?s="objectNormal":(e.requires.normal=!0,s="vObjectNormal");break;case Au.WORLD:e.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,s="vWNormal");break}return e.format(s,this.getType(e),t)}},ka=Au;ka.LOCAL="local",ka.WORLD="world",ka.VIEW="view",ka.NORMAL="normal";Ia.addKeyword("viewNormal",function(){return new ka(ka.VIEW)});Ia.addKeyword("localNormal",function(){return new ka(ka.NORMAL)});Ia.addKeyword("worldNormal",function(){return new ka(ka.WORLD)});var So=class extends ti{constructor(e){super("v3"),this.nodeType="Position",this.scope=e??So.LOCAL}getType(){switch(this.scope){case So.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case So.LOCAL:case So.WORLD:return!1}return!0}generate(e,t,i,r,a){let s;switch(this.scope){case So.LOCAL:e.isShader("vertex")?s="transformed":(e.requires.position=!0,s="vPosition");break;case So.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,s="vWPosition";break;case So.VIEW:s=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case So.PROJECTION:s=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return e.format(s,this.getType(),t)}},$s=So;$s.LOCAL="local",$s.WORLD="world",$s.VIEW="view",$s.PROJECTION="projection";Ia.addKeyword("position",function(){return new $s});Ia.addKeyword("worldPosition",function(){return new $s($s.WORLD)});Ia.addKeyword("viewPosition",function(){return new $s($s.VIEW)});var Pn=class extends ti{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=e??Pn.CUBE}getUnique(e){return!e.context.viewNormal}getType(){switch(this.scope){case Pn.SPHERE:return"v2"}return this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let r;switch(this.scope){case Pn.VECTOR:{let a=new ka(ka.VIEW),s=e.context.roughness,n=a.build(e,"v3"),o=new $s($s.VIEW).build(e,"v3"),l=s?s.build(e,"f"):void 0,c=`reflect( -normalize( ${o} ), ${n} )`;l&&(c=`normalize( mix( ${c}, ${n}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(e.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case Pn.CUBE:{let a=new Pn(Pn.VECTOR).build(e,"v3"),s="vec3( -"+a+".x, "+a+".yz )";i?(e.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case Pn.SPHERE:{let a="normalize( ( viewMatrix * vec4( "+new Pn(Pn.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode(`vec2 reflectSphereVec = ${a};`),r="reflectSphereVec"):r=a;break}}return e.format(r,this.getType(),t)}else return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},cd=Pn;cd.CUBE="cube",cd.SPHERE="sphere",cd.VECTOR="vector";var dse=class extends ti{constructor(e=new Lo,t,i){super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new nS(this.value,t??new cd(cd.VECTOR),i),this.irradianceNode=new nS(this.value,new ka(ka.WORLD),new Be(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),(e.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},pse=class extends Ga{constructor(e=new oE,t,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=t??new cd,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var l;if(t==="samplerCube")return this.getTexture(e,t);let i=this.getTexture(e,t),r=(l=this.uv)==null?void 0:l.build(e,"v3"),a=this.bias?this.bias.build(e,"f"):void 0;a===void 0&&e.context.bias&&(a=e.context.bias.setTexture(this).build(e,"f"));let s;a?s="texCubeBias( "+i+", "+r+", "+a+" )":s="texCube( "+i+", "+r+" )";let n={include:e.isShader("vertex"),ignoreCache:!0},o=this.getType(e);return e.addContext(n),this.colorSpace=this.colorSpace??new Un(new ci("",o)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(e,o),e.removeContext(),e.format(s,o,t)}},fse=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,mse=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,gse=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,vse=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,yse=`
layout(location = 1) out vec4 gVelocity;
`,xse=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,pO=["x","y","z","w"],bse=["float","vec2","vec3","vec4"],wse={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},_se={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},EN=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(t,i){return t.deps.length-i.deps.length}return function(t,i){let r=this.getIncludes(t,i);if(!r)return"";let a="";r=r.sort(e);for(let s=0;s<r.length;s++)r[s].src&&(a+=r[s].src+`
`);return a}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode(fse),this.addFragmentParsCode(mse),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(gse),this.addFragmentFinalCode(vse)),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=e??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){this.fragmentVariables[e]===void 0&&(this.addFragmentCode(`${t} ${e};`),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){this.fragmentParsVariables[e]===void 0&&(this.addFragmentParsCode(`${t} ${e};`),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){this.vertexParsVariables[e]===void 0&&(this.addVertexParsCode(`${t} ${e};`),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[t??this.shader]+=e+`
`}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[t??this.shader]+=e+`
`}clearNodeCode(e){e=e??this.shader;let t=this.nodeCode[e];return this.nodeCode[e]="",t}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[t??this.shader]+=e+`
`}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[t??this.shader]+=e+`
`}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return this.caches.indexOf(e)!==-1}isSlot(e){return this.slots.indexOf(e)!==-1}define(e,t){this.defines[e]=t===void 0?1:t}require(e){this.requires[e]=!0}isDefined(e){return this.defines[e]!==void 0}getVar(e,t,i,r="varying",a="V",s=""){let n=this.getVars(r),o=n[e];if(!o){let l=n.length;o={name:i||"node"+a+l+(s?"_"+s:""),type:t},n.push(o),n[e]=o}return o}getTempVar(e,t,i,r){return this.getVar(e,t,i,this.shader,"T",r)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join(`
`)}getVarListCode(e,t){t=t??"";let i="";for(let r=0,a=e.length;r<a;++r){let s=e[r],n=s.type,o=s.name,l=s.size,c=this.getFormatByType(n);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=t+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=t+" "+c+" "+o+`;
`}return i}getVars(e){return this.inputs.vars[e??this.shader]}getNodeData(e){let t=e instanceof pc?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,r,a,s){if(t.includes("[]")){let n=this.inputs.arrayUniforms,o=n.list.length,l=new hO({type:t,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:a});return n.list.push(l),n[e].push(l),n[e][l.name]=l,this.uniforms[l.name]=l,l}else{let n=this.inputs.uniforms,o=n.list.length,l=new hO({type:t,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:a});return n.list.push(l),n[e].push(l),n[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,r,a){return this.createUniform("vertex",e,t,i,r,a)}createFragmentUniform(e,t,i,r,a){return this.createUniform("fragment",e,t,i,r,a)}include(e,t,i){var s;let r;if(e=typeof e=="string"?Ia.get(e):e,this.context.include===!1)return e.name;e instanceof Ie?r=this.includes.functions:e instanceof Zt?r=this.includes.consts:e instanceof SN&&(r=this.includes.structs);let a=r[this.shader]=r[this.shader]||[];if(e){let n=a[e.name];if(n||(n=a[e.name]={node:e,deps:[]},a.push(n),n.src=e.build(this,"source")),e instanceof Ie&&t&&a[t.name]&&a[t.name].deps.indexOf(e)===-1&&(a[t.name].deps.push(e),(s=e.includes)==null?void 0:s.length)){let o=0;do this.include(e.includes[o++],t);while(o<e.includes.length)}return i&&(n.src=i),e.name}else throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return bse[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return e==="f"?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return e===1?"f":"v"+e}findNode(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!=null&&i.isNode)return i}}resolve(...e){for(let t=0;t<arguments.length;t++){let i=e[t];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case uh:case dh:return new pse(i);case Nm:return new dse(new Lo(i));default:return new Lo(i)}else{if(i.isVector2)return new Rr(i);if(i.isVector3)return new ms(i);if(i.isVector4)return new Mo(i)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":return e+".x";case"f <- v3":return e+".x";case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":return e+".xy";case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":return"int( "+e+".x )";case"i <- v3":return"int( "+e+".x )";case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return wse[e]||e}getFormatByType(e){return _se[e]||e}getUUID(e,t){return t=t!==void 0?t:!0,t&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return pO[e]}getIndexByElement(e){return pO.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=ln,t===ln&&this.context.gamma&&(t=yt),t}},Li=class extends Ga{constructor(e=0,t,i,r){super("c"),this.nodeType="Color",this.value=e instanceof Vr?e:new Vr(e||0,t,i,r)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,r,a,s){i=e.getUUID(i??this.getUUID()),r=r??this.getType(e);let n=e.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(e,"f");e.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(e,t,i,r,a,s):e.isShader("vertex")?(n.vertex||(n.vertex=e.createVertexUniform(r,this,a,s,this.getLabel())),e.format(n.vertex.name,r,t)):(n.fragment||(n.fragment=e.createFragmentUniform(r,this,a,s,this.getLabel())),e.format(n.fragment.name,r,t))}generateReadonly(e,t,i,r,a,s){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,t)}},ai=class extends Ga{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(e??0)}generateReadonly(e,t,i,r,a,s){return e.format(this.value.toString(),r,t)}},ma=class extends Ga{constructor(e){super("b"),this.nodeType="Bool",this.value=e??!1}generateReadonly(e,t,i,r){return e.format(this.value?"true":"false",r,t)}},Tc=class extends Ga{constructor(e=1,t){super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:typeof t=="number"?new Array(e).fill(t):new Array(e).fill(0)}},nC=class extends Ga{},Sse=class extends nC{constructor(e){super("v3"),this.image=e,this._value=new P}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},oS=class extends nC{constructor(e,t,i=1008){super("t"),this.image=e,this.wrap=t,this.minFilter=i}get value(){return this.image.getTexture(this.wrap,this.minFilter)}},CN=class extends Ga{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=e??new Ui}generateReadonly(e,t,i,r,a,s){return e.format("mat3("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},eo=class extends Ga{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=e??new Se}generateReadonly(e,t,i,r,a,s){return e.format("mat4("+this.value.elements.join(", ")+")",r,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function fO(e,t,i){e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0)}var Ase=class extends CN{constructor(e,t){super(new Ui),this.repeat=e,this.offset=t,fO(this.value,e,t)}updateMatrix(){fO(this.value,this.repeat,this.offset)}},Pc=class extends Ga{constructor(e=1,t){super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof dt?new Array(e).fill(t):new Array(e).fill(new dt(0))}},mO=class extends ti{constructor(e,t,i,r){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=r}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}else return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},MN=class extends ti{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(MN.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.build(e,"v3")})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},lS=MN;lS.Nodes=function(){return{customColor:new Ie(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}}();var TN=class extends ti{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){let i=e.include(TN.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(e,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},PN=TN;PN.Nodes=function(){return{customNormal:new Ie(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}}();var df=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=r,this.axis=a,this.side=s,this.size=n,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=e.include(df.Nodes.cylindrical);break;case 2:r=e.include(df.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],n=["zy","xz","xy"][this.axis.value],o=new Ie(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${n})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=e.include(o);break;case 4:r=e.include(df.Nodes.triplanar);break;default:r=e.include(df.Nodes.uv);break}e.addFragmentVariable(this.calpha,"float");let a=[];if(a.push("normal"),a.push(this.texture.generate(e,"t")),a.push(this.textureSize.build(e,"v2")),a.push(this.crop.build(e,"f")),a.push(this.mat.build(e,"mat3")),a.push(this.size.build(e,"v2")),a.push(this.blending.build(e,"f")),a.push(this.isMask.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.mode.build(e,"i")),a.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,n=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;e.addFragmentVariable(n,"vec2"),e.addFragmentVariable(o,"vec2"),e.addFragmentVariable(l,"vec2"),e.addFragmentVariable(c,"vec3"),a.push(n),a.push(o),a.push(l),a.push(c)}else{let s=`${i}_writeUvs`;e.addFragmentVariable(s,"vec2"),a.push(s)}return e.format(r+"("+a.join(",")+")",this.getType(e),t)}},oC=df;oC.Nodes=function(){let e=new Ie(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),t=new Ie(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new Ie(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new Ie(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:e,spherical:t,uv:i,triplanar:r}}();var pf=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=r,this.isVector=a,this.isWorldSpace=s,this.origin=n,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new Ie(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[pf.Nodes.vectorLinearWorldSpaceDepth,pf.Nodes.vectorLinearObjectSpaceDepth,pf.Nodes.vectorSphericalObjectSpaceDepth,pf.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&e.define(`${i}_SMOOTH`),this.isVector.value>.5&&e.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&e.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&e.define(`${i}_WORLDSPACE`),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let a=e.include(r),s=[];return s.push(this.near.build(e,"f")),s.push(this.far.build(e,"f")),s.push(this.origin.build(e,"v3")),s.push(this.direction.build(e,"v3")),s.push(this.colors.build(e,"v4[]")),s.push(this.steps.build(e,"f[]")),s.push(this.isMask.build(e,"b")),s.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),s.push(this.alpha.build(e,"f")),s.push(this.calpha),e.format(a+"("+s.join(",")+")",this.getType(e),t)}else return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},DN=pf;DN.Nodes=function(){let e=new Ie(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),t=new Ie(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new Ie(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new Ie(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:e,vectorLinearObjectSpaceDepth:t,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}}();var Ese=class extends ti{constructor(e,t,i,r,a,s,n,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=r,this.factor=a,this.isMask=o,this.alpha=s,this.mode=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new Ie(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=e.include(i),a=[];return a.push(this.color.build(e,"c")),a.push(this.bias.build(e,"f")),a.push(this.scale.build(e,"f")),a.push(this.intensity.build(e,"f")),a.push(this.factor.build(e,"f")),a.push(this.isMask.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.mode.build(e,"i")),a.push(this.calpha),e.format(r+"("+a.join(",")+")",this.getType(e),t)}else return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},ON=class extends ti{constructor(e,t,i,r,a,s,n,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=r,this.offset=a,this.morph=s,this.angle=n,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(ON.Nodes.gradient),r=[];return r.push(this.gradientType.build(e,"i")),r.push(this.smooth.build(e,"b")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.offset.build(e,"v2")),r.push(this.morph.build(e,"v2")),r.push(this.angle.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},IN=ON;IN.Nodes=function(){return{gradient:new Ie(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}}();var RN=class extends ti{constructor(e,t,i,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=r,this.alpha=t,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(RN.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let r=[];return r.push(this.texture.generate(e,"t")),r.push("normal"),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},LN=RN;LN.Nodes=function(){return{matcap:new Ie(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}}();var lC=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(lC||{}),Da=function(){let e=new Ie(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),t=new Ie(`float simplex3d(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[e]);t.keywords.F3=new Zt("float F3 0.3333333"),t.keywords.G3=new Zt("float G3 0.1666667");let i=new Ie(`float simplex3dFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplex3d(m * rot1)
				 + 0.2666667 * simplex3d(2.0 * m * rot2)
				 + 0.1333333 * simplex3d(4.0 * m * rot3)
				 + 0.0666667 * simplex3d(8.0 * m);
		}`,[t]),r=new Ie("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),a=new Ie("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),s=new Ie(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[r,a]),n=new Ie("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new Ie("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[n]),l=new Ie(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[o]),c=new Ie(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[l]);c.keywords.NUM_OCTAVES=new Zt("int NUM_OCTAVES 5");let u=new Ie("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),h=new Ie(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[r,a,u]),d=new Ie(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new Ie(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),f=new Ie(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new Ie(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),g=new Ie(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),v=new Ie(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),y=new Ie(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			float id = hashwithoutsine13(vec3(p + mb) + seed);

			// Second pass for edge distance  
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[d,p,f,m,g,v]);return{simplex:t,simplexFractal:i,simplexAshima:s,fbm:c,perlin:h,voronoi:y}}(),kN=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c,u,h,d,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=r,this.fB=a,this.distortion=s,this.colorA=n,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t,i,r,a){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let s=Object.values(lC)[this.noiseType.value],n=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new Ie(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${n}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Da.simplex,Da.simplexFractal,Da.simplexAshima,Da.fbm,Da.perlin,Da.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};kN.numOctaves=5;var zN=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c,u,h,d,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=a,this.outlineThreshold=s,this.contourFrequency=n,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(e,"f"),a=this.resolution.build(e,"v2"),s=this.compensation.build(e,"b"),n=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(r,"uniform float"),e.addVertexParsVariable(a,"uniform vec2"),e.addVertexParsVariable(s,"uniform bool"),e.addVertexParsVariable(n,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${a} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${n};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let r=e.include(zN.Nodes.outline),a=[];return a.push(this.outlineColor.build(e,"c")),a.push(this.contourColor.build(e,"c")),a.push(this.outlineWidth.build(e,"f")),a.push(this.contourWidth.build(e,"f")),a.push(this.contourThreshold.build(e,"f")),a.push(this.outlineThreshold.build(e,"f")),a.push(this.contourFrequency.build(e,"f")),a.push(this.outlineSmoothing.build(e,"f")),a.push(this.contourDirection.build(e,"v3")),a.push(this.positionalLines.build(e,"b")),a.push(this.resolution.build(e,"v2")),a.push(this.normalMap.getTexture(e,"t")),a.push(this.depthMap.getTexture(e,"t")),a.push(this.pixelRatio.build(e,"f")),a.push(this.compensation.build(e,"b")),a.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.calpha),this.firstTime=!this.firstTime,e.format(r+"("+a.join(",")+")",this.getType(e),t)}else return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},NN=zN;NN.Nodes=function(){let e=new Ie(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new Ie(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[e])}}();var Ao=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c,u,h,d,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=r,this.offset=a,this.colorA=s,this.colorB=n,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.isShader("fragment")){e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,a=new Ie(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new Ie(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),n="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;n=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}n=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new Ie(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${n}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,a,Ao.DrawFunctions.circle,Ao.DrawFunctions.ring,Ao.DrawFunctions.polygon,Ao.DrawFunctions.cross,Ao.DrawFunctions.diamond,Ao.DrawFunctions.checkerboard,Ao.DrawFunctions.line,Ao.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}else return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},BN=Ao;BN.DrawFunctions=function(){let e=new Ie(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),t=new Ie(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[e]),i=new Ie(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[t]),r=new Ie(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[t]),a=new Ie(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[t]),s=new Ie(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[t]),n=new Ie(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[t]),o=new Ie(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new Ie(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[t]),c=new Ie(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:t,circle:i,ring:r,polygon:a,cross:s,diamond:n,checkerboard:o,line:l,wave:c}}();var jN=class extends ti{constructor(e,t,i,r,a,s,n,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=a,this.offset=s,this.isMask=o,this.alpha=n,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(jN.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(e,"f")),r.push(this.movement.build(e,"f")),r.push(this.wavelengths.build(e,"v3")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.offset.build(e,"v3")),r.push(this.isMask.build(e,"b")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},FN=jN;FN.Nodes=function(){let e=new Ie(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
                 vec3 st = position / noiseScale;
				 vec3 q = vec3(simplex3d(st),
							  simplex3d(st + vec3(1.0)),
							  simplex3d(st + vec3(1.0)));

				 vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),
							  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),
							  simplex3d(st * q));

                 float noise = simplex3d(st + r);

                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);
             }`,[Da.simplex]);return{rainbow:new Ie(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
             }`,[e])}}();var UN=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=r,this.isWorldSpace=a,this.noiseStrength=s,this.noiseScale=n,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(UN.Nodes.toon),r=[];return r.push(this.positioning.build(e,"i")),r.push(this.colors.build(e,"v4[]")),r.push(this.steps.build(e,"f[]")),r.push(this.source.build(e,"v3")),r.push(this.isWorldSpace.build(e,"b")),r.push(this.noiseStrength.build(e,"f")),r.push(this.noiseScale.build(e,"f")),r.push(this.shadowColor.build(e,"v4")),r.push(this.offset.build(e,"v3")),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},VN=UN;VN.Nodes=function(){let e=new Ie(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),t=new Ie(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new Ie(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[t]),r=new Ie(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),a=new Ie(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new Ie(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplex3d(st),
					// 	simplex3d(st + vec3(111.1, 143.89, 217.19)),
					// 	simplex3d(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Da.simplex,e,i,a])}}();var Cse=function(){return{textureBicubic:new Ie(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}}();function Mse(e,t){return e>=t?new Q(t/e,1):new Q(1,e/t)}var GN=class extends ti{constructor(e,t,i,r,a,s,n,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=a,this.transmissionDepthMap=s,this.aspectRatio=n,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,at.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(GN.Nodes.transmission),r=[];return r.push(this.thickness.build(e,"f")),r.push(this.ior.build(e,"f")),r.push(this.roughness.build(e,"f")),r.push(this.transmissionSamplerSize.build(e,"v2")),r.push(this.transmissionSamplerMap.getTexture(e,"t")),r.push(this.transmissionDepthMap.getTexture(e,"t")),r.push(this.aspectRatio.build(e,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(e,"v3").result})`:"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.calpha),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},HN=GN;HN.Nodes=function(){let e=new Ie(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),t=new Ie(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new Ie(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new Ie(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[Cse.textureBicubic,i,e]),a=new Ie(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,t]);return{transmission:new Ie(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[a])}}();var cS=(e=>(e.NOISE="noise",e.MAP="map",e))(cS||{}),WN=class extends ti{constructor(e,t,i,r,a,s,n,o,l,c,u){super("v3"),this.displacementTypeIndex=new ai(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,Object.values(cS)[this.displacementTypeIndex.value]==="map"&&(this.mat=new CN(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=a,this.seed=s,this.highCut=n,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(cS)[this.displacementTypeIndex.value]){case"map":{i=e.include(WN.Nodes.map),r.push(this.movementOrTexture.getTexture(e,"t")),r.push("uv"),r.push(this.cropOrOffset.build(e,"f")),this.mat&&r.push(this.mat.build(e,"mat3"));break}case"noise":{let a=Object.values(lC)[this.noiseFunctionIndex.value],s=new Ie(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),n=a=="voronoi"?`
					float v = ${a}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${a}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new Ie(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${n}
						}`,[Da.simplex,Da.simplexFractal,Da.simplexAshima,Da.fbm,Da.perlin,Da.voronoi]),l=new Ie(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=e.include(l),r.push(this.scale.build(e,"f")),r.push(this.cropOrOffset.build(e,"v3")),r.push(this.movementOrTexture.build(e,"f")),r.push(this.voronoiStyle.build(e,"i")),r.push(this.smoothness.build(e,"f")),r.push(this.seed.build(e,"f")),r.push(this.highCut.build(e,"f")),r.push(this.lowCut.build(e,"f")),r.push(this.quality.build(e,"i"));break}}return r.push(this.intensity.build(e,"f")),r.push("displaced_normal"),e.format(i+"("+r.join(",")+")",this.getType(e),t)}else return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},qN=WN;qN.Nodes=function(){let e=new Ie(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),t=new Ie(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new Ie(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[e,t])}}();var at={normalRenderTarget:new Lo,normalRenderTargetDepth:new Lo,transmissionRenderTarget:new Lo,aspectRatio:new Rr,transmissionSize:new Rr(2048,2048),transmissionRenderTargetDepth:new Lo,aoRenderTarget:new Lo,aoEnabled:new ma,pixelRatioNode:new Be(1),resolution:new Rr,penumbraSize:new Tc(5,.5),frameIndex:new ai(0),transmissionLod:new ai(2)};for(let e of Object.values(at))e.isRenderGlobal=!0;var XN={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.0.26/build/ui.wasm"},cC=class extends pc{constructor(){super("basic"),this.nodeType="Basic",this.color=new Li(as),this.shadingAlpha=new Be(1),this.shadingBlend=new ai(0),this.previousModelViewMatrix=new eo,this.previouseProjectionMatrix=new eo}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({resolution:at.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Zd.merge([Oe.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{this.color===void 0&&(this.color=new Li(as)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(e,"f"):void 0,a=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,s=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=r!==void 0,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let n=["#include <normal_fragment_begin>",i.code];r&&n.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?n.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):n.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(e),o=`luminance(${this.mask.flow(e,"v3").result})`),r?n.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):n.push("gl_FragColor = vec4("+i.result+", 1.0 );"),a&&n.push(`gl_FragColor.a *= ${a.result};`),n.push("#include <fog_fragment>","#include <dithering_fragment>"),t=n.join(`
`)}return t}},Tse=class extends pc{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new Li(as),this.emissive=new Li(0),this.emissiveIntensity=new Be(1),this.previousModelViewMatrix=new eo,this.previouseProjectionMatrix=new eo,this.shadingAlpha=new Be(1),this.shadingBlend=new ai(0),this.occlusion=new ma(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({resolution:at.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Zd.merge([Oe.fog,Oe.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:at.penumbraSize}),e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({aoMap:at.aoRenderTarget}),e.mergeUniform({aoEnabled:at.aoEnabled}),this.color===void 0&&(this.color=new Li(as)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.emissive.flow(e,"c",{slot:"emissive"}),a=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),s=this.occlusion.flow(e,"b",{slot:"occlusion"}),n=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+a.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},Fd=function(){let e=new Ie(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),t=new Ie(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:e,perturbNormalArb:t}}(),Pse=class extends pc{constructor(){super("phong"),this.nodeType="Phong",this.color=new Li(as),this.specular=new Li(1118481),this.shininess=new Be(30),this.previousModelViewMatrix=new eo,this.previouseProjectionMatrix=new eo,this.shadingAlpha=new Be(1),this.shadingBlend=new ai(0),this.occlusion=new ma(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({resolution:at.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Zd.merge([Oe.fog,Oe.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif


				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:at.penumbraSize}),e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({aoMap:at.aoRenderTarget}),e.mergeUniform({aoEnabled:at.aoEnabled}),this.color===void 0&&(this.color=new Li(as)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let r=this.color.flow(e,"c",{slot:"color"}),a=this.specular.flow(e,"c"),s=this.shininess.flow(e,"f"),n=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=c!==void 0,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){e.include(Fd.dHdxy),e.include(Fd.perturbNormalArb);let p=this.bumpMap.texture.flow(e,"t"),f=this.bumpMap.flow(e,"v3"),m=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${p.result}, uv0, ${m});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${p.result}, uv1, ${m});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${p.result}, uv2, ${m});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${p.result}, bumpMapCachedUv, ${m});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${g}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",a.code,"	vec3 specular = "+a.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(e),d=`luminance(${this.mask.flow(e,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${n.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${n.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join(`
`)}return t}},Dse=class extends pc{constructor(){super("standard"),this.nodeType="Standard",this.color=new Li(as),this.roughness=new Be(.3),this.metalness=new Be(0),this.reflectivity=new Be(.5),this.previousModelViewMatrix=new eo,this.previouseProjectionMatrix=new eo,this.shadingAlpha=new Be(1),this.shadingBlend=new ai(0),this.occlusion=new ma(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({resolution:at.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Zd.merge([Oe.fog,Oe.lights])),Oe.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:at.penumbraSize}),e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({aoMap:at.aoRenderTarget}),e.mergeUniform({aoEnabled:at.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new Li(as)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let r=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let a=this.color.flow(e,"c",{slot:"color",context:i}),s=this.roughness.flow(e,"f"),n=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=u!==void 0,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let p=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(Fd.dHdxy),e.include(Fd.perturbNormalArb);let m=this.bumpMap.texture.flow(e,"t"),g=this.bumpMap.flow(e,"v3"),v=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",y="";this.bumpMap.projection.value===4?y=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${m.result}, uv0, ${v});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${m.result}, uv1, ${v});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${m.result}, uv2, ${v});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:y=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${m.result}, bumpMapCachedUv, ${v});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};
					${y}
					`)}if(p.push(a.code,"	vec3 diffuseColor = "+a.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"	float metalnessFactor = "+n.result+";"),this.roughnessMap){let m=this.roughnessMap.texture.flow(e,"t"),g=this.roughnessMap.flow(e,"v3"),v="";this.roughnessMap.projection.value===4?v=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${m.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${m.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${m.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:v=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${m.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,p.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${g.result};

					const float roughnessScale = 1.0;

					${v}
				`)}else p.push(s.code,"	float roughnessFactor = "+s.result+";");u&&p.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?p.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f=`luminance(${this.mask.flow(e,"v3").result})`),p.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${f} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${f}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&p.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?p.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&p.push(`gl_FragColor.a *= ${h.result};`),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join(`
`)}return t}},Ose=class extends pc{constructor(){super("toon"),this.nodeType="Toon",this.color=new Li(as),this.specular=new Li(1118481),this.shininess=new Be(30),this.previousModelViewMatrix=new eo,this.previouseProjectionMatrix=new eo,this.shadingAlpha=new Be(1),this.shadingBlend=new ai(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({resolution:at.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(Zd.merge([Oe.fog,Oe.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=r.join(`
`)}else{e.mergeUniform({penumbraSize:at.penumbraSize}),e.mergeUniform({frameIndex:at.frameIndex}),e.mergeUniform({aoMap:at.aoRenderTarget}),e.mergeUniform({aoEnabled:at.aoEnabled}),this.color===void 0&&(this.color=new Li(as)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),a=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),n=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=l!==void 0,e.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){e.include(Fd.dHdxy),e.include(Fd.perturbNormalArb);let d=this.bumpMap.texture.flow(e,"t"),p=this.bumpMap.flow(e,"v3"),f=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${f});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${f});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${f});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${f});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${m}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",a.code,"	float shininess = max( 0.0001, "+a.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(e),h=`luminance(${this.mask.flow(e,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${n.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=u.join(`
`)}return t}},Ise=class{constructor(e=1e3*10){this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...e){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(e){var t;return(t=this.cache.get(e))==null?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return i===void 0?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},Rse=class extends Ise{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}},$b;function Lse(e){return typeof e=="string"?e:($b||($b=new Rse),$b.load(e))}var kse=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},zse=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data)}load(e){let t=this.cache.get(e);return t===void 0&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},YN=class extends kse{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isCanvas=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=e.type==="video",this.isCanvas=e.nodeName==="CANVAS",this.updateSrc(this.isCanvas?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let a of Object.values(r))a&&(a.image=this.img,a.needsUpdate=!0);this.shared.requestRender()};if(this.isCanvas)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof e!="string"){var i=new FileReader;i.readAsDataURL(new Blob([e],{type:"video/mp4"}));let r;await new Promise(a=>{i.onloadend=s=>{var n;r=(n=s.target)==null?void 0:n.result,a(null)}}),this.img.src=r}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=Lse(e),this.img.onload=t}getTexture(e,t=1008){let i=this._cache[e][t];if(i)return i;{let r;return this.isCanvas&&(r=new TW(this.img,void 0,e,e,void 0,t)),this.isVideo?r=new MW(this.img,void 0,e,e):r=new Si(this.img,void 0,e,e,void 0,t),this.loaded&&(r.needsUpdate=!0),this._cache[e][t]=r,r}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))i&&(i.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,r]of Object.entries(t))r==null||r.dispose(),this._cache[e][i]=void 0}dispose(){super.dispose(),this.disposeTextures()}},Ol=class extends YN{};function Nse(e,t){var i=Use(t);return i.formatToParts?jse(i,e):Fse(i,e)}var Bse={year:0,month:1,day:2,hour:3,minute:4,second:5};function jse(e,t){try{for(var i=e.formatToParts(t),r=[],a=0;a<i.length;a++){var s=Bse[i[a].type];s>=0&&(r[s]=parseInt(i[a].value,10))}return r}catch(n){if(n instanceof RangeError)return[NaN];throw n}}function Fse(e,t){var i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var Jb={};function Use(e){if(!Jb[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=t==="06/25/2014, 00:00:00"||t==="‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00";Jb[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return Jb[e]}function QN(e,t,i,r,a,s,n){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(r,a,s,n),o}var gO=36e5,Vse=6e4,ew={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function ZN(e,t,i){var r,a;if(!e||(r=ew.timezoneZ.exec(e),r))return 0;var s;if(r=ew.timezoneHH.exec(e),r)return s=parseInt(r[1],10),vO(s)?-(s*gO):NaN;if(r=ew.timezoneHHMM.exec(e),r){s=parseInt(r[1],10);var n=parseInt(r[2],10);return vO(s,n)?(a=Math.abs(s)*gO+n*Vse,s>0?-a:a):NaN}if(Wse(e)){t=new Date(t||Date.now());var o=i?t:Gse(t),l=hS(o,e),c=i?l:Hse(t,l,e);return-c}return NaN}function Gse(e){return QN(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function hS(e,t){var i=Nse(e,t),r=QN(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),a=e.getTime(),s=a%1e3;return a-=s>=0?s:1e3+s,r-a}function Hse(e,t,i){var r=e.getTime(),a=r-t,s=hS(new Date(a),i);if(t===s)return t;a-=s-t;var n=hS(new Date(a),i);return s===n?s:Math.max(s,n)}function vO(e,t){return-23<=e&&e<=23&&(t==null||0<=t&&t<=59)}var yO={};function Wse(e){if(yO[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),yO[e]=!0,!0}catch{return!1}}var qse=ar(o8(),1),xO=ar(l8(),1),Xse=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Yse=Xse,tw=36e5,bO=6e4,Qse=2,ga={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Yse};function Zse(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(e===null)return new Date(NaN);var i=t||{},r=i.additionalDigits==null?Qse:(0,qse.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]")return new Date(e.getTime());if(typeof e=="number"||Object.prototype.toString.call(e)==="[object Number]")return new Date(e);if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=Kse(e),s=$se(a.date,r),n=s.year,o=s.restDateString,l=Jse(o,n);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(a.time&&(u=ene(a.time),isNaN(u)))return new Date(NaN);if(a.timeZone||i.timeZone){if(h=ZN(a.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,xO.default)(new Date(c+u)),h=(0,xO.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function Kse(e){var t={},i=ga.dateTimePattern.exec(e),r;if(i?(t.date=i[1],r=i[3]):(i=ga.datePattern.exec(e),i?(t.date=i[1],r=i[2]):(t.date=null,r=e)),r){var a=ga.timeZone.exec(r);a?(t.time=r.replace(a[1],""),t.timeZone=a[1].trim()):t.time=r}return t}function $se(e,t){var i=ga.YYY[t],r=ga.YYYYY[t],a;if(a=ga.YYYY.exec(e)||r.exec(e),a){var s=a[1];return{year:parseInt(s,10),restDateString:e.slice(s.length)}}if(a=ga.YY.exec(e)||i.exec(e),a){var n=a[1];return{year:parseInt(n,10)*100,restDateString:e.slice(n.length)}}return{year:null}}function Jse(e,t){if(t===null)return null;var i,r,a,s;if(e.length===0)return r=new Date(0),r.setUTCFullYear(t),r;if(i=ga.MM.exec(e),i)return r=new Date(0),a=parseInt(i[1],10)-1,_O(t,a)?(r.setUTCFullYear(t,a),r):new Date(NaN);if(i=ga.DDD.exec(e),i){r=new Date(0);var n=parseInt(i[1],10);return rne(t,n)?(r.setUTCFullYear(t,0,n),r):new Date(NaN)}if(i=ga.MMDD.exec(e),i){r=new Date(0),a=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return _O(t,a,o)?(r.setUTCFullYear(t,a,o),r):new Date(NaN)}if(i=ga.Www.exec(e),i)return s=parseInt(i[1],10)-1,SO(t,s)?wO(t,s):new Date(NaN);if(i=ga.WwwD.exec(e),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return SO(t,s,l)?wO(t,s,l):new Date(NaN)}return null}function ene(e){var t,i,r;if(t=ga.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),iw(i)?i%24*tw:NaN;if(t=ga.HHMM.exec(e),t)return i=parseInt(t[1],10),r=parseFloat(t[2].replace(",",".")),iw(i,r)?i%24*tw+r*bO:NaN;if(t=ga.HHMMSS.exec(e),t){i=parseInt(t[1],10),r=parseInt(t[2],10);var a=parseFloat(t[3].replace(",","."));return iw(i,r,a)?i%24*tw+r*bO+a*1e3:NaN}return null}function wO(e,t,i){t=t||0,i=i||0;var r=new Date(0);r.setUTCFullYear(e,0,4);var a=r.getUTCDay()||7,s=t*7+i+1-a;return r.setUTCDate(r.getUTCDate()+s),r}var tne=[31,28,31,30,31,30,31,31,30,31,30,31],ine=[31,29,31,30,31,30,31,31,30,31,30,31];function KN(e){return e%400===0||e%4===0&&e%100!==0}function _O(e,t,i){if(t<0||t>11)return!1;if(i!=null){if(i<1)return!1;var r=KN(e);if(r&&i>ine[t]||!r&&i>tne[t])return!1}return!0}function rne(e,t){if(t<1)return!1;var i=KN(e);return!(i&&t>366||!i&&t>365)}function SO(e,t,i){return!(t<0||t>52||i!=null&&(i<0||i>6))}function iw(e,t,i){return!(e!=null&&(e<0||e>=25)||t!=null&&(t<0||t>=60)||i!=null&&(i<0||i>=60))}function ane(e,t,i){var r=Zse(e,i),a=ZN(t,r,!0),s=new Date(r.getTime()-a),n=new Date(0);return n.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),n.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),n}function va(e,t){return t.color(e)}function AO(e=new Date,t){let i=t.format,r=e.getSeconds(),a=e;t&&t.timeZone!==null&&(a=ane(new Date,t.timeZone));let s=a.getHours(),n=a.getMinutes(),o;t.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;t.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,n,r];break;case"HH:mm":c=[l,n];break;case"HH":c=[l],o=void 0;break;case"mm":c=[n],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=a.getFullYear();break;case"month":u=a.getMonth()+1;break;case"dayOfYear":u=Math.floor((a.getTime()-new Date(a.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=a.getDate();break;case"secondOfDay":u=s*60*60+n*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function sne(e,t){switch(e.type){case"fresnel":return lne(e,t);case"gradient":return cne(e,t);case"depth":return hne(e,t);case"normal":return une(e,t);case"noise":return dne(e,t);case"rainbow":return pne(e,t);case"toon":return fne(e,t);case"outline":return mne(e,t);case"transmission":return gne(e,t);case"color":return one(e,t);case"pattern":return vne(e,t)}}function nne(e){return{type:e.type}}function dn(e,t){let{alpha:i,mode:r,isMask:a}=e,s=typeof i=="string"?(Number(t.getVariable(i))??100)/100:i;return{...nne(e),alpha:s,mode:r,isMask:a}}function one(e,t){return{...dn(e,t),color:va(e.color,t)}}function lne(e,t){let{bias:i,scale:r,intensity:a,factor:s,color:n}=e;return{...dn(e,t),color:va(n,t),bias:i,scale:r,intensity:a,factor:s}}function cne(e,t){let{gradientType:i,smooth:r,colors:a,steps:s,angle:n,offset:o,morph:l}=e;return{...dn(e,t),gradientType:i,smooth:r,colors:a.map(c=>new dt(c[0],c[1],c[2],c[3])),num:a.length,steps:s,offset:new Q(...o),morph:new Q(...l),angle:n}}function hne(e,t){let{gradientType:i,near:r,far:a,isVector:s,isWorldSpace:n,origin:o,direction:l,colors:c,steps:u,smooth:h}=e;return{...dn(e,t),gradientType:i,near:r,far:a,isVector:s,isWorldSpace:n,origin:new P(...o),direction:l?new P(...l):new P(1,0,0),colors:c.map(d=>d!==void 0?new dt(d[0],d[1],d[2],d[3]):new dt(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function une(e,t){let{cnormal:i}=e;return{...dn(e,t),cnormal:new P(i[0],i[1],i[2])}}function dne(e,t){return{...dn(e,t),scale:e.scale,move:e.move,fA:new Q(...e.fA),fB:new Q(...e.fB),size:new P(...e.size),distortion:new Q(...e.distortion),colorA:va(e.colorA,t),colorB:va(e.colorB,t),colorC:va(e.colorC,t),colorD:va(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}function pne(e,t){return{...dn(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new P(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new P(...e.offset)}}function fne(e,t){return{...dn(e,t),positioning:e.positioning,colors:e.colors.map(i=>new dt(i[0],i[1],i[2],i[3])),num:e.colors.length,steps:e.steps,source:new P(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:va(e.shadowColor,t),offset:new P(...e.offset)}}function mne(e,t){return{...dn(e,t),outlineColor:va(e.outlineColor,t),contourColor:va(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new P(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}function gne(e,t){return{...dn(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}function vne(e,t){return{...dn(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new Q(...e.offset),colorA:va(e.colorA,t),colorB:va(e.colorB,t),frequency:new Q(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new Q(...e.vertical),horizontal:new Q(...e.horizontal),sides:e.sides}}var jy=class extends Vr{},$N={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},JN={depth:["colors"]};function yne(e,t,i){var s,n;if(t==="isMask")return!0;let r=$N[e.type],a=JN[e.type];if(a!==void 0){let o=e.color;if(a.includes(t)){let l=(n=(s=o[t])==null?void 0:s.value)==null?void 0:n.length;if(l!==void 0&&l!==i.length)return!0}}return r!==void 0?r.includes(t):!1}function eB(e,t,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let a=!1,s=e;if("image"in s){let n=s.image,o=t.image(n),l=r;l.image instanceof Ol||l.image.deref(),l.image=o}if("video"in s){let n=s.video,o=t.video(n),l=r;l.image instanceof Ol||l.image.deref(),l.image=o}if("wrapping"in s){let n=r;n.wrap=s.wrapping}if("minFilter"in s){let n=r;n.minFilter=s.minFilter}if("repeat"in s||"offset"in s){let n="mat",o=i.uniforms[`f${i.id}_${n}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),o.updateMatrix()}return a}function xne(e,t,i,r){let a=!1;for(let[s,n]of Object.entries(e)){if(s==="bumpMap"||s==="roughnessMap"){a=!0;continue}if(!s||n===void 0)continue;if(iB(s,i,r,t)){s==="visible"&&i.type==="light"&&(a=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof nC))switch(a=a||yne(i,s,n),o.constructor){case Li:if(typeof n=="string"){let l=t.getColor(n);l&&(o.value=l);break}else{let l=n;o.value instanceof jy?o.value=new Vr(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case Mo:if(typeof n=="string"){let l=t.getColor(n);l&&(o.value=l);break}else{let l=n;o.value instanceof jy?o.value=new Vr(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case Rr:{let l=n;o.value.setX(l[0]),o.value.setY(l[1]);break}case ms:{let l=n;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case Lo:{eB(n,t,i);break}case Pc:{o.value=n.map(l=>new dt(...l));break}default:{o.value=n;break}}}return a}var yh=(e,t,i)=>Math.max(0,Math.min(1,Number(t.getVariable(typeof e=="number"?e*100:e,i)??100)/100))??1,sh=class{constructor(e,t,i,r,a){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)iB(s,this,i,a)}get type(){return this.data.type}static create(e,t,i,r){if(i.type==="light")return In.createLigherLayer(e,t,i,r);if(i.type==="texture"||i.type==="video"){let a=i.type==="texture"?r.canvas(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new oS(a,i.texture.wrapping,i.texture.minFilter??1008),n=new Sse(a),o=new Ase(i.texture.repeat,i.texture.offset),l=new Be(i.crop?1:0),c=new ai(i.projection??0),u=new ai(["x","y","z"].indexOf(i.axis)??0),h=new ai(i.side??0),d=new Rr(i.size?new Q(i.size[0],i.size[1]):new Q(100,100)),p=new Be(i.blending??0),f=new Be(yh(i.alpha,r)),m=new ai(i.mode??0),g=new ma(i.isMask??!1),v=new oC(s,n,l,c,u,h,d,p,o,f,m,g),y=new ci(v.calpha,"f");return new Di(e,t,i,{texture:s,textureSize:n,crop:l,projection:c,axis:u,side:h,size:d,blending:p,mat:o,alpha:f,mode:m,isMask:g},v,m,y,g,r)}else if(i.type==="matcap"){let a=r.image(i.texture.image),s=new oS(a,i.texture.wrapping,i.texture.minFilter??1008),n=new Be(yh(i.alpha,r)),o=new ai(i.mode??0),l=new ma(i.isMask??!1),c=new LN(s,n,o,l),u=new ci(c.calpha,"f");return new Di(e,t,i,{texture:s,alpha:n,mode:o,isMask:l},c,o,u,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let a=new ms(new P(...i.offset)),s=new Be(i.scale??10),n=new Be(i.intensity??8),o=new Be(i.movement??1),l=new ai(i.noiseType??0),c=new ai(i.voronoiStyle??0),u=new Be(i.smoothness??.5),h=new Be(i.seed??0),d=new Be(i.highCut??1),p=new Be(i.lowCut??0),f=new ai(i.quality??1),m=new qN(n,o,a,c,u,h,d,p,f,s,l);return new tB(e,t,i,{offset:a,scale:s,intensity:n,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:p,quality:f},m,r)}else throw new Error;else return _ne(e,t,i,r)}updateByOp(e,t,i){let r=e;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):xne(r.props,i.shared,this,t)}else if(r.path[0]==="texture")return"texture"in t||"video"in t?eB(r.props,i.shared,this):!0;return!1}dispose(){if(bne(this)){let e=this.uniforms[`f${this.id}_texture`];if(!e)return!1;let t=e;t.image instanceof Ol||t.image.deref()}}hasValueByKey(e){return this.uniforms[e]!==void 0}hasValue(e){return this.hasValueByKey(`f${this.id}_${e}`)}setValue(e,t){let i=`f${this.id}_${e}`;this.hasValueByKey(i)&&t!==void 0&&(this.uniforms[i].value=t)}getNode(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t=`f${this.id}_${e}`;if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log(`Layer.getName: error ${e}`)}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},Di=class extends sh{constructor(t,i,r,a,s,n,o,l,c){super(t,i,r,a,c),this.params=a,this.color=s,this.mode=n,this.alpha=o,this.isMask=l}},tB=class extends sh{constructor(e,t,i,r,a,s){super(e,t,i,r,s),this.position=a}},In=class extends sh{constructor(e,t,i,r,a,s){super(e,t,i,a,s),this.node=r}static createLigherLayer(e,t,i,r){let a,s=new Be(yh(i.alpha,r)),n=new ai(i.mode),o=new Be(i.bumpMapIntensity),l=new Be(yh(i.alphaOverride,r)),c;if(!i.visible)a=new cC,c={};else if(i.category==="lambert"){a=new Tse;let u=new Li(r.color(i.emissive)??0),h=new ma(i.occlusion??!0);c={emissive:u,occlusion:h},a.emissive=u,a.occlusion=h}else if(i.category==="toon"){a=new Ose;let u=new Be(i.shininess??30),h=new Li(r.color(i.specular)??1118481);c={shininess:u,specular:h},a.shininess=u,a.specular=h}else if(i.category==="physical"){a=new Dse;let u=new Be(i.roughness??.3),h=new Be(i.metalness??0),d=new Be(i.reflectivity??.5),p=new ma(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:p},a.roughness=u,a.metalness=h,a.reflectivity=d,a.occlusion=p}else{a=new Pse;let u=new Be(i.shininess??30),h=new Li(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new ma(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},a.shininess=u,a.specular=h,a.occlusion=d}return a.alpha=new Be(1),a.shadingAlpha=s,a.shadingBlend=n,a.bumpMapIntensity=o,a.alphaOverride=l,c.alpha=a.shadingAlpha,c.mode=a.shadingBlend,c.bumpMapIntensity=a.bumpMapIntensity,c.alphaOverride=a.alphaOverride,new In(e,t,i,a,c,r)}get category(){return this.node.category}};function bne(e){let t=e instanceof sh?e.type:e;return t==="texture"||t==="video"||t==="displace_map"||t==="matcap"}function hs(e){return{alpha:new Be(e.alpha??1),mode:new ai(e.mode??0),isMask:new ma(e.isMask??!1)}}function wne(e,t,i,r,a){switch(e.type){case"color":{let s=new Li(r.color??as),n=hs(r),o=new lS(s,n.alpha),l=new ci(o.calpha,"f");return new Di(t,i,e,{color:s,...n},o,n.mode,l,n.isMask,a)}case"fresnel":{let s=new Li(r.color??16777215),n=new Be(r.bias??.1),o=new Be(r.scale??1),l=new Be(r.intensity??2),c=new Be(r.factor??1),u=hs(r),h=new Ese(s,n,o,l,c,u.alpha,u.mode,u.isMask),d=new ci(h.calpha,"f");return new Di(t,i,e,{color:s,bias:n,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,a)}case"rainbow":{let s=new Be(r.filmThickness??30),n=new Be(r.movement??0),o=new ms(r.wavelengths??new P(0,0,0)),l=new Be(r.noiseStrength??0),c=new Be(r.noiseScale??1),u=new ms(r.offset??new P(0,0,0)),h=hs(r),d=new FN(s,n,o,l,c,u,h.alpha,h.isMask),p=new ci(d.calpha,"f");return new Di(t,i,e,{filmThickness:s,movement:n,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,p,h.isMask,a)}case"transmission":{let s=new Be(r.thickness??10),n=new Be(r.ior??1.5),o=new Be(r.roughness??.5),l=at.transmissionSize,c=at.transmissionRenderTarget,u=at.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,p=h>=d?new Rr(d/h,1):new Rr(1,h/d),f=hs(r),m=new HN(s,n,o,l,c,u,p,f.alpha),g=new ci(m.calpha,"f");return new Di(t,i,e,{thickness:s,ior:n,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,a)}case"toon":{let s=new ai(r.positioning??0),n;r.colors?n=new Pc(r.colors.length,r.colors):(n=new Pc(10,new dt(0,0,0,1)),n.value[1]=new dt(1,1,1,1));let o;r.steps?o=new Tc(r.steps.length,r.steps):(o=new Tc(10,1),o.value[0]=0);let l=new ms(r.source??new P(0,0,0)),c=new ma(r.isWorldSpace??!0),u=new Be(r.noiseStrength??0),h=new Be(r.noiseScale??1),d=new Mo(r.shadowColor),p=new ms(r.offset??new P(0,0,0)),f=hs(r),m=new VN(s,n,o,l,c,u,h,d,p,f.alpha),g=new ci(m.calpha,"f");return new Di(t,i,e,{positioning:s,colors:n,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:p,...f},m,f.mode,g,f.isMask,a)}case"outline":{let s=new Li(r.outlineColor??16777215),n=new Li(r.contourColor??16777215),o=new Be(r.outlineWidth??.1),l=new Be(r.contourWidth??.1),c=new Be(r.outlineThreshold??.1),u=new Be(r.contourThreshold??.1),h=new Be(r.outlineSmoothing??.1),d=new Be(r.contourFrequency??.1),p=new ms(r.contourDirection??new P(0,1,0)),f=new ma(r.positionalLines??!1),m=new ma(r.compensation??!0),g=at.normalRenderTarget,v=at.normalRenderTargetDepth,y=at.pixelRatioNode,x=at.resolution,w=hs(r),S=new NN(s,n,o,l,c,u,h,d,p,f,m,x,g,v,y,w.alpha),_=new ci(S.calpha,"f");return new Di(t,i,e,{outlineColor:s,contourColor:n,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:p,positionalLines:f,compensation:m,...w},S,w.mode,_,w.isMask,a)}case"depth":{let s=new ai(r.gradientType??0),n=new ma(r.smooth??!1),o=new Be(r.near??50),l=new Be(r.far??200),c=new Be(r.isVector??1),u=new Be(r.isWorldSpace??0),h=new ms(r.origin??new P),d=new ms(r.direction??new P),p;r.colors?p=new Pc(r.colors.length,r.colors):(p=new Pc(2,new dt(0,0,0,1)),p.value[1]=new dt(1,1,1,1));let f;r.steps?f=new Tc(r.steps.length,r.steps):(f=new Tc(2,1),f.value[0]=0);let m=hs(r),g=new DN(s,n,o,l,c,u,h,d,p,f,m.alpha,m.isMask),v=new ci(g.calpha,"f");return new Di(t,i,e,{gradientType:s,smooth:n,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:p,steps:f,...m},g,m.mode,v,m.isMask,a)}case"noise":{let s=new Be(r.scale??1),n=new ms(r.size??new P(100,100,100)),o=new Be(r.move??1),l=new Rr(r.fA??new Q(1.7,9.2)),c=new Rr(r.fB??new Q(8.3,2.8)),u=new Rr(r.distortion??new Q(1,1)),h=new Mo(r.colorA),d=new Mo(r.colorB),p=new Mo(r.colorC),f=new Mo(r.colorD),m=new ai(r.noiseType??0),g=new ai(r.voronoiStyle??0),v=new Be(r.highCut??1),y=new Be(r.lowCut??0),x=new Be(r.smoothness??.5),w=new Be(r.seed??.5),S=new ai(r.quality??1),_=hs(r),A=new kN(s,n,o,l,c,u,h,d,p,f,_.alpha,m,_.isMask,g,v,y,x,w,S),E=new ci(A.calpha,"f");return new Di(t,i,e,{scale:s,size:n,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:p,colorD:f,noiseType:m,..._,voronoiStyle:g,highCut:v,lowCut:y,smoothness:x,seed:w,quality:S},A,_.mode,E,_.isMask,a)}case"normal":{let s=new ms(r.cnormal??new P(1,1,1)),n=hs(r),o=new PN(s,n.alpha),l=new ci(o.calpha,"f");return new Di(t,i,e,{cnormal:s,...n},o,n.mode,l,n.isMask,a)}case"gradient":{let s=new ai(r.gradientType??0),n=new ma(r.smooth??!1),o;r.colors?o=new Pc(r.colors.length,r.colors):(o=new Pc(10,new dt(0,0,0,1)),o.value[1]=new dt(1,1,1,1));let l;r.steps?l=new Tc(r.steps.length,r.steps):(l=new Tc(10,1),l.value[0]=0);let c=new Rr(r.offset??new Q(0,0)),u=new Rr(r.morph??new Q(0,0)),h=new Be(r.angle??0),d=hs(r),p=new IN(s,n,o,l,c,u,h,d.alpha,d.isMask),f=new ci(p.calpha,"f");return new Di(t,i,e,{gradientType:s,smooth:n,colors:o,steps:l,offset:c,morph:u,angle:h,...d},p,d.mode,f,d.isMask,a)}case"pattern":{let s=new ai(r.style??0),n=new ai(r.projection??0),o=new ai(["x","y","z"].indexOf(r.axis)??0),l=new Be(r.blending??0),c=new Rr(r.offset??new Q(0,0)),u=new Mo(r.colorA),h=new Mo(r.colorB),d=new Rr(r.frequency??new Q(10,10)),p=new Be(r.size??.5),f=new Be(r.variation??0),m=new Be(r.smoothness??.5),g=new Be(r.zigzag??0),v=new Be(r.rotation??0),y=new Rr(r.vertical??new Q(0,1)),x=new Rr(r.horizontal??new Q(0,1)),w=new ai(r.sides??6),S=hs(r),_=new BN(s,n,o,l,c,u,h,d,p,f,m,g,v,y,x,w,S.alpha,S.isMask),A=new ci(_.calpha,"f");return new Di(t,i,e,{style:s,projection:n,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:x,sides:w,...S},_,S.mode,A,S.isMask,a)}default:{let s=new Li(1,0,0,1),n=hs(r),o=new lS(s,n.alpha),l=new ci(o.calpha,"f");return new Di(t,i,e,{color:s,...n},o,n.mode,l,n.isMask,a)}}}function _ne(e,t,i,r){let a=sne(i,r);return wne(i,e,t,a,r)}function iB(e,t,i,r){if(i.type==="displace"&&(e==="intensity"||e==="visible")){let a=t.uniforms[`f${t.id}_intensity`];return a?(a.value=i.intensity*(i.visible?1:0),a):void 0}if(i.type!=="displace"&&(e==="alpha"||e==="visible")){let a=t.uniforms[`f${t.id}_alpha`];if(!a)return;if(a.value=yh(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&e==="visible"){let s=t.uniforms[`f${t.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return a}}function Hu(e,t){let i=0,r=e.layers.find(a=>a.data.type==="light");if(r){let a=r.data,s=Number(t.getVariable(a.alphaOverride));if((typeof a.alphaOverride=="string"?s/100:a.alphaOverride)<1)return!0}for(let a of e.layers){if(a.data.type!=="displace"&&a.data.isMask)return!0;if(a.data.type!=="displace"&&"alpha"in a.data&&a.data.type!=="light"&&a.data.type!=="fresnel"&&a.data.type!=="texture"&&a.data.type!=="matcap"&&a.data.type!=="rainbow"&&a.data.type!=="outline"&&a.data.type!=="pattern"){let s=a.data.visible?a.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(t.getVariable(s)??100)/100))),s===1&&a.data.type==="depth"||a.data.type==="gradient"){for(let n of a.data.colors)if(n[3]<1){s=n[3];break}}else if(s===1&&a.data.type==="noise"){let n=t.color(a.data.colorA).a,o=t.color(a.data.colorB).a,l=t.color(a.data.colorC).a,c=t.color(a.data.colorD).a,u=Math.min(n,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var lc=class extends Wt{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.cacheKey="",this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return this.cacheKey}},Sne=class extends lc{constructor(e,t,i,r){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=r}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},hC=class extends lc{constructor(e,t,i=!0){super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.reset0(e,t)}get nodeMaterial(){return this}getFlavor(e,t,i){let r=i?6:(e?3:0)+t;if(r===0)return this;this.flavors===void 0&&(this.flavors=[]),r-=1;let a=this.flavors[r];return a===void 0&&(a=new Sne(e,t,i,this),this.flavors[r]=a,a.flatShading=e,a.side=t,a.updateAfterBuild()),a}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e;return((e=this.lightLayer.getNode("occlusion"))==null?void 0:e.value)??!1}reset(e,t,i=!1){(this.data!==e||i)&&this.reset0(e,t)}reset0(e,t){this.data=e;let i=e.layers??ra.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>sh.create(this.layerIdGen++,r.id,r.data,t.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=e.name??"Untitled Material",this.onUpdate(t.shared),this.transparent=Hu(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if(e[0]==="alphaOverride")this.transparent=Hu(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if(e[0]==="layer"){let r=e[1],a=e[2];if(r&&a){let s=this.layers.find(n=>n.uuid===r);s!=null&&s.hasValue(a)&&(a==="alpha"?(this.transparent=Hu(this.data,i.shared),s.setValue(a,Math.max(0,Math.min(Number(t)/100,1)))):s.setValue(a,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find(i=>i.data.type==="light");t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&e.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(e){return this.layers.filter(t=>t.type===e)}getLayerByUuid(e){return this.layers.find(t=>t.uuid===e)}onUpdate(e){this.cacheKey=this.computeCacheKey(),this.lightLayer=this.layers.find(t=>t instanceof In),this.lightLayer===void 0&&(this.lightLayer=new In(0,"",{...br.defaultData("light","phong"),visible:!1},new cC,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions()}applyTextureMaps(){let e=this.layers.find(a=>a instanceof In);if(!e)return;let t=e.data,i=t.bumpMap,r=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let a=0;a<this.layers.length;++a){let s=this.layers[a];s instanceof Di&&s.color instanceof oC&&(s.uuid===i&&(e.node.bumpMap=s.color),s.uuid===r&&(e.node.roughnessMap=s.color))}}updateByOp(e,t,i){if(t!==void 0?this.data=t:t=this.data,this.transparent=Hu(t,i.shared),e.path[0]==="layers"){this.data=t;let r=i.shared,a=e.path[1];if(a===void 0){if(this.layers.reverse(),e.type===4){let s=sh.create(this.layerIdGen++,e.id,e.data,i.shared);this.layers.splice(e.localIndex,0,s),i.scene.markNeedsUpdateRendererDirty()}else if(e.type===5)this.layers.splice(e.localIndex,1)[0].dispose(),i.scene.markNeedsUpdateRendererDirty();else if(e.type===6){let s=this.layers.findIndex(o=>o.uuid===e.id),n=this.layers[s];this.layers.splice(s,1),this.layers.splice(e.localIndex,0,n),i.scene.markNeedsUpdateRendererDirty()}this.layers.reverse(),this.onUpdate(i.shared)}else{e.type===0&&e.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(n=>n.uuid===a);if(s){let n=t.layers.data(a),o;if(e.type===0&&("alpha"in e.props||"alphaOverride"in e.props)&&("alpha"in e.props?o={...e.props,alpha:yh(e.props.alpha,r,["material",this.uuid,"layer",a,"alpha"])}:o={...e.props,alphaOverride:yh(e.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...e,...o?{props:o}:{},path:e.path.slice(2)},n,i)){let l=sh.create(this.layerIdGen++,a,n,r);this.layers.splice(this.layers.findIndex(c=>c.uuid===a),1,l),this.onUpdate(i.shared)}}}}else this.reset(t,i)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof Di?t.color.mask=void 0:t instanceof In&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof Di&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,r=this.layers[i];r instanceof In?r.node.mask=new Ta(t.color,t.alpha,Ta.MUL):r instanceof Di&&(r.isMask.value||(r.color.mask=new Ta(t.color,t.alpha,Ta.MUL)))}}}blendColors(){let e=this.layers.findIndex(i=>i instanceof Di),t=this.layers.findIndex(i=>i instanceof In);if(e!==-1&&e<t){let i=this.layers[e].color;for(let r=e+1;r<t;++r){let a=this.layers[r];if(a instanceof Di){if(a.isMask.value)continue;i=new mO(i,a.color,a.alpha,a.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new ci("outgoingLight","f"),t=this.layers.findIndex(i=>i instanceof In);if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof Di){if(r.isMask.value)continue;e=new mO(e,r.color,r.alpha,r.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter(t=>t instanceof tB);if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new Ta(t,e[i].position,Ta.ADD),t=new Ta(t,new Be(.5).setReadonly(!0),Ta.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=this.extensions.derivatives===!0,e.extensionFragDepth=this.extensions.fragDepth===!0,e.extensionDrawBuffers=this.extensions.drawBuffers===!0,e.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(e,t){let i=(r,a,s)=>Math.min(Math.max(r,a),s);for(let r of this.layers)if(r.type==="displace"){let a=i(r.uniforms[`f${r.id}_intensity`].value,e,t);r.uniforms[`f${r.id}_intensity`].value=a}}computeCacheKey(){let e="[";for(let{data:t}of this.data.layers)if(t.type==="light")e+=`"${t.visible?t.category.toUpperCase():"Basic"}"`;else{let i=($N[t.type]??[]).map(o=>t[o]),r=(JN[t.type]??[]).map(o=>{var l;return((l=t[o])==null?void 0:l.length)??0}),a=[...i,...r],s="isMask"in t&&t.isMask,n=`"${t.type}-${t.visible}-${s}"`;a.length?e+=`[${n}, "${a.join('","')}"],`:e+=n}return e=e.slice(0,-1)+"]",e}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new EN;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof Di){let t=e.params.texture;if(t instanceof oS&&!t.image.loaded)return!1}return!0}getHash(){let e="{";return e+='"fragment":'+this.fragment.getHash(),e+="}",e}};Object.defineProperties(lc.prototype,{properties:{get:function(){return this.fragment.properties}}});var uS=class extends hC{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},Ane=ar(c8()),EO=new Map;function Ene(e){if(typeof e=="string")return e;let t=EO.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},EO.set(e,t)),t.url}var ff=class{constructor({src:e,volume:t,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let a;typeof e=="string"?a={src:e}:a={src:Ene(e),format:"wav"},this.sound=new Ane.Howl(a),this.sound.on("end",this.onEnd),this.src=e,t!==void 0&&(this.volume=t),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(e,t=1e3){e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,t),this.clearFade()},e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(e=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},Cne=class{constructor(){this.type="ShapePath",this.color=new tt,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new J0,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return(i=this.currentPath)==null||i.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){var a;return(a=this.currentPath)==null||a.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,a,s){var n;return(n=this.currentPath)==null||n.bezierCurveTo(e,t,i,r,a,s),this}splineThru(e){var t;return(t=this.currentPath)==null||t.splineThru(e),this}toShapes(){let e={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},t={loc:e.ORIGIN,t:0};function i(p,f,m,g){let v=p.x,y=f.x,x=m.x,w=g.x,S=p.y,_=f.y,A=m.y,E=g.y,M=(w-x)*(S-A)-(E-A)*(v-x),C=(y-v)*(S-A)-(_-S)*(v-x),T=(E-A)*(y-v)-(w-x)*(_-S),D=M/T,I=C/T;if(T===0&&M!==0||D<=0||D>=1||I<0||I>1)return null;if(M===0&&T===0){for(let O=0;O<2;O++)if(r(O===0?m:g,p,f),t.loc===e.ORIGIN){let B=O===0?m:g;return{x:B.x,y:B.y,t:t.t}}else if(t.loc===e.BETWEEN){let B=+(v+t.t*(y-v)).toPrecision(10),q=+(S+t.t*(_-S)).toPrecision(10);return{x:B,y:q,t:t.t}}return null}else{for(let q=0;q<2;q++)if(r(q===0?m:g,p,f),t.loc===e.ORIGIN){let F=q===0?m:g;return{x:F.x,y:F.y,t:t.t}}let O=+(v+D*(y-v)).toPrecision(10),B=+(S+D*(_-S)).toPrecision(10);return{x:O,y:B,t:D}}}function r(p,f,m){let g=m.x-f.x,v=m.y-f.y,y=p.x-f.x,x=p.y-f.y,w=g*x-y*v;if(p.x===f.x&&p.y===f.y){t.loc=e.ORIGIN,t.t=0;return}if(p.x===m.x&&p.y===m.y){t.loc=e.DESTINATION,t.t=1;return}if(w<-Number.EPSILON){t.loc=e.LEFT;return}if(w>Number.EPSILON){t.loc=e.RIGHT;return}if(g*y<0||v*x<0){t.loc=e.BEHIND;return}if(Math.sqrt(g*g+v*v)<Math.sqrt(y*y+x*x)){t.loc=e.BEYOND;return}let S;g!==0?S=y/g:S=x/v,t.loc=e.BETWEEN,t.t=S}function a(p,f){let m=[],g=[];for(let v=1;v<p.length;v++){let y=p[v-1],x=p[v];for(let w=1;w<f.length;w++){let S=f[w-1],_=f[w],A=i(y,x,S,_);A!==null&&m.find(E=>E.t<=A.t+Number.EPSILON&&E.t>=A.t-Number.EPSILON)===void 0&&(m.push(A),g.push(new Q(A.x,A.y)))}}return g}function s(p,f,m){let g=new Q;f.getCenter(g);let v=[];return m.forEach(y=>{y.boundingBox.containsPoint(g)&&a(p,y.points).forEach(x=>{v.push({identifier:y.identifier,isCW:y.isCW,point:x})})}),v.sort((y,x)=>y.point.x-x.point.x),v}function n(p,f,m,g,v){(v==null||v==="")&&(v="nonzero");let y=new Q;p.boundingBox.getCenter(y);let x=[new Q(m,y.y),new Q(g,y.y)],w=s(x,p.boundingBox,f);w.sort((C,T)=>C.point.x-T.point.x);let S=[],_=[];w.forEach(C=>{C.identifier===p.identifier?S.push(C):_.push(C)});let A=S[0].point.x,E=[],M=0;for(;M<_.length&&_[M].point.x<A;)E.length>0&&E[E.length-1]===_[M].identifier?E.pop():E.push(_[M].identifier),M++;if(E.push(p.identifier),v==="evenodd"){let C=E.length%2===0,T=E[E.length-2];return{identifier:p.identifier,isHole:C,for:T}}else if(v==="nonzero"){let C=!0,T=null,D=null;for(let I=0;I<E.length;I++){let O=E[I];f[O]&&(C?(D=f[O].isCW,C=!1,T=O):D!==f[O].isCW&&(D=f[O].isCW,C=!0))}return{identifier:p.identifier,isHole:C,for:T}}else console.warn('fill-rule: "'+v+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(p=>{let f=p.getPoints(),m=-999999999,g=999999999,v=-999999999,y=999999999;for(let x=0;x<f.length;x++){let w=f[x];w.y>m&&(m=w.y),w.y<g&&(g=w.y),w.x>v&&(v=w.x),w.x<y&&(y=w.x)}c<=v&&(c=v+1),l>=y&&(l=y-1),f.length&&u.push({curves:p.curves,points:f,isCW:n5.isClockWise(f),identifier:o++,boundingBox:new y5(new Q(y,g),new Q(v,m))})});let h=u.map(p=>{var f;return n(p,u,l,c,(f=this.userData)==null?void 0:f.style.fillRule)}),d=[];return u.forEach(p=>{let f=h[p.identifier];if(f&&!f.isHole){let m=new ey;m.curves=p.curves,h.filter(g=>(g==null?void 0:g.isHole)&&g.for===p.identifier).forEach(g=>{if(g){let v=u[g.identifier],y=new J0;y.curves=v.curves,m.holes.push(y)}}),d.push(m)}}),d}},rB=!1,aB,CO=new Promise(e=>{aB=e}),MO=!1,_v;function Mne(){if(rB=!0,MO)return;if(_v)return _v;async function e(){let t=await Xd(()=>import("./opentype-BktxL4Qf.js"),__vite__mapDeps([]));aB(t),MO=!0}return _v=e(),_v}var Tne=class{async load(e,t,i=()=>{}){let{load:r}=await CO;r(e,(a,s)=>{a||!s?i(a??"Something went wrong"):t(s)})}async parse(e){let{parse:t,Bidi:i}=await CO;try{let r=t(e),a=new i,s=n=>r.charToGlyphIndex(n.char);return a.registerModifier("glyphIndex",null,s),a.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:a}}catch(r){console.error(r)}}};async function Pne(e){return await(await fetch(e)).arrayBuffer()}var Dne=new Tne;async function TO(e){let t,i,r=!1;if(e.url?(t=await Pne(e.url),i=e.url,r=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t)if(rB){let a=await Dne.parse(t);if(a)return{font:a.font,url:i,intercepted:r,arr:t,bidi:a.bidi}}else return{font:void 0,url:i,intercepted:r,arr:t,bidi:null}}function One(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var Ine=class{constructor(e){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=TO(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}update(e){this._isLoaded=!1,this._isUserFont=e.isUserFont??!1,this._loadingPromise=TO(e).then(t=>{t&&(this._arrayBuffer=t.arr,this._url=t.url,this.font=t.font,this._intercepted=t.intercepted,this._isLoaded=!0,this._bidi=t.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(t);let a=r.tokenizer.tokens,s=[],n=0,o=i.length===a.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=a[n];if(One(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),n++;else{let d=h.char,p="",f=[h.state.glyphIndex],m=[],g=!1;for(;!g;)n++,p=t.charAt(n),d+=p,f.push(e.charToGlyphIndex(p)),m=e.stringToGlyphs(d),m.length===1&&m[0].index===c&&(g=!0),n>t.length&&(g=!0);s.push({char:u,index:c,replacements:f,replacementChars:Array.from(d)}),n++}}return s}generateShapes(e,t){if(!this._isLoaded)return;let i=this.font,r=t.fontSize/this.unitsPerEm,a=t.fontSize*t.lineHeight,s=e.map(v=>this.getTextWidth(v,t)),n=t.width,o=this.getCharWidth(`
`,t),l=t.horizontalAlign===1?o:0,c=this.computeSpaceWidthForLine(e,0,t),u=this.getLineInitialOffsetX(s[0],n,t.horizontalAlign,e[0],o),h=this.getLineInitialOffsetY(a,e.length,t.height,r,t.verticalAlign),d=[],p=e.map(v=>[]),f=e.map(v=>[]),m;for(let v=0;v<e.length;v++){let y=e[v],x={features:{liga:!0}},w=[];try{w=i.stringToGlyphs(y,x)}catch(_){console.warn(_)}u=this.getLineInitialOffsetX(s[v],n,t.horizontalAlign,y,o);let S=[];try{S=this.reverseLigaturesTable(i,y,w)}catch(_){console.warn(_)}c=this.computeSpaceWidthForLine(e,v,t);for(let _=0;_<w.length;_++){let A=w[_],E=A.index===0?`
`:A.unicode?String.fromCharCode(A.unicode):void 0,M=S[_],C=0,T=0;_===0&&t.horizontalAlign===2&&A.leftSideBearing!==void 0&&(T=-A.leftSideBearing*r),m&&(C=i.getKerningValue(A,m)*r),u+=T+C;let D=0;if(E===`
`)D=l;else if(E===" ")D=c;else{let I=this.createPath(A,r,u,h,t);I&&(D=I.offsetX-(C+T),d.push(I.path))}if(M.replacements.length===1)f[v].push([u,h]),p[v].push(D);else{let I=M.replacements.map(F=>(i.glyphs.get(F).advanceWidth??0)*r),O=I.reduce((F,L)=>F+=L,0),B=I.map(F=>F/O),q=u;for(let F=0;F<B.length;F++){let L=D*B[F];f[v].push([q,h]),p[v].push(L),q+=L}}u+=D,m=A}h-=a}let g=[];for(let v=0,y=d.length;v<y;v++)g.push(...d[v].toShapes());return{shapes:g,charWidths:p,lineWidths:s,charCoords:f}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e;return((e=this.font)==null?void 0:e.ascender)??0}get descender(){var e;return((e=this.font)==null?void 0:e.descender)??0}get familyName(){var e;return((e=this.font)==null?void 0:e.names.fontFamily)??""}get subfamilyName(){var e;return((e=this.font)==null?void 0:e.names.fontSubfamily)??""}get unitsPerEm(){var e;return((e=this.font)==null?void 0:e.unitsPerEm)??1}getLineInitialOffsetX(e,t,i,r,a){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(e-=a),i===3?t*.5-e*.5:i===2?t-e:0}getLineInitialOffsetY(e,t,i,r,a){let s=t*e,n=Math.abs(this.ascender-this.descender)*r,o=e-n,l=-this.ascender*r-o/2;return a===3?-(i-s-l):a===2?-(i*.5-s*.5-l):l}createPath(e,t,i,r,a){var l;let s=e.getPath(i,-r,a.fontSize,{kerning:!1,letterSpacing:a.letterSpacing});if(!s){console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");return}let n=new Cne,o=(e.advanceWidth??1)*t;if(e)for(let c of s.commands){let u=(l=n.currentPath)==null?void 0:l.currentPoint;if(!(u&&c.type!=="Z"&&u.x===c.x&&-u.y===c.y))switch(c.type){case"M":n.moveTo(c.x,-c.y);break;case"L":n.lineTo(c.x,-c.y);break;case"Q":n.quadraticCurveTo(c.x1,-c.y1,c.x,-c.y);break;case"C":n.bezierCurveTo(c.x1,-c.y1,c.x2,-c.y2,c.x,-c.y);break}}return n.subPaths.forEach(c=>{let u=Rne(c.curves);u!==void 0&&c.currentPoint.distanceTo(u)>0&&c.lineTo(u.x,u.y)}),{offsetX:o+a.fontSize*a.letterSpacing,path:n}}getCharWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}getTextWidth(e,t){var i;return((i=this.font)==null?void 0:i.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))??0}computeSpaceWidthForLine(e,t,i){let r=this.getCharWidth(" ",i),a=e[t];if(a){let s=this.countSpaces(a.trimEnd());if(i.horizontalAlign===4&&t<e.length-1&&s){let n=i.width,o=this.getTextWidth(a,i);return(n-(o-s*r))/s}}return r}countSpaces(e){return(e.match(/ /g)||[]).length}};function Rne(e){if(e.length){let t=e[0];if(t instanceof an)return t.v1;if(t instanceof Ks||t instanceof nc)return t.v0}}var Lne=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let r=this.objects.get(e);return r===void 0?(r=this.createObject(e,t,i),this.objects.set(e,r)):r.isShared=!0,r}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&i.isShared!==!0)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){let i=this.objects.get(e);t===i&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach(e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)}),this.unreachable.clear()}dispose(){this.objects.forEach(e=>{this.disposeObject(e)}),this.objects.clear()}},PO=class extends Lne{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let r=Sm(e,t,this.flatShading,i);return r.computeBoundingSphere(),r}},kne={markNeedsUpdateRendererDirty:()=>{}},zne=class extends zse{constructor(e){super(),this.shared=e}create(e){return new YN(e,this.shared)}},uC=class{constructor(e,t={}){if(this.data=e,this.geometryCache=new PO(!0),this.geometryCache2=new PO(!1),this.imageHolderCache=new zne(this),this.thisContext={scene:kne,shared:this},this.deletedMaterial=new uS(ra.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Ol(Ty.emptyImage,this),this.deletedVideo=new Ol(wy.defaultVideo,this),this.materials={},this.images={},this.canvases={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,r]of Object.entries(t.images))this.addImage(i,r);if(t.videos)for(let[i,r]of Object.entries(t.videos))this.addVideo(i,r);if(t.audios)for(let[i,r]of Object.entries(t.audios))this.addAudio(i,r);if(t.particles)for(let[i,r]of Object.entries(t.particles))this.addParticle(i,r);this.reset(e)}setRequestRender(e){this._requestRender=e}setEntityOpContext(e){this.entityOpContext=e}reset(e,t=!1){this.resetLib(e.lib);for(let{id:i,data:r}of e.variables)this.addVariableHolder(i,r),t&&this.updateVariableHolder(i,r);for(let[i,r]of Object.entries(e.images))this.addImage(i,r);for(let[i,r]of Object.entries(e.videos))this.addVideo(i,r);for(let[i,r]of Object.entries(e.colors))this.addColor(i,r);for(let[i,r]of Object.entries(e.materials))this.addMaterial(i,r);for(let[i,r]of Object.entries(e.audios))this.addAudio(i,r);for(let[i,r]of Object.entries(e.particles))this.addParticle(i,r);for(let[i,r]of Object.entries(e.fonts))this.addFont(i,r)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new uS(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){return this.materials[e]??this.deletedMaterial}material(e){return typeof e=="string"?this.getMaterialOrDeletedPlaceholder(e):e==null?(console.error("material is undefined or null"),this.deletedMaterial):new hC(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new Ol(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){return this.images[e]??this.deletedImage}image(e){return typeof e=="string"?this.getImage(e):this.imageHolderCache.load(e)}addCanvas(e,t){return this.canvases[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.canvases[e].updateSrc(t),!0):(this.canvases[e]=new Ol(t,this),!1)}canvas(e){return this.canvases[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new Ol(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){return this.videos[e]??this.deletedVideo}video(e){return typeof e=="string"?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):("a"in t?this.colors[e]=new jy(t.r,t.g,t.b,t.a):this.colors[e]=new jy(t.r,t.g,t.b,1),!1)}updateColor(e,t){if(this.colors[e]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[e];return this.colors[e].r=t.r??i.r,this.colors[e].g=t.g??i.g,this.colors[e].b=t.b??i.b,this.colors[e].a=t.a??i.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if(typeof e=="string"){let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new Vr(0,0,0,0))}else return"a"in e?new Vr(e.r,e.g,e.b,e.a):new Vr(e.r,e.g,e.b,1);return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof ff)return t;{let i=new ff({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof ff&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new Ine(t),this.fonts[e].loadingPromise.then(()=>this.requestRender())}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach(e=>this.deleteMaterial(e)),this._requestRender=void 0,Object.values(this.audios).forEach(e=>{e instanceof ff&&e.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){return this.variables[e]===void 0?(this.variables[e]={value:t.value,locations:[]},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0):(this.variables[e].value=t.value,!1)}resetDynamicVariablePlayState(){for(let e in this.variables)this.variables[e].dynamicVariablePlayState!==void 0&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(this.variables[e]===void 0)return!1;this.variables[e].value=t;let i=t;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let a=this.variables[e].locations.length-1;a>=0;a--){let s=this.variables[e].locations[a];if(s[0]==="material"){let n=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===n&&d.onVariableUpdate(c,o,l)});let u=this.materials[n];u&&u.onVariableUpdate(c,o,l)}else{let n=r.find(s[0]);if(n===void 0){this.variables[e].locations.splice(a,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)n=n[s[o]];s[1]==="rotation"?n[s[s.length-1]]=i*Ge.DEG2RAD:n[s[s.length-1]]=i}if(n=r.find(s[0]),n.type==="ParticleEmitter"&&n.updateVariableState(i,s),Ot.is(n)){if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")n.onVariableUpdate();else if(s[1]==="geometry"){let o=n;n.component&&(o=n.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0)})}}}}return!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){var i,r,a;if(Array.isArray(e)){if(e[0]==="mouse")return((i=this.mouseProperty)==null?void 0:i[e[1]])??0;if(e[0]==="raycast")return((r=this.raycastProperty)==null?void 0:r[e[1]])??0;let s=this.entityOpContext.scene.find(e[0]);if(e[1]==="width"||e[1]==="height"||e[1]==="depth")return s.geometry.userData.parameters[e[1]];for(let n=1;n<e.length;n++)s=s[e[n]];return e[1]==="rotation"&&(s*=Ge.RAD2DEG),s}for(let s in this.variables){if(t===void 0)break;let n=this.variables[s],o=(a=n.locations)==null?void 0:a.findIndex(l=>Br.equal(l,t));o!==void 0&&o!==-1&&n.locations.splice(o,1)}if(typeof e=="string"){let s=e,n=e;do{if(n=s,this.variables[s]===void 0)break;s=this.variables[s].value}while(typeof s=="string");return t&&this.variables[n]!==void 0&&this.variables[n].locations.push(t),s}else return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return(t=this.variables[e])==null?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){this.variables[e]!==void 0&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){e.path[0]==="images"?e.path.length===1&&e.type===1?this.addImage(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===1&&e.type===1?this.addVideo(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===1&&e.type===1?this.addAudio(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===1&&e.type===1?this.addParticle(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===1&&e.type===1?this.addColor(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteMaterial(e.id):e.path[0]==="fonts"?e.path.length===1&&e.type===1?this.addFont(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===1&&e.type===1?this.addVariableHolder(e.id,e.data.asset):e.path.length===1&&e.type===2&&this.deleteVariable(e.id):e.path[0]==="components"&&t.updateByLibOp(e,this)}updateByOp(e,t,i){this.data=t,e.path[0]==="images"?e.path.length===2&&e.type===0?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addImage(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteImage(e.id):e.path[0]==="videos"?e.path.length===2&&e.type===0?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):e.path.length===1&&e.type===1?this.addVideo(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteVideo(e.id):e.path[0]==="audios"?e.path.length===2&&e.type===0?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):e.path.length===1&&e.type===1?this.addAudio(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteAudio(e.id):e.path[0]==="particles"?e.path.length===2&&e.type===0?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):e.path.length===1&&e.type===1?this.addParticle(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteParticle(e.id):e.path[0]==="colors"?e.path.length===2&&e.type===0?this.updateColor(e.path[1],e.props):e.path.length===1&&e.type===1?this.addColor(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteColor(e.id):e.path[0]==="materials"?e.path.length===1&&e.type===1?this.addMaterial(e.id,e.data):e.path.length===1&&e.type===2?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(Ar.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i}):e.path[0]==="fonts"?e.path.length===2&&e.type===0?this.updateFont(e.path[1],e,i):e.path.length===1&&e.type===1?this.addFont(e.id,e.data):e.path.length===1&&e.type===2&&this.deleteFont(e.id):e.path[0]==="variables"?e.path.length===2&&e.type===0&&"value"in e.props?this.updateVariable(e.path[1],e.props.value):e.path.length===1&&e.type===4?this.addVariableHolder(e.id,e.data):e.path.length===1&&e.type===5&&this.deleteVariable(e.id):e.path[0]==="lib"&&this.updateLibByOp(Ar.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let r=this.getFont(e),a={...this.data.fonts[e],url:t.props.url};r.update(a),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(e,this)}}};new uC(ys.emptyData());var cp=class extends ba{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),Dte(e.path,["materials"])!==null&&e.type===0&&Array.isArray(this.material))for(let[r,a]of Object.entries(e.props)){let s=i.shared.material(a);this.material[Number(r)]=s}else if(si(e.path,["material"])&&this.material instanceof lc)"material"in t&&typeof t.material!="string"&&this.material.updateByOp(Ar.drop(e,1),t.material,i);else if(si(e.path,["materials","*"])&&Array.isArray(this.material)){let r=e.path[1];if("materials"in t&&r<this.material.length){let a=t.materials[r];typeof a!="string"&&this.material[r].updateByOp(Ar.drop(e,2),a,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(e,t){var r,a;super.updateState(e,t),e.castShadow!==void 0&&(this.castShadow=e.castShadow),e.receiveShadow!==void 0&&(this.receiveShadow=e.receiveShadow);let i=this.dataPatched;if(((r=e.geometry)==null?void 0:r.type)!=="NonParametricGeometry"&&"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe),t.scene.markNeedsUpdateRendererDirty()),(((a=e.geometry)==null?void 0:a.type)==="NonParametricGeometry"||"materials"in e)&&("materials"in e&&e.materials!==void 0?(this.disposeMaterial(),this.material=e.materials.map(s=>t.shared.material(s).getFlavor(i.flatShading,i.side,i.wireframe)),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&e.material!==void 0&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(i.flatShading,i.side,i.wireframe)],t.scene.markNeedsUpdateRendererDirty())),e.flatShading!==void 0||e.wireframe!==void 0||e.side!==void 0)if(Array.isArray(this.material))for(let s=0;s<this.material.length;s++)this.material[s]=this.material[s].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe)}disposeMaterial(){this.material&&iz(this.material).forEach(e=>{e instanceof lc&&(e instanceof uS||e.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},DO=new P,OO=new dt,IO=new dt,Nne=new P,RO=new Se,ia=class extends cp{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=new Se().fromArray(t.bindMatrix),this.bindMatrixInverse=new Se)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Qe&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof uC){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return Ay.is2DParametricMesh(e.type)&&e.depth===0}get is2DType(){return Ay.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),si(e.path,["geometry"])&&this.updateByPatchedOpGeometry(Ar.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;(t=this.localGeometry)==null||t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){var r;this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let a=e;if(this.localGeometry===void 0){let c={...this.data.geometry,...a};this.localGeometry=Sm(c,t,this.data.flatShading,this)}let s,n,o;a.scaleBaked?[s,n,o]=a.scaleBaked:{width:s,height:n,depth:o}=a;let l=this.localGeometry.userData;l.sxPrev!==void 0&&sS(this.localGeometry.attributes,s/l.sxPrev,n/l.syPrev,o/l.szPrev),l.sxPrev=s,l.syPrev=n,l.szPrev=o}else{let a={...this.data.geometry,...e};(r=this.localGeometry)==null||r.dispose(),this.localGeometry=Sm(a,t,this.data.flatShading,this)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand(()=>t.updateShape())}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var a;let r=!1;e.type===0&&e.path.length===0&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof fa&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||((a=i.scene)==null||a.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){e.geometry!==void 0&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e;Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(((e=this.geometry.getIndex())==null?void 0:e.count)??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;this.is2DType?e.set(0,0,i.depth*.5):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):e.setScalar(0),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new dt,i=this.geometry.attributes.skinWeight;for(let r=0,a=i.count;r<a;r++){t.fromBufferAttribute(i,r);let s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),i.setXYZW(r,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;OO.fromBufferAttribute(r.attributes.skinIndex,e),IO.fromBufferAttribute(r.attributes.skinWeight,e),DO.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){let s=IO.getComponent(a);if(s!==0){let n=OO.getComponent(a);RO.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(Nne.copy(DO).applyMatrix4(RO),s)}}return t.applyMatrix4(this.bindMatrixInverse)}};function Bne(e){var n,o;if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,r=i.position.array,a=i.normal.array,s=new Float32Array(r.length);for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=new P(a[l],a[l+1],a[l+2]);t.has(c)?(n=t.get(c))==null||n.normals.push(u):t.set(c,{normals:[u],result:new P})}t.forEach((l,c)=>{for(let u of l.normals)l.result.add(u);l.result.divideScalar(l.normals.length)});for(let l=0;l<r.length;l+=3){let c=`${r[l]}_${r[l+1]}_${r[l+2]}`,u=(o=t.get(c))==null?void 0:o.result;u&&(s[l]=u.x,s[l+1]=u.y,s[l+2]=u.z)}e.geometry.setAttribute("extrudeNormal",new Re(s,3))}function jne(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=new P;for(let a=0;a<t.length;a+=3)r.set(t[a],t[a+1],t[a+2]).normalize(),i[a]=r.x,i[a+1]=r.y,i[a+2]=r.z;e.geometry.setAttribute("extrudeNormal",new Re(i,3))}function dC(e){if(Array.isArray(e.material)){for(let t of e.material)if(t.getLayersOfType("outline").length===0)return}else if(!(e.material instanceof lc)||e.material.getLayersOfType("outline").length===0)return;e instanceof ia&&e.is2DAndNoDepth?jne(e):Bne(e)}function pC(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),r=parseInt(e.uuid.replace(/\D/g,"")),a=[Ge.seededRandom(r),Ge.seededRandom(r+1e4),Ge.seededRandom(r+2e4)];for(let s=0;s<t.length;s++)i[s]=a[s%3];e.geometry.setAttribute("randomColor",new ht(i,3))}var _n=new Hi,Up=new P;function Fne(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(t=!0)}),t}var Am=class extends ia{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new Se,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(e,t){let i=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(e){var s,n,o;if(this.skipReactionUpdate===!0)return;let t=(s=this.localGeometry)==null?void 0:s.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:a}=fa.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=a,i!==void 0&&((n=this.originalGeometry)==null||n.dispose(),this.originalGeometry=i),r!==void 0&&((o=this.subdividedGeometry)==null||o.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,dC(this),pC(this),this.calcBoundingBox(),t&&(this.localGeometry.uuid=t)}updateState(e,t){if(super.updateState(e,t),e.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(e=!1){fa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&fa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=fa.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=fa.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,ba.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;e.boundingSphere===null&&(e.boundingSphere=new Fa,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;_n.setFromBufferAttribute(t),_n.getCenter(i),e.boundingSphere.radius=i.distanceTo(_n.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),_n.getSize(Up),this.hasNonUniformScale&&Up.divide(this.scale);let r={width:Up.x,height:Up.y,depth:Up.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(e){let t=this.originalGeometry;_n.min.set(e[0],e[2],e[4]),_n.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(_n.min.applyMatrix4(this.shearScaleInv),_n.max.applyMatrix4(this.shearScaleInv)),t.boundingSphere===null&&(t.boundingSphere=new Fa);let i=t.boundingSphere.center;_n.getCenter(i),t.boundingSphere.radius=i.distanceTo(_n.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(fa.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,(e=this.originalGeometry)==null||e.dispose(),(t=this.subdividedGeometry)==null||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},LO=-1,Une=1,Vne={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},Gne={polygon_center:0,edge:1,vertex:2},Sv=(e,t)=>(i,r)=>!t||i===0||e===0?0:e*r/100,vt=(e,t)=>{let i=Math.abs(t),r=i*-1;return(e-LO)*(i-r)/(Une-LO)+r};function Hne(e){let t=[],i={};for(var r=0,a=e.length;r<a;r++){var s=JSON.stringify(e[r].pos.map(n=>Math.round(n*1e4)/1e4));i[s]||(t.push(e[r]),i[s]=!0)}return t}var Wne=new P,Av=new P,qne=new P,Xne=new P;function hd(e,t){let i=qne.fromArray(e),r=Xne.fromArray(t);Av.copy(r).sub(i);let a=Av.length();return Av.normalize().multiplyScalar(a*.5),Wne.copy(i).add(Av).toArray()}var ws=new Nr,Ev=new P,Fy=new P,Lc=new P;function Yne(e){let t=[];for(let i=0;i<=e.index.count;i++)if(Ev.fromArray(e.index.array,i*3),ws.setFromAttributeAndIndices(e.attributes.position,Ev.x,Ev.y,Ev.z),ws.getNormal(Fy),ws.getMidpoint(Lc),!(isNaN(Lc.x)||isNaN(Lc.y)||isNaN(Lc.z))){let{a:r,b:a,c:s}=ws,n=r.toArray(),o=a.toArray(),l=s.toArray(),c=r.distanceTo(a),u=a.distanceTo(s),h=s.distanceTo(r),d=hd(n,o),p=hd(o,l),f=hd(l,n),m=[c,u,h],g=Math.max(...m),v=m.filter(w=>Math.round(w)===Math.round(g)).length>1,y=[],x=ws.getMidpoint(Lc).toArray();g===c&&!v&&(y=[p,f,f],x=d),g===u&&!v&&(y=[d,f,f],x=p),g===h&&!v&&(y=[d,p,p],x=f),v&&(y=[d,p,f]),t.push({vertices:[n,o,l],faceCenters:y,midpoint:x,norm:ws.getNormal(Fy).toArray()})}return t}function Qne(e){let t=[],{position:i}=e.attributes;for(let r=0;r<i.count;r++){ws.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),ws.getNormal(Fy),ws.getMidpoint(Lc);let a=ws.a.toArray(),s=ws.b.toArray(),n=ws.c.toArray();t.push({vertices:[a,s,n],faceCenters:[hd(a,s),hd(s,n),hd(n,a)],midpoint:Lc.toArray(),norm:Fy.toArray()})}return t}var Zne=4,Kne=.5,rw=e=>.5*(1-Math.cos(e*Math.PI)),$ne=class{constructor(){this.perlin=new Array(4096)}noise(e,t=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let g=0;g<4096;g++)this.perlin[g]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let r=Math.floor(e),a=Math.floor(t),s=Math.floor(i),n=e-r,o=t-a,l=i-s,c,u,h=0,d=.5,p,f,m;for(let g=0;g<Zne;g++){let v=r+(a<<4)+(s<<8);c=rw(n),u=rw(o),p=this.perlin[v&4095],p+=c*(this.perlin[v+1&4095]-p),f=this.perlin[v+16&4095],f+=c*(this.perlin[v+16+1&4095]-f),p+=u*(f-p),v+=256,f=this.perlin[v&4095],f+=c*(this.perlin[v+1&4095]-f),m=this.perlin[v+16&4095],m+=c*(this.perlin[v+16+1&4095]-m),f+=u*(m-f),p+=rw(l)*(f-p),h+=p*d,d*=Kne,r<<=1,n*=2,a<<=1,o*=2,s<<=1,l*=2,n>=1&&(r++,n--),o>=1&&(a++,o--),l>=1&&(s++,l--)}return h}noiseSeed(e){let t=(()=>{let i,r;return{setSeed(a){r=i=(a??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},Jne=$ne,kO=new P,zO=new Se,NO=new Qd;function BO(e){let t=!1;return e.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="TextGeometry"&&(t=!0)}),t}var sB=class extends ia{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var t;let e=this.dataPatched;return((t=this.font)==null?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,e.geometry.height,this.fontScale,e.geometry.verticalAlign))??0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e;return(((e=this.font)==null?void 0:e.ascender)??1)*this.fontScale}get descender(){var e;return(((e=this.font)==null?void 0:e.descender)??1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!(isNaN(e.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(zO.copy(i).invert(),NO.copy(e.ray).applyMatrix4(zO),NO.intersectBox(this.singleBBox,kO))){let r=kO.applyMatrix4(i),a=e.ray.origin.distanceTo(r);t.push({distance:a,point:r.clone(),object:this})}}},ca=1e-4,Sn,nB,oB,lB,jO=new P,FO=new P;gN.then(e=>{Sn=e,nB=[Sn.get_face_center,Sn.get_edge_midpoint,Sn.get_vertex_position],oB=[Sn.get_face_normal,Sn.get_edge_normal,Sn.get_vertex_normal],lB=[Sn.face_count,Sn.edge_count,Sn.vertex_count]});var eoe=new Se,toe=new Se,fl=new P,wc=new P,Vp=new P,aw=new P,ioe=new P,roe=new P,go=new Jne,Js=class extends QE(Yt){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(this.parent===null)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof ta&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse(t=>{t instanceof ta&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(e!==void 0?t=e:t=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"&&!this.parameters.toObject.object&&(t=0),this.parameters.type==="toObject"&&this.objectForSample){for(let r=0,a=this.children.length;r<a;++r)this.remove(this.children[0]);let i=this.children;if(i.length===t)return;if(i.length<t)for(let r=0,a=t-i.length;r<a;++r){let s=new ta(this.object);s.expand(),this.add(s)}else for(let r=0,a=i.length-t;r<a;++r)this.remove(i[r])}else{if(this.children.length===t)return;if(this.children.length<t)for(let i=0,r=t-this.children.length;i<r;++i){let a=new ta(this.object);a.expand(),this.add(a)}else for(let i=0,r=this.children.length-t;i<r;++i)this.remove(this.children[0])}}_updateRadial(e){let t=e.radial,i=t.start*Ge.DEG2RAD,r=t.end*Ge.DEG2RAD,a=i-r,s=new hr(t.rotation[0],t.rotation[1],t.rotation[2]),n;switch(t.axis){case"z":n=new P(0,0,1);break;case"y":n=new P(0,1,0);break;default:case"x":n=new P(1,0,0);break}let o=e.randomnessObject??Bl.defaultData([1,1,1]).randomnessObject,l=o.noiseType==="perlin";go.noiseSeed(o.seed);let c=zb((0,zp.default)(o.seed)),u=Sv(o.strength,this.parameters.randomness);for(let[h,d]of this.children.entries()){let p=h*(o.freqScale/10)+o.movement,f=l?go.noise(p):c(p,p),m=h+1;d.scale.x=t.scale[0]+u(m,vt(f,o.scale[0]))||ca,d.scale.y=t.scale[1]+u(m,vt(f,o.scale[1]))||ca,d.scale.z=t.scale[2]+u(m,vt(f,o.scale[2]))||ca,d.position.setScalar(0);let g=a/e.count*h-i;switch(t.axis){case"x":d.rotation.set(0,g,0);break;case"y":d.rotation.set(0,0,g);break;case"z":d.rotation.set(g,0,0);break}d.translateOnAxis(n,t.radius),d.position.x+=t.position[0]+u(m,vt(f,o.position[0])),d.position.y+=t.position[1]+u(m,vt(f,o.position[1])),d.position.z+=t.position[2]+u(m,vt(f,o.position[2]));let v=u(m,vt(f,o.rotation[0])),y=u(m,vt(f,o.rotation[1])),x=u(m,vt(f,o.rotation[2]));t.alignment===!0?(d.rotation.x+=s.x+v,d.rotation.y+=s.y+y,d.rotation.z+=s.z+x):d.rotation.set(s.x+v,s.y+y,s.z+x)}}_updateLinear(e){if(e.type!=="linear")throw new Error;let t=e.linear,i=new hr(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??Bl.defaultData([1,1,1]).randomnessObject,a=r.noiseType==="perlin";go.noiseSeed(r.seed);let s=zb((0,zp.default)(r.seed)),n=Sv(r.strength,this.parameters.randomness);for(let[o,l]of this.children.entries()){let c=o*(r.freqScale/10)+r.movement,u=a?go.noise(c):s(c,c),h=o+1,d=n(h,vt(u,r.rotation[0])),p=n(h,vt(u,r.rotation[1])),f=n(h,vt(u,r.rotation[2]));l.scale.x=1+(t.scale[0]-1)*o+n(h,vt(u,r.scale[0]))||ca,l.scale.y=1+(t.scale[1]-1)*o+n(h,vt(u,r.scale[1]))||ca,l.scale.z=1+(t.scale[2]-1)*o+n(h,vt(u,r.scale[2]))||ca,l.rotation.x=i.x*o+d,l.rotation.y=i.y*o+p,l.rotation.z=i.z*o+f,l.position.x=t.position[0]*o+n(h,vt(u,r.position[0])),l.position.y=t.position[1]*o+n(h,vt(u,r.position[1])),l.position.z=t.position[2]*o+n(h,vt(u,r.position[2]))}}_updateGrid(e){let t=0,i=e.grid,r=e.randomnessObject??Bl.defaultData([1,1,1]).randomnessObject,a=Sv(r.strength,this.parameters.randomness),s=r.noiseType==="perlin";go.noiseSeed(r.seed);let n=cre((0,zp.default)(r.seed));if(i.useCenter===!0){let o={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},l=new P(i.size[0]*(i.count[0]-o.x)*.5,i.size[1]*(i.count[1]-o.y)*.5,i.size[2]*(i.count[2]-o.z)*.5);for(let c=0;c<i.count[0];c++)for(let u=0;u<i.count[1];u++)for(let h=0;h<i.count[2];h++){let d=[(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement,(h+1)*(r.freqScale/10)+r.movement],p=s?go.noise(...d):n(...d),f=this.children[t++];f.scale.x=1+a(t,vt(p,r.scale[0]))||ca,f.scale.y=1+a(t,vt(p,r.scale[1]))||ca,f.scale.z=1+a(t,vt(p,r.scale[2]))||ca;let m=a(t,vt(p,r.rotation[0])),g=a(t,vt(p,r.rotation[1])),v=a(t,vt(p,r.rotation[2]));f.rotation.set(m,g,v),f.position.x=i.size[0]*c-l.x+a(t,vt(p,r.position[0])),f.position.y=i.size[1]*u-l.y+a(t,vt(p,r.position[1])),f.position.z=i.size[2]*h-l.z+a(t,vt(p,r.position[2]))}}else for(let o=0;o<i.count[0];o++)for(let l=0;l<i.count[1];l++)for(let c=0;c<i.count[2];c++){let u=[(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement],h=s?go.noise(...u):n(...u),d=this.children[t++];d.scale.x=1+a(t,vt(h,r.scale[0]))||ca,d.scale.y=1+a(t,vt(h,r.scale[1]))||ca,d.scale.z=1+a(t,vt(h,r.scale[2]))||ca;let p=a(t,vt(h,r.rotation[0])),f=a(t,vt(h,r.rotation[1])),m=a(t,vt(h,r.rotation[2]));d.rotation.set(p,f,m),d.position.x=i.size[0]*o+a(t,vt(h,r.position[0])),d.position.y=-i.size[1]*l+a(t,vt(h,r.position[1])),d.position.z=-i.size[2]*c+a(t,vt(h,r.position[2]))}}_updateToObject(e){var m;if(e.type!=="toObject")throw new Error;let{toObject:t}=e,i=new hr(t.rotation[0],t.rotation[1],t.rotation[2]),r=e.randomnessObject??Bl.defaultData([1,1,1]).randomnessObject,a=r.noiseType==="perlin";go.noiseSeed(r.seed);let s=zb((0,zp.default)(r.seed)),n=Sv(r.strength,this.parameters.randomness);if(!t.object){for(let[,g]of this.children.entries())g.position.set(0,0,0),g.scale.setScalar(1),g.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof sB)if(!((m=this.objectForSample.font)!=null&&m.isLoaded)||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let o=this.getSubdivData(),l=[],c=g=>{let v=g.length,y=g.map(S=>S[0]).reduce((S,_)=>S+_,0),x=g.map(S=>S[1]).reduce((S,_)=>S+_,0),w=g.map(S=>S[2]).reduce((S,_)=>S+_,0);return[y/v,x/v,w/v]},u=g=>Math.round(g*1e6)/1e6;o.forEach(g=>{let v=o.filter(y=>u(g.pos[0])===u(y.pos[0])&&u(g.pos[1])===u(y.pos[1])&&u(g.pos[2])===u(y.pos[2]));v.length>1?l.push({pos:g.pos,norm:c(v.map(y=>y.norm))}):l.push(g)});let h=Hne(l);if(h.length>0){let g=Math.round(h.length*t.count/100);this._updateCount(g)}else{let g=this.objectForSample.geometry.getAttribute("position");if(!g||isNaN(g.count)||g.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let d=new hre(this.objectForSample).build(),p=Vne[t.axis],f=this.children;d.setRandomGenerator((0,zp.default)(this.object.uuid+t.seed));for(let[g,v]of f.entries()){let y=g*(r.freqScale/10)+r.movement,x=a?go.noise(y):s(y,y),w=g+1,S=n(w,vt(x,r.rotation[0])),_=n(w,vt(x,r.rotation[1])),A=n(w,vt(x,r.rotation[2]));t.spreadType==="random"?d.sample(Vp,aw):(h.length&&(Vp.fromArray(h[g].pos),aw.fromArray(h[g].norm)),this.objectForSample instanceof Am&&Vp.applyMatrix4(eoe.copy(this.objectForSample.matrixWorld).invert())),Vp.applyMatrix4(this.object.hiddenMatrix.clone().invert()),v.position.copy(Vp),fl.fromArray(p);let E=t.align==="normal"?aw:this.object.getWorldDirection(roe),M=wc.fromArray(t.position);wc.x+=wc.x+n(w,vt(x,r.position[0])),wc.y+=wc.y+n(w,vt(x,r.position[1])),wc.z+=wc.z+n(w,vt(x,r.position[2]));let C=Math.acos(E.dot(fl)),T=ioe.crossVectors(fl,E).normalize(),D=toe.makeRotationAxis(T,C),I=E.clone().cross(this.object.up).normalize(),O=I.clone().cross(E).normalize(),B=new Se().makeBasis(I,E,O),q=new P(fl.y,fl.z,fl.x).normalize(),F=q.clone().cross(fl).normalize(),L=new Se().makeBasis(q,fl,F).invert(),X=new Se().multiplyMatrices(B,L);v.rotation.setFromRotationMatrix(X),M.applyMatrix4(D),v.position.add(M),v.rotation.x=v.rotation.x+i.x+S,v.rotation.y=v.rotation.y+i.y+_,v.rotation.z=v.rotation.z+i.z+A,v.scale.setScalar(1),v.scale.x=v.scale.x+t.scale[0]+n(w,vt(x,r.scale[0]))||ca,v.scale.y=v.scale.y+t.scale[1]+n(w,vt(x,r.scale[1]))||ca,v.scale.z=v.scale.z+t.scale[2]+n(w,vt(x,r.scale[2]))||ca,v.scale.multiply(this.object.scale),v.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if(e==="random")return[];if(this.objectForSample instanceof Am){let t=this.objectForSample,i=Gne[e],r=lB[i],a=nB[i],s=oB[i],n=[],o=r(t.subdivPointerNew);for(let l=0;l<=o-1;l++){let c=a(t.subdivPointerNew,l),u=s(t.subdivPointerNew,l);jO.fromArray(c).applyMatrix4(t.matrixWorld),FO.fromArray(u),n.push({pos:jO.toArray(),norm:FO.toArray()})}return n}else return(this.objectForSample.geometry.index?Yne(this.objectForSample.geometry):Qne(this.objectForSample.geometry)).map((t,i)=>e==="polygon_center"?{pos:t.midpoint,norm:t.norm}:e==="vertex"?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:e==="edge"?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[]).flat()}updateState(e,t){var i;if(this.parameters=O1(e),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),(i=this.object.parent)==null||i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let r=t.find(this.parameters.toObject.object);r instanceof ba?this.objectForSample=r:this.objectForSample=void 0,this.matrix=new Se,this.hiddenMatrix=new Se,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,r&&r.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},Wm=e=>{var t;return t=class extends e{},t.geometryHelper=new cn(30,30,30),t},Cv=new Qd,sw=new Fa,UO=new Se,qm=(e,t,i,r,a=!1)=>{let s=t,n=e.matrixWorld;if(s.boundingSphere===null&&s.computeBoundingSphere(),sw.copy(s.boundingSphere),sw.applyMatrix4(n),i.ray.intersectsSphere(sw)===!1||(UO.copy(n).invert(),Cv.copy(i.ray).applyMatrix4(UO),s.boundingBox!==null&&Cv.intersectsBox(s.boundingBox)===!1))return;let o,l,c,u,h=s.index,d=s.attributes.position,p=s.drawRange,f,m;if(a===!1){let v=Math.max(0,p.start),y=Math.min(h.count,p.start+p.count);for(f=v,m=y;f<m;f+=3)if(l=h.getX(f),c=h.getX(f+1),u=h.getX(f+2),o=g(e,i,Cv,d,l,c,u),o){o.faceIndex=Math.floor(f/3),r.push(o);return}}else{let v=s.attributes.position,y=new P,x=new P,w=new P,S=new P,_=2,A=1/((e.scale.x+e.scale.y+e.scale.z)/3),E=A*A,M=Math.max(0,p.start),C=Math.min(v.count,p.start+p.count);for(let T=M,D=C-1;T<D;T+=_){if(y.fromBufferAttribute(v,T),x.fromBufferAttribute(v,T+1),Cv.distanceSqToSegment(y,x,S,w)>E)continue;S.applyMatrix4(e.matrixWorld);let I=i.ray.origin.distanceTo(S);I<i.near||I>i.far||r.push({distance:I,point:w.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(v,y,x,w,S,_,A){let E=new P,M=new P,C=new P,T=new P,D=new P;if(E.fromBufferAttribute(w,S),M.fromBufferAttribute(w,_),C.fromBufferAttribute(w,A),x.intersectTriangle(E,M,C,!1,T)===null)return null;D.copy(T),D.applyMatrix4(v.matrixWorld);let I=y.ray.origin.distanceTo(D);return I<y.near||I>y.far?null:{faceIndex:1,distance:I,point:D.clone(),object:v}}},Mv=new P,us=new Sh,aoe=class extends jm{constructor(e){let t=new Qe,i=new dc({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],a=[],s={},n=new tt(15711266),o=new tt(15711266),l=new tt(2857471);c("n1","n2",n),c("n2","n4",n),c("n4","n3",n),c("n3","n1",n),c("f1","f2",n),c("f2","f4",n),c("f4","f3",n),c("f3","f1",n),c("n1","f1",n),c("n2","f2",n),c("n3","f3",n),c("n4","f4",n),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,p){u(h,p),u(d,p)}function u(h,d){r.push(0,0,0),a.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}t.setAttribute("position",new Re(r,3)),t.setAttribute("color",new Re(a,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let e=this.geometry,t=this.pointMap;us.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,a=.8;Fs("n1",t,e,us,-i,-r,a),Fs("n2",t,e,us,i,-r,a),Fs("n3",t,e,us,-i,r,a),Fs("n4",t,e,us,i,r,a);let s=a;Fs("f1",t,e,us,-i,-r,s),Fs("f2",t,e,us,i,-r,s),Fs("f3",t,e,us,-i,r,s),Fs("f4",t,e,us,i,r,s);let n=s,o=.5;Fs("u1",t,e,us,i*.7*o,r*1.1,n),Fs("u2",t,e,us,-i*.7*o,r*1.1,n),Fs("u3",t,e,us,0,r*(1.1+.9*o),n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function Fs(e,t,i,r,a,s,n){Mv.set(a,s,n).unproject(r);let o=t[e];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],Mv.x,Mv.y,Mv.z)}}var soe=class extends Wm(aoe){constructor(e){super(e),this.object=e,this.object=e,this.name=`CombinedCameraHelper: ${e.uuid}`}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){qm(this.object,this.geometry,e,t,!0)}},dS;(e=>e.is=t=>"objectHelper"in t)(dS||(dS={}));var hp=(e,t)=>class extends ZE(e){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof sy&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof cn?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof sy&&(r.visible=!1)}}},Tv=790,tu=new P,nw=new P,ow=new ut,lw=new P,Gp=new P,cw=new P,aa=class extends hp(Sh,soe){constructor(t="",i={...mm.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=Rd.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,i),this.previousProjectionMatrix=new Se,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let r=this.width,a=this.height;this.orthoCamera=new cE(r*-.5,r*.5,a*.5,a*-.5,-5e4,1e4),this.perspCamera=new Jr(45,r/a,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,i){t==="PerspectiveCamera"?this.perspCamera.near=i:this.orthoCamera.near=i}setZoom(t,i){i>=0&&(t==="PerspectiveCamera"?this.perspCamera.zoom=i:this.orthoCamera.zoom=i)}set cameraType(t){t==="PerspectiveCamera"?this.toPerspective():t==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(t){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,i,r){typeof t=="number"&&(t=new P(t,i,r)),super.lookAt(t),this.getWorldPosition(tu),this.targetOffset=tu.distanceTo(t)}getTarget(t=new P){return this.getWorldDirection(nw),this.getWorldPosition(tu),nw.multiplyScalar(this.targetOffset),t.copy(tu).add(nw),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(tu),tu.distanceTo(t)}updateUp(){this.getWorldQuaternion(ow),lw.set(0,0,1).applyQuaternion(ow),Gp.copy(Yt.DEFAULT_UP),this.isUpVectorFlipped&&Gp.negate(),Gp.applyQuaternion(ow),cw.copy(Yt.DEFAULT_UP).projectOnPlane(lw),this.angleOffsetFromUp=cw.angleTo(Gp),this.angleOffsetFromUp*=cw.cross(Gp).dot(lw)>=0?1:-1}updateTransformState(t,i){let r=super.updateTransformState(t,i);return t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),r}getViewFrontToObject(t){let i=t.getWorldPosition(new P),r=t.getWorldDirection(new P).multiplyScalar(this.targetOffset);return{position:i.clone().add(r),target:i}}getViewToTarget(t){let i=this.getWorldDirection(new P).multiplyScalar(this.targetOffset);return{position:t.clone().sub(i),target:t}}getViewToObject(t){let i=new P;return t.getWorldPosition(i),this.getViewToTarget(i)}setViewplaneSize(t,i,r=!1){if(this.aspect=t/i,r){let a=t>i?this.aspect:1,s=t>i?1:this.aspect;this.left=-Tv*.5*a,this.right=Tv*.5*a,this.top=Tv*.5*(1/s),this.bottom=-Tv*.5*(1/s)}else this.left=-t*.5,this.right=t*.5,this.top=i*.5,this.bottom=-i*.5;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,i,r,a,s,n){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(t,i,r,a,s,n):this.orthoCamera.setViewOffset(t,i,r,a,s,n)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,i){super.updateWorldMatrix(t,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,i){return super.copy(t,i),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=t.view===null?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(t=[]){let i={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return c2(i,t)}updateCameraSubtype(t,i){let r=t==="perspective"?"PerspectiveCamera":"OrthographicCamera";i.zoom!==void 0&&this.setZoom(r,i.zoom),i.near!==void 0&&this.setNear(r,i.near),i.fov!==void 0&&r==="PerspectiveCamera"&&(this.fov=i.fov)}updateState(t,i){this.updateCameraState(t,i)}updateCameraState(t,i){this.updateState_Entity(t,i),t.far!==void 0&&(this.far=t.far),t.orthographic!==void 0&&this.updateCameraSubtype("orthographic",t.orthographic),t.perspective!==void 0&&this.updateCameraSubtype("perspective",t.perspective),t.type!==void 0&&(this.cameraType=t.type),t.up!==void 0&&this.up.fromArray(t.up),t.targetOffset!==void 0&&(this.targetOffset=t.targetOffset),t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,i,r){super.updateByPatchedOp(t,i,r),t.path.length===1&&t.type===0&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},iu=new Se,noe=new Se,Pv=new Se,VO=new P,GO=new P;function HO(e){let t=!1;return e.scene.objects.traverse((i,r)=>{var a;((a=r.geometry)==null?void 0:a.type)==="BooleanGeometry"&&(t=!0)}),t}var xh=class extends cp{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Qe,this.onAfterRender=(r,a,s,n,o,l)=>{super.onAfterRender(r,a,s,n,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&e.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e,t=!0){var r;if(this.booleanMeshSetAddress!==-1&&!e)return;for(let a=0;a<this.children.length;a++){let s=this.children[a];s instanceof xh&&s.dataPatched.visible===!0&&s.recomputeBoolean(e===!0,t)}this.meshSetAddresses=[];for(let a=0;a<this.children.length;a++){let s=this.children[a];if(s instanceof ba&&s.dataPatched.visible===!0&&((r=s.geometry.attributes.position)==null?void 0:r.count)>0&&s.geometry.drawRange.count>0&&s.booleanMeshSetAddress!==0){iu.multiplyMatrices(s.hiddenMatrix,s.matrix);try{if(s.booleanMeshSetAddress===-1){if((s.geometry.index??s.geometry.getAttribute("position")).count/3<15e5&&(s.booleanMeshSetAddress=Co.getMeshSet(s.geometry,e===!0,t)),s.booleanMeshSetAddress===-1)return;Co.transformMeshSet(s.booleanMeshSetAddress,iu),s.booleanMatrixInvOld.copy(iu).invert(),s.booleanWasTransformed=!1}else s instanceof xh&&s.needsTransformForDownstream===!0?(Co.transformMeshSet(s.booleanMeshSetAddress,iu),s.needsTransformForDownstream=!1):s.booleanWasTransformed===!0&&(Co.transformMeshSet(s.booleanMeshSetAddress,noe.multiplyMatrices(iu,s.booleanMatrixInvOld)),s.booleanMatrixInvOld.copy(iu).invert(),s.booleanWasTransformed=!1)}catch(n){console.error(n),s.booleanMeshSetAddress=0,s.geometry.userData.booleanOperationDidFail=!0;continue}Co.hasOpenEdges(s.booleanMeshSetAddress)===!1||a===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(s.booleanMeshSetAddress),s.geometry.userData.booleanOperationDidFail=!1):s.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Re([],0)),this.geometry.setDrawRange(0,0);return}if(e===!0)return Co.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new Qe,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=Co.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(a){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(a)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,dC(this),pC(this)}dispose(){super.dispose(),this.geometry.dispose()}get recursiveBBox(){var t;let e=super.recursiveBBox;return((t=this.geometry.boundingSphere)==null?void 0:t.radius)===-1&&(e.getCenter(this.geometry.boundingSphere.center),Pv.copy(this.matrixWorld).invert(),this.geometry.boundingSphere.center.applyMatrix4(Pv),VO.copy(e.max).applyMatrix4(Pv),GO.copy(e.min).applyMatrix4(Pv),this.geometry.boundingSphere.radius=VO.distanceTo(GO)/2),e}},pS;(e=>{function t(i){return Ot.is(i)&&i instanceof Vm}e.is=t})(pS||(pS={}));var fC=(e,t)=>class extends hp(e,t){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Zs=e=>e instanceof ba,Fo=e=>e!==null&&e instanceof xh,ooe=e=>e instanceof aa,loe=e=>pS.is(e),fS=e=>dS.is(e),Xm=class extends Wm(Nq){constructor(e,t=15){super(t),this.object=e,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${e.uuid}`,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){qm(this.object,Xm.geometryHelper,e,t)}update(){}},ud=class extends hp(Fc,Xm){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&Object.keys(e).length===1&&t.scene.reloadSplats()}},mS=class extends hp(Fc,Xm){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},cB={RED:0,GREEN:1,BLUE:2,ALPHA:3},Ym="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",coe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,Dv=class extends Wt{constructor(e=!1,t=!1){super({name:"BokehMaterial",defines:{PASS:e?"2":"1"},uniforms:{kernel64:new we(null),kernel16:new we(null),inputBuffer:new we(null),cocBuffer:new we(null),texelSize:new we(new Q),scale:new we(1)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:coe,vertexShader:Ym}),this.toneMapped=!1,t&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=2.39996323,t=new Float32Array(128),i=new Float32Array(32),r=0,a=0;for(let o=0;o<80;++o){let l=o*e,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[a++]=u,i[a++]=h):(t[r++]=u,t[r++]=h)}let s=[],n=[];for(let o=0;o<128;)s.push(new dt(t[o++],t[o++],t[o++],t[o++]));for(let o=0;o<32;)n.push(new dt(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=n}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function WO(e,t,i){return e*(t-i)-t}function gS(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var hoe=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,uoe=class extends Wt{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new we(null),focusDistance:new we(0),focusRange:new we(0),cameraNear:new we(.3),cameraFar:new we(1e3)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:hoe,vertexShader:Ym}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=il){this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-WO(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=gS(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-WO(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=gS(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Jr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},doe=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,poe="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",qO=class extends Wt{constructor(e=new Q){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new we(null),texelSize:new we(new Q),halfTexelSize:new we(new Q),kernel:new we(0),scale:new we(1)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:doe,vertexShader:poe}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},foe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,moe=class extends Wt{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new we(null),opacity:new we(1)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:foe,vertexShader:Ym}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},goe=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,voe=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,F1={DEPTH:0,LUMA:1,COLOR:2},yoe={DISABLED:0,DEPTH:1,CUSTOM:2},xoe=class extends Wt{constructor(e=new Q,t=F1.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Yd.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new we(null),depthBuffer:new we(null),predicationBuffer:new we(null),texelSize:new we(e)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:goe,vertexShader:voe}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=il){this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(e*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},boe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,woe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",Us={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},vS=class extends Wt{constructor(e,t,i,r,a=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Yd.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new we(null),depthBuffer:new we(null),resolution:new we(new Q),texelSize:new we(new Q),cameraNear:new we(.3),cameraFar:new we(1e3),aspect:new we(1),time:new we(0)},blending:ir,depthWrite:!1,depthTest:!1,dithering:a}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e,t=il){this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader=boe.replace(Us.FRAGMENT_HEAD,e.get(Us.FRAGMENT_HEAD)).replace(Us.FRAGMENT_MAIN_UV,e.get(Us.FRAGMENT_MAIN_UV)).replace(Us.FRAGMENT_MAIN_IMAGE,e.get(Us.FRAGMENT_MAIN_IMAGE)),this.vertexShader=woe.replace(Us.VERTEX_HEAD,e.get(Us.VERTEX_HEAD)).replace(Us.VERTEX_MAIN_SUPPORT,e.get(Us.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof Jr?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return Us}},_oe=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,Soe=class extends Wt{constructor(e=!1,t=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Yd.replace(/\D+/g,"")},uniforms:{inputBuffer:new we(null),threshold:new we(0),smoothing:new we(1),range:new we(null)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:_oe,vertexShader:Ym}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return this.luminanceRange!==null}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){e!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},Aoe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,hB={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2},Eoe=class extends Wt{constructor(e=null){super({name:"MaskMaterial",uniforms:{maskTexture:new we(e),inputBuffer:new we(null),strength:new we(1)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:Aoe,vertexShader:Ym}),this.toneMapped=!1,this.setColorChannel(cB.RED),this.setMaskFunction(hB.DISCARD)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==na&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return this.defines.INVERTED!==void 0}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},Coe=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Moe="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Toe=class extends Wt{constructor(e=new Q,t=new Q){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new we(null),searchTexture:new we(null),areaTexture:new we(null),resolution:new we(t),texelSize:new we(e)},blending:ir,depthWrite:!1,depthTest:!1,fragmentShader:Coe,vertexShader:Moe}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},Poe=new Sh,ml=null;function Doe(){if(ml===null){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);ml=new Qe,ml.setAttribute!==void 0?(ml.setAttribute("position",new ht(e,3)),ml.setAttribute("uv",new ht(t,2))):(ml.addAttribute("position",new ht(e,3)),ml.addAttribute("uv",new ht(t,2)))}return ml}var Aa=class{constructor(e="Pass",t=new Vo,i=Poe){this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();t!==null&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new tr(Doe(),e),t.frustumCulled=!1,this.scene===null&&(this.scene=new Vo),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=il){}render(e,t,i,r,a){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Vo||t===this.renderer)continue;this[e].dispose()}}}},yS=class extends Aa{constructor(e,t=!0){super("CopyPass"),this.fullscreenMaterial=new moe,this.needsSwap=!1,this.renderTarget=e,e===void 0&&(this.renderTarget=new Ht(1,1,{minFilter:bt,magFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,r,a){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==na?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===yt&&(this.renderTarget.texture.encoding=yt))}},Ooe=class extends Aa{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,r,a){let s=e.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},hw=new tt,mC=class extends Aa{constructor(e=!0,t=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,r,a){let s=this.overrideClearColor,n=this.overrideClearAlpha,o=e.getClearAlpha(),l=s!==null,c=n>=0;l?(hw.copy(e.getClearColor(hw)),e.setClearColor(s,c?n:o)):c&&e.setClearAlpha(n),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(hw,o):c&&e.setClearAlpha(o)}},gl=-1,za=class extends Hr{constructor(e,t=gl,i=gl,r=1){super(),this.resizable=e,this.base=new Q(1,1),this.preferred=new Q(t,i),this.target=this.preferred,this.s=r}get width(){let{base:e,preferred:t,scale:i}=this,r;return t.width!==gl?r=t.width:t.height!==gl?r=Math.round(t.height*(e.width/Math.max(e.height,1))):r=Math.round(e.width*i),r}set width(e){this.preferredWidth=e}get height(){let{base:e,preferred:t,scale:i}=this,r;return t.height!==gl?r=t.height:t.width!==gl?r=Math.round(t.width/Math.max(e.width/Math.max(e.height,1),1)):r=Math.round(e.height*i),r}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(gl),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return gl}},uw=!1,XO=class{constructor(e=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=t=>{if(t.isMesh){let i;if(t.material.flatShading)switch(t.material.side){case La:i=this.materialsFlatShadedDoubleSide;break;case Er:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(t.material.side){case La:i=this.materialsDoubleSide;break;case Er:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(t,t.material),t.isSkinnedMesh?t.material=i[2]:t.isInstancedMesh?t.material=i[1]:t.material=i[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,e!==null){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=on;t[2].skinning=!0,this.materialsBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=Er,r}),this.materialsDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.side=La,r}),this.materialsFlatShaded=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=Er,r}),this.materialsFlatShadedDoubleSide=t.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},e.uniforms),r.flatShading=!0,r.side=La,r})}}render(e,t,i){let r=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,uw){let a=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let s of a)s[0].material=s[1];this.meshCount!==a.size&&a.clear()}else{let a=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=a}e.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return uw}static set workaroundEnabled(e){uw=e}},Ioe=class extends Aa{constructor(e,t,i=null){super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new mC,this.overrideMaterialManager=i===null?null:new XO(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return e!==null?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;e!==null?t!==null?t.setMaterial(e):this.overrideMaterialManager=new XO(e):t!==null&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,r,a){let s=this.scene,n=this.camera,o=this.selection,l=n.layers.mask,c=s.background,u=e.shadowMap.autoUpdate,h=this.renderToScreen?null:t;o!==null&&n.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(e,s,n):e.render(s,n),n.layers.mask=l,s.background=c,e.shadowMap.autoUpdate=u}},YO=class extends Aa{constructor(e,t,{resolutionScale:i=1,width:r=za.AUTO_SIZE,height:a=za.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Ioe(e,t,new Qk({depthPacking:kk}));let n=this.renderPass;n.skipShadowMapUpdate=!0,n.ignoreBackground=!0;let o=n.getClearPass();o.overrideClearColor=new tt(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Ht(1,1,{minFilter:Gt,magFilter:Gt,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new za(this,r,a,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,a){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,s)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},kt={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},Roe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",Loe="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",koe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",zoe="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Noe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Boe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",joe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",Foe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",Uoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",Voe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",Goe="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Hoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",Woe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",qoe="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Xoe="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Yoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",Qoe="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Zoe="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",Koe=new Map([[kt.SKIP,null],[kt.ADD,Roe],[kt.ALPHA,Loe],[kt.AVERAGE,koe],[kt.COLOR_BURN,zoe],[kt.COLOR_DODGE,Noe],[kt.DARKEN,Boe],[kt.DIFFERENCE,joe],[kt.EXCLUSION,Foe],[kt.LIGHTEN,Uoe],[kt.MULTIPLY,Voe],[kt.DIVIDE,Goe],[kt.NEGATION,Hoe],[kt.NORMAL,Woe],[kt.OVERLAY,qoe],[kt.REFLECT,Xoe],[kt.SCREEN,Yoe],[kt.SOFT_LIGHT,Qoe],[kt.SUBTRACT,Zoe]]),$oe=class extends Hr{constructor(e,t=1){super(),this.f=e,this.opacity=new we(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return Koe.get(this.blendFunction)}},Xn={NONE:0,DEPTH:1,CONVOLUTION:2},ro=class extends Hr{constructor(e,t,{attributes:i=Xn.NONE,blendFunction:r=kt.SCREEN,defines:a=new Map,uniforms:s=new Map,extensions:n=null,vertexShader:o=null}={}){super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=a,this.uniforms=s,this.extensions=n,this.blendMode=new $oe(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e,t=il){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(t!==null&&typeof t.dispose=="function"){if(t instanceof Vo||t===this.renderer)continue;this[e].dispose()}}}};function QO(e,t,i){for(let r of t){let a="$1"+e+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let n of i.entries())n[1]!==null&&i.set(n[0],n[1].replace(s,a))}}function Joe(e,t,i,r,a,s,n){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,p=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",t);else if(c&&n&Xn.CONVOLUTION)console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);else{let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=vS.Section;if(c){let v=`	${e}MainUv(UV);
`;i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+v),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let v=`	${e}MainSupport(`;v+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+v),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(y=>y[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(f)].map(y=>y[1]))}h=h.concat([...o.get("fragment").matchAll(f)].map(v=>v[1])),h=h.concat([...t.defines.keys()].map(v=>v.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...t.uniforms.keys()]),t.uniforms.forEach((v,y)=>s.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),t.defines.forEach((v,y)=>a.set(e+y.charAt(0).toUpperCase()+y.slice(1),v)),QO(e,h,a),QO(e,h,o);let g=t.blendMode;if(r.set(g.blendFunction,g),l){let v=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,y=`${e}MainImage(color0, UV, `;n&Xn.DEPTH&&v.test(o.get("fragment"))&&(y+="depth, ",p=!0),y+=`color1);
	`;let x=e+"BlendOpacity";s.set(x,g.opacity),y+=`color0 = blend${g.blendFunction}(color0, color1, ${x});

	`,i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+y),y=`uniform float ${x};

`,i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+y)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:p}}var Uy=class extends Aa{constructor(e,...t){super("EffectPass"),this.fullscreenMaterial=new vS(null,null,null,e),this.effects=t.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=vS.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,a=new Map,s=new Set,n=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===kt.SKIP)l|=d.getAttributes()&Xn.DEPTH;else if(l&d.getAttributes()&Xn.CONVOLUTION)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let p="e"+n++,f=Joe(p,d,t,i,r,a,l);if(o+=f.varyings.length,c=c||f.transformedUv,u=u||f.readDepth,d.extensions!==null)for(let m of d.extensions)s.add(m)}let h=/\bblend\b/g;for(let d of i.values()){let p=d.getShaderCode().replace(h,`blend${d.blendFunction}`);t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+p+`
`)}l&Xn.DEPTH?(u&&t.set(e.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+t.get(e.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(t.set(e.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+t.get(e.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),t.forEach((d,p,f)=>f.set(p,d.trim().replace(/^#/,`
#`))),this.uniformCount=a.size,this.varyingCount=o,this.skipRendering=n===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(s).setUniforms(a).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e,t=il){this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,r,a){for(let s of this.effects)s.update(e,t,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,s.time+=r,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let r of this.effects)r.initialize(e,t,i),r.addEventListener("change",a=>this.handleEvent(a));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==na&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){switch(e.type){case"change":this.recompile();break}}},ele=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],gC=class extends Aa{constructor({resolutionScale:e=.5,width:t=za.AUTO_SIZE,height:i=za.AUTO_SIZE,kernelSize:r=U1.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Ht(1,1,{minFilter:bt,magFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let a=this.resolution=new za(this,t,i,e);a.addEventListener("change",s=>this.setSize(a.baseWidth,a.baseHeight)),this.blurMaterial=new qO,this.ditheredBlurMaterial=new qO,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,r,a){let s=this.scene,n=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=ele[this.kernelSize],u=this.blurMaterial,h=t,d,p;for(this.fullscreenMaterial=u,d=0,p=c.length-1;d<p;++d){let f=d&1?l:o;u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(f),e.render(s,n),h=f}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,a=i.height;this.renderTargetA.setSize(r,a),this.renderTargetB.setSize(r,a),this.blurMaterial.setSize(r,a),this.ditheredBlurMaterial.setSize(r,a)}initialize(e,t,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==na?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===yt&&(this.renderTargetA.texture.encoding=yt,this.renderTargetB.texture.encoding=yt))}static get AUTO_SIZE(){return za.AUTO_SIZE}},tle=class extends Aa{constructor({width:e=za.AUTO_SIZE,height:t=za.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:a}={}){super("LuminancePass"),this.fullscreenMaterial=new Soe(a,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Ht(1,1,{minFilter:bt,magFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new za(this,e,t);s.addEventListener("change",n=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,r,a){let s=this.fullscreenMaterial;s.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){i!==void 0&&i!==na&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ile=class extends Aa{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new mC(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,r,a){let s=e.getContext(),n=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;n.color.setMask(!1),n.depth.setMask(!1),n.color.setLocked(!0),n.depth.setLocked(!0),n.stencil.setTest(!0),n.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.stencil.setFunc(s.ALWAYS,u,4294967295),n.stencil.setClear(h),n.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),n.color.setLocked(!1),n.depth.setLocked(!1),n.stencil.setLocked(!1),n.stencil.setFunc(s.EQUAL,1,4294967295),n.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.stencil.setLocked(!0)}},Qs=class extends Aa{constructor(e,t="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let t=this.fullscreenMaterial.uniforms;t!==void 0&&t[e]!==void 0&&(this.inputBufferUniform=t[e])}}render(e,t,i,r,a){this.inputBufferUniform!==null&&t!==null&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){i!==void 0&&i!==na&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},dw=1/1e3,rle=1e3,ale=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&document.hidden!==void 0&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*dw}getFixedDelta(){return this.fixedDelta*dw}setFixedDelta(e){return this.fixedDelta=e*rle,this}getElapsed(){return this.elapsed*dw}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=e!==void 0?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},U1={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},sle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,nle=class extends ro{constructor({blendFunction:e=kt.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:a=1,width:s=za.AUTO_SIZE,height:n=za.AUTO_SIZE,kernelSize:o=U1.LARGE}={}){super("BloomEffect",sle,{blendFunction:e,uniforms:new Map([["map",new we(null)],["intensity",new we(a)]])}),this.renderTarget=new Ht(1,1,{minFilter:bt,magFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new tle({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new gC({resolutionScale:r,width:s,height:n,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,r),this.blurPass.render(e,r,r)):this.blurPass.render(e,t,r)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),i!==void 0&&(this.renderTarget.texture.type=i,e.outputEncoding===yt&&(this.renderTarget.texture.encoding=yt))}},ole="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",lle=class extends ro{constructor({blendFunction:e=kt.NORMAL,brightness:t=0,contrast:i=0}={}){super("BrightnessContrastEffect",ole,{blendFunction:e,uniforms:new Map([["brightness",new we(t)],["contrast",new we(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},cle="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",hle=class extends ro{constructor(e=kt.NORMAL){super("ColorAverageEffect",cle,{blendFunction:e})}},ule="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",dle="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",ple=class extends ro{constructor({blendFunction:e=kt.NORMAL,offset:t=new Q(.001,5e-4)}={}){super("ChromaticAberrationEffect",ule,{vertexShader:dle,blendFunction:e,attributes:Xn.CONVOLUTION,uniforms:new Map([["offset",new we(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},fle=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,mle=class extends ro{constructor(e,{blendFunction:t=kt.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:a=0,focalLength:s=.1,focusRange:n=s,bokehScale:o=1,width:l=za.AUTO_SIZE,height:c=za.AUTO_SIZE}={}){super("DepthOfFieldEffect",fle,{blendFunction:t,attributes:Xn.DEPTH,uniforms:new Map([["nearColorBuffer",new we(null)],["farColorBuffer",new we(null)],["nearCoCBuffer",new we(null)],["scale",new we(1)]])}),this.camera=e,this.renderTarget=new Ht(1,1,{minFilter:bt,magFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new Qs(new uoe(e));let u=this.cocMaterial;u.focusDistance=a,u.focusRange=n,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new gC({kernelSize:U1.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",p=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new Qs(new Eoe(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=hB.MULTIPLY,d.colorChannel=cB.GREEN,this.bokehNearBasePass=new Qs(new Dv(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new Qs(new Dv(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new Qs(new Dv(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new Qs(new Dv(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera,i=t.position.distanceTo(e);return gS(-i,t.near,t.far)}setDepthTexture(e,t=il){this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let r=this.renderTarget,a=this.renderTargetCoC,s=this.renderTargetCoCBlurred,n=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(e,null,a),this.blurPass.render(e,a,s),this.maskPass.render(e,t,n),this.bokehFarBasePass.render(e,n,r),this.bokehFarFillPass.render(e,r,this.renderTargetFar),this.bokehNearBasePass.render(e,t,r),this.bokehNearFillPass.render(e,r,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let r=i.width,a=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(n=>n.setSize(e,t)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(n=>n.setSize(r,a)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(n=>n.fullscreenMaterial.setSize(r,a))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(e,t,i)),this.blurPass.initialize(e,t,na),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===yt&&(this.renderTarget.texture.encoding=yt,this.renderTargetNear.texture.encoding=yt,this.renderTargetFar.texture.encoding=yt,this.renderTargetMasked.texture.encoding=yt))}};new P;new Se;var gle="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",vle=class extends ro{constructor({blendFunction:e=kt.NORMAL,hue:t=0,saturation:i=0}={}){super("HueSaturationEffect",gle,{blendFunction:e,uniforms:new Map([["hue",new we(new P)],["saturation",new we(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((e.x*3-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}};new tt;var yle=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,xle=class extends ro{constructor({blendFunction:e=kt.SCREEN,premultiply:t=!1}={}){super("NoiseEffect",yle,{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}},ble="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",wle=class extends ro{constructor(e=30){super("PixelationEffect",ble,{uniforms:new Map([["active",new we(!1)],["d",new we(new Q)]])}),this.resolution=new Q,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new P;new P;var ZO="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",KO="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",_le="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",Sle="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",kc={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},uB=class extends ro{constructor({preset:e=kc.MEDIUM,edgeDetectionMode:t=F1.COLOR,predicationMode:i=yoe.DISABLED}={}){super("SMAAEffect",_le,{vertexShader:Sle,blendFunction:kt.NORMAL,attributes:Xn.CONVOLUTION|Xn.DEPTH,uniforms:new Map([["weightMap",new we(null)]])});let r,a;arguments.length>1&&(r=arguments[0],a=arguments[1],arguments.length>2&&(e=arguments[2]),arguments.length>3&&(t=arguments[3])),this.renderTargetEdges=new Ht(1,1,{minFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new mC(!0,!1,!1),this.clearPass.overrideClearColor=new tt(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new Qs(new xoe),this.edgeDetectionMaterial.edgeDetectionMode=t,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new Qs(new Toe);let s=new f5;s.onLoad=()=>{let n=new Si(r);n.name="SMAA.Search",n.magFilter=Gt,n.minFilter=Gt,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!0,this.weightsMaterial.searchTexture=n;let o=new Si(a);o.name="SMAA.Area",o.magFilter=bt,o.minFilter=bt,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&a!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,a=new Image,r.addEventListener("load",()=>s.itemEnd("search")),a.addEventListener("load",()=>s.itemEnd("area")),r.src=ZO,a.src=KO),this.applyPreset(e)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case kc.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case kc.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case kc.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case kc.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(e,t=il){this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;e!==null&&t!==null&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return ZO}static get areaImageDataURL(){return KO}},Ale=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,Ov={DEFAULT:0,ESKIL:1},Ele=class extends ro{constructor({blendFunction:e=kt.NORMAL,technique:t=Ov.DEFAULT,eskil:i=!1,offset:r=.5,darkness:a=.5}={}){super("VignetteEffect",Ale,{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new we(r)],["darkness",new we(a)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===Ov.ESKIL}set eskil(e){this.technique=e?Ov.ESKIL:Ov.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}},rl=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=kt.NORMAL}},Cle=class extends rl{constructor(){super(nle),this.blendFunction=kt.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},Mle=class extends rl{constructor(){super(lle)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},Tle=class extends rl{constructor(){super(ple),this.effect.offset=new Q(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},Ple=class extends rl{constructor(){super(hle)}},Dle=class extends rl{constructor(){super(vle),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},Ole=class extends rl{constructor(){super(xle),this.blendFunction=kt.OVERLAY}},Ile=class extends rl{constructor(){super(Ele)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},Rle=class extends rl{constructor(e){super(mle,e)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=e}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}},Lle=class extends rl{constructor(){super(wle)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},kle=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,zle=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,Nle=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Ble=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,xS=class extends Wt{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new we(null)},blending:ir,depthWrite:!1,depthTest:!1,vertexShader:Nle,fragmentShader:Ble})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},jle=class extends Aa{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new xS,this.resolutionVector=new Q,this.resolveMaterial=new Wt({name:"TAAResolveMaterial",uniforms:{inputBuffer:new we(null),historyBuffer:new we(null),velocityBuffer:new we(null),depthBuffer:new we(null),resolution:new we(new Q)},blending:ir,depthWrite:!1,depthTest:!1,vertexShader:kle,fragmentShader:zle}),this.historyRenderTarget=new Ht(1024,1024,{minFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Ht(1024,1024,{minFilter:bt,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},Fle=class extends Aa{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new YO(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new xS,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new xS,this.depthPass=new YO(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let r=this.camera.layers.mask,a=e;a.setRenderTarget(a.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],a.clear(),a.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),a.shadowMap.needsUpdate=!1,a.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(s),e.render(this.splineScene,this.camera),this.camera.layers.mask=r}},$O=new Vo,Ule=new Wt({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),bS=class extends Aa{constructor(e,t,i){super("OpaquePass",t??$O,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}set splatViewer(e){this._splatViewer=e}get splatViewer(){return this._splatViewer}setCamera(e){this.camera=e}setScene(e){this.scene=e??$O}getScene(){return this.scene}render(e,t){var r;this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse(a=>{a.layers.isEnabled(3)&&a instanceof ba&&(this.originalMaterials.set(a.id,a.material),a.material=Ule)}),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;if(e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),((r=this._splatViewer)==null?void 0:r.splatRenderingInitialized)===!0){let a=e.autoClear;e.autoClear=!1,e.render(this.scene,this.camera),this._splatViewer.update(),e.render(this._splatViewer.splatMesh,this.camera),e.autoClear=a}else e.render(this.scene,this.camera);this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach((a,s)=>{let n=this.scene.getObjectById(s);n&&(n.material=a)})}},Vle=class{constructor(e,{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:a=0}={}){this.renderer=e,this.helperStartIndex=0,this.copyPass=new yS,this.depthTexture=null,this.timer=new ale,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,a,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,a,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,a,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){var t;if(this.renderer=e,e!==null){let i=e.getSize(new Q),r=((t=e.getContext().getContextAttributes())==null?void 0:t.alpha)??!1,a=this.inputBuffer.texture[0].type;a===na&&e.outputEncoding===yt&&(this.inputBuffer.texture[0].encoding=yt,this.outputBuffer.texture[0].encoding=yt,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(i.width,i.height,!1);for(let s of this.passes)s.initialize(e,r,a)}}replaceRenderer(e,t=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(e),t&&r!==null&&(r.removeChild(i.domElement),r.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new Td(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(e.format=fh,e.type=Jc):e.type=Bo,e}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,r,a,s){let n=this.renderer,o=n===null?new Q:n.getDrawingBufferSize(new Q),l={minFilter:bt,magFilter:bt,wrapS:pi,wrapT:pi,stencilBuffer:t,depthBuffer:e},c;return r>0?(c=new Ht(o.width,o.height,l),c.samples=r):(a?(c=new TV(o.width,o.height,2,l),c.texture[1].type=ph):c=new Ht(o.width,o.height,l),c.depthTexture=new Td(2048,2048),c.depthTexture.type=er),i===na&&n!==null&&n.outputEncoding===yt&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=yt):c.texture.encoding=yt),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${a} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${a}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(e,t){var o;let i=this.passes,r=this.renderer,a=r.getDrawingBufferSize(new Q),s=((o=r.getContext().getContextAttributes())==null?void 0:o.alpha)??!1,n;if(e.MRTCompatible&&(n=this.inputBuffer.texture[0].type),e.MRTCompatible||(n=this.inputBuffer.texture.type),e.setRenderer(r),e.setSize(a.width,a.height),e.initialize(r,s,n),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),t!==void 0?i.splice(t,0,e):i.push(e),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),e.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let l=this.createDepthTexture();for(e of i)e.setDepthTexture(l)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(i!==-1&&t.splice(i,1).length>0){if(this.depthTexture!==null){let r=(a,s)=>a||s.needsDepthTexture;t.reduce(r,!1)||(e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;this.deleteDepthTexture(),e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t=this.renderer,i=this.copyPass,r=this.inputBuffer,a=this.outputBuffer,s=this.inputBufferSingle,n=this.outputBufferSingle,o=!1,l,c,u,h;e===void 0&&(e=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(t,r,a,e,o):d.render(t,s,n,e,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=t.getContext(),c=t.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(t,r,a,e,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=a,s=n,a=u,n=h),d instanceof ile?o=!0:d instanceof Ooe&&(o=!1))}setSize(e,t,i){let r=this.renderer;if(this._width=e,this._height=t,e===void 0||t===void 0){let s=r.getSize(new Q);e=s.width,t=s.height}r.setSize(e,t,i);let a=r.getDrawingBufferSize(new Q);this.inputBuffer.setSize(a.width,a.height),this.outputBuffer.setSize(a.width,a.height),this.inputBufferSingle.setSize(a.width,a.height),this.outputBufferSingle.setSize(a.width,a.height);for(let s of this.passes)s.setSize(a.width,a.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Gle=new Wt({name:"CombineMaterial",uniforms:{inputBufferA:new we(null),inputBufferB:new we(null)},blending:ir,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),Hle=class extends Aa{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=Gle,this.helperPass=new bS(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new bS(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new uB({preset:kc.LOW,edgeDetectionMode:F1.COLOR});this.effectPass=new Uy(this.camera,t),this.rt=new Ht(10,10,{minFilter:bt,magFilter:bt,wrapS:pi,wrapT:pi,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let r=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(r),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Wle=`#define GLSLIFY 1
#include <skinning_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,qle=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,Xle=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,Yle=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,Qle=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,Zle=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,Hp=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Kle=new Wt({vertexShader:Wle,fragmentShader:qle}),Iv=new Wt({vertexShader:Qle,fragmentShader:Zle,uniforms:{texture_ao_lrez:new we(null),texture_depth_lrez:new we(null),texture_depth_hrez:new we(null),near:new we(null),far:new we(null)}}),$le=class extends Aa{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Ht(i,r,{type:er,depthTexture:new Td(i,r),minFilter:bt,magFilter:bt}),this.depthBufferHighRes=new Ht(i,r,{depthTexture:new Td(i,r)}),this.aoBuffer=new Ht(i,r,{minFilter:bt,magFilter:bt}),this.splineScene=e,this.splineCamera=t;let a=new Float32Array(Hp.length*2);for(let n=0;n<Hp.length;n++){let o=n*2;a[o+0]=Hp[n][0],a[o+1]=Hp[n][1]}this.blueNoiseInDiskTexture=new As(a,Hp.length,1,q0,er),this.blueNoiseInDiskTexture.wrapS=No,this.blueNoiseInDiskTexture.wrapT=No,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Wt({vertexShader:Xle,fragmentShader:Yle,uniforms:{near:new we(null),far:new we(null),fov:new we(null),proj_info:new we(new dt),is_ortho:new we(!1),resolution:new we(new Q),radius_of_influence:new we(8),radius_in_screen_space:new we(1),exponent:new we(1),ao_color:new we(new P),bias:new we(.5),texture_depth:new we(null),texture_normals:new we(null),texture_blue_noise:new we(null),texture_blue_noise_in_disk:new we(this.blueNoiseInDiskTexture),frame_index:new we(0),fog_enabled:new we(!1),fog_near:new we(1),fog_far:new we(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Ht(i,r,{minFilter:bt,magFilter:bt,wrapS:pi,wrapT:pi,depthBuffer:!1,type:er});let s=new uB({preset:kc.ULTRA,edgeDetectionMode:F1.COLOR});this.effectPass=new Uy(this.camera,s)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,r=e*i,a=t*i;this.gBuffer.setSize(r,a),this.aoBuffer.setSize(r,a),this.hbaoMaterial.uniforms.resolution.value.set(r,a),this.aaBuffer.setSize(r,a),this.effectPass.setSize(r,a)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}render(e,t,i){this.splineScene.overrideMaterial=Kle;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let a=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/a[0],n=2/a[5],o=-(1-a[8])/a[0],l=-(1+a[9])/a[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,n,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let a=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/a[0],n=2/a[5],o=-(1+a[12])/a[0],l=-(1-a[13])/a[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,n,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/n),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Iv,Iv.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Iv.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Iv.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Jle=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ece=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,tce=class extends Qs{constructor(){super(new Wt({vertexShader:Jle,fragmentShader:ece,uniforms:{tInput:new we(null),tMap:new we(null),uResolution:new we(new Q),uSize:new we(new Q),uCoords:new we(new Q),uScale:new we(1),uSceneColor:new we(new tt(16711680)),uDPR:new we(1),uCurrent:new we(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},ice=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,rce=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,ace=[],sce=class extends Qs{constructor(){super(new Wt({vertexShader:ice,fragmentShader:rce,uniforms:{toScene:new we(null),fromScene:new we(null),uResolution:new we(new Q),uDPR:new we(1),mixRatio:new we(0),threshold:new we(.1),useTexture:new we(0),tMixTexture:{value:ace[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},nce=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,oce=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
	gl_FragColor.a = 1.0;
}
`,lce=class extends Qs{constructor(){super(new Wt({vertexShader:nce,fragmentShader:oce,uniforms:{inputBuffer:new we(null),blurredInputBuffer:new we(null),overlay:new we(null),uResolution:new we(new Q),uDPR:new we(1),blurIntensity:new we(0)}})),this._blurEnabled=!1,this.blurTarget=new Ht(1,1,{minFilter:bt,magFilter:bt,wrapS:pi,wrapT:pi}),this.blurPass=new gC({width:window.innerWidth,height:window.innerHeight,kernelSize:U1.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t,i=1){this.uniforms.uResolution.value.set(e,t).divideScalar(i),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let i=t.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(e,t,i,r,a){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,r,a)),super.render(e,t,i,r,a)}};function JO(e,t){return t&&t.enabled&&e.push(t.effect),e}var cce=e=>Object.values(kt).includes(e)?e:kt.NORMAL,hce=class extends Hr{constructor(e){super(),this.postprocessingState=Ey.defaultData,this._scene=new Vo,this._camera=new aa,this.effects=new Map,this.blueNoiseTexture=new As,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new bq,this.renderer=e,this.debug=!1,this.effects.set("bloom",new Cle),this.effects.set("chromaticAberration",new Tle),this.effects.set("vignette",new Ile),this.effects.set("noise",new Ole),this.effects.set("colorAverage",new Ple),this.effects.set("hueSaturation",new Dle),this.effects.set("brightnessContrast",new Mle),this.effects.set("depthOfField",new Rle),this.effects.set("pixelation",new Lle),this.effectComposer=new Vle(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new bS(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new Fle(this.scene,this.camera,this.renderer),this.aoPass=new $le(this.scene,this.camera),this.taaPass=new jle,this.taaPass.renderToScreen=!1,this.helperPass=new Hle(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new tce,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new lce,this.uiOverlayPass.enabled=!1,this.sceneTransitionPass=new sce,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){e!==void 0?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),this.aoPass.setCamera(e),this.helperPass.setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];if(i.enabled===!0&&!e&&this._renderToScreen){i.renderToScreen=!0,e=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new As(e,128,128),this.blueNoiseTexture.wrapS=No,this.blueNoiseTexture.wrapT=No,this.blueNoiseTexture.minFilter=Gt,this.blueNoiseTexture.magFilter=Gt,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,r,a,s,n,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=a,this.aoPass.fogNear=s,this.aoPass.fogFar=n,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t;if((e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let i=[this.effects.get("pixelation")].reduce(JO,[]);i.length>0&&(this.uvEffectPass=new Uy(this.camera,...i),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let r=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(JO,[]);r.length>0&&(this.effectPass=new Uy(this.camera,...r),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass))}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new Q;this.renderer.getDrawingBufferSize(e),this._rt=new Ht(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:No,wrapT:No}),this._rt.samples=0,this._savePass=new yS(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new yS(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(e===!0?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(e!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,r=!1;t!==this.postprocessingState.enabled&&(r=!0);for(let a of Object.entries(i)){let s=a[1],n=this.effects.get(a[0]);if(n){n.enabled!==s.enabled&&(r=!0),n.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?n.blendFunction=cce(l):n[o]=l}}this.postprocessingState=e,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,r){e instanceof dt?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,r),this.effectComposer.outputBuffer.scissor.set(e,t,i,r));let a=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(a),this.effectComposer.outputBuffer.scissor.multiplyScalar(a),this.renderer.setScissor(e,t,i,r)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,r){e instanceof dt?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,r),this.effectComposer.outputBuffer.viewport.set(e,t,i,r))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(e*r,t*r)}}dispose(){var e,t;(e=this.uvEffectPass)==null||e.dispose(),(t=this.effectPass)==null||t.dispose(),this.effectComposer.dispose()}},uce=e=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${e};
const int gShadowSamples = ${e};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,dce=xt.lights_fragment_begin,pce=xt.shadowmask_pars_fragment,e4=null,fce=e=>{switch(e){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},mce=(e="medium")=>{if(e4===e)return!1;e4=e;let t=fce(e);xt.shadowmap_pars_fragment=uce(t);let i=dce.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),xt.lights_fragment_begin=i;let r=pce.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),xt.shadowmask_pars_fragment=r,!0},gce=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;

void main()
{
vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(position, 1.0));
}
`,vce=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,pw=new Wt({vertexShader:gce,fragmentShader:vce,uniforms:{depthContrast:{value:1}}}),t4=new Si,yce=class extends Zk{constructor(e){super(e),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Q,this.pipeline=new hce(this),this.dummyCamera=new aa,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(a=!0,s=!0,n=!0)=>{let o=this.getContext(),l=0;a&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),n&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.autoClear=!1;let t=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=iE,this.dummyCamera.matrixAutoUpdate=!1;let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(a){console.warn(a)}this.setPixelRatio=a=>{this._pixelRatio!==a&&(this._pixelRatio=a,t(a))},this.setSize=(a,s,n=!0)=>{var o,l;(this.viewportWidth!==a||this.viewportHeight!==s)&&(this.viewportWidth=a,this.viewportHeight=s,i(a,s,n),(o=this.normalRenderTarget)==null||o.setSize(a*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(a,s),(l=this.transmissionDepthTarget)==null||l.setSize(a*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(a,s,n))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Ht(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:bt,magFilter:bt,wrapS:pi,wrapT:pi,depthBuffer:!1}))}_resizeTransmission(e,t){var i,r;(i=this.transmissionRenderTarget)==null||i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),(r=this.aoRenderTarget)==null||r.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return at.transmissionLod.value===1}set hdTransmission(e){at.transmissionLod.value=e===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Ht(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:Cd,magFilter:bt,wrapS:pi,wrapT:pi,depthBuffer:!1}),this.transmissionDepthTarget=new Ht(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:Gt,magFilter:Gt,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Ht(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:Gt,magFilter:Gt,type:er,depthTexture:new Td(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof aa?pw.uniforms.depthContrast.value=(i.far-i.near)/1e4:pw.uniforms.depthContrast.value=1,t.overrideMaterial=pw,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?DS:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(e,t,i=1){this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let r=t.height,a=t.width,s=this.viewportWidth/this.viewportHeight;a<r?a=r*s:r=a/s,this.dummyCamera.setViewplaneSize(a,r);for(let n=0;n<i;n++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t,{sceneHelpers:i=void 0,sceneHelpersOnTop:r=void 0,overrideTransmission:a=void 0,overrideNormal:s=void 0}={}){var d;let n=e instanceof SC?e.activePage:e,o=n.visible;n.visible=!0;let l=n.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(n.bgColor,n.bgColor.a),n.penumbraSizeArray.forEach((p,f)=>{at.penumbraSize.value[f]=p}),at.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?at.resolution.value.set(this.resolution.x,this.resolution.y):at.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(at.normalRenderTarget.value=s,at.normalRenderTargetDepth.value=t4):l.needsNormal()&&(this.createNormalRenderTarget(),at.normalRenderTarget.value=this.normalRenderTarget.texture,at.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,n,t));let c=n.data.ao,u=c.occlusion;u&&(this.createAORenderTarget(),at.aoRenderTarget.value=this.aoRenderTarget.texture),at.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,n.aoColor,n.fog!==null,n.backupFog.near,n.backupFog.far,c.aoFullRes),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&((d=n.uiCanvas)!=null&&d.enabled)&&n.uiCanvas.texture&&n.uiCanvas.texture.image.width>0?((n.uiCanvas.width!==this.viewportWidth||n.uiCanvas.height!==this.viewportHeight)&&n.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight}),n.uiCanvas.render(),this.pipeline.uiOverlayPass.uiCanvas=n.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(this.domElement.width,this.domElement.height,window.devicePixelRatio),this.pipeline.updateRenderToScreen()):(this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen());let h=!1;if(a!==void 0)at.transmissionRenderTarget.value=a,at.transmissionRenderTargetDepth.value=t4,this.pipeline.setTransmissionPassEnabled(!1);else{let p=l.needsTransmission();p&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),at.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,at.aspectRatio.value=Mse(this.viewportWidth,this.viewportHeight),at.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(p)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=n,this.pipeline.camera=t,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==n.postprocessing&&(this.pipeline.updatePostprocessing(n.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),n.overrideMaterial=l.wireframeState?DS:null,this.pipeline.render(),at.frameIndex.value=(at.frameIndex.value+1)%16,t instanceof aa&&t.copyHistory(),n.visible=o}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,r,a,s;this._superDispose(),this.pipeline.dispose(),(e=this.aoRenderTarget)==null||e.dispose(),(t=this.transmissionRenderTarget)==null||t.dispose(),(i=this.transmissionDepthTarget)==null||i.dispose(),(r=this.normalRenderTarget)==null||r.dispose(),(s=(a=this.normalRenderTarget)==null?void 0:a.depthTexture)==null||s.dispose()}},dB=class extends Wm(zq){constructor(e,t=15,i=10066329){super(e,t,i),this.object=e,this.added=!1,this.name=`DirectionalLightHelper: ${e.uuid}`}raycast(e,t){qm(this.object,dB.geometryHelper,e,t)}},pB=class extends Wm(kq){constructor(e,t=15,i=6710886){super(e,t,i),this.object=e,this.name=`PointLightHelper: ${e.uuid}`}raycast(e,t){qm(this.object,pB.geometryHelper,e,t)}},wS=class extends Wm(Lq){constructor(e,t=6710886){super(e,t),this.object=e,this.name=`SpotLightHelper: ${e.uuid}`}raycast(e,t){qm(this.object,wS.geometryHelper,e,t)}update(){if(this.object!==void 0){let e=wS._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let a=0,s=this.cone.material.length;a<s;a++)this.cone.material[a].color.set(r);else this.cone.material.color.set(r)}}},fB=wS;fB._vector=new P;function xce(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}var mB=class extends fC(xq,dB){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let a=new ay(this.shadow.camera);a.visible=!1,this.gizmos.shadowmap=a}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof ay&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=e.depth!==void 0&&e.depth!==this.shadow.camera.far||e.size!==void 0&&e.size/2!==this.shadow.camera.right;e.size!==void 0&&xce(this,e.size),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},i4=new P,r4=new P,a4=new ut,gB=class extends fC(mq,fB){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Ge.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let a=new ay(this.shadow.camera);a.visible=!1,this.gizmos.shadowmap=a,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof ay&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),r4.setFromMatrixPosition(this.matrixWorld),a4.setFromRotationMatrix(this.matrixWorld),i4.copy(this.up).applyQuaternion(a4).negate().multiplyScalar(this.distance),this.target.position.copy(r4).add(i4),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.angle!==void 0&&(this.angle=e.angle),e.penumbra!==void 0&&(this.penumbra=e.penumbra),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.penumbraSize!==void 0&&t.scene.markPenumbraSizeDirty(),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},Kt;(e=>{function t(){return[1,0,0,0,1,0,0,0,1]}e.identity=t;function i(_,A=e.identity()){for(let E=0,M=_.length;E<M;E++)A[E]=_[E];return A}e.copy=i;function r(_,A,E,M,C,T){return e.setAbcdef(e.identity(),_,A,E,M,C,T)}e.create=r;function a(_,A,E,M,C,T,D){return _[0]=A,_[1]=M,_[2]=T,_[3]=E,_[4]=C,_[5]=D,_}e.setAbcdef=a;function s(_,A){let[E,M,C,T,D,I]=o(_),[O,B,q,F,L,X]=o(A),G=O*E+B*C,U=O*M+B*T,H=q*E+F*C,$=q*M+F*T,Y=L*E+X*C+D,J=L*M+X*T+I;return e.create(G,U,H,$,Y,J)}e.append=s;function n(_,A){let[E,M,C,T,D,I]=o(_),[O,B,q,F,L,X]=o(A),G=E,U=M,H=C,$=T;(O!==1||B!==0||q!==0||F!==1)&&(G=E*O+M*q,U=E*B+M*F,H=C*O+T*q,$=C*B+T*F);let Y=D*O+I*q+L,J=D*B+I*F+X;return e.create(G,U,H,$,Y,J)}e.prepend=n;function o(_){return[_[0],_[3],_[1],_[4],_[2],_[5]]}e.getAbcdef=o;function l(_){let[A,E,M,C,T,D]=e.getAbcdef(_),I=A*C-E*M,O=C/I,B=-E/I,q=-M/I,F=A/I,L=(M*D-C*T)/I,X=-(A*D-E*T)/I;return e.create(O,B,q,F,L,X)}e.invert=l;function c([_,A],E){let[M,C,T,D,I,O]=e.getAbcdef(E);return[M*_+T*A+I,C*_+D*A+O]}e.apply=c;function u(_,A){let[E,M,C,T,D,I]=e.getAbcdef(A),O=1/(E*T+C*-M),[B,q]=_;return[T*O*B+-C*O*q+(I*C-D*T)*O,E*O*q+-M*O*B+(-I*E+D*M)*O]}e.applyInverse=u;function h(_,A,E=A){let[M,C,T,D,I,O]=e.getAbcdef(_);return e.setAbcdef(_,M*A,C*E,T*A,D*E,I*A,O*E),_}e.scale=h;function d(_,A){let E=Math.cos(A),M=Math.sin(A),[C,T,D,I,O,B]=e.getAbcdef(_);return e.setAbcdef(_,C*E-T*M,C*M+T*E,D*E-I*M,D*M+I*E,O*E-B*M,O*M+B*E),_}e.rotate=d;function p(_,A,E){let[M,C]=E,T=e.translate(_,-M,-C);return T=e.rotate(T,A),T=e.translate(T,M,C),T}e.rotateAround=p;function f(_,A,E){let[M,C,T,D,I,O]=e.getAbcdef(_);return e.setAbcdef(_,M,C,T,D,I+A,O+E),_}e.translate=f;function m(_,A,E){let[M,C,T,D]=e.getAbcdef(_);return e.setAbcdef(_,M,C,T,D,A,E),_}e.setTranslate=m;function g(_,A,E){let[M,C,T,D]=e.getAbcdef(_);return e.setAbcdef(_,M,C,T,D,A,E),_}e.setPosition=g;function v(_){let[A,E,M,C]=e.getAbcdef(_),T=Math.sqrt(A*A+E*E),D=Math.sqrt(M*M+C*C);return[T,D]}e.getScale=v;function y(_){let[,,,,A,E]=e.getAbcdef(_);return[A,E]}e.getPosition=y;function x(_,A){return e.decompose(_,A).rotation}e.getRotation=x;function w(_,A){let[E,M,C,T,D,I]=e.getAbcdef(_),O=-Math.atan2(-C,T),B=Math.atan2(M,E),q=Math.abs(O+B),F=0,L=[0,0];q<1e-5||Math.abs(Math.PI*2-q)<1e-5?(F=B,L[0]=L[1]=0):(F=0,L[0]=O,L[1]=B);let X=[Math.sqrt(E*E+M*M),Math.sqrt(C*C+T*T)];return{position:[D+(A[0]*E+A[1]*C)-A[0],I+(A[0]*M+A[1]*T)-A[1]],scale:X,rotation:F,skew:L,pivot:A}}e.decompose=w;function S(_,A,E,M,C=[0,0]){let[T,D]=_,[I,O]=A,[B,q]=M,[F,L]=C,X=Math.cos(E+L)*I,G=Math.sin(E+L)*I,U=-Math.sin(E-F)*O,H=Math.cos(E-F)*O,$=T-(B*X+q*U)+B,Y=D-(B*G+q*H)+q;return e.create(X,G,U,H,$,Y)}e.compose=S})(Kt||(Kt={}));var bce=Math.PI/180;function wce(e,t,i,r,a,s){let n=e-i,o=t-r;return n*n/(a*a)+o*o/(s*s)<=1}function _ce(e){return e*bce}function Sce(e){return{all:e=e||new Map,on:function(t,i){var r=e.get(t);r?r.push(i):e.set(t,[i])},off:function(t,i){var r=e.get(t);r&&(i?r.splice(r.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var r=e.get(t);r&&r.slice().map(function(a){a(i)}),(r=e.get("*"))&&r.slice().map(function(a){a(t,i)})}}}var dr=class{constructor(e,t,i){this.uuid=e,this.data=t,this.localMatrix=Kt.identity(),this.worldMatrix=Kt.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new _S,this._recursiveBBox=new _S,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.emitter=Sce(),this.dpr=i.dpr??1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Kt.append(t.worldMatrix,i)),Kt.applyInverse(e,i)}intersects(e,t,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),r)}intersectsInLocalSpace(e,t,i=!1){let{min:r,max:a}=i?this.recursiveBBox:this.singleBBox;return e>=r[0]&&e<=a[0]&&t>=r[1]&&t<=a[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Kt.compose(this.position,this.scale,_ce(this.rotation),rh.getPivot(this.dataPatched))}updateWorldMatrix(e,t,i){let r=this.parent;t&&r!==null&&r!==void 0&&r.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Kt.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Kt.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return rh.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{e.resetBBoxNeedsUpdateSelf()})}updateTransformState(e){let t=!1;e.position!==void 0&&(t=!0,this.position=e.position),e.rotation!==void 0&&(t=!0,this.rotation=e.rotation),e.scale!==void 0&&(t=!0,this.scale=e.scale),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){e.type===0&&e.props.visible!==void 0&&(this.visible=e.props.visible),this.data=t,this.data=t;let r=e,a=si(e.path,["states","*"]);if(a!==null){if(e.type===0){let[s]=a;if((this==null?void 0:this.stateSelection)===s){let n={...e.props};if(delete n.name,Object.values(e.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=Br.zoom(o,e.path.slice(2));if(l)for(let c in e.props)e.props[c]===void 0&&c in l&&(n[c]=l[c])}}r={...e,props:n,path:e.path.slice(2)}}}}else if(e.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(e.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let n=Br.removeOverridden(e.path,e.props,s);r={...e,props:n}}}this.updateByPatchedOpBase(r,Wc.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)Wc.toOps(this.data,r.data).forEach(a=>{let s=my.replaceProps(a,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,t)});if(e!==null){let r=this.data.states.data(e);r&&(this.dataPatched=Wc.patch(this.data,r),Wc.toOps(this.data,r).forEach(a=>{this.updateByPatchedOp(a,this.dataPatched,t)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){e.name!==void 0&&(this.name=e.name),e.visible!==void 0&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){e.path.length===0&&e.type===0&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors(t=>{t.data.type==="frame2d"&&e(t)})}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors(e=>{e.requestRender()})}clone(e){let t=new dr(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){this.emitter.emit(e.type,{...e,target:e.target??this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof dr&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},Vn=class extends dr{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof Vn&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(t!==!0)for(let i of this.children)i instanceof Vn?i.traverse(e):t=e(i)}intersectsChildren(e,t,i,r=!1,a=[],s=!1){for(let n of this.children){let o=n instanceof Jo;if(n instanceof Vn&&!o&&s&&n.intersectsChildren(e,t,i,r,a,!1),n.intersects(e,t,i,o)&&(a.push(n),r))break}return a}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse(i=>{i.uuid===e&&(t=i)}),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(e=>{e.resetBBoxNeedsUpdateSelf()})}clone(e){let t=new Vn(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Jo=class extends Vn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new Jo(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function Ace(e,t){let[[i,r],[a,s]]=e,[[n,o],[l,c]]=t,u=(i-a)*(o-c)-(r-s)*(n-l);if(u===0)return!1;let h=((i-n)*(o-c)-(r-o)*(n-l))/u,d=-((i-a)*(r-o)-(r-s)*(i-n))/u;return h>=0&&h<=1&&d>=0&&d<=1}var vB=[[-1,1],[-1,-1],[1,-1],[1,1]],s4=(e,t,i)=>{let r=e.getCenter(),a=e.getHalfSize(),s=Kt.append(t,e.worldMatrix);a[0]===0&&a[1]===0?i.push(Kt.apply(r,s)):vB.forEach(n=>{let o=[n[0]*a[0]+r[0],n[1]*a[1]+r[1]];i.push(Kt.apply(o,s))})},_S=class{constructor(){this.matrix=Kt.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e,t=!1){e.updateWorldMatrix(),this.makeEmpty(),Kt.copy(e.worldMatrix,this.matrix);let i=Kt.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t,i=!1){let r=[];i===!0&&e instanceof Vn?e.traverse(a=>{a.visible&&s4(a,t,r)}):s4(e,t,r),this.setFromPoints(r)}getCenter(){let[e,t]=this.min,[i,r]=this.getHalfSize();return Kt.apply([e+i,t+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[r,a,s,n]=Kt.getAbcdef(this.matrix),o=Kt.create(r,a,s,n,i[0],i[1]);this.vertices=vB.map(([l,c])=>Kt.apply([l*e,c*t],o))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Kt.append(t.worldMatrix,i)),Kt.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:r}=this;return e>=i[0]&&e<=r[0]&&t>=i[1]&&t<=r[1]}containsPoint(e){let[t,i]=e,[r,a]=this.min,[s,n]=this.max;return t>=r&&t<=s&&i>=a&&i<=n}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let r=this.edges[t];for(let a=0,s=e.edges.length;a<s;a++){let n=e.edges[a];if(Ace(r,n))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let r=e.vertices[t];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Kt.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new _S;return e.copy(this),e}},yB,Ece=new Promise(e=>{yB=e}),n4=!1,Rv;function Cce(){if(n4)return;if(Rv)return Rv;async function e(){let t=await Xd(()=>import("./ui-8DWtXw2q.js"),__vite__mapDeps([]));yB(t.default??t),n4=!0}return Rv=e(),Rv}function o4(e){let t=!1;return e.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(t=!0)}),t}var pt,fw;async function Mce(e){let t=await Ece;pt||(fw||(fw=t({locateFile:()=>e})),pt=await fw)}var l4=Kt.identity(),c4=class{constructor(e,t=1){this.canvas=e,this.dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=Jt.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=Jt.transparent,this._fonts=new Map;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=l4,this._currentTransform=new Float32Array(l4)}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await Mce(this.wasmURL),this._surface=pt.MakeWebGLCanvasSurface(this.canvas),this.ctx=(e=this._surface)==null?void 0:e.getCanvas(),this._paint=new pt.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(pt.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(pt.PaintStyle.Stroke),(t=this.ctx)==null||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=pt.FontMgr.FromData(e);if(i)this._fonts.set(t,i);else throw new Error("Invalid font data for "+t)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(Lv(e),pt.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(Lv(e),pt.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?e:e*2)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;(e=this.ctx)==null||e.clear(pt.TRANSPARENT)}save(){var e;(e=this.ctx)==null||e.save()}restore(){var e;(e=this.ctx)==null||e.restore()}beginPath(){var e;(e=this._currentPath)==null||e.delete(),this._currentPath=new pt.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,r,a=0,s=0,n=0,o=0){var c,u;let l=pt.XYWHRect(e,t,i,r);if(a===0&&s===0&&o===0&&n===0)(c=this.ctx)==null||c.clipRect(l,pt.ClipOp.Intersect,!0);else{let h=pt.RRectXY(l,a,a);h[4]=h[5]=a,h[6]=h[7]=s,h[8]=h[9]=n,h[10]=h[11]=o,(u=this.ctx)==null||u.clipRRect(h,pt.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Kt.invert(this.currentTransform);this.ctx.concat(e);let t=Kt.translate(Kt.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t,i=!0){var r,a,s,n;if(this.ctx&&this._currentPath){let o,l=!1;if(i&&this._hasDropShadow()){let c=e.copy();c.setColor(Lv(this._dropShadowColor));let u;this._dropShadowBlur>0&&(u=pt.MaskFilter.MakeBlur(pt.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(((r=this.camera)==null?void 0:r.scale)??1),!1),c.setMaskFilter(u)),this.ctx.save(),this.ctx.clipPath(this._currentPath,pt.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(c),this.ctx.restore(),c.delete(),u==null||u.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,pt.ClipOp.Intersect,!0);let c=pt.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,pt.TileMode.Clamp,null),u=e.copy();u.setImageFilter(c),u.setAlphaf(1);let h=this._currentPath.computeTightBounds();this.ctx.saveLayer(u,h,null,pt.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),u.delete(),c.delete(),l=!0}if(this._layerBlur>0){let c=e.copy();o=pt.MaskFilter.MakeBlur(pt.BlurStyle.Normal,this._layerBlur*this.dpr*(((a=this.camera)==null?void 0:a.scale)??1),!1),c.setMaskFilter(o),t(c),c.delete(),o.delete(),l=!0}if(l||t(e),i&&this._hasInnerShadow()){let c=new pt.Paint;c.setAntiAlias(!0),c.setStyle(pt.PaintStyle.Fill),c.setColor(Lv(this._innerShadowColor));let u;this._innerShadowBlur>0&&(u=pt.MaskFilter.MakeBlur(pt.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(((s=this.camera)==null?void 0:s.scale)??1),!1),c.setMaskFilter(u));let h=this._currentPath.computeTightBounds(),[d,p,f,m]=h,g=f-d,v=m-p;this.ctx.save(),this.ctx.clipPath(this._currentPath,pt.ClipOp.Intersect,!0),this.ctx.saveLayer(c,h,null,pt.SaveLayerInitWithPrevious),(n=this.ctx)==null||n.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(pt.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+g+Math.abs(this._innerShadowOffsetX*2),2e3+v+Math.abs(this._innerShadowOffsetY*2)),c),c.setBlendMode(pt.BlendMode.Clear),this.ctx.drawPath(this._currentPath,c),this.ctx.restore(),this.ctx.restore(),c.delete(),u==null||u.delete()}}}_paintInner(e,t=!0){if(this.ctx&&this._currentPath&&e){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(e,a=>{let s=!1;!t&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?pt.ClipOp.Difference:pt.ClipOp.Intersect,!0),s=!0),i.drawPath(r,a),s&&i.restore()},t)}}_hasDropShadow(){var e;return((e=this._dropShadowColor)==null?void 0:e.a)>0}_hasInnerShadow(){var e;return((e=this._innerShadowColor)==null?void 0:e.a)>0}path(e){var t;(t=this._currentPath)==null||t.addPath(pt.Path.MakeFromSVGString(e))}ellipse(e,t,i,r,a,s,n,o){var c;if(!h4([e,t,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=pt.XYWHRect(e-i,t-r,i*2,r*2);(c=this._currentPath)==null||c.addOval(l)}rect(e,t,i,r,a=0,s=0,n=0,o=0){var c,u;let l=pt.XYWHRect(e,t,i,r);if(h4(l))if(a===0&&s===0&&o===0&&n===0)(c=this._currentPath)==null||c.addRect(l);else{let h=pt.RRectXY(l,a,a);h[4]=h[5]=a,h[6]=h[7]=s,h[8]=h[9]=n,h[10]=h[11]=o,(u=this._currentPath)==null||u.addRRect(h)}}getHorizontalAlign(e){switch(e){case 2:return pt.TextAlign.Right;case 3:return pt.TextAlign.Center;case 4:return pt.TextAlign.Justify;case 1:default:return pt.TextAlign.Left}}drawTextInner(e,t,i,[r,a,s,n],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),p=l.copy();return p.setAlphaf(0),this._applyEffectsToPaint(d,f=>{t.pushPaintStyle(i,f,p),t.addText(e);let m=t.build();m.layout(s);let g=a;o===2?g+=(n-m.getHeight())/2:o===3&&(g+=n-m.getHeight()),h.drawParagraph(m,r,g),u=m.getHeight(),t.reset(),m.delete()},c),d.delete(),p.delete(),u}drawText(e,t){let i=0,r=this._fonts.get(t.font),{ctx:a,_paintFill:s,_paintStroke:n}=this;if(r&&a){let o=new pt.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),l=new pt.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),c=pt.XYWHRect(t.x,t.y,t.width,t.height),u=pt.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,s,!0)),n&&(i=this.drawTextInner(e,u,o,c,t.verticalAlign,n,!1)),u.delete()}return{height:i}}render(){var e;(e=this._surface)==null||e.flush()}moveTo(e,t){var i;(i=this._currentPath)==null||i.moveTo(e,t)}lineTo(e,t){var i;(i=this._currentPath)==null||i.lineTo(e,t)}bezierCurveTo(e,t,i,r,a,s){var n;(n=this._currentPath)==null||n.cubicTo(e,t,i,r,a,s)}quadraticCurveTo(e,t,i,r){var a;(a=this._currentPath)==null||a.quadTo(e,t,i,r)}setTransform(e,t=!1){var a,s,n,o,l;if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Kt.invert(i);if(r&&this.ctx.concat(r),(a=this.ctx)==null||a.scale(this.dpr,this.dpr),((s=this.camera)==null?void 0:s.enabled)&&((n=this.ctx)==null||n.concat(this.camera.worldMatrix),t)){let c=Kt.getScale(this.camera.worldMatrix);(o=this.ctx)==null||o.scale(1/c[0],1/c[1])}(l=this.ctx)==null||l.concat(e),this.currentTransform=e}transform(e){var t;(t=this.ctx)==null||t.concat(e)}setSize(e,t){var i;e===this._width&&t===this._height||(this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=pt.MakeWebGLCanvasSurface(this.canvas),this.ctx=(i=this._surface)==null?void 0:i.getCanvas()))}};function h4(e){for(let t=0;t<e.length;t++)if(e[t]!==void 0&&!Number.isFinite(e[t]))return!1;return!0}function Lv({r:e,g:t,b:i,a:r}){return pt.Color4f(e,t,i,r)}var u4=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Jt.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){e.color!==void 0&&(this.color=e.color),e.enabled!==void 0&&(this.enabled=e.enabled),e.blurRadius!==void 0&&(this.blurRadius=e.blurRadius),e.offset!==void 0&&(this.offset=e.offset),e.spread!==void 0&&(this.spread=e.spread)}},d4=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.radius!==void 0&&(this.radius=e.radius)}},Tce=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Jt.transparent,this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color)}},Pce=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=Jt.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.color!==void 0&&(this.color=e.color),e.thickness!==void 0&&(this.thickness=e.thickness),e.mode!==void 0&&(this.mode=e.mode)}},_r=class extends dr{constructor(t,i,r){super(t,i,r),this.uuid=t,this.data=i,this.autoClose=!0,this.fill=new Tce(t+"-fill",i.fill,r),this.stroke=new Pce(t+"-stroke",i.stroke,r),this.dropShadow=new u4(t+"-dropShadow",i.dropShadow,r),this.innerShadow=new u4(t+"-innerShadow",i.innerShadow,r),this.backgroundBlur=new d4(t+"-backgroundBlur",i.backgroundBlur,r),this.layerBlur=new d4(t+"-layerBlur",i.layerBlur,r)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:Jt.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Jt.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=this.layerBlur.radius*5:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=this.backgroundBlur.radius*5:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=this.dropShadow.blurRadius*5,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=Jt.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=this.innerShadow.blurRadius*5,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=Jt.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,i,r){super.updateByPatchedOp(t,i,r),t.type===0&&(si(t.path,["fill"])?this.fill.update(t.props):si(t.path,["stroke"])?this.stroke.update(t.props):si(t.path,["dropShadow"])?this.dropShadow.update(t.props):si(t.path,["innerShadow"])?this.innerShadow.update(t.props):si(t.path,["layerBlur"])?this.layerBlur.update(t.props):si(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,i){super.updateState(t,i),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let i=new _r(this.uuid,this.data,t);return i.parent=void 0,i}},vC=class extends _r{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(e,t){return wce(e,t,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new vC(this.uuid,this.data,e);return t.parent=void 0,t}},Qm=class extends _r{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new Qm(this.uuid,this.data,e);return t.parent=void 0,t}},yC=class extends _r{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:Jt.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Jt.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var s;(s=this._fontHolder)!=null&&s.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let t=this.data.textTransform,i=this.data.text.textValue.toString(),r=t===2?i.toUpperCase():t===3?i.toLowerCase():i,{height:a}=e.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=a}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,{shared:t}){e.font!==void 0&&(this._fontHolder=t.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new yC(this.uuid,this.data,e);return t.parent=void 0,t}},xB=class extends _r{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let e=this.curves.map(r=>Vy.extremas(r)),t=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,a=e.length;r<a;r++){let s=e[r];s[0][0]<t[0]&&(t[0]=s[0][0]),s[0][1]<t[1]&&(t[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let a=this.data.points[i].data,s=this.data.points[i-1].data,n={start:s.position,cp1:s.controlNext.position,cp2:a.controlPrevious.position,end:a.position};this.curves.push(n)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[e+i,t+r]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[(t[0]-e[0])*.5,(t[1]-e[1])*.5]}innerDraw(e){for(let r=0,a=this.data.points.length;r<a;r++){let s=this.data.points[r].data;if(r===0){let[n,o]=s.position;e.moveTo(n,o)}else{let n=this.data.points[r-1].data,[o,l]=n.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,p={start:n.position,cp1:n.controlNext.position,cp2:s.controlPrevious.position,end:s.position};Vy.derive(p),e.bezierCurveTo(o,l,c,u,h,d)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,a]=i.controlNext.position,[s,n]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(r,a,s,n,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new xB(this.uuid,this.data,e);return t.parent=void 0,t}},Vy;(e=>{function t(n){let o=n.start,l=n.cp1,c=n.cp2,u=n.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],p=[3*(u[0]-c[0]),3*(u[1]-c[1])],f={start:h,cp:d,end:p};return n.derivative=f,f.derivative=SS.derive(f),f}e.derive=t;function i(n,o,l,c=!1){let u=n-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-n*l)),d=-n+o,p=-(h+d)/u,f=-(-h+d)/u;return[p,f]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(n){let o=n.derivative??e.derive(n),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}e.droot=r;function a(n){let[o,l]=e.droot(n),c=[n.start[0],n.end[0]],u=[n.start[1],n.end[1]];for(let h of o)c.push(e.compute(n,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(e.compute(n,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}e.extremas=a;function s(n,o){if(o===0)return[...n.start];if(o===1)return[...n.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,p=l*u*3,f=o*u;return[h*n.start[0]+d*n.cp1[0]+p*n.cp2[0]+f*n.end[0],h*n.start[1]+d*n.cp1[1]+p*n.cp2[1]+f*n.end[1]]}e.compute=s})(Vy||(Vy={}));var SS;(e=>{function t(a){let s=a.start,n=a.cp,o=a.end,l=[2*(n[0]-s[0]),2*(n[1]-s[1])],c=[2*(o[0]-n[0]),2*(o[1]-n[1])],u={start:l,end:c};return u.derivative=AS.derive(u),a.derivative=u,u}e.derive=t;function i(a){let s=a.derivative??e.derive(a),n=s.start,o=s.end;return[n[0]!==o[0]?n[0]/(n[0]-o[0]):0,n[1]!==o[1]?n[1]/(n[1]-o[1]):0]}e.droot=i;function r(a,s){if(s===0)return[...a.start];if(s===1)return[...a.end];let n=1-s,o=n*n,l=s*s,c=o,u=n*s*2,h=l;return[c*a.start[0]+u*a.cp[0]+h*a.end[0],c*a.start[1]+u*a.cp[1]+h*a.end[1]]}e.compute=r})(SS||(SS={}));var AS;(e=>{function t(r){let a=r.start,s=r.end,n=[s[0]-a[0],s[1]-a[1]];return r.derivative=n,r.derivative}e.derive=t;function i(r,a){if(a===0)return[...r.start];if(a===1)return[...r.end];let s=r.start,n=r.end;return[s[0]+(n[0]-s[0])*a,s[1]+(n[1]-s[1])*a]}e.compute=i})(AS||(AS={}));var Yn=class extends Vn{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new Qm(e+"-background",ym.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),(e=this.background)==null||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var r;super.updateWorldMatrix(e,t,i),(r=this.background)==null||r.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(e){e.cornerRadius!==void 0&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;e.width!==void 0&&(this.width=typeof e.width=="number"?e.width:this.width,t=!0),e.height!==void 0&&(this.height=typeof e.height=="number"?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),e.fill!==void 0&&this.fill.update(e.fill),e.stroke!==void 0&&this.stroke.update(e.stroke),e.dropShadow!==void 0&&this.dropShadow.update(e.dropShadow),e.innerShadow!==void 0&&this.innerShadow.update(e.innerShadow),e.layerBlur!==void 0&&this.layerBlur.update(e.layerBlur),e.backgroundBlur!==void 0&&this.backgroundBlur.update(e.backgroundBlur),e.clipped!==void 0&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),e.type===0&&(si(e.path,["fill"])?this.fill.update(e.props):si(e.path,["stroke"])?this.stroke.update(e.props):si(e.path,["dropShadow"])?this.dropShadow.update(e.props):si(e.path,["innerShadow"])?this.innerShadow.update(e.props):si(e.path,["layerBlur"])?this.layerBlur.update(e.props):si(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new Yn(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},Dce=ar(Ck(),1),V1=class extends _r{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),e.path!==void 0&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new V1(this.uuid,this.data,e);return t.parent=void 0,t}};function Oce(e,t=1,i=1){if(t<=0||i<=0)return e;let r=(0,Dce.parseSVG)(e).map(a=>{let s={...a};return"x"in s&&(s.x=s.x*t),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*t),"x2"in s&&(s.x2=s.x2*t),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*t),"ry"in s&&(s.ry=s.ry*i),s});return Ice(r)}function Ice(e){let t=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return e.map(r=>{let a=[];t.forEach(n=>{if(n in r){let o=r[n]*1;a.length&&o>=0&&a.push(","),a.push(o)}});let s=(i===r.code?a[0]<0?"":",":r.code)+a.join("");return i=r.code,s}).join("")}function Rce(e,t,i){switch(t.type){case"ellipse2d":return new vC(e,t,i);case"rectangle2d":return new Qm(e,t,i);case"text2d":return new yC(e,t,i);case"vector2d":return new xB(e,t,i);case"path2d":return new V1(e,t,i);case"frame2d":return new Yn(e,t,i);case"group2d":default:return new Jo(e,t,i)}}var bB=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new Jo(bB.GROUP_ID,{...ky.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,r,a,s){let n=Rce(e,t,s);n&&(r.add(n),r.children.splice(a,0,r.children.pop()),n.updateWorldMatrix(),i.length>0&&(n instanceof Jo||n instanceof Yn)&&this.createChildrenObjects(i,n,s))}createChildrenObjects(e,t,i){let r=0;for(let a of e)this.createObject(a.id,a.data,a.children,t,r,i),r+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,r){let a=this.find(e);if(a)try{a.updateByOp(t,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(e,t){if(e.path.length===0&&e.type===7){let i=e.parent===null?this.group:this.find(e.parent);i!==void 0&&i instanceof Vn&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(e.path.length===0&&e.type===8){let i=this.find(e.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof Vn){let r=i.parent;i.resetBBoxNeedsUpdate(),r==null||r.remove(i),r==null||r.requestRender()}}else if(e.path.length===0&&e.type===9){let i=this.find(e.id);if(i!==void 0){let r=i.parent,a=e.parent===null?this:this.find(e.parent);if(a instanceof Vn||a===this){a.add(i);let s=e.localIndex;a.children.splice(s,0,a.children.pop()),i.updateWorldMatrix(!0,!1,!0),r==null||r.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse(t=>{t!==this.group&&e(t)})}intersectsChildren(e,t,i,r=!1,a=[]){return this.group.intersectsChildren(e,t,i,r,a,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this.group;){let a=r;r=r.parent;let s=r.children.indexOf(a);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>rz(i.sortKey,r.sortKey)),t.map(i=>i.entity)}},xC=bB;xC.GROUP_ID="scene2d";function wB({constraints:e,newParentWidth:t,newParentHeight:i,initialParentWidth:r,initialParentHeight:a,objectInitialWidth:s,objectInitialHeight:n,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=e,u=t-r,h=i-a,d=s,p=n,f=o[0],m=o[1];if(l!==0){if(l===1)f+=u;else if(l===3)f+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let g=t/r;d*=g,f*=g}}if(c!==0){if(c===1)m+=h;else if(c===3)m+=h/2;else if(c===2)p=Math.max(1,p+h);else if(c===4){let g=i/a;p*=g,m*=g}}return{width:d,height:p,position:[f,m]}}ar(Ck(),1);var Lce=Kt.identity(),_B=class{constructor(e,t,i,r){this.uuid=e,this.width=t,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this.onFrameOverrideObjectEvent=a=>{var s,n;if(((s=a.target)==null?void 0:s.uuid)!==void 0){let o=(n=this.frameRoot)==null?void 0:n.find(a.target.uuid);o&&o.dispatchEvent({...a,target:o})}},this.scene2d=new xC(Ge.generateUUID(),Y2.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=document.createElement("canvas"),this.renderer=new c4(this.canvas),r.shared.addCanvas(this.uuid,this.canvas),this.textureHolder=r.shared.canvas(this.uuid),this.promise=this.init()}async init(){this.renderer instanceof c4&&(this.renderer.wasmURL=XN.skiaWasmUrl),await this.renderer.init()}render(){var e,t;this.isFrameDirty&&(this.renderer.clear(),(e=this.frameOverride)==null||e.draw(this.renderer),this.renderer.render(),(t=this.textureHolder)==null||t.setNeedsUpdate(!0),this.isFrameDirty=!1)}updateEntity2DByOp(e,t,i,r){this.scene2d.updateEntityByOp(e,t,i,r),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.frameOverride.width=t,this.frameOverride.height=i,this.frameOverride.localMatrix=Lce,this.isScreenSpace&&(this.frameOverride.fill.color=Jt.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:t,height:i},SB({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e){var r,a;let t=(e==null?void 0:e.width)??this.width,i=(e==null?void 0:e.height)??this.height;this.width=t,this.height=i,this.renderer.dpr=this.isScreenSpace?window.devicePixelRatio:Math.floor(2048/Math.max(t,i)),this.renderer.setSize(t,i),(r=this.textureHolder)==null||r.dispose(),this.applyOverrides(e),(a=this.frameOverride)==null||a.requestRender()}applyFrame(e){var i,r,a;let t=this.context.scene.find2D(e);if(!(!t||!(t instanceof Yn)))return this.disposeFrameOverride(),this.frameRoot=t,this.frameOverride=t.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),(i=this.textureHolder)==null||i.dispose(),(r=this.frame)==null||r.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(s=>{s.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(s=>{s.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),(a=this.frame)==null||a.requestRender(),t}get frame(){return this.frameOverride}get frameId(){var e;return(e=this.frame)==null?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return(e=this.textureHolder)==null?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;(e=this.frameOverride)==null||e.removeEventListener("render",this.onRenderRequestedDownstream),(t=this.frameOverride)==null||t.traverse(r=>{r.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),(i=this.frameOverride)==null||i.traverse(r=>{r.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function SB({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:a,initialParentHeight:s}){if(e instanceof Yn&&t instanceof Yn||e instanceof Jo&&t instanceof Jo)for(let n=0,o=e.children.length;n<o;n++){let l=e.children[n],c=t.children[n];l&&c&&l.uuid===c.uuid&&zce({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:a,initialParentHeight:s})}}function kce(e){if(ES(e))return[e.width,e.height];if(e instanceof V1){let[t,i]=e.getHalfSize();return[t*2,i*2]}else if(e instanceof Jo){let[t,i]=e.recursiveBBox.getHalfSize();return[t*2,i*2]}return[0,0]}function zce({objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:a,initialParentHeight:s}){let[n,o]=kce(t),{width:l,height:c,position:u}=wB({constraints:e.data,newParentWidth:i,newParentHeight:r,initialParentWidth:a,initialParentHeight:s,objectInitialWidth:n,objectInitialHeight:o,objectInitialPosition:t.position});if(e.position=u,e.data={...e.data,position:u},e.states)for(let h in e.states)Nce({stateId:h,objectOverride:e,objectRoot:t,newParentWidth:i,newParentHeight:r,initialParentWidth:a,initialParentHeight:s});if(ES(e)||e instanceof Jo)ES(e)&&(e.width=l,e.height=c,e.data={...e.data,width:l,height:c}),SB({objectOverride:e,objectRoot:t,newParentWidth:l,newParentHeight:c,initialParentWidth:n,initialParentHeight:o});else if(e instanceof V1){let h=t,d=n!==0?l/n:1,p=o!==0?c/o:1;e.path=Oce(h.path,d,p),e.data={...e.data,path:e.path}}}function Nce({stateId:e,objectOverride:t,objectRoot:i,newParentWidth:r,newParentHeight:a,initialParentWidth:s,initialParentHeight:n}){var c,u;let o=(c=t.states)==null?void 0:c[e],l=(u=i.states)==null?void 0:u[e];if(o&&l){let{width:h,height:d,position:p}=wB({constraints:t.data,newParentWidth:r,newParentHeight:a,initialParentWidth:s,initialParentHeight:n,objectInitialWidth:rh.isResizeable(l)?l.width:0,objectInitialHeight:rh.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(t.states[e],{position:p}),rh.isResizeable(o)&&Object.assign(t.states[e],{width:h,height:d})}}function ES(e){return e instanceof Qm||e instanceof Yn||e instanceof vC||e instanceof yC}var kr=class extends ZE(Vo){constructor(e,t,i){super(),this.data=t,this.bgColor=new Vr(1,1,1,1),this.fog=null,this.backupFog=new Kk(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new tt,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new aa(np,{...mm.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new pq(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new xC((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return(e=this.uiCanvas)==null?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new _B(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{var i,r;(i=this.uiCanvas)==null||i.applyFrame(e),(r=this.uiCanvas)==null||r.applySize()})}updateVisible(){}setBackgroundColor(e){this.bgColor=e,this.fogUseBGColor===!0&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){e.color!==void 0&&(this.ambientLight.color=va(e.color,t)),e.intensity!==void 0&&(this.ambientLight.intensity=e.intensity),e.enabled!==void 0&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity(t=>{t instanceof xh&&t.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(e=>{if(e instanceof cp)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()})}updateShadow(e){e.softShadowQuality!==void 0&&this.isActive&&mce(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=va(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){e.aoColor!==void 0&&(this.aoColor=va(e.aoColor,t))}updateByOp(e,t,i,r){let a=this.data.uiFrame;super.updateByOp(e,t,i,r);let s=t;si(e.path,["fog"])?this.updateFog(s.fog,i.shared):si(e.path,["ao"])?this.updateAo(s.ao,i.shared):si(e.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):si(e.path,["shadow"])?this.updateShadow(s.shadow):e.type===0&&e.path.length===0&&(e.props.uiFrame!==void 0||a!==s.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),e.backgroundColor!==void 0&&this.setBackgroundColor(va(e.backgroundColor,t.shared)),e.fog!==void 0&&this.updateFog(e.fog,t.shared),e.ambient!==void 0&&this.updateAmbientLight(e.ambient,t.shared),e.ao!==void 0&&this.updateAo(e.ao,t.shared),e.shadow!==void 0&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e;return((e=this.scene)==null?void 0:e.find(this.data.publish.playCamera))??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof mB&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize,e+=1),i instanceof gB&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize,t+=1)})}raycastWithClones(e){let t=[],i=r=>{for(let a of r.children){let s=a.cloner;Ot.is(a)&&(a.visible||s!=null&&s.object.data.visible)&&((Zs(a)||fS(a)&&this.scene.enableHelpers&&a.objectHelper.visible)&&(e.intersectObject(a,!1,t),MS(a,e,t,!0)),i(a))}};return i(this),t}updateEntity2DByOp(e,t,i,r){var a;(a=this.uiCanvas)==null||a.updateEntity2DByOp(e,t,i,r)}},Bce=class extends fC(vq,pB){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let a=new P(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new P(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),n=new Hi(a,s),o=new sy(n,new tt(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof sy){let i=this.shadow.camera,r=new P(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),a=new P(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);t.box.set(r,a),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),e.distance!==void 0&&(this.distance=e.distance),e.decay!==void 0&&(this.decay=e.decay),e.shadowRadius!==void 0&&(this.shadow.radius=e.shadowRadius),e.shadowResolution!==void 0&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},jce=class extends ia{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?aC(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},bC=class extends ia{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){var r;let e={...this.data.geometry.extrusion.shape};for(let a in e)typeof e[a]=="string"&&(e[a]=this._context.shared.getVariable(e[a],[this.uuid,"geometry","extrusion","shape",a]));let t;if(e.type==="Custom"){let a=e.shapeId;if(a!==this._shapeId&&this.detachShape(),a){this._shapeId=a;let s=this._context.scene.find(a);s!=null&&s.data&&(s.attachedPaths.add(this),t=(r=s.geometry.userData)==null?void 0:r.shape),t||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let a;switch(e.type){case"Rectangle":a=rC;break;case"Ellipse":a=iC;break;case"Polygon":a=hN;break;case"Star":a=uN;break;default:throw new Error(`Unknown shape type: ${e.type}`)}t=a.create({parameters:e}).userData.shape}let i=this.geometry;t&&i.inputs&&(i.inputs.shapeData=t,i.build(),this.attachedSurfaceCloners.forEach(a=>a.update()))}detachShape(){var e;this._shapeId!==null&&((e=this._context.scene.find(this._shapeId))==null||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");i!==void 0?aC(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},dd=class extends hp(Fc,Xm){constructor(e,t,i){super(),t.type==="Instance"&&typeof e=="string"&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(e,t){let i=Oy.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let r,a;for(let s of jl.rootOverrideProps)e[s]===void 0?(r===void 0&&(r={...e}),r[s]=i.data[s]):(a===void 0&&(a={}),a[s]=e[s],r===void 0&&(r={...e}),r[s]=ec.apply(i.data[s],e[s]));return this.overrideData=a,r}else return{...Ur.defaultData,...e,...Go(Ur.defaultData,jl.rootOverrideProps)}}updateByOp(e,t,i,r){let a;if(this.isInstanceRoot&&!r){if(t=this.transformAssignData(t,i),e.type===0&&e.path.length===0&&this.component)for(let s of jl.rootOverrideProps)s in e.props&&e.props[s]===void 0&&(a===void 0&&(a={...e,props:{...e.props}}),a.props[s]=this.component.data[s]);else if(e.type===0&&e.path.length>0&&jl.rootOverrideProps.includes(e.path[0])){let s=e.path[0];a===void 0&&(a={...e,path:[],props:{[s]:t[s]}})}}super.updateByOp(a??e,t,i,r)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(this.component===void 0){let i=e.scene.find(t.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let a=0;for(let s of this.children)if(Ot.is(s))e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),wC(s),a+=1;else break;this.children.splice(0,a)}r=!0}if(i){let a={};AB(e,[this.uuid],t.overrides,this,i,i,0,r,a);for(let s of this.children)if(Ot.is(s)){let n=s.data;n.type==="Empty"&&n.animations&&s.traverseEntity(o=>{if(o instanceof ia&&o.isSkinnedMesh){let l=o.dataPatched;if(l.bones&&l.boneInverses){let c=l.bones.map(d=>e.scene.find(a[d])),u=l.boneInverses.map(d=>new Se().fromArray(d)),h=new uE(c,u);o.bind(h,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function wC(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)Ot.is(i)&&wC(i)}}function p4(e,t,i,r){return e.component===t&&ez(e.identity,r)?e.overrideData===i?2:1:0}function AB(e,t,i,r,a,s,n,o,l){if(n>50)return!1;if(r.component!==a){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}a.instances.push(r),r.component=a}a instanceof dd&&a.isInstanceRoot&&a.expandInstanceChildren(e);let c=0;for(let u of a.children)if(Ot.is(u)){let h=[...t,...typeof u.identity=="string"?[u.identity]:u.identity],d=Cy.resolve(i,h,1);d!=null&&!(d instanceof rr)&&(Object.setPrototypeOf(d,rr.prototype),console.error("wrong prototype"));let p=null,f;if(!o){let m=r.children[c];if(p=Ot.is(m)?m:null,p!==null){let g=p4(p,u,d,h);f=g>=1?p.stateSelection:void 0,g!==2&&(p=null)}if(p===null&&(p=e.scene.findInstance(h)??null,p!==null)){let g=p4(p,u,d,h);if(f=g>=1?p.stateSelection:void 0,g!==2)p=null;else{let v=p.parent.children.indexOf(p);p.parent.children.splice(v,1),r.children.splice(c,0,p),p.parent===r?v<=c&&console.error("not possible"):(p.parent=r,p.matrixWorldNeedsUpdate=!0,p.resetBBoxNeedsUpdate(),p.updateVisible(),e.pendingDeletes.delete(p))}}}if(p===null){let m=d?ec.apply(u.data,d):u.data;gh.is(m.type)&&(m={...m,type:"Empty"}),p=Ul.createEntity(h,m,e),p.overrideData=d,r.add(p),r.children.splice(r.children.length-1,1),r.children.splice(c,0,p),p.updateState(p.data,e),f&&p.changeSelectedState(f,e),e.scene.registerInstanceAndSetUuid(p)}if(p.isBone){let m=p.identity[p.identity.length-1];l[m]=p.uuid}c+=1,AB(e,t,i,p,u,s,n+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(Ot.is(h))e.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var Fce=class extends hp($k,Xm){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},ea=class extends ia{constructor(t,i,r){super(t,i,r),this.onBeforeRender=()=>{this.uiCanvas.render()},this.uiCanvas=new _B(t+"-canvas",i.geometry.width,i.geometry.height,r),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,r.shared)})}updateByPatchedOpGeometry(t,i,r){super.updateByPatchedOpGeometry(t,i,r),t.type===0&&(t.props.frame!==void 0&&this.applyFrame(t.props.frame,r.shared),(t.props.width!==void 0||t.props.height!==void 0)&&this.applySize(t.props,r.shared))}applySize(t,i){let r=(t==null?void 0:t.width)??this.dataPatched.geometry.width,a=(t==null?void 0:t.height)??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:r,height:a}),this.applyGeometryParametersFromFrame(i)}applyFrame(t,i){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(i),this.applyMaterialParametersFromFrame({shared:i})}applyGeometryParametersFromFrame(t){var r;let i=this.frame;i&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:i.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:i.cornerRadius,cornerType:0})}),(r=this.localGeometry)==null||r.dispose(),this.localGeometry=Sm(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let i=this.frame;if(i){let r=i.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:r.radius,alpha:r.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:r.radius,alpha:r.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,i,r,a){this.uiCanvas.updateEntity2DByOp(t,i,r,a),t===this.frameId&&i.type===0&&(i.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(a):si(i.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:a}))}get frame(){return this.uiCanvas.frame}get frameId(){var t;return(t=this.frame)==null?void 0:t.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,i){super.updateGeometryInteractions(t,i),this.applySize({width:t.width,height:t.height},i)}},Uce=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let r=er,a=new Vo,s=new Sh;s.position.z=1;let n={passThruTexture:{value:null}},o=u(d(),n),l=new tr(new Ah(2,2),o);a.add(l),this.setDataType=function(p){return r=p,this},this.addVariable=function(p,f,m){let g=this.createShaderMaterial(f),v={name:p,initialValueTexture:m,material:g,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:Gt,magFilter:Gt};return this.variables.push(v),v},this.setVariableDependencies=function(p,f){p.dependencies=f},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let p=0;p<this.variables.length;p++){let f=this.variables[p];f.renderTargets[0]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),f.renderTargets[1]=this.createRenderTarget(e,t,f.wrapS,f.wrapT,f.minFilter,f.magFilter),this.renderTexture(f.initialValueTexture,f.renderTargets[0]),this.renderTexture(f.initialValueTexture,f.renderTargets[1]);let m=f.material,g=m.uniforms;if(f.dependencies!==null)for(let v=0;v<f.dependencies.length;v++){let y=f.dependencies[v];if(y.name!==f.name){let x=!1;for(let w=0;w<this.variables.length;w++)if(y.name===this.variables[w].name){x=!0;break}if(!x)return"Variable dependency not found. Variable="+f.name+", dependency="+y.name}g[y.name]={value:null},m.fragmentShader=`
uniform sampler2D `+y.name+`;
`+m.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let p=this.currentTextureIndex,f=this.currentTextureIndex===0?1:0;for(let m=0,g=this.variables.length;m<g;m++){let v=this.variables[m];if(v.dependencies!==null){let y=v.material.uniforms;for(let x=0,w=v.dependencies.length;x<w;x++){let S=v.dependencies[x];y[S.name].value=S.renderTargets[p].texture}}this.doRenderTarget(v.material,v.renderTargets[f])}this.currentTextureIndex=f},this.getCurrentRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(p){return p.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let p=this.variables;for(let f=0;f<p.length;f++){let m=p[f];m.initialValueTexture&&m.initialValueTexture.dispose();let g=m.renderTargets;for(let v=0;v<g.length;v++)g[v].dispose()}};function c(p){p.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}this.addResolutionDefine=c;function u(p,f){f=f||{};let m=new Wt({uniforms:f,vertexShader:h(),fragmentShader:p});return c(m),m}this.createShaderMaterial=u,this.createRenderTarget=function(p,f,m,g,v,y){return p=p||e,f=f||t,m=m||pi,g=g||pi,v=v||Gt,y=y||Gt,new Ht(p,f,{wrapS:m,wrapT:g,minFilter:v,magFilter:y,format:Sr,type:r,depthBuffer:!1})},this.createTexture=function(){let p=new Float32Array(e*t*4),f=new As(p,e,t,Sr,er);return f.needsUpdate=!0,f},this.renderTexture=function(p,f){n.passThruTexture.value=p,this.doRenderTarget(o,f),n.passThruTexture.value=null},this.doRenderTarget=function(p,f){let m=i.getRenderTarget(),g=i.xr.enabled,v=i.shadowMap.autoUpdate,y=i.outputEncoding,x=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=ln,i.toneMapping=qn,l.material=p,i.setRenderTarget(f),i.render(a,s),l.material=o,i.xr.enabled=g,i.shadowMap.autoUpdate=v,i.outputEncoding=y,i.toneMapping=x,i.setRenderTarget(m)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},Dr=new Nr,kv=new P,Vce=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||t.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let a=0;a<e.count;a+=3){let s=1;t&&(s=t.getX(a)+t.getX(a+1)+t.getX(a+2)),Dr.a.fromBufferAttribute(e,a),Dr.b.fromBufferAttribute(e,a+1),Dr.c.fromBufferAttribute(e,a+2),s*=Dr.getArea(),i[a/3]=s}this.distribution=new Float32Array(e.count/3);let r=0;for(let a=0;a<i.length;a++)r+=i[a],this.distribution[a]=r;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let r=this.distribution[this.distribution.length-1],a=this.binarySearch(this.randomFunction()*r);return this.sampleFace(a,e,t,i)}binarySearch(e){let t=this.distribution,i=0,r=t.length-1,a=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||t[s-1]<=e&&t[s]>e){a=s;break}else e<t[s]?r=s-1:i=s+1}return a}sampleFace(e,t,i,r){let a=this.randomFunction(),s=this.randomFunction();return a+s>1&&(a=1-a,s=1-s),Dr.a.fromBufferAttribute(this.positionAttribute,e*3),Dr.b.fromBufferAttribute(this.positionAttribute,e*3+1),Dr.c.fromBufferAttribute(this.positionAttribute,e*3+2),t.set(0,0,0).addScaledVector(Dr.a,a).addScaledVector(Dr.b,s).addScaledVector(Dr.c,1-(a+s)),i!==void 0&&Dr.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(Dr.a.fromBufferAttribute(this.colorAttribute,e*3),Dr.b.fromBufferAttribute(this.colorAttribute,e*3+1),Dr.c.fromBufferAttribute(this.colorAttribute,e*3+2),kv.set(0,0,0).addScaledVector(Dr.a,a).addScaledVector(Dr.b,s).addScaledVector(Dr.c,1-(a+s)),r.r=kv.x,r.g=kv.y,r.b=kv.z),this}};function Gce(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let a=i*e+r;t[a*2+0]=i/(e-1),t[a*2+1]=r/(e-1)}return t}function Hce(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}function Wce(e,t){let i=new tr(e.geometry,e.material),r=[],a=[],s=new P,n=new P;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new Vce(i).build();for(let u=0;u<t;u++)o.sample(s,n),r.push(s.x,s.y,s.z),a.push(n.x,n.y,n.z);let l=new Float32Array(r),c=new Float32Array(a);return{positions:l,normals:c}}function f4(e,t){let i=e,r=new Float32Array(4*t*t);for(let s=0;s<t*t;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let a=new As(r,t,t,Sr,er);return a.needsUpdate=!0,a}function qce({size:e}){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=r,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new As(t,e,e,Sr,er);return i.needsUpdate=!0,i}function Xce(e){let t=new Float32Array(4*e*e);for(let r=0;r<e*e;r++)t[4*r]=0,t[4*r+1]=0,t[4*r+2]=0,t[4*r+3]=0;let i=new As(t,e,e,Sr,er);return i.needsUpdate=!0,i}var Yce=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,Qce=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,Zce=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,Kce=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,$ce=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,Jce=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+Qce+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          float offset = 0.0;
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), offset);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          float offset = 0.0;
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${Zce}
      // ATTRACTION
      ${Kce}  
      // VORTEX
      ${$ce}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,EB=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,ehe=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,the=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,ihe=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${ehe}
  ${EB}
`,rhe=({easeSize:e="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${e}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,ahe=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+EB+`  
  ${the}

`,she=({easeOpacity:e="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${e}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,nhe=class extends Wt{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],this.lightLayer=new In(0,"",{...br.defaultData("light","phong"),visible:!1},new cC,{},t.shared),this.build()}updateState(e){e.coloring!==void 0&&(this.isColoringRandom=e.coloring==="random"),e.color!==void 0&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),e.color2!==void 0&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),e.size!==void 0&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),e.ease!==void 0&&(this.easeOpacity=e.ease,this.build()),e.easeSize!==void 0&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new EN;return e.needsJitter=this.needsJitter,e.addFragmentParsCode(yse),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode(xse),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(ihe),e.addFragmentParsCode(ahe),e.addVertexFinalCode(rhe({easeSize:this.easeSize})),e.addFragmentFinalCode(she({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(e=>e.dispose()),super.dispose()}},mw=class{constructor(e,t,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=Hce(t);let a=1;this.targetMesh=(r==null?void 0:r.type)==="Mesh"&&r?r:this.getMesh(i,a);let{positions:s,dataTexture:n,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,a));this.positionsTexture=n,this.positionsAttribute=s,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:r}=Wce(t,e*e),a=f4(i,e),s=f4(r,e);return{dataTexture:a,positions:i,dataTextureNormals:s}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":{i=new ed(t*.5,32,32);break}case"TorusEmitterShape":{i=new l5(t*.5,.3,15,40);break}case"ConeEmitterShape":{i=new mE(t,t,15);break}case"BoxEmitterShape":{i=new cn(t,t,t);break}case"PlaneEmitterShape":{i=new Ah(t,t),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new ed(t,32,32);break}default:{i=new ed(t,32,32);break}}return new tr(i,new _h({color:16711680}))}applyToShader(e,t){this.size=new P().fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function mf(e){let t={...e},i=by.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let r={...i.shape,...t.shape},a={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:r,renderMaterial:a}}var ohe=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,gw=10,lhe=class extends Yt{constructor(e,t){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new dq,this.currentWorldPosition=new P,this.systemQuaternion=new ut,this.worldGravity=new P(0,0,0),this.directionAxis=new P(0,0,0),this.colliderV3=new P(0,0,0),this.colliderQuaternion=new ut(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let i=t.data;this.material=new nhe(i.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new P(0,0,0)},uEmissionData:{value:new P(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new P(0,0,0)},uWorldQuaternion:{value:new dt(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(e,t){let i=t.data;if(typeof t=="string"){let r=this.shared.image(t),a=new Si(r.img);a.needsUpdate=!0,e.uTexture.value=a;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let n=new Si(r);n.needsUpdate=!0,e.uTexture.value=n};let a=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(a);r.src=s}}updateGeometryAttributes(e,t){var r;let i=Gce(t);!((r=this.emitterShape)!=null&&r.positionsAttribute)||e.geometry.setAttribute("ref",new sm(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var n;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let i=1e3/t,r=this.targetFPS/i,a=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=a,this.previousRatio=a;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=(n=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))==null?void 0:n.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0];if(!e)return;e.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let t=e.data.size;this.colliderV3.fromArray(t),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;t[2]==="size"&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),t[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(r,a)=>{let s=[...this.system.data.shape.size];s[r]=a,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};t[2]==="shape_size_0"&&i(0,e),t[2]==="shape_size_1"&&i(1,e),t[2]==="shape_size_2"&&i(2,e),t[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/gw),t[2]==="gravity"&&this.worldGravity.set(0,e/100,0),t[2]==="noiseStrength"&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t[2]==="noiseScale"&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),t[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),t[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){var t,i,r;if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(e)&&this.init(mf(this.system.data)),e.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),e.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/gw),e.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),e.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),e.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),((t=e.renderMaterial)==null?void 0:t.size)!==void 0){let a=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(a)}if(((i=e.renderMaterial)==null?void 0:i.spriteRotation)!==void 0&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),e.shape!==void 0){let a=e.shape.size??this.system.data.shape.size,s=[Number(this.shared.getVariable(a[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(a[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(a[2],[this.uuid,"particles","shape_size_2"]))],n={...mf(this.system.data).shape,size:s};(r=this.emitterShape)==null||r.applyToShader(this.positionSimRT.material.uniforms,n)}if(e.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),e.direction!==void 0){let a=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(a),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}e.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),e.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(e.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),e.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Ge.DEG2RAD,Number(e[1])*Ge.DEG2RAD,Number(e[2])*Ge.DEG2RAD],i=new hr(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:r,shape:a,emitTimeDuration:s,emitTimeCycle:n,life:o,directionMode:l,noiseType:c}=e;return t!==void 0||i!==void 0||r||r===null||n!==void 0||a!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:e.emitTimeCycle==="infinity"?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(e);return}else clearInterval(t)},100);if(!this.emitterShape)return;let i=new Uce(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(e),a=i.addVariable("uCurrentPosition",r+Yce,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+Jce,this.emitterShape.directionsTexture),n=i.addVariable("uCurrentEmissionRate",ohe,Xce(this.emitterShape.textureSize));i.setVariableDependencies(a,[a,s,n]),i.setVariableDependencies(s,[a,s,n]),i.setVariableDependencies(n,[a,s,n]);let o=qce({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new P(0,0,0)},uWorldQuaternion:{value:new dt(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new P(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};a.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let u=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new dt(0,0,0,1)},uColliderPos:{value:new P(0,0,0)},uColliderSize:{value:new P(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new dt(0,0,0,1)},uColliderQuaternionInvert:{value:new dt(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/gw}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};n.material.uniforms=d;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...mf(this.system.data).shape,size:p};this.emitterShape.applyToShader(a.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=a,this.velocitySimRT=s,this.emissionRateSimRT=n,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){let t=Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]));return[t,i,r]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(e.colliderEntityId);switch(i==null?void 0:i.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i==null?void 0:i.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),(i==null?void 0:i.forceRange)==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}e.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),e.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),e.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),e.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(t+=`#define ${i}
`);return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new P(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if(e.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(a=>{a.uuid===e.fromMeshId&&(r=a)}),r?new mw(i,t,e.type,r):new mw(i,t,"SphereEmitterShape")}else return new mw(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new CW(new Ah(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount({birthRatePerSecond:e,particleMaxLifeTime:t,loopDuration:i=0}){return Math.ceil(e*(t+i))}dispose(){var e,t,i;!this.gpuCompute||((t=(e=this.rootObject)==null?void 0:e.parent)==null||t.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),(i=this.emitterShape)==null||i.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,r=1/t;if(i>=r){let a=Math.max(1,Math.floor(i/r));return this.lastEmitTime=e,this.emittedParticlesAmount+a>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=a,a}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(mf(this.system.data))}startEmitting(){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=this.globalTime}stopEmitting(){this.isEmitting=!1}},CS=class extends ba{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Qe,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...t,...mf(t)},this.geometry.setAttribute("position",new Re([],3)),this.material=new _h({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new lhe(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||t)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),t||this.start(this.data.emitTimeLoopDelayStart==="start"?0:this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some(t=>t.identity===e)}getColliderData(e){let t=this.colliderEntities.find(i=>i.identity===e);return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),si(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Ar.drop(e,1).props}}),si(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Ar.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(e.colliderEntityId!==void 0&&e.colliderEntityId!==null){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}e.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(e=0){var t;if(this.currentLoopTime=0,e){setTimeout(()=>{this.start(0)},e);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,(t=this.emitter)==null||t.startEmitting()}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;this.stopped=!0,this.currentLoopTime=0,(e=this.emitter)==null||e.stopEmitting()}reset(){var e;this.started=!1,this.stopped=!1,(e=this.emitter)==null||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function che(e,t,i){let r;return t.geometry.type==="TextGeometry"?new sB(e,t,i):(t.geometry.type==="SubdivGeometry"?r=new Am(e,t,i):t.geometry.type==="PathGeometry"?r=new bC(e,t,i):t.geometry.type==="VectorGeometry"?r=new jce(e,t,i):t.geometry.type==="BooleanGeometry"?r=new xh(e,t,i):t.geometry.type==="UIGeometry"?r=new ea(e,t,i):r=new ia(e,t,i),r)}function _C(e,t,i){return console.assert(t.type!==void 0),t.type==="Mesh"?che(e,t,i):t.type==="Empty"?new ud(e,t):t.type==="Particle"?new CS(e,t,i):t.type==="ParticleCollider"?new mS(e,t,i):t.type==="Splat"?new ud(e,t):t.type==="Bone"?new Fce(e,t):t.type==="Page"?new kr(e,t,i):t.type==="PointLight"?new Bce(e,t,i):t.type==="SpotLight"?new gB(e,t,i):t.type==="DirectionalLight"?new mB(e,t,i):t.type==="Component"||t.type==="Instance"?new dd(e,t,i):gh.is(t.type)?new aa(e,t):(console.error(t),new ud(e,t))}Ul.createEntity=_C;function hhe(e,t,i){let r=_C(e.identity,t,i),a=e.children,s=e.attachedPaths,n=e.parent,o=e.component,l=e.instances,c=e.overrideData,u=e.uuid,h=e.stateSelection;e.dispose();for(let d of Object.keys(e))delete e[d];Object.setPrototypeOf(e,Object.getPrototypeOf(r));for(let d of Object.keys(r))e[d]=r[d];e.children=[...e.children,...a],e.attachedPaths=s,e.parent=n,e.component=o,e.instances=l,e.uuid=u,e.overrideData=c,e.updateState(e.data,i),h&&e.changeSelectedState(h,i),e.resetBBoxNeedsUpdate()}Ul.changeEntityProptotype=hhe;Ul.Cloner=Js;function uhe(e,t,i,r){e.updateByOp(t,i,r,!1)}function m4(e,t){let i=!1,r=t.getLayersOfType("transmission"),a=t.getLayersOfType("outline");return a.length>0&&(e.layers.set(8),r.length>0&&e.layers.enable(3),i=!0,pC(e),dC(e)),r.length===0&&a.length===0&&e.layers.set(0),e instanceof cp&&e.needsAO&&e.layers.enable(5),i}function g4(e,t){if(!t.layers)return!1;let i=!1,r=t.getLayersOfType("transmission").filter(s=>s.data.visible),a=t.getLayersOfType("outline").filter(s=>s.data.visible);return r.length>0&&(e.layers.set(3),a.length>0&&e.layers.enable(8),i=!0),r.length===0&&a.length===0&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}function dhe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof cp)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)m4(i,i.material[r])&&(t=!0);else m4(i,i.material)&&(t=!0)}),t}function phe(e){let t=!1;return e.traverseEntity(i=>{if(i instanceof cp)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)g4(i,i.material[r])&&(t=!0);else g4(i,i.material)&&(t=!0)}),t}var fhe=new v5,mhe=new Se,ghe=new Qd;function MS(e,t,i,r=!1){let a=e.cloner;if(a)for(let s of a.children){let n=mhe.copy(s.matrixWorld).invert(),o=ghe.copy(t.ray).applyMatrix4(n),l=e.matrixWorld;o.applyMatrix4(l);let c=fhe;c.set(o.origin,o.direction),c.near=t.near,c.far=t.far;let u=c.intersectObject(e,!1);u.length>0&&i.push({...u[0],object:r?s:e})}}var vhe=class{constructor(){this._constraints=new Map}setConstraint(e,t){t===null?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach((i,r)=>{let a=[r,i],s=i;for(;this._constraints.has(s);)s=this._constraints.get(s),t.has(s)||a.push(s);for(let n=a.length-2;n>=0;n--)if(!t.has(a[n])){let o=e.find(a[n]);o?o.applyPathSnapping(e):console.warn(`missing entity ${a[n]}`),t.add(a[n])}})}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},An=ar(km()),vo=ar(zm()),ji=ar(km()),St=ar(zm()),Gy=class{constructor(e,t,i){this._dataNormalized=e,this._minD=t,this._maxD=i}static createFromUnnormalized(e){let t=St.sup(e),i=St.inf(e),r=(0,ji.default)(new Float32Array(e.size),e.shape),a=t-i;return a<1e-4?St.assigns(r,0):(St.subs(r,e,i),St.divs(r,r,a)),new Gy(r,i,t)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let e=(0,ji.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return St.muls(e,this._dataNormalized,this._maxD-this._minD),St.adds(e,e,this._minD),e}},xi=class{constructor(e,t){this._quantized=e,this._method=t}get quantized(){return this._quantized}static maxIntBits(e){return 2**e-1}static fromNormalized(e,t){let i=e.data,r;if(t==="norm8x"){let a=xi.maxIntBits(8),s=(0,ji.default)(new Float32Array(i.size),i.shape);St.muls(s,i,a),St.roundeq(s),r=(0,ji.default)(new Uint8Array(s.data),i.shape)}else if(t==="norm565"){let a=(0,ji.default)(new Float32Array(i.size),i.shape);St.assign(a,i),St.mulseq(a.pick(null,0),xi.maxIntBits(5)),St.mulseq(a.pick(null,1),xi.maxIntBits(6)),St.mulseq(a.pick(null,2),xi.maxIntBits(5)),St.roundeq(a);let s=(0,ji.default)(new Uint16Array(a.data),i.shape),n=(0,ji.default)(new Uint16Array(i.shape[0]),[i.shape[0]]),o=(0,ji.default)(new Uint16Array(i.shape[0]),[i.shape[0]]);St.lshifts(n,s.pick(null,0),11),St.lshifts(o,s.pick(null,1),5),St.boreq(n,o),St.boreq(n,s.pick(null,2)),r=n}else{let a=(0,ji.default)(new Float32Array(i.size),i.shape);St.assign(a,i),St.mulseq(a.pick(null,0),xi.maxIntBits(11)),St.mulseq(a.pick(null,1),xi.maxIntBits(10)),St.mulseq(a.pick(null,2),xi.maxIntBits(11)),St.roundeq(a);let s=(0,ji.default)(new Uint32Array(a.data),i.shape),n=(0,ji.default)(new Uint32Array(i.shape[0]),[i.shape[0]]),o=(0,ji.default)(new Uint32Array(i.shape[0]),[i.shape[0]]);St.lshifts(n,s.pick(null,0),21),St.lshifts(o,s.pick(null,1),11),St.boreq(n,o),St.boreq(n,s.pick(null,2)),r=n}return new xi(r,t)}dequantize(e,t){let i=this._method,r,a=this._quantized;if(i==="norm8x"){let s=xi.maxIntBits(8);r=(0,ji.default)(new Float32Array(a.size),a.shape),St.muls(r,a,1/s)}else if(i==="norm565"){let s=(0,ji.default)(new Uint8Array(a.shape[0]),[a.shape[0]]),n=(0,ji.default)(new Uint8Array(a.shape[0]),[a.shape[0]]),o=(0,ji.default)(new Uint8Array(a.shape[0]),[a.shape[0]]);St.rrshifts(s,a,11),St.rrshifts(n,a,5),St.bandseq(n,xi.maxIntBits(6)),St.bands(o,a,xi.maxIntBits(5)),r=(0,ji.default)(new Float32Array(a.shape[0]*3),[a.shape[0],3]),St.muls(r.pick(null,0),s,1/xi.maxIntBits(5)),St.muls(r.pick(null,1),n,1/xi.maxIntBits(6)),St.muls(r.pick(null,2),o,1/xi.maxIntBits(5))}else{let s=(0,ji.default)(new Uint16Array(a.shape[0]),[a.shape[0]]),n=(0,ji.default)(new Uint16Array(a.shape[0]),[a.shape[0]]),o=(0,ji.default)(new Uint16Array(a.shape[0]),[a.shape[0]]);St.rrshifts(s,a,21),St.rrshifts(n,a,11),St.bandseq(n,xi.maxIntBits(10)),St.bands(o,a,xi.maxIntBits(11)),r=(0,ji.default)(new Float32Array(a.shape[0]*3),[a.shape[0],3]),St.muls(r.pick(null,0),s,1/xi.maxIntBits(11)),St.muls(r.pick(null,1),n,1/xi.maxIntBits(10)),St.muls(r.pick(null,2),o,1/xi.maxIntBits(11))}return new Gy(r,e,t)}},Pi=class{constructor(t,i,r,a,s,n=!1){this._quantized=t,this._minMaxMatrix=i,this._chunkSize=r,this._quantizationMethod=a,this._variableChunkSize=s,this._isDynamicChunks=n}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(t){let i=t.length,r=this.minmaxMatrix.shape[0]-i,a=(0,An.default)(new Float32Array(r*2),[r,2]),s=0,n=r,o=0,l=this.minmaxMatrix.shape[0];for(let c=0;c<t.length;c++)l=t[c],n=l-o+s,n>s&&vo.assign(a.hi(n,2).lo(s,0),this.minmaxMatrix.hi(l,2).lo(o,0)),s=n,o=l+1;return s<r&&vo.assign(a.lo(s,0),this.minmaxMatrix.lo(o,0)),a}_createPrunedQuantized(t){let i=t.length,r=this.quantized.shape[0]-i,a=this._quantizationMethod,s,n;if(a==="norm8x"){n=this._quantized.shape[1];let h=n?r*n:r;s=(0,An.default)(new Uint8Array(h),n?[r,n]:[r,1])}else a==="norm565"?s=(0,An.default)(new Uint16Array(r),[r]):s=(0,An.default)(new Uint32Array(r),[r]);let o=0,l=r,c=0,u=s.shape[0];for(let h=0;h<t.length;h++)u=t[h],l=u-c+o,l>o&&(n?vo.assign(s.hi(l,n).lo(o,0),this._quantized.hi(u,n).lo(c,0)):vo.assign(s.hi(l).lo(o),this._quantized.hi(u).lo(c))),o=l,c=u+1;return o<r&&(n?vo.assign(s.lo(o,0),this._quantized.lo(c,0)):vo.assign(s.lo(o),this._quantized.lo(c))),s}pruneFeature(t,i,r){let a=this._createPrunedQuantized(t),s=this._createPrunedMinMax(i);return new Pi(a,s,this._chunkSize,this._quantizationMethod,r,!0)}static getRequiredNChunks(t,i){return Math.floor(t/i)}static fromArray(t,i,r){let a=t.shape[0],s=Math.floor(a/r),n=(0,An.default)(new Float32Array(s*2),[s,2],[2,1]),o;i==="norm8x"?o=(0,An.default)(new Uint8Array(t.size),t.shape):i==="norm565"?o=(0,An.default)(new Uint16Array(t.shape[0]),[t.shape[0]]):o=(0,An.default)(new Uint32Array(t.shape[0]),[t.shape[0]]);for(let l=0;l<s;l++){let c=l*r,u=l+1<s?(l+1)*r:a,h;t.shape.length>1?h=Gy.createFromUnnormalized(t.hi(u,t.shape[1]).lo(c,0)):h=Gy.createFromUnnormalized(t.hi(u).lo(c)),n.set(l,0,h.minD),n.set(l,1,h.maxD),o.shape.length>1?vo.assign(o.hi(u,o.shape[1]).lo(c,0),xi.fromNormalized(h,i).quantized):vo.assign(o.hi(u).lo(c),xi.fromNormalized(h,i).quantized)}return new Pi(o,n,r,i)}denormDequant(){let t=this._minMaxMatrix.shape[0],i=this._quantized,r=i.shape[0],a=this._quantizationMethod,s=this._chunkSize,n;if(this._isDynamicChunks){if(!this._variableChunkSize)throw new Error("variable chunk must exists if chunkSize isDynamic");n=this._variableChunkSize}let o;a==="norm8x"?o=(0,An.default)(new Float32Array(i.size),i.shape):o=(0,An.default)(new Float32Array(r*3),[r,3]);let l=0,c=s;for(let u=0;u<t;u++){let[h,d]=[this._minMaxMatrix.get(u,0),this._minMaxMatrix.get(u,1)];this._isDynamicChunks&&(c=n[u]);let p=u+1<t?l+c:r,f;i.shape.length>1?f=new xi(i.hi(p,i.shape[1]).lo(l,0),a):f=new xi(i.hi(p).lo(l),a),vo.assign(o.hi(p,o.shape[1]).lo(l,0),f.dequantize(h,d).denormalize()),l=p}return o}static async fetchArrayBuffer(t){return await(await fetch(t,{mode:"cors"})).arrayBuffer()}},vl=ar(km()),Rt=ar(zm()),yhe="http://127.0.0.1:8000",pd=ar(km()),Qi=ar(zm()),v4=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function y4(e){return e<1e5?e<100?e<10?0:1:e<1e4?e<1e3?2:3:4:e<1e7?e<1e6?5:6:e<1e9?e<1e8?7:8:9}function x4(e,t){if(e===t)return 0;if(~~e===e&&~~t===t){if(e===0||t===0)return e<t?-1:1;if(e<0||t<0){if(t>=0)return-1;if(e>=0)return 1;e=-e,t=-t}let a=y4(e),s=y4(t),n=0;return a<s?(e*=v4[s-a-1],t/=10,n=-1):a>s&&(t*=v4[a-s-1],e/=10,n=1),e===t?n:e<t?-1:1}let i=String(e),r=String(t);return i===r?0:i<r?-1:1}function xhe(e){let t=0;for(;e>=32;)t|=e&1,e>>=1;return e+t}function b4(e,t,i,r){let a=t+1;if(a===i)return 1;if(r(e[a++],e[t])<0){for(;a<i&&r(e[a],e[a-1])<0;)a++;bhe(e,t,a)}else for(;a<i&&r(e[a],e[a-1])>=0;)a++;return a-t}function bhe(e,t,i){for(i--;t<i;){let r=e[t];e[t++]=e[i],e[i--]=r}}function w4(e,t,i,r,a){for(r===t&&r++;r<i;r++){let s=e[r],n=t,o=r;for(;n<o;){let c=n+o>>>1;a(s,e[c])<0?o=c:n=c+1}let l=r-n;switch(l){case 3:e[n+3]=e[n+2];case 2:e[n+2]=e[n+1];case 1:e[n+1]=e[n];break;default:for(;l>0;)e[n+l]=e[n+l-1],l--}e[n]=s}}function vw(e,t,i,r,a,s){let n=0,o=0,l=1;if(s(e,t[i+a])>0){for(o=r-a;l<o&&s(e,t[i+a+l])>0;)n=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o),n+=a,l+=a}else{for(o=a+1;l<o&&s(e,t[i+a-l])<=0;)n=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o);let c=n;n=a-l,l=a-c}for(n++;n<l;){let c=n+(l-n>>>1);s(e,t[i+c])>0?n=c+1:l=c}return l}function yw(e,t,i,r,a,s){let n=0,o=0,l=1;if(s(e,t[i+a])<0){for(o=a+1;l<o&&s(e,t[i+a-l])<0;)n=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o);let c=n;n=a-l,l=a-c}else{for(o=r-a;l<o&&s(e,t[i+a+l])>=0;)n=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o),n+=a,l+=a}for(n++;n<l;){let c=n+(l-n>>>1);s(e,t[i+c])<0?l=c:n=c+1}return l}var whe=class{constructor(e,t){pa(this,"array",null),pa(this,"compare",null),pa(this,"minGallop",7),pa(this,"length",0),pa(this,"tmpStorageLength",256),pa(this,"stackLength",0),pa(this,"runStart",null),pa(this,"runLength",null),pa(this,"stackSize",0),this.array=e,this.compare=t,this.length=e.length,this.length<2*256&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}pushRun(e,t){this.runStart[this.stackSize]=e,this.runLength[this.stackSize]=t,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;if(e>=1&&this.runLength[e-1]<=this.runLength[e]+this.runLength[e+1]||e>=2&&this.runLength[e-2]<=this.runLength[e]+this.runLength[e-1])this.runLength[e-1]<this.runLength[e+1]&&e--;else if(this.runLength[e]>this.runLength[e+1])break;this.mergeAt(e)}}forceMergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;e>0&&this.runLength[e-1]<this.runLength[e+1]&&e--,this.mergeAt(e)}}mergeAt(e){let t=this.compare,i=this.array,r=this.runStart[e],a=this.runLength[e],s=this.runStart[e+1],n=this.runLength[e+1];this.runLength[e]=a+n,e===this.stackSize-3&&(this.runStart[e+1]=this.runStart[e+2],this.runLength[e+1]=this.runLength[e+2]),this.stackSize--;let o=yw(i[s],i,r,a,0,t);r+=o,a-=o,a!==0&&(n=vw(i[r+a-1],i,s,n,n-1,t),n!==0&&(a<=n?this.mergeLow(r,a,s,n):this.mergeHigh(r,a,s,n)))}mergeLow(e,t,i,r){let a=this.compare,s=this.array,n=this.tmp,o=0;for(o=0;o<t;o++)n[o]=s[e+o];let l=0,c=i,u=e;if(s[u++]=s[c++],--r===0){for(o=0;o<t;o++)s[u+o]=n[l+o];return}if(t===1){for(o=0;o<r;o++)s[u+o]=s[c+o];s[u+r]=n[l];return}let h=this.minGallop;for(;;){let d=0,p=0,f=!1;do if(a(s[c],n[l])<0){if(s[u++]=s[c++],p++,d=0,--r===0){f=!0;break}}else if(s[u++]=n[l++],d++,p=0,--t===1){f=!0;break}while((d|p)<h);if(f)break;do{if(d=yw(s[c],n,l,t,0,a),d!==0){for(o=0;o<d;o++)s[u+o]=n[l+o];if(u+=d,l+=d,t-=d,t<=1){f=!0;break}}if(s[u++]=s[c++],--r===0){f=!0;break}if(p=vw(n[l],s,c,r,0,a),p!==0){for(o=0;o<p;o++)s[u+o]=s[c+o];if(u+=p,c+=p,r-=p,r===0){f=!0;break}}if(s[u++]=n[l++],--t===1){f=!0;break}h--}while(d>=7||p>=7);if(f)break;h<0&&(h=0),h+=2}if(this.minGallop=h,h<1&&(this.minGallop=1),t===1){for(o=0;o<r;o++)s[u+o]=s[c+o];s[u+r]=n[l]}else{if(t===0)throw new Error("mergeLow preconditions were not respected");for(o=0;o<t;o++)s[u+o]=n[l+o]}}mergeHigh(e,t,i,r){let a=this.compare,s=this.array,n=this.tmp,o=0;for(o=0;o<r;o++)n[o]=s[i+o];let l=e+t-1,c=r-1,u=i+r-1,h=0,d=0;if(s[u--]=s[l--],--t===0){for(h=u-(r-1),o=0;o<r;o++)s[h+o]=n[o];return}if(r===1){for(u-=t,l-=t,d=u+1,h=l+1,o=t-1;o>=0;o--)s[d+o]=s[h+o];s[u]=n[c];return}let p=this.minGallop;for(;;){let f=0,m=0,g=!1;do if(a(n[c],s[l])<0){if(s[u--]=s[l--],f++,m=0,--t===0){g=!0;break}}else if(s[u--]=n[c--],m++,f=0,--r===1){g=!0;break}while((f|m)<p);if(g)break;do{if(f=t-yw(n[c],s,e,t,t-1,a),f!==0){for(u-=f,l-=f,t-=f,d=u+1,h=l+1,o=f-1;o>=0;o--)s[d+o]=s[h+o];if(t===0){g=!0;break}}if(s[u--]=n[c--],--r===1){g=!0;break}if(m=r-vw(s[l],n,0,r,r-1,a),m!==0){for(u-=m,c-=m,r-=m,d=u+1,h=c+1,o=0;o<m;o++)s[d+o]=n[h+o];if(r<=1){g=!0;break}}if(s[u--]=s[l--],--t===0){g=!0;break}p--}while(f>=7||m>=7);if(g)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),r===1){for(u-=t,l-=t,d=u+1,h=l+1,o=t-1;o>=0;o--)s[d+o]=s[h+o];s[u]=n[c]}else{if(r===0)throw new Error("mergeHigh preconditions were not respected");for(h=u-(r-1),o=0;o<r;o++)s[h+o]=n[o]}}};function _he(e,t,i,r){if(!Array.isArray(e))throw new TypeError("Can only sort arrays");t?typeof t!="function"&&(r=i,i=t,t=x4):t=x4,i||(i=0),r||(r=e.length);let a=r-i;if(a<2)return;let s=0;if(a<32){s=b4(e,i,r,t),w4(e,i,r,i+s,t);return}let n=new whe(e,t),o=xhe(a);do{if(s=b4(e,i,r,t),s<o){let l=a;l>o&&(l=o),w4(e,i,i+l,i+s,t),s=l}n.pushRun(i,s),n.mergeRuns(),a-=s,i+=s}while(a!==0);n.forceMergeRuns()}function xw(e){let t=(0,pd.default)(new Int32Array(e.shape[0]),[e.shape[0]]),i=(0,pd.default)(new Int32Array(e.shape[0]),[e.shape[0]]);return Qi.bands(t,e,1023),Qi.lshifts(i,t,16),Qi.bxoreq(t,i),Qi.bandseq(t,4278190335),Qi.lshifts(i,t,8),Qi.bxoreq(t,i),Qi.bandseq(t,50393103),Qi.lshifts(i,t,4),Qi.bxoreq(t,i),Qi.bandseq(t,51130563),Qi.lshifts(i,t,2),Qi.bxoreq(t,i),Qi.bandseq(t,153391689),t}function She(e){let t=xw(e.pick(null,0)),i=xw(e.pick(null,1));Qi.lshiftseq(i,1);let r=xw(e.pick(null,2));return Qi.lshiftseq(r,2),Qi.boreq(t,i),Qi.boreq(t,r),t}function ru(e,t){if(e.shape[0]!==t.shape[0])throw new Error("wrong length");let i=(0,pd.default)(new Float32Array(e.size),e.shape,e.stride,e.offset);for(let r=0;r<t.shape[0];r++){let a=t.get(r);if(e.shape.length>1)for(let s=0;s<e.shape[1];s++)i.set(r,s,e.get(a,s));else i.set(r,e.get(a))}return i}function Ahe(e){let t=Qi.sup(e),i=Qi.inf(e),r=1e3/Math.min(1e3,t-i),a=(0,pd.default)(new Float32Array(e.data),e.shape);Qi.mulseq(a,r);let s=(0,pd.default)(new Int32Array(a.data),e.shape),n=She(s),o=Array.from(n.data).map((c,u)=>[c,u]);_he(o,(c,u)=>c[0]-u[0]);let l=o.map(([c,u])=>u);return(0,pd.default)(Uint32Array.from(l))}var Dc=class{constructor(e,t,i,r,a,s,n,o,l,c){this.propertyDescs=e,this.format=t,this.nsplats=i,this.xyz=r,this.colors=a,this.harmonics=s,this.opacity=n,this.scaling=o,this.rotation=l,this.maxSHDegree=c}getPlyBinary(){let e=Dc._generateHeaderString(this.propertyDescs,this.format,this.nsplats),t=new TextEncoder().encode(e),i=Object.keys(this.propertyDescs).length,r=(0,vl.default)(new Float32Array(this.nsplats*i),[this.nsplats,i]);if(Rt.assign(r.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),Rt.assign(r.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),Rt.assign(r.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),Rt.assign(r.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),Rt.assign(r.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),Rt.assign(r.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),Rt.assign(r.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),Rt.assign(r.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),Rt.assign(r.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),Rt.assign(r.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),Rt.assign(r.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),Rt.assign(r.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),Rt.assign(r.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),Rt.assign(r.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let n=0;n<this.harmonics.length;n++){let o=n*3;Rt.assign(r.pick(null,this.propertyDescs[`f_rest_${o}`].index),this.harmonics[n].pick(null,0)),Rt.assign(r.pick(null,this.propertyDescs[`f_rest_${o+1}`].index),this.harmonics[n].pick(null,1)),Rt.assign(r.pick(null,this.propertyDescs[`f_rest_${o+2}`].index),this.harmonics[n].pick(null,2))}let a=new Uint8Array(r.data.buffer),s=new Uint8Array(a.length+t.length);return s.set(t),s.set(a,t.length),s.buffer}save(e,t){let i=this.getPlyBinary(),r=new Blob([i],{type:"application/octet-stream"}),a=new File([r],e),s=new FormData;s.append("file",a),s.append("filename",e),s.append("basedir",t),fetch(`${yhe}/push_file`,{method:"POST",body:s})}static async loadFile(e){return await(await fetch(e)).arrayBuffer()}mortonPositionSplatsSort(){let e=Ahe(this.xyz),t=ru(this.xyz,e),i=ru(this.colors,e),r=ru(this.opacity,e),a=ru(this.scaling,e),s=ru(this.rotation,e),n=[];for(let o=0;o<this.harmonics.length;o++)n.push(ru(this.harmonics[o],e));return new Dc(this.propertyDescs,this.format,this.nsplats,t,i,n,r,a,s,this.maxSHDegree)}static _generateHeaderString(e,t,i){let r=`ply
format ${t.format} ${t.version}
element vertex ${i}`,a=Object.keys(e).length,s=Array(a);for(let n in e){let o=e[n];s[o.index]={name:n,dtype:o.dtype}}for(let n=0;n<s.length;n++)r=`${r}
property ${s[n].dtype} ${s[n].name}`;return`${r}
end_header
`}static fromArrayBuffer(e,t=3){let{splatCount:i,vertexData:r,propertiesDesc:a,format:s}=Dc.decodeHeader(e),n=r.buffer.slice(r.byteOffset),o=Object.keys(a).length,l=(0,vl.default)(new Float32Array(n),[i,o]),c=0,u={},h={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1};for(let x in a)if(a.hasOwnProperty(x)){let w=a[x].dtype;u[x]=c,c+=h[w]}let d=(0,vl.default)(new Float32Array(i*3),[i,3]);Rt.assign(d.pick(null,0),l.pick(null,u.x/4)),Rt.assign(d.pick(null,1),l.pick(null,u.y/4)),Rt.assign(d.pick(null,2),l.pick(null,u.z/4));let p=(0,vl.default)(new Float32Array(i*3),[i,3]);Rt.assign(p.pick(null,0),l.pick(null,u.scale_0/4)),Rt.assign(p.pick(null,1),l.pick(null,u.scale_1/4)),Rt.assign(p.pick(null,2),l.pick(null,u.scale_2/4));let f=(0,vl.default)(new Float32Array(i*3),[i,3]);Rt.assign(f.pick(null,0),l.pick(null,u.f_dc_0/4)),Rt.assign(f.pick(null,1),l.pick(null,u.f_dc_1/4)),Rt.assign(f.pick(null,2),l.pick(null,u.f_dc_2/4));let m=(0,vl.default)(new Float32Array(i*4),[i,4]);Rt.assign(m.pick(null,0),l.pick(null,u.rot_1/4)),Rt.assign(m.pick(null,1),l.pick(null,u.rot_2/4)),Rt.assign(m.pick(null,2),l.pick(null,u.rot_3/4)),Rt.assign(m.pick(null,3),l.pick(null,u.rot_0/4));for(let x=0;x<i;x++){let w=m.pick(x,null),S=Math.sqrt(w.get(0)**2+w.get(1)**2+w.get(2)**2+w.get(3)**2);Rt.divseq(w,S)}let g=(0,vl.default)(new Float32Array(i*1),[i,1]);Rt.assign(g.pick(null,0),l.pick(null,u.opacity/4));let v=(Math.min(Math.max(t,0),3)+1)**2-1,y=[];for(let x=0;x<v;x++){let w=(0,vl.default)(new Float32Array(i*3),[i,3]),S=x*3;Rt.assign(w.pick(null,0),l.pick(null,u[`f_rest_${S}`]/4)),Rt.assign(w.pick(null,1),l.pick(null,u[`f_rest_${S+1}`]/4)),Rt.assign(w.pick(null,2),l.pick(null,u[`f_rest_${S+2}`]/4)),y.push(w)}return new Dc(a,s,i,d,f,y,g,p,m,t)}static async fromPLYFile(e,t=3){let i=await Dc.loadFile(e);return Dc.fromArrayBuffer(i,t)}static decodeHeader(e){let t=new TextDecoder,i=0,r="",a=100;for(;;){if(i+a>=e.byteLength)throw new Error("End of file reached while searching for end of header");let d=new Uint8Array(e,i,a);r+=t.decode(d),i+=a;let p=i-a*2,f=new Uint8Array(e,Math.max(0,p),p>0?a*2:a);if(t.decode(f).includes("end_header"))break}let s=r.split(`
`),n=0,o={},l=0,c;for(let d=0;d<s.length;d++){let p=s[d].trim();if(p.startsWith("element vertex")){let f=p.match(/\d+/);f&&(n=parseInt(f[0]))}else if(p.startsWith("property")){let f=p.match(/(\w+)\s+(\w+)\s+(\w+)/);if(f){let m=f[2],g=f[3];o[g]={dtype:m,index:l},l++}}else if(p.startsWith("format")){let f=p.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);f&&(c={format:f[2],version:f[3]})}else if(p==="end_header")break}let u=r.indexOf("end_header")+10+1,h=new DataView(e,u);return{splatCount:n,vertexData:h,headerOffset:i,propertiesDesc:o,format:c}}},TS=class{constructor(e,t,i,r,a,s,n,o){this.config=e,this.xyz=t,this.scaling=i,this.color=r,this.opacity=a,this.harmonics=n,this.quaternion=s,this.variableChunkSize=o}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(e,t){let i=Pi.fromArray(e.xyz,t.xyz,t.chunkSize),r=Pi.fromArray(e.scaling,t.scaling,t.chunkSize),a=Pi.fromArray(e.colors,t.color,t.chunkSize),s=Pi.fromArray(e.opacity,t.opacity,t.chunkSize),n=Pi.fromArray(e.rotation,t.quaternion,t.chunkSize),o=e.harmonics,l=[];if(t.harmonics)for(let c=0;c<o.length;c++){let u=Pi.fromArray(o[c],t.harmonics,t.chunkSize);l.push(u)}return new TS(t,i,r,a,s,n,l)}_countIndexesInChunks(e){let t=[],i=this.nchunks,r=this.chunkSize,a=this.nsplats,s=Pi.getRequiredNChunks(a,r);if(i===s)for(let n=0;n<e.length;n++){let o=e[n],l=Math.floor(o/this.chunkSize);l in t?t[l].push(o):t[l]=[o]}else{let n=this.variableChunkSize,o={},l=0;for(let c=0;c<i;c++)o[c]=l,l+=n[c];for(let c=0;c<e.length;c++){let u=e[c],h=Math.min(Math.floor(u/r),i-1);for(;u>=o[h]+n[h];)h++;h in t?t[h].push(u):t[h]=[u]}}return t}pruneSplats(e){let t=this._countIndexesInChunks(e),i,r=[];return t.length>0&&(i=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),t.forEach((a,s)=>{i[s]-=a.length,i[s]<=0&&r.push(s)}),i=i.filter(a=>a>0)),new TS(this.config,this.xyz.pruneFeature(e,r,i),this.scaling.pruneFeature(e,r,i),this.color.pruneFeature(e,r,i),this.opacity.pruneFeature(e,r,i),this.quaternion.pruneFeature(e,r,i),this.harmonics?this.harmonics.map(a=>a.pruneFeature(e,r,this.variableChunkSize)):void 0,i)}static async loadConfig(e){return await(await fetch(e,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){var a;let e={format:"binary_little_endian",version:"1.0"},t={},i=0;if(t.x={dtype:"float",index:i},i++,t.y={dtype:"float",index:i},i++,t.z={dtype:"float",index:i},i++,t.f_dc_0={dtype:"float",index:i},i++,t.f_dc_1={dtype:"float",index:i},i++,t.f_dc_2={dtype:"float",index:i},i++,this.harmonics&&this.harmonics.length>0)for(let s=0;s<this.harmonics.length;s++)t[`f_rest_${s}`]={dtype:"float",index:i},i++,t[`f_rest_${s+1}`]={dtype:"float",index:i},i++,t[`f_rest_${s+2}`]={dtype:"float",index:i},i++;t.opacity={dtype:"float",index:i},i++,t.scale_0={dtype:"float",index:i},i++,t.scale_1={dtype:"float",index:i},i++,t.scale_2={dtype:"float",index:i},i++,t.rot_0={dtype:"float",index:i},i++,t.rot_1={dtype:"float",index:i},i++,t.rot_2={dtype:"float",index:i},i++,t.rot_3={dtype:"float",index:i},i++;let r=(a=this.harmonics)==null?void 0:a.map(s=>s.denormDequant());return new Dc(t,e,this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),r||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},au=ar(km()),ds=ar(zm()),_4={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},PS=class{constructor(e){this._buffer=e}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let e=.28209479177387814,t=this.decoded.color.denormDequant(),i=this.decoded.opacity.denormDequant(),r=(0,au.default)(new Float32Array(t.shape[0]*4),[t.shape[0],4]);return ds.mulseq(t,e),ds.addseq(t,.5),ds.mulseq(t,255),ds.maxseq(t,0),ds.minseq(t,255),ds.negeq(i),ds.expeq(i),ds.addseq(i,1),ds.recipeq(i),ds.mulseq(i,255),ds.assign(r.hi(t.shape[0],3).lo(0,0),t),ds.assign(r.hi(t.shape[0],4).lo(0,3),i),(0,au.default)(new Uint8Array(r.data),[t.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:e,chunkCount:t,chunkSize:i,typeChunks:r,vertexData:a,propertiesDesc:s}=this.decodeHeader(),n={xyz:s.xyz.compressionMethod,color:s.color.compressionMethod,opacity:s.opacity.compressionMethod,scaling:s.scaling.compressionMethod,quaternion:s.quaternion.compressionMethod,chunkSize:i};s.harmonics_0&&(n.harmonics=s.harmonics_0.compressionMethod);let o=a.byteOffset,l=Array(Object.keys(s).length);for(let g in s)l[s[g].index]={name:g,method:s[g].compressionMethod};let c=t*2*4,u=o,h=r==="dynamic"?t*2:0,d,p=!1;if(h>0){let g=new Uint16Array(a.buffer.slice(u,u+h));u+=h,d=Array.from(g),p=!0}let f={};for(let g of l){let v=0,y=!0;if(g.method==="norm8x")v=e*1*_4[g.name];else if(g.method==="norm11")v=e*4;else if(g.method==="norm565")v=e*2;else throw y=!1,new Error(`Not Implemented format: ${g.method}`);let x;if(y){let _=a.buffer.slice(u,u+c);x=(0,au.default)(new Float32Array(_),[t,2]),u+=c}else throw new Error("loading chunk byt hasnot minmax!");let w=a.buffer.slice(u,u+v);u+=v;let S;if(g.method==="norm8x")S=(0,au.default)(new Uint8Array(w),[e,_4[g.name]]);else if(g.method==="norm11")S=(0,au.default)(new Uint32Array(w));else if(g.method==="norm565")S=(0,au.default)(new Uint16Array(w));else throw new Error(`Not Implemented format: ${g.method}`);f[g.name]=new Pi(S,x,i,g.method,d,p)}let m=[];for(let g=0;g<15;g++){let v=f[`harmonics_${g}`];v&&(m.push(v),delete f[`harmonics_${g}`])}return m.length>0&&(f.harmonics=m),new TS(n,f.xyz,f.scaling,f.color,f.opacity,f.quaternion,f.harmonics,d)}buildPreComputedBuffers(){let e=this.decoded,t=e.nsplats,i=new ArrayBuffer(24*t),r=new Float32Array(i),a=e.scaling.denormDequant(),s=e.quaternion.denormDequant(),n=new ut,o=new Ui,l=new Ui,c=new Ui,u=new Se;for(let h=0;h<t;h++){u.makeScale(Math.exp(a.get(h,0)),Math.exp(a.get(h,1)),Math.exp(a.get(h,2))),l.setFromMatrix4(u),n.set(s.get(h,0),s.get(h,1),s.get(h,2),s.get(h,3)),u.makeRotationFromQuaternion(n),o.setFromMatrix4(u),c.copy(o).multiply(l);let d=c.elements;r[6*h]=d[0]*d[0]+d[3]*d[3]+d[6]*d[6],r[6*h+1]=d[0]*d[1]+d[3]*d[4]+d[6]*d[7],r[6*h+2]=d[0]*d[2]+d[3]*d[5]+d[6]*d[8],r[6*h+3]=d[1]*d[1]+d[4]*d[4]+d[7]*d[7],r[6*h+4]=d[1]*d[2]+d[4]*d[5]+d[7]*d[8],r[6*h+5]=d[2]*d[2]+d[5]*d[5]+d[8]*d[8]}this._precomputedCovarianceBufferData=i}decodeHeader(){let e=this._buffer,t=new TextDecoder,i=0,r="",a=100;for(;;){if(i+a>=e.byteLength)throw new Error("End of file reached while searching for end of header");let f=new Uint8Array(e,i,a);r+=t.decode(f),i+=a;let m=i-a*2,g=new Uint8Array(e,Math.max(0,m),m>=0?a*2:a);if(t.decode(g).includes("end_header"))break}let s=r.split(`
`),n=0,o=0,l=0,c=0,u="",h={};for(let f=0;f<s.length;f++){let m=s[f].trim();if(m.startsWith("element vertex")){let g=m.match(/\d+/);g&&(n=parseInt(g[0]))}else if(m.startsWith("property")){let g=m.match(/(\w+)\s+(\w+)\s+(\w+)/);if(g){let v=g[2],y=g[3];h[v]={compressionMethod:y,index:c},c++}}else if(m.startsWith("element chunks")){let g=m.match(/\d+/);g&&(o=parseInt(g[0]))}else if(m.startsWith("element chunkSize")){let g=m.match(/\d+/);g&&(l=parseInt(g[0]))}else if(m.startsWith("element typeChunks")){let g=m.match(/(\w+)\s+(\w+)\s+(\w+)/);g&&(u=g[3])}else if(m==="end_header")break}let d=r.indexOf("end_header")+10+1,p=new DataView(e,d);return{splatCount:n,chunkCount:o,chunkSize:l,typeChunks:u,vertexData:p,propertiesDesc:h}}pruneSplats(e){let t=this.decodeBuffer().pruneSplats(e);return PS.fromCompressedGaussianSplats(t)}static fromCompressedGaussianSplats(e){let t=e.xyz.length,i=e.xyz.nchunks,r=`gspline
element vertex ${t}
element chunks ${i}
element chunkSize ${e.chunkSize}
element typeChunks ${e.isDynamicChunks?"dynamic":"static"}
property xyz ${e.xyz.method}
property color ${e.color.method}
property opacity ${e.opacity.method}
property scaling ${e.scaling.method}
property quaternion ${e.quaternion.method}`;if(e.harmonics&&e.harmonics.length>0)for(let A=0;A<e.harmonics.length;A++)r=`${r}
property harmonics_${A} ${e.harmonics[A].method}`;r=`${r}
end_header
`;let a=new TextEncoder().encode(r),s=i*2*4,n=e.xyz.quantized.data.buffer.byteLength,o=e.xyz instanceof Pi?s:0,l=e.color.quantized.data.buffer.byteLength,c=e.color instanceof Pi?s:0,u=e.opacity.quantized.data.buffer.byteLength,h=e.opacity instanceof Pi?s:0,d=e.scaling.quantized.data.buffer.byteLength,p=e.scaling instanceof Pi?s:0,f=e.quaternion.quantized.data.buffer.byteLength,m=e.quaternion instanceof Pi?s:0,g=e.variableChunkSize?Uint16Array.from(e.variableChunkSize):void 0,v=g?g.byteLength:0,y=a.byteLength+v+n+o+l+c+u+h+d+p+f+m,x=0,w=0;if(e.harmonics&&e.harmonics.length>0)for(let A=0;A<e.harmonics.length;A++)x+=e.harmonics[A].quantized.data.buffer.byteLength,w+=e.harmonics[A]instanceof Pi?s:0;x=0,w=0,y+=x+w;let S=new Uint8Array(y),_=0;if(S.set(a,_),_+=a.byteLength,v>0&&(S.set(new Uint8Array(g.buffer),_),_+=v),e.xyz instanceof Pi&&(S.set(new Uint8Array(e.xyz.minmaxMatrix.data.buffer),_),_+=s),S.set(new Uint8Array(e.xyz.quantized.data.buffer),_),_+=n,e.color instanceof Pi&&(S.set(new Uint8Array(e.color.minmaxMatrix.data.buffer),_),_+=s),S.set(new Uint8Array(e.color.quantized.data.buffer),_),_+=l,e.opacity instanceof Pi&&(S.set(new Uint8Array(e.opacity.minmaxMatrix.data.buffer),_),_+=s),S.set(new Uint8Array(e.opacity.quantized.data.buffer),_),_+=u,e.scaling instanceof Pi&&(S.set(new Uint8Array(e.scaling.minmaxMatrix.data.buffer),_),_+=s),S.set(new Uint8Array(e.scaling.quantized.data.buffer),_),_+=d,e.quaternion instanceof Pi&&(S.set(new Uint8Array(e.quaternion.minmaxMatrix.data.buffer),_),_+=s),S.set(new Uint8Array(e.quaternion.quantized.data.buffer),_),_+=f,x>0&&e.harmonics&&e.harmonics.length>0)for(let A=0;A<e.harmonics.length;A++){let E=e.harmonics[A];E instanceof Pi&&(S.set(new Uint8Array(E.minmaxMatrix.data.buffer),_),_+=s),S.set(new Uint8Array(E.quantized.data.buffer),_),_+=E.quantized.data.byteLength}return new PS(S.buffer)}},Ehe="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",Gl=class{};pa(Gl,"DepthMapRange",65536),pa(Gl,"MemoryPageSize",65536),pa(Gl,"BytesPerFloat",4),pa(Gl,"BytesPerInt",4);function Che(e){let t,i,r,a,s,n,o,l,c,u,h,d,p,f,m,g;function v(T){let D=new Float64Array(u,n,16);for(let O=0;O<16;O++)D[O]=T[O];let I;if(r>1){t.exports.sortIndexes(a,s,c,n,o,l,d.DepthMapRange,r);let O=new Uint32Array(r);I=O.buffer,O.set(new Uint32Array(u,l,r))}else if(r===1){let O=new Uint32Array(r);O[0]=new Uint32Array(u,a,i)[0],I=O.buffer}else I=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:I},[I])}function y(T,D,I){let O=new Float32Array(u,s,i*3);r=0;let B=new Uint32Array(u,a,i);for(let q=0;q<I.length-1;q++){let F=D[q],L=T[q].elements,X=F.filter(U=>U.enabled&&U.mode==="Include").map(U=>U.type==="Box"?_(U):M(U)),G=F.filter(U=>U.enabled&&U.mode==="Exclude").map(U=>U.type==="Box"?_(U):M(U));for(let U=I[q];U<I[q+1];U++){let H=p[U*3],$=p[U*3+1],Y=p[U*3+2];if((X.length===0||w(H,$,Y,X))&&(G.length===0||!w(H,$,Y,G))){let J=1/(L[3]*H+L[7]*$+L[11]*Y+L[15]);O[r*3]=(L[0]*H+L[4]*$+L[8]*Y+L[12])*J,O[r*3+1]=(L[1]*H+L[5]*$+L[9]*Y+L[13])*J,O[r*3+2]=(L[2]*H+L[6]*$+L[10]*Y+L[14])*J,B[r]=U,r++}}}}function x(T,D){let I=[],O=D.filter(F=>F.enabled&&F.mode==="Include").map(F=>F.type==="Box"?_(F):M(F)),B=D.filter(F=>F.enabled&&F.mode==="Exclude").map(F=>F.type==="Box"?_(F):M(F)),q=T.length;for(let F=0;F<q;F+=3){let L=T[F],X=T[F+1],G=T[F+2];(O.length===0||w(L,X,G,O))&&(B.length===0||!w(L,X,G,B))||I.push(F/3)}return console.log(I),I}function w(T,D,I,O,B){return O[B==="Intersect"?"every":"some"](q=>{let F=S(T,D,I,q.invRotationMatrix,q.cropCenter);return Array.isArray(q)?E(F.x,F.y,F.z,q):C(F.x,F.y,F.z,q)})}function S(T,D,I,O,B){let q=T-B[0],F=D-B[1],L=I-B[2],X=1/(O[3]*q+O[7]*F+O[11]*L+O[15]);return{x:(O[0]*q+O[4]*F+O[8]*L+O[12])*X+B[0],y:(O[1]*q+O[5]*F+O[9]*L+O[13])*X+B[1],z:(O[2]*q+O[6]*F+O[10]*L+O[14])*X+B[2]}}function _(T){let D=T.cropSize[0]/2,I=T.cropSize[1]/2,O=T.cropSize[2]/2,B=[T.cropCenter[0]-D,T.cropCenter[1]-I,T.cropCenter[2]-O,T.cropCenter[0]+D,T.cropCenter[1]+I,T.cropCenter[2]+O],q=A(T.cropRotation);return Object.assign(B,{invRotationMatrix:q,cropCenter:T.cropCenter})}function A(T){let D=[],I=T[0]*Math.PI/180,O=T[1]*Math.PI/180,B=T[2]*Math.PI/180,q=Math.cos(I),F=Math.sin(I),L=Math.cos(O),X=Math.sin(O),G=Math.cos(B),U=Math.sin(B),H=q*G,$=q*U,Y=F*G,J=F*U;return D[0]=L*G,D[1]=-L*U,D[2]=X,D[4]=$+Y*X,D[5]=H-J*X,D[6]=-F*L,D[8]=J-H*X,D[9]=Y+$*X,D[10]=q*L,D[12]=0,D[13]=0,D[14]=0,D[3]=0,D[7]=0,D[11]=0,D[15]=1,D}function E(T,D,I,O){return T>=O[0]&&T<=O[3]&&D>=O[1]&&D<=O[4]&&I>=O[2]&&I<=O[5]}function M(T){let D=2/T.cropSize[0],I=2/T.cropSize[1],O=2/T.cropSize[2],B=A(T.cropRotation);return{invRadiusX:D,invRadiusY:I,invRadiusZ:O,cropCenter:T.cropCenter,invRotationMatrix:B}}function C(T,D,I,O){let B=(T-O.cropCenter[0])*O.invRadiusX,q=(D-O.cropCenter[1])*O.invRadiusY,F=(I-O.cropCenter[2])*O.invRadiusZ;return B*B+q*q+F*F<=1}e.onmessage=T=>{if(T.data.getCroppedIndexes){let D=new Uint32Array(x(new Float32Array(T.data.positions),T.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:D},[D])}else if(T.data.positions)h=T.data.positions,p=new Float32Array(h),m=T.data.meshMatrixWorlds,g=T.data.cropsArray,f=T.data.meshIndexIntervals,y(m,g,f),e.postMessage({sortSetupComplete:!0});else if(T.data.sort||T.data.newMatrixWorlds||T.data.newCropsArray)(T.data.newMatrixWorlds||T.data.newCropsArray)&&(g=T.data.newCropsArray||g,m=T.data.newMatrixWorlds||m,y(m,g,f)),v(T.data.sort.view,T.data.sort.cameraPosition);else if(T.data.init){d=T.data.init.Constants,i=T.data.init.splatCount;let D=d.BytesPerInt,I=d.BytesPerFloat*3,O=new Uint8Array(T.data.init.sorterWasmBytes),B=D+I,q=i*B,F=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,L=d.MemoryPageSize*32,X=q+F+L,G=Math.floor(X/d.MemoryPageSize)+1,U={module:{},env:{memory:new WebAssembly.Memory({initial:G*2,maximum:G*3,shared:!0})}};WebAssembly.compile(O).then(H=>WebAssembly.instantiate(H,U)).then(H=>{t=H,a=0,s=i*D,n=s+i*I,c=n+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=U.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})})}}}function Mhe(e){let t=new Worker(URL.createObjectURL(new Blob(["(",Che.toString(),")(self)"],{type:"application/javascript"}))),i=atob(Ehe),r=new Uint8Array(i.length);for(let a=0;a<i.length;a++)r[a]=i.charCodeAt(a);return t.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:e,Constants:{BytesPerFloat:Gl.BytesPerFloat,BytesPerInt:Gl.BytesPerInt,DepthMapRange:Gl.DepthMapRange,MemoryPageSize:Gl.MemoryPageSize}}}),t}var bw=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),The=function(e,t,i,r){return e+(t<<8)+(i<<16)+(r<<24)},zv=new Q,u0=class extends tr{constructor(e,t,i,r,a=!1,s=1,n,o){super(i,r),this.splatCount=t,this.meshIndexIntervals=n,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=a,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t,i=!1,r=1,a,s){let n=u0.buildGeomtery(t),o=u0.buildMaterial(a);return new u0(e,t,n,o,i,r,a,s)}static buildMaterial(e){let t=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Q},viewport:{type:"v2",value:new Q},basisViewport:{type:"v2",value:new Q},debugColor:{type:"v3",value:new tt},covariancesTextureSize:{type:"v2",value:new Q(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Q(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Wt({uniforms:r,vertexShader:t,fragmentShader:i,transparent:!0,alphaTest:1,blending:$c,depthTest:!0,depthWrite:!1,side:La})}static buildGeomtery(e){let t=new Qe;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(4*3),r=new ht(i,3);t.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let a=new m5().copy(t),s=new Uint32Array(e),n=new sm(s,1,!1);return n.setUsage(uV),a.setAttribute("splatIndex",n),a.instanceCount=e,a}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let e=0,t=0,i=0;for(let r of this.splatBuffers){let a=r.nsplats;this.colors.subarray(e,e+a*4).set(r.colorsA),e+=a*4,this.centers.subarray(t,t+a*3).set(r.decoded.xyz.denormDequant().data),t+=a*3,this.covariances.subarray(i,i+a*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=a*6}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new Q(4096,1024);for(;t.x*t.y*2<e*6;)t.y*=2;let i=new Q(4096,1024);for(;i.x*i.y*4<e*4;)i.y*=2;let r,a;if(this.halfPrecisionCovariancesOnGPU){a=new Uint16Array(t.x*t.y*2);for(let u=0;u<this.covariances.length;u++)a[u]=Uq.toHalfFloat(this.covariances[u]);r=new As(a,t.x,t.y,q0,ph)}else a=new Float32Array(t.x*t.y*2),a.set(this.covariances),r=new As(a,t.x,t.y,q0,er);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(t);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<e;u++){let h=u*4,d=u*3,p=u*4;s[p]=The(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[p+1]=bw(this.centers[d]),s[p+2]=bw(this.centers[d+1]),s[p+3]=bw(this.centers[d+2])}let n=new As(s,i.x,i.y,Ik,Bo);n.internalFormat="RGBA32UI",n.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=n,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new As(l,o,1,Sr,er);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:a,texture:r,size:t},centerColors:{data:s,texture:n,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,r){this.splatCount>0&&(zv.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(zv),this.material.uniforms.basisViewport.value.set(2/zv.x,2/zv.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose())}},Phe=class{constructor(e={}){pa(this,"updateSplatMeshUniforms",function(){let t=new Q;return function(){this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(this.renderer.getSize(t),this.cameraFocalLengthX=this.camera.projectionMatrix.elements[0]*this.devicePixelRatio*t.x*.45,this.cameraFocalLengthY=this.camera.projectionMatrix.elements[5]*this.devicePixelRatio*t.y*.45,this.splatMesh.updateUniforms(t,this.cameraFocalLengthX,this.cameraFocalLengthY,this.camera.isPerspectiveCamera?-1:this.camera.zoom*this.devicePixelRatio))}}()),pa(this,"updateView",function(){let t=new Se,i=[],r=new P(0,0,-1),a=new P(0,0,-1),s=new P,n=new P;return function(o=!1){let l=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!o){a.set(0,0,-1).applyQuaternion(this.camera.quaternion);let h=!1,d=!1;if(a.dot(r)<=.95&&(h=!0),n.copy(this.camera.position).sub(s).length()>=1&&(d=!0),!h&&!d&&!l&&!c)return}s.copy(this.camera.position),r.copy(a),t.copy(this.camera.matrixWorld).invert(),t.premultiply(this.camera.perspCamera.projectionMatrix),i[0]=this.camera.position.x,i[1]=this.camera.position.y,i[2]=this.camera.position.z;let u={sort:{view:t.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...l?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=u:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(u))}}()),this.scene=e.scene,this.currentPage=null,this.renderer=e.renderer,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.splatRenderingInitialized=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null}get camera(){return this.scene.activeCamera}reloadSplats(){this.splatRenderingInitialized=!1;let e=this.loadSplat();this.renderer.pipeline.opaquePass.splatViewer=e?this:null}loadSplat(e={}){this.activePage=this.scene.activePage,e.position&&(e.position=new P().fromArray(e.position)),e.orientation&&(e.orientation=new ut().fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseEntity(s=>{if(s.data.type==="Splat"){let n=s.visible;s.traverseAncestors(o=>{n&&(n=o.visible)}),n&&t.push(s)}}),this.splatMesh&&this.splatMesh.dispose(),t.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=t.map(s=>s.matrixWorld.clone()),this.cropsArray=t.map(s=>s.data.crops.map(n=>n.data));let i=t.map(s=>new PS(new Uint8Array(s.data.buffer).buffer)),r=0,a=[0];for(let s of i)r+=s.getSplatCount(),a.push(r);return this.setupSplatMesh(i,r,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,a,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,t*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((t,i)=>t.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(t=>t.clone()),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach((t,i)=>{var r;t.data.crops.forEach((a,s)=>{this.cropsArray[i][s]===void 0?(e=!0,this.cropsArray[i][s]=a.data):Object.entries(a.data).forEach(([n,o])=>{var l;Array.isArray(o)&&o.some((c,u)=>c!==this.cropsArray[i][s][n][u])?(e=!0,this.cropsArray[i][s][n]=o):o!==((l=this.cropsArray[i][s])==null?void 0:l[n])&&(e=!0,this.cropsArray[i][s][n]=o)})}),t.data.crops.length!==((r=this.cropsArray[i])==null?void 0:r.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)}),e}setupSplatMesh(e,t,i=new P,r=new ut,a=!1,s=1,n,o){this.splatMesh=u0.buildMesh(e,t,a,s,n,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=10,this.updateSplatMeshUniforms(),this.splatRenderCount=t}setupSortWorker(e){this.sortWorker=Mhe(e),this.sortWorker.onmessage=t=>{var i;t.data.sortDone?(this.sortRunning=!1,(i=this.splatMesh)==null||i.updateIndexes(new Uint32Array(t.data.indexesBuffer)),this.lastSortTime=t.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):t.data.sortCanceled?this.sortRunning=!1:t.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):t.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.updateView(!0,!0),this.splatRenderingInitialized=!0)}}update(){this.splatRenderingInitialized!==!1&&(this.updateSplatMeshUniforms(),this.updateView())}getSplatMesh(){return this.splatMesh}},DS=new _h;DS.wireframe=!0;var S4=new P,SC=class extends Vo{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new vhe,this.invisibleObjects=new ud("jflkdsafjasdifjaslk",{...N2.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new kr("fdasfa",{...Nd.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=phe(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=dhe(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof kr&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(t===void 0)return;let i=[],r=t;for(;r!==this;){let a=r;r=r.parent;let s=r.children.indexOf(a);i.splice(0,0,s)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let r=this.getWithSortKey(i.id);r!==void 0&&t.push(r)}return t.sort((i,r)=>rz(i.sortKey,r.sortKey)),t.map(i=>i.entity)}nonExistOrDescendantOf(e,t){let i=this.find(e);if(i===void 0)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if(e==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(e===np)return this.activePage.personalCamera}if(e===""||e===void 0)return;let t=this.entityByUuid[e];return t===void 0?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof kr&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof kr&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity(i=>{t===void 0&&i instanceof ea&&(t=i.uiCanvas.find(e))}),t}traverse2D(e){for(let t of this.children)t instanceof kr&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);if(t){if(Array.isArray(t.identity)&&this.findInstance(t.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors(t=>{this.toExpandCloner.add(t)})}doPendingExpandCloner(){this.toExpandCloner.forEach(e=>{e.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(e=>{var t;(t=e.cloner)==null||t.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach(e=>e()),this.pendingCommands.length=0}updateByLibOp(e,t){e.path.length===1&&e.path[0]==="components"&&e.type===1&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){var i;if(e.path.length===0&&e.type===7){let r=e.parent===null?this:this.find(e.parent);if(r===void 0)throw new Error("unexpected");let a=this.createObject(e.id,e.data,e.children,r,e.localIndex,t);a.updateVisible(this),a.resetBBoxNeedsUpdate(),Zs(a)&&Fo(a.parent)&&(a.invalidateUpstreamBooleanData(),a.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(a),this.markToExpandCloner(a),this.markPenumbraSizeDirty(),a.updatePathSnapping()}else if(e.path.length===0&&e.type===8){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markToExpandCloner(r),r.resetBBoxNeedsUpdate(),this.unregisterObject(r);let a=r.parent;this.markNeedsRecomputeInstancesForAncessors(a),this.markNeedsRecomputeInstancesForChildren(r),this.markPenumbraSizeDirty(),r.parent.remove(r),Fo(r.parent)&&(r.parent.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Zs(r)&&(r.freeBooleanPointer(),a instanceof xh&&a.invalidateDownstreamBooleanData().recomputeBoolean()),r instanceof bC&&r.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),this.pathConstraints.removeDependencies(r.uuid),r.updatePathSnapping()}else if(e.path.length===0&&e.type===9){let r=this.find(e.id);if(r===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(r);let a=r.parent;this.markNeedsRecomputeInstancesForAncessors(a),(i=r.cloner)==null||i.resetOnMove(),this.markToExpandCloner(r);let s=e.parent===null?this:this.find(e.parent);if(s===void 0)throw new Error("unexpected");s.add(r),this.markNeedsRecomputeInstancesForAncessors(s),this.markToExpandCloner(r),r.invalidateClonerTransform(r),r.updateVisible(this),r.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let n=e.localIndex;s.children.splice(n,0,s.children.pop()),Zs(r)&&(r.invalidateUpstreamBooleanData(),Fo(r.parent)?r.parent.invalidateDownstreamBooleanData().recomputeBoolean():a instanceof xh&&a.invalidateDownstreamBooleanData().recomputeBoolean()),r.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof kr&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==((t=this.splatViewer)==null?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,r){if(t.type===0){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:s}=t.props;t={...t,props:s},this.markNeedsRecomputeInstances()}t.path[0]==="pathSnapping"&&t.props.pathId!==void 0&&this.pathConstraints.setConstraint(e,t.props.pathId)}let a=this.find(e);if(a)try{uhe(a,t,i,{scene:this,shared:r}),a instanceof ia&&a.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(e,t,i,r,a,s=[]){e.updateEntityByOp(t,i,r,a),this.traverseEntity(n=>{(n instanceof ea||n instanceof kr)&&(s.includes(n.frameId??"")||n.frameId===t)&&n.updateEntity2DByOp(t,i,r,a)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map((r,a)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:a}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity(r=>{r instanceof aa&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity(t=>{(t.data.type==="Component"||t.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(e){Ot.is(e)&&(e.data.type==="Component"&&this.markNeedsRecomputeInstances(),e.traverseAncestors(t=>{Ot.is(t)&&t.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(e,t,i,r,a,s,n){if(e){let o=r.find(e);o&&o!==r&&a.forInstancesRec(l=>{l.data=fm(l.data,c=>{let u=c.events.data(n.id),h=l.goUp(s);if(h){let d=[...iz(h.identity),e].join("-"),p=this.entityIdentityToEntity[d];if(p){let f=p.uuid,m=Br.zoom(u,t);m[i]=f}else console.warn("cannot find instance")}}).data})}}rewriteActions(e,t,i,r,a,s){e.forEach(n=>{n.data.type==="Transition"?this.relativeizeInner(n.data.object,[...t,n.id],"object",i,r,a,s):n.data.type==="Animation"&&this.relativeizeInner(n.data.object,[...t,n.id],"object",i,r,a,s)})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(e=>{if(e instanceof dd&&typeof e.identity=="string"&&e.data.type==="Component")return e.traverseEntity((t,i)=>{t.data.events.forEach(r=>{if(r.data.type==="GameControl"){let a=!1;if(t.forInstancesRec(s=>{s.data=fm(s.data,n=>{s.isInstanceRoot||(n.events.delete(r.id),a=!0)}).data}),a===!1)for(let s of Py.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],e,t,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",e,t,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",e,t,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",e,t,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,r)),this.rewriteActions(r.data.inActions,["inActions"],e,t,i,r),this.rewriteActions(r.data.outActions,["outActions"],e,t,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],e,t,i,r)})}),!0})}expandInstances(e,t,i){let r=new Set;this.traverseEntity(a=>{if(a instanceof dd&&a.isInstanceRoot)return a.expandInstanceChildren({scene:this,shared:e,pendingDeletes:r}),t||a.resetBBoxNeedsUpdate(),i&&a.traverseEntity(s=>{i.addClip(s)}),!0});for(let a of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(a),wC(a)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof dd&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity(t=>{let i=typeof t.identity=="string"?t.identity:t.identity.join("-");this.entityIdentityToEntity[i]===t&&(delete this.entityByUuid[t.uuid],delete this.entityIdentityToEntity[i]),t.dispose()})}clearScene(){for(let e of this.children)Ot.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],r=a=>{for(let s of a.children){let n=s.cloner;if(Ot.is(s)&&!s.raycastLock&&(s.visible||n!=null&&n.object.data.visible))if(t===!0&&s.isInstanceRoot){let o=[];if(e.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(Zs(s)||fS(s)&&this.enableHelpers&&s.objectHelper.visible)&&(e.intersectObject(s,!1,i),MS(s,e,i)),r(s)}};return r(this.activePage),i}raycastWithClones(e){let t=[],i=r=>{for(let a of r.children){let s=a.cloner;Ot.is(a)&&(a.visible||s!=null&&s.object.data.visible)&&((Zs(a)||fS(a)&&this.enableHelpers&&a.objectHelper.visible)&&(e.intersectObject(a,!1,t),MS(a,e,t,!0)),i(a))}};return i(this),t}forEachEntity(e){for(let t of this.children)Ot.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)Ot.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)Ot.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity(i=>{if(i instanceof ia&&i.data.type==="Mesh"&&i.data.geometry.type==="TextGeometry"&&i.data.geometry.font===e){let r=i.geometry,a=i.data.geometry;r.updateFont(e,t).then(()=>{r.update(a);let s=i.invalidateDownstreamBooleanData();Fo(s)&&s.recomputeBoolean()})}})}traverseObject(e){for(let t of this.children)_m.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)Ot.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let r=0;for(let a of e)this.createObject(a.id,a.data,a.children,t,r,i),r+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,r,a,s){var l;let n={scene:this,shared:s},o=_C(e,t,n);return o&&(this.entityByUuid[e]=o,r.add(o),r.children.splice(a,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(t,n),o instanceof ia&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),(l=t.pathSnapping)!=null&&l.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),t.type==="Empty"&&t.animations&&o.traverseEntity(c=>{let u=c.dataPatched;if(c instanceof ia&&u.bones&&u.boneInverses){let h=u.bones.map(f=>this.find(f)),d=u.boneInverses.map(f=>new Se().fromArray(f)),p=new uE(h,d);c.bind(p,c.bindMatrix)}else c.matrixAutoUpdate=!0}),o}getCenter(e){let t=[];for(let r=0,a=e.length;r<a;++r){let{id:s,recursive:n}=e[r],o=this.find(s),l=n?o.recursiveBBox:o.singleBBox;t.push(...l.vertices)}let i=new Hi;return i.setFromPoints(t),i.getCenter(S4),S4}copyMatrixWorld(e,t){if(e===null){t.identity();return}let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var r;if(e===null){t.identity();return}let i=(r=this.find(e))==null?void 0:r.parent;i?t.copy(i.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity(t=>{if(t instanceof ba)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof lc&&e(t.material[i]);else t.material instanceof lc&&e(t.material)})}updateViewPlaneSize(e,t,i=!1){this.traverseConcreteEntity(r=>{r instanceof aa&&r.setViewplaneSize(e,t,i)})}initializeSplatViewer(e){this.splatViewer=new Phe({scene:this,renderer:e}),this.reloadSplats()}reloadSplats(){var e;(e=this.splatViewer)==null||e.reloadSplats()}},d0=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)},Dhe=(e,t)=>{let i=t.x-e.x,r=t.y-e.y;return Ihe(Math.atan2(r,i))},Ohe=(e,t,i)=>{let r={x:0,y:0};return i=OS(i),r.x=e.x-t*Math.cos(i),r.y=e.y-t*Math.sin(i),r},OS=e=>e*(Math.PI/180),Ihe=e=>e*(180/Math.PI),Rhe=e=>isNaN(e.buttons)?e.pressure!==0:e.buttons!==0,ww=new Map,A4=e=>{ww.has(e)&&clearTimeout(ww.get(e)),ww.set(e,setTimeout(e,100))},Hy=(e,t,i)=>{let r=t.split(/[ ,]+/g),a;for(let s=0;s<r.length;s+=1)a=r[s],e.addEventListener?e.addEventListener(a,i,!1):e.attachEvent&&e.attachEvent(a,i)},E4=(e,t,i)=>{let r=t.split(/[ ,]+/g),a;for(let s=0;s<r.length;s+=1)a=r[s],e.removeEventListener?e.removeEventListener(a,i):e.detachEvent&&e.detachEvent(a,i)},CB=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),C4=()=>{if(typeof window>"u")return;let e=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:e,y:t}},IS=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},AC=(e,t,i)=>{let r=MB(e);for(let a in r)if(r.hasOwnProperty(a))if(typeof t=="string")r[a]=t+" "+i;else{let s="";for(let n=0,o=t.length;n<o;n+=1)s+=t[n]+" "+i+", ";r[a]=s.slice(0,-2)}return r},Lhe=(e,t)=>{let i=MB(e);for(let r in i)i.hasOwnProperty(r)&&(i[r]=t);return i},MB=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach(function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""}),t},_w=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},khe=(e,t)=>{let i={};for(let r in e)e.hasOwnProperty(r)&&t.hasOwnProperty(r)?i[r]=t[r]:e.hasOwnProperty(r)&&(i[r]=e[r]);return i},RS=(e,t)=>{if(e.length)for(let i=0,r=e.length;i<r;i+=1)t(e[i]);else t(e)},zhe=(e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)});typeof window<"u"&&(TB="ontouchstart"in window,PB=!!window.PointerEvent,DB=!!window.MSPointerEvent);var TB,PB,DB,Wp={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Wu,Em={};PB?Wu=Wp.pointer:DB?Wu=Wp.MSPointer:TB?(Wu=Wp.touch,Em=Wp.mouse):Wu=Wp.mouse;function Ph(){}Ph.prototype.on=function(e,t){var i=this,r=e.split(/[ ,]+/g),a;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)a=r[s],i._handlers_[a]=i._handlers_[a]||[],i._handlers_[a].push(t);return i};Ph.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},e===void 0?i._handlers_={}:t===void 0?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i};Ph.prototype.trigger=function(e,t){var i=this,r=e.split(/[ ,]+/g),a;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)a=r[s],i._handlers_[a]&&i._handlers_[a].length&&i._handlers_[a].forEach(function(n){n.call(i,{type:a,target:i},t)})};Ph.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=khe(t.options,e))};Ph.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){typeof i["on"+t]=="function"?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},Hy(e,Wu[t],i._domHandlers_[t]),Em[t]&&Hy(e,Em[t],i._domHandlers_[t]),i};Ph.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},E4(e,Wu[t],i._domHandlers_[t]),Em[t]&&E4(e,Em[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var EC=Ph;function mr(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=mr.id,mr.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}mr.prototype=new EC;mr.constructor=mr;mr.id=0;mr.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};mr.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=Lhe("borderRadius","50%"),i=AC("transition","opacity",e),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},_w(r.el,i),this.options.shape==="circle"&&_w(r.back,t),_w(r.front,t),this.applyStyles(r),this};mr.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this};mr.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};mr.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};mr.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};mr.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),typeof e=="function"&&e.call(this)},t.options.fadeTime)),t};mr.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout(function(){var i=t.options.mode==="dynamic"?"none":"block";t.ui.el.style.display=i,typeof e=="function"&&e.call(t),t.trigger("hidden",t.instance)},t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:t.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:t.instance.frontPosition.y,t.setPosition(e,r)}return t};mr.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var r=i.options.fadeTime+"ms",a={};a.front=AC("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(a),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof e=="function"&&e.call(i),i.restCallback()},i.options.fadeTime)};mr.prototype.restCallback=function(){var e=this,t={};t.front=AC("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)};mr.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};mr.prototype.computeDirection=function(e){var t=e.angle.radian,i=Math.PI/4,r=Math.PI/2,a,s,n;if(t>i&&t<i*3&&!e.lockX?a="up":t>-i&&t<=i&&!e.lockY?a="left":t>-i*3&&t<=-i&&!e.lockX?a="down":e.lockY||(a="right"),e.lockY||(t>-r&&t<r?s="left":s="right"),e.lockX||(t>0?n="up":n="down"),e.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:n,angle:a},e.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+s,e),c.y||this.trigger("plain:"+n,e),c.angle||this.trigger("dir dir:"+a,e)}else this.resetDirection();return e};var Nhe=mr;function Wi(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=Wi.id,Wi.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Wi.prototype=new EC;Wi.constructor=Wi;Wi.id=0;Wi.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(i){if(i===void 0)return t[0];for(var r=0,a=t.length;r<a;r+=1)if(t[r].identifier===i)return t[r];return!1}};Wi.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"};Wi.prototype.begin=function(){var e=this,t=e.options;if(t.mode==="static"){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}};Wi.prototype.createNipple=function(e,t){var i=this,r=i.manager.scroll,a={},s=i.options,n={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(e.x&&e.y)a={x:e.x-n.x,y:e.y-n.y};else if(e.top||e.right||e.bottom||e.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=e.top,o.style.right=e.right,o.style.bottom=e.bottom,o.style.left=e.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),a=e,e={x:l.left+r.x,y:l.top+r.y}}var c=new Nhe(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:t,position:e,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(IS(c.ui.el,a),IS(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};Wi.prototype.updateBox=function(){var e=this;e.box=e.options.zone.getBoundingClientRect()};Wi.prototype.bindNipple=function(e){var t=this,i,r=function(a,s){i=a.type+" "+s.id+":"+a.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Wi.prototype.pressureFn=function(e,t,i){var r=this,a=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval((function(){var s=e.force||e.pressure||e.webkitForce||0;s!==a&&(t.trigger("pressure",s),r.trigger("pressure "+t.identifier+":pressure",s),a=s)}).bind(r),100)};Wi.prototype.onstart=function(e){var t=this,i=t.options,r=e;e=CB(e),t.updateBox();var a=function(s){t.actives.length<i.maxNumberOfNipples?t.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach(function(n){if(Object.values(r.touches).findIndex(function(l){return l.identifier===n})<0){var o=[e[0]];o.identifier=n,t.processOnEnd(o)}}),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(s))};return RS(e,a),t.manager.bindDocument(),!1};Wi.prototype.processOnStart=function(e){var t=this,i=t.options,r,a=t.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,n={x:e.pageX,y:e.pageY},o=t.getOrCreate(a,n);o.identifier!==a&&t.manager.removeIdentifier(o.identifier),o.identifier=a;var l=function(u){u.trigger("start",u),t.trigger("start "+u.id+":start",u),u.show(),s>0&&t.pressureFn(e,u,u.identifier),t.processOnMove(e)};if((r=t.idles.indexOf(o))>=0&&t.idles.splice(r,1),t.actives.push(o),t.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=d0(n,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),t.processOnStart(e);return}}return o};Wi.prototype.getOrCreate=function(e,t){var i=this,r=i.options,a;return/(semi|static)/.test(r.mode)?(a=i.idles[0],a?(i.idles.splice(0,1),a):r.mode==="semi"?i.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1)):(a=i.createNipple(t,e),a)};Wi.prototype.processOnMove=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),a=t.nipples.get(r),s=t.manager.scroll;if(!Rhe(e)){this.processOnEnd(e);return}if(!a){console.error("Found zombie joystick with ID "+r),t.manager.removeIdentifier(r);return}if(i.dynamicPage){var n=a.el.getBoundingClientRect();a.position={x:s.x+n.left,y:s.y+n.top}}a.identifier=r;var o=a.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=a.position.y),i.lockY&&(l.x=a.position.x);var c=d0(l,a.position),u=Dhe(l,a.position),h=OS(u),d=c/o,p={distance:c,position:l},f,m;if(a.options.shape==="circle"?(f=Math.min(c,o),m=Ohe(a.position,f,u)):(m=zhe(l,a.position,o),f=d0(m,a.position)),i.follow){if(c>o){let x=l.x-m.x,w=l.y-m.y;a.position.x+=x,a.position.y+=w,a.el.style.top=a.position.y-(t.box.top+s.y)+"px",a.el.style.left=a.position.x-(t.box.left+s.x)+"px",c=d0(l,a.position)}}else l=m,c=f;var g=l.x-a.position.x,v=l.y-a.position.y;a.frontPosition={x:g,y:v},i.dataOnly||IS(a.ui.front,a.frontPosition);var y={identifier:a.identifier,position:l,force:d,pressure:e.force||e.pressure||e.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:g/o,y:-v/o},raw:p,instance:a,lockX:i.lockX,lockY:i.lockY};y=a.computeDirection(y),y.angle={radian:OS(180-u),degree:180-u},a.trigger("move",y),t.trigger("move "+a.id+":move",y)};Wi.prototype.processOnEnd=function(e){var t=this,i=t.options,r=t.manager.getIdentifier(e),a=t.nipples.get(r),s=t.manager.removeIdentifier(a.identifier);!a||(i.dataOnly||a.hide(function(){i.mode==="dynamic"&&(a.trigger("removed",a),t.trigger("removed "+a.id+":removed",a),t.manager.trigger("removed "+a.id+":removed",a),a.destroy())}),clearInterval(t.pressureIntervals[a.identifier]),a.resetDirection(),a.trigger("end",a),t.trigger("end "+a.id+":end",a),t.ids.indexOf(a.identifier)>=0&&t.ids.splice(t.ids.indexOf(a.identifier),1),t.actives.indexOf(a)>=0&&t.actives.splice(t.actives.indexOf(a),1),/(semi|static)/.test(i.mode)?t.idles.push(a):t.nipples.indexOf(a)>=0&&t.nipples.splice(t.nipples.indexOf(a),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[s.id]=s.identifier))};Wi.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()};Wi.prototype.destroy=function(){var e=this;e.unbindEvt(e.options.zone,"start"),e.nipples.forEach(function(i){i.destroy()});for(var t in e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var Bhe=Wi;function Tr(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=C4(),t.config(e),t.prepareCollections();var i=function(){var a;t.collections.forEach(function(s){s.forEach(function(n){a=n.el.getBoundingClientRect(),n.position={x:t.scroll.x+a.left,y:t.scroll.y+a.top}})})};if(typeof window>"u")return t.collections;Hy(window,"resize",function(){A4(i)});var r=function(){t.scroll=C4()};return Hy(window,"scroll",function(){A4(r)}),t.collections}Tr.prototype=new EC;Tr.constructor=Tr;Tr.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every(function(r){return i=r.get(t),!i}),i}};Tr.prototype.create=function(e){return this.createCollection(e)};Tr.prototype.createCollection=function(e){var t=this,i=new Bhe(t,e);return t.bindCollection(i),t.collections.push(i),i};Tr.prototype.bindCollection=function(e){var t=this,i,r=function(a,s){i=a.type+" "+s.id+":"+a.type,t.trigger(i,s)};e.on("destroyed",t.onDestroyed.bind(t)),e.on("shown hidden rested dir plain",r),e.on("dir:up dir:right dir:down dir:left",r),e.on("plain:up plain:right plain:down plain:left",r)};Tr.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)};Tr.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||e===!0)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)};Tr.prototype.getIdentifier=function(e){var t;return e?(t=e.identifier===void 0?e.pointerId:e.identifier,t===void 0&&(t=this.latest||0)):t=this.index,this.ids[t]===void 0&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]};Tr.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t};Tr.prototype.onmove=function(e){var t=this;return t.onAny("move",e),!1};Tr.prototype.onend=function(e){var t=this;return t.onAny("end",e),!1};Tr.prototype.oncancel=function(e){var t=this;return t.onAny("end",e),!1};Tr.prototype.onAny=function(e,t){var i=this,r,a="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=CB(t);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[a](o),o._found_=!0)},n=function(o){r=i.getIdentifier(o),RS(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return RS(t,n),!1};Tr.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach(function(t){t.destroy()}),e.off()};Tr.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var jhe=Tr,M4=new jhe,Fhe={create:function(e){return M4.create(e)},factory:M4},OB=new Map,Lf=new Map,Xc=class{constructor(e,t,i,r){this.data=t;let{audio:a,volume:s,delay:n,loop:o}=t;if(!a)throw new Error("Missing property");let l=typeof a=="string"?r.getAudio(a).src:a.data;this.audioPlayer=new ff({src:l,volume:s,delay:n,loop:o}),Lf.has(i.uuid)?Lf.get(i.uuid).push(this):Lf.set(i.uuid,[this]),OB.set(e,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},LS=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=OB.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=Lf.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let e=[...Lf.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},IB=class{constructor(e,t,i,r,a){if(this.data=t,this.shared=r,this.condition=a,t.interaction==="play")this.interaction=new Xc(e,t,i,r);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new LS(t);else throw new Error("Missing property")}dispatchBasic(){if(Ai(this.shared,this.condition)===!1)return!1;this.interaction instanceof Xc?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Ai(this.shared,this.condition)===!1)return!1;this.interaction instanceof Xc?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(Ai(this.shared,this.condition)===!1)return!1;this.interaction instanceof Xc&&(e==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},RB=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.delay=0,this.emission=e.emission,e.delay!==void 0&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop():this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze():this.unFreeze()}start(e=0){if(e){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},this.delay);return}this.particleSystem.start()}stop(){this.particleSystem.stop(),this.clearDelay()}freeze(){this.particleSystem.froze(),this.clearDelay()}unFreeze(){this.particleSystem.unFroze(),this.clearDelay()}reset(){this.particleSystem.reset(),this.clearDelay()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Ai(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze();break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop();break;case"reset":this.reset();break}}dispatchConditional(){if(Ai(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.particleSystem.start();break;case"stop":this.particleSystem.stop();break;case"reset":this.particleSystem.reset();break}}dispatchGameControl(e){if(Ai(this.shared,this.condition)===!1||!this.particleSystem)return!1;e==="start"?this.particleSystem.start():this.particleSystem.stop()}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},Uhe="text/plain",Vhe="us-ascii",T4=(e,t)=>t.some(i=>i instanceof RegExp?i.test(e):i===e),Ghe=(e,{stripHash:t})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!i)throw new Error(`Invalid URL: ${e}`);let{type:r,data:a,hash:s}=i.groups,n=r.split(";");s=t?"":s;let o=!1;n[n.length-1]==="base64"&&(n.pop(),o=!0);let l=(n.shift()||"").toLowerCase(),c=[...n.map(u=>{let[h,d=""]=u.split("=").map(p=>p.trim());return h==="charset"&&(d=d.toLowerCase(),d===Vhe)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==Uhe)&&c.unshift(l),`data:${c.join(";")},${o?a.trim():a}${s?`#${s}`:""}`};function Hhe(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return Ghe(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),t.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,n=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(n,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,n=h+u.length}let l=r.pathname.slice(n,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(t.removeDirectoryIndex===!0&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),n=s[s.length-1];T4(n,t.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let s of[...r.searchParams.keys()])T4(s,t.removeQueryParameters)&&r.searchParams.delete(s);if(t.removeQueryParameters===!0&&(r.search=""),t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let a=e;return e=r.toString(),!t.removeSingleSlash&&r.pathname==="/"&&!a.endsWith("/")&&r.hash===""&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var Whe=class{constructor({url:e,context:t},i,r,a){if(this.controlsManager=i,this.shared=r,this.condition=a,!e)throw new Error("Missing property");this.url=e.startsWith("mailto:")?e:Hhe(e,{removeTrailingSlash:!1,removeSingleSlash:!1}),this.context=t??"tab"}dispatch(){var e;if(Ai(this.shared,this.condition)===!1)return!1;NE?window.location.assign(this.url):(this.context==="tab"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),(e=this.controlsManager.orbitControls)==null||e.onPointerUp(ot[0]),dte())}},LB=class{constructor(e,t,i,r,a){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=a,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{var c,u;this.timeoutIdQueue.shift();let n=this.page.scene.find(s);if(n===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?(c=n.dataPatched.physics)==null?void 0:c.fusedBody:!0;if(n.cloner){for(let h of n.cloner.children)l?(h.playModeVisible=!1,h.rigidBody&&((u=n.dataPatched.physics)==null?void 0:u.rigidBody)==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0),h.bvhGeometry&&(h.bvhGeometry=void 0)):this.clone===void 0||this.clone===h?(h.playModeVisible=!1,h.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(h.rigidBody.collider(0).handle),o.removeRigidBody(h.rigidBody),h.rigidBody=void 0)):h.playModeVisible===void 0&&(h.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(n.visible=!1,n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),o.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0))}else n.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(n.rigidBody.collider(0).handle),o.removeRigidBody(n.rigidBody),n.rigidBody=void 0),n.bvhGeometry&&(n.bvhGeometry=void 0),n.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(h=>h.rigidBody!==void 0),n.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(Ai(this.shared,this.condition)===!1)return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Ai(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(e=>window.clearTimeout(e))}},kB=class{constructor(e,t,i,r,a){this.data=e,this.page=t,this.shared=i,this.eventManager=r,this.condition=a,this.shared=i}dispatch(){if(Ai(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{var e;this.shared.reset(this.shared.data,!0),zC(this.page,this.shared,!0),this.eventManager.reset(),(e=this.eventManager.controlsManager.gameControl)==null||e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},zB={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},CC={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},qhe=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],Wy={CSS:{},springs:{}};function en(e,t,i){return Math.min(Math.max(e,t),i)}function kf(e,t){return e.indexOf(t)>-1}function Sw(e,t){return e.apply(null,t)}var ct={arr:function(e){return Array.isArray(e)},obj:function(e){return kf(Object.prototype.toString.call(e),"Object")},pth:function(e){return ct.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||ct.svg(e))},str:function(e){return typeof e=="string"},fnc:function(e){return typeof e=="function"},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return ct.hex(e)||ct.rgb(e)||ct.hsl(e)},key:function(e){return!zB.hasOwnProperty(e)&&!CC.hasOwnProperty(e)&&e!=="targets"&&e!=="keyframes"}};function NB(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(i){return parseFloat(i)}):[]}function BB(e,t){var i=NB(e),r=en(ct.und(i[0])?1:i[0],.1,100),a=en(ct.und(i[1])?100:i[1],.1,100),s=en(ct.und(i[2])?10:i[2],.1,100),n=en(ct.und(i[3])?0:i[3],.1,100),o=Math.sqrt(a/r),l=s/(2*Math.sqrt(a*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-n)/c:-n+o;function d(f){var m=t?t*f/1e3:f;return l<1?m=Math.exp(-m*l*o)*(u*Math.cos(c*m)+h*Math.sin(c*m)):m=(u+h*m)*Math.exp(-m*o),f===0||f===1?f:1-m}function p(){var f=Wy.springs[e];if(f)return f;for(var m=1/6,g=0,v=0;;)if(g+=m,d(g)===1){if(v++,v>=16)break}else v=0;var y=g*m*1e3;return Wy.springs[e]=y,y}return t?d:p}function Xhe(e){return e===void 0&&(e=10),function(t){return Math.ceil(en(t,1e-6,1)*e)*(1/e)}}var Yhe=function(){var e=11,t=1/(e-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function a(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+a(h))*u}function n(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+a(h)}function o(u,h,d,p,f){var m,g,v=0;do g=h+(d-h)/2,m=s(g,p,f)-u,m>0?d=g:h=g;while(Math.abs(m)>1e-7&&++v<10);return g}function l(u,h,d,p){for(var f=0;f<4;++f){var m=n(h,d,p);if(m===0)return h;var g=s(h,d,p)-u;h-=g/m}return h}function c(u,h,d,p){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var f=new Float32Array(e);if(u!==h||d!==p)for(var m=0;m<e;++m)f[m]=s(m*t,u,d);function g(v){for(var y=0,x=1,w=e-1;x!==w&&f[x]<=v;++x)y+=t;--x;var S=(v-f[x])/(f[x+1]-f[x]),_=y+S*t,A=n(_,u,d);return A>=.001?l(v,_,u,d):A===0?_:o(v,y,y+t,u,d)}return function(v){return u===h&&d===p||v===0||v===1?v:s(g(v),h,p)}}return c}(),jB=function(){var e={linear:function(){return function(r){return r}}},t={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var a,s=4;r<((a=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((a*3-2)/22-r,2)}},Elastic:function(r,a){r===void 0&&(r=1),a===void 0&&(a=.5);var s=en(r,1,10),n=en(a,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-n/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/n)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,a){t[r]=function(){return function(s){return Math.pow(s,a+2)}}}),Object.keys(t).forEach(function(r){var a=t[r];e["easeIn"+r]=a,e["easeOut"+r]=function(s,n){return function(o){return 1-a(s,n)(1-o)}},e["easeInOut"+r]=function(s,n){return function(o){return o<.5?a(s,n)(o*2)/2:1-a(s,n)(o*-2+2)/2}}}),e}();function MC(e,t){if(ct.fnc(e))return e;var i=e.split("(")[0],r=jB[i],a=NB(e);switch(i){case"spring":return BB(e,t);case"cubicBezier":return Sw(Yhe,a);case"steps":return Sw(Xhe,a);default:return Sw(r,a)}}function FB(e){try{var t=document.querySelectorAll(e);return t}catch{return}}function G1(e,t){for(var i=e.length,r=arguments.length>=2?arguments[1]:void 0,a=[],s=0;s<i;s++)if(s in e){var n=e[s];t.call(r,n,s,e)&&a.push(n)}return a}function H1(e){return e.reduce(function(t,i){return t.concat(ct.arr(i)?H1(i):i)},[])}function P4(e){return ct.arr(e)?e:(ct.str(e)&&(e=FB(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function TC(e,t){return e.some(function(i){return i===t})}function PC(e){var t={};for(var i in e)t[i]=e[i];return t}function kS(e,t){var i=PC(e);for(var r in e)i[r]=t.hasOwnProperty(r)?t[r]:e[r];return i}function W1(e,t){var i=PC(e);for(var r in t)i[r]=ct.und(e[r])?t[r]:e[r];return i}function Qhe(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}function Zhe(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=e.replace(t,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),a=parseInt(r[1],16),s=parseInt(r[2],16),n=parseInt(r[3],16);return"rgba("+a+","+s+","+n+",1)"}function Khe(e){var t=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),i=parseInt(t[1],10)/360,r=parseInt(t[2],10)/100,a=parseInt(t[3],10)/100,s=t[4]||1;function n(d,p,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?d+(p-d)*6*f:f<1/2?p:f<2/3?d+(p-d)*(2/3-f)*6:d}var o,l,c;if(r==0)o=l=c=a;else{var u=a<.5?a*(1+r):a+r-a*r,h=2*a-u;o=n(h,u,i+1/3),l=n(h,u,i),c=n(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function $he(e){if(ct.rgb(e))return Qhe(e);if(ct.hex(e))return Zhe(e);if(ct.hsl(e))return Khe(e)}function Wo(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function Jhe(e){if(kf(e,"translate")||e==="perspective")return"px";if(kf(e,"rotate")||kf(e,"skew"))return"deg"}function zS(e,t){return ct.fnc(e)?e(t.target,t.id,t.total):e}function Gn(e,t){return e.getAttribute(t)}function DC(e,t,i){var r=Wo(t);if(TC([i,"deg","rad","turn"],r))return t;var a=Wy.CSS[t+i];if(!ct.und(a))return a;var s=100,n=document.createElement(e.tagName),o=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;o.appendChild(n),n.style.position="absolute",n.style.width=s+i;var l=s/n.offsetWidth;o.removeChild(n);var c=l*parseFloat(t);return Wy.CSS[t+i]=c,c}function UB(e,t,i){if(t in e.style){var r=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),a=e.style[t]||getComputedStyle(e).getPropertyValue(r)||"0";return i?DC(e,a,i):a}}function OC(e,t){if(ct.dom(e)&&!ct.inp(e)&&(Gn(e,t)||ct.svg(e)&&e[t]))return"attribute";if(ct.dom(e)&&TC(qhe,t))return"transform";if(ct.dom(e)&&t!=="transform"&&UB(e,t))return"css";if(e[t]!=null)return"object"}function VB(e){if(ct.dom(e)){for(var t=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,a;a=i.exec(t);)r.set(a[1],a[2]);return r}}function eue(e,t,i,r){var a=kf(t,"scale")?1:0+Jhe(t),s=VB(e).get(t)||a;return i&&(i.transforms.list.set(t,s),i.transforms.last=t),r?DC(e,s,r):s}function IC(e,t,i,r){switch(OC(e,t)){case"transform":return eue(e,t,r,i);case"css":return UB(e,t,i);case"attribute":return Gn(e,t);default:return e[t]||0}}function RC(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var r=Wo(e)||0,a=parseFloat(t),s=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return a+s+r;case"-":return a-s+r;case"*":return a*s+r}}function GB(e,t){if(ct.col(e))return $he(e);if(/\s/g.test(e))return e;var i=Wo(e),r=i?e.substr(0,e.length-i.length):e;return t?r+t:r}function LC(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function tue(e){return Math.PI*2*Gn(e,"r")}function iue(e){return Gn(e,"width")*2+Gn(e,"height")*2}function rue(e){return LC({x:Gn(e,"x1"),y:Gn(e,"y1")},{x:Gn(e,"x2"),y:Gn(e,"y2")})}function HB(e){for(var t=e.points,i=0,r,a=0;a<t.numberOfItems;a++){var s=t.getItem(a);a>0&&(i+=LC(r,s)),r=s}return i}function aue(e){var t=e.points;return HB(e)+LC(t.getItem(t.numberOfItems-1),t.getItem(0))}function WB(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return tue(e);case"rect":return iue(e);case"line":return rue(e);case"polyline":return HB(e);case"polygon":return aue(e)}}function sue(e){var t=WB(e);return e.setAttribute("stroke-dasharray",t),t}function nue(e){for(var t=e.parentNode;ct.svg(t)&&ct.svg(t.parentNode);)t=t.parentNode;return t}function qB(e,t){var i=t||{},r=i.el||nue(e),a=r.getBoundingClientRect(),s=Gn(r,"viewBox"),n=a.width,o=a.height,l=i.viewBox||(s?s.split(" "):[0,0,n,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:n/l[2],h:o/l[3]}}function oue(e,t){var i=ct.str(e)?FB(e)[0]:e,r=t||100;return function(a){return{property:a,el:i,svg:qB(i),totalLength:WB(i)*(r/100)}}}function lue(e,t){function i(o){o===void 0&&(o=0);var l=t+o>=1?t+o:0;return e.el.getPointAtLength(l)}var r=qB(e.el,e.svg),a=i(),s=i(-1),n=i(1);switch(e.property){case"x":return(a.x-r.x)*r.w;case"y":return(a.y-r.y)*r.h;case"angle":return Math.atan2(n.y-s.y,n.x-s.x)*180/Math.PI}}function D4(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=GB(ct.pth(e)?e.totalLength:e,t)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:ct.str(e)||t?r.split(i):[]}}function XB(e){var t=e?H1(ct.arr(e)?e.map(P4):P4(e)):[];return G1(t,function(i,r,a){return a.indexOf(i)===r})}function YB(e){var t=XB(e);return t.map(function(i,r){return{target:i,id:r,total:t.length,transforms:{list:VB(i)}}})}function cue(e,t){var i=PC(t);if(/^spring/.test(i.easing)&&(i.duration=BB(i.easing)),ct.arr(e)){var r=e.length,a=r===2&&!ct.obj(e[0]);a?e={value:e}:ct.fnc(t.duration)||(i.duration=t.duration/r)}var s=ct.arr(e)?e:[e];return s.map(function(n,o){var l=ct.obj(n)&&!ct.pth(n)?n:{value:n};return ct.und(l.delay)&&(l.delay=o?0:t.delay),ct.und(l.endDelay)&&(l.endDelay=o===s.length-1?t.endDelay:0),l}).map(function(n){return W1(n,i)})}function hue(e){for(var t=G1(H1(e.map(function(s){return Object.keys(s)})),function(s){return ct.key(s)}).reduce(function(s,n){return s.indexOf(n)<0&&s.push(n),s},[]),i={},r=function(s){var n=t[s];i[n]=e.map(function(o){var l={};for(var c in o)ct.key(c)?c==n&&(l.value=o[c]):l[c]=o[c];return l})},a=0;a<t.length;a++)r(a);return i}function uue(e,t){var i=[],r=t.keyframes;r&&(t=W1(hue(r),t));for(var a in t)ct.key(a)&&i.push({name:a,tweens:cue(t[a],e)});return i}function due(e,t){var i={};for(var r in e){var a=zS(e[r],t);ct.arr(a)&&(a=a.map(function(s){return zS(s,t)}),a.length===1&&(a=a[0])),i[r]=a}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function pue(e,t){var i;return e.tweens.map(function(r){var a=due(r,t),s=a.value,n=ct.arr(s)?s[1]:s,o=Wo(n),l=IC(t.target,e.name,o,t),c=i?i.to.original:l,u=ct.arr(s)?s[0]:c,h=Wo(u)||Wo(l),d=o||h;return ct.und(n)&&(n=c),a.from=D4(u,d),a.to=D4(RC(n,u),d),a.start=i?i.end:0,a.end=a.start+a.delay+a.duration+a.endDelay,a.easing=MC(a.easing,a.duration),a.isPath=ct.pth(s),a.isColor=ct.col(a.from.original),a.isColor&&(a.round=1),i=a,a})}var QB={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,r,a){if(r.list.set(t,i),t===r.last||a){var s="";r.list.forEach(function(n,o){s+=o+"("+n+") "}),e.style.transform=s}}};function ZB(e,t){var i=YB(e);i.forEach(function(r){for(var a in t){var s=zS(t[a],r),n=r.target,o=Wo(s),l=IC(n,a,o,r),c=o||Wo(l),u=RC(GB(s,c),l),h=OC(n,a);QB[h](n,a,u,r.transforms,!0)}})}function fue(e,t){var i=OC(e.target,t.name);if(i){var r=pue(t,e),a=r[r.length-1];return{type:i,property:t.name,animatable:e,tweens:r,duration:a.end,delay:r[0].delay,endDelay:a.endDelay}}}function mue(e,t){return G1(H1(e.map(function(i){return t.map(function(r){return fue(i,r)})})),function(i){return!ct.und(i)})}function KB(e,t){var i=e.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},a={};return a.duration=i?Math.max.apply(Math,e.map(function(s){let n=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+n+o+l+s.duration*(s.loop??1)})):t.duration,a.delay=i?Math.min.apply(Math,e.map(function(s){let n=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+n+o+s.delay})):t.delay,a.endDelay=i?a.duration-Math.max.apply(Math,e.map(function(s){let n=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+n+o+s.duration*(s.loop??1)-s.endDelay-l})):t.endDelay,a}var O4=0;function gue(e){var t=kS(zB,e),i=kS(CC,e),r=uue(i,e),a=YB(e.targets),s=mue(a,r),n=KB(s,i),o=O4;return O4++,W1(t,{id:o,children:[],animatables:a,animations:s,duration:n.duration,delay:n.delay,endDelay:n.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var Ts=[],I4=[],p0,vue=function(){function e(){p0=requestAnimationFrame(t)}function t(i){var r=Ts.length;if(r){for(var a=0;a<r;){var s=Ts[a];s.paused?(Ts.splice(a,1),r-=1):(s.tick(i),a++)}e()}else p0=cancelAnimationFrame(p0)}return e}();function yue(e){document.hidden?(Ts.forEach(function(t){return t.pause(e.timeStamp)}),I4=Ts.slice(0),Gi.running=Ts=[]):I4.forEach(function(t){return t.play(e.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",yue);function Gi(e){e===void 0&&(e={});var t=0,i=0,r=0,a,s,n=0,o=null;function l(_){var A=window.Promise&&new Promise(function(E){return o=E});return _.finished=A,A}var c=gue(e);l(c);function u(){var _=c.direction;_!=="alternate"&&(c.direction=_!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(A){(A.loop===1||A.loop%2===0)&&(A.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(_){return _.reversed=!1})}function d(_){return c.reversed?c.duration-_:_}function p(){t=0,i=d(c.currentTime)*(1/Gi.speed)}function f(_,A,E=!1){A&&(c.reversed?A.seek(A.duration*A.loop-(_-A.timelineOffset-A.pingPongDelayCorrection),E):A.seek(_-A.timelineOffset-A.startOnceDelay-A.pingPongDelayCorrection,E))}function m(_,A=!1){if(c.reversed)for(var E=n;E--;)f(_,s[E],A);else for(var M=0;M<n;M++)f(_,s[M],A)}function g(_){var ne,re,ie,le,ue,fe,be,ke,Ce,Ve;var A=0,E=c.animations,M=E.length;for(c.direction!=="alternate"&&((ne=c.parent)==null?void 0:ne.direction)==="alternate"?((re=c.parent)==null?void 0:re.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1&&((ie=c.parent)!=null&&ie.reversed&&c.direction==="alternate"?_=c.duration-c.delay+c.endDelay-_:_=c.duration+c.delay-c.endDelay-_):w(!1,(le=c.parent)==null?void 0:le.rewind,c.rewind,(ue=c.parent)==null?void 0:ue.reversePlayback,c.reversePlayback)&&((fe=c.parent)!=null&&fe.reversed&&c.direction==="alternate"?_=c.duration-c.delay+c.endDelay-_:_=c.duration+c.delay-c.endDelay-_);A<M;){var C=E[A],T=C.animatable,D=C.tweens,I=D.length-1,O=D[I];I&&(O=G1(D,function(Pe){return _<Pe.end})[0]||O);let je;(be=c.parent)!=null&&be.reversed&&c.direction==="alternate"?je=en(_-O.start-O.endDelay,0,O.duration)/O.duration:je=en(_-O.start-O.delay,0,O.duration)/O.duration;for(var B=isNaN(je)?1:O.easing(je),q=O.to.strings,F=O.round,L=[],X=O.to.numbers.length,G=void 0,U=0;U<X;U++){var H=void 0;let Pe,Me;c.direction!=="alternate"?((ke=c.parent)==null?void 0:ke.rewind)===!1&&c.reversePlayback===!0&&c.rewind===!1?(Pe=O.to.numbers[U],Me=O.from.numbers[U]||0):(Me=O.to.numbers[U],Pe=O.from.numbers[U]||0):w(!0,(Ce=c.parent)==null?void 0:Ce.rewind,c.rewind,(Ve=c.parent)==null?void 0:Ve.reversePlayback,c.reversePlayback)?(Pe=O.to.numbers[U],Me=O.from.numbers[U]||0):(Me=O.to.numbers[U],Pe=O.from.numbers[U]||0),O.isPath?H=lue(O.value,B*Me):H=Pe+B*(Me-Pe),F&&(O.isColor&&U>2||(H=Math.round(H*F)/F)),L.push(H)}var $=q.length;if(!$)G=L[0];else{G=q[0];for(var Y=0;Y<$;Y++){q[Y];var J=q[Y+1],Z=L[Y];isNaN(Z)||(J?G+=Z+J:G+=Z+" ")}}QB[C.type](T.target,C.property,G,T.transforms),C.currentValue=G,A++}}function v(_){c[_]&&!c.passThrough&&c[_](c)}function y(){c.remaining&&c.remaining!==!0&&c.remaining--}let x={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function w(_,A,E,M,C){return x[_<<4|A<<3|E<<2|M<<1|C]}function S(_,A=!1){var D;var E=c.duration;let M=c.delay,C=E-c.endDelay;(D=c.parent)!=null&&D.reversed&&c.direction==="alternate"&&(M=c.endDelay,C=E-c.delay);var T=d(_);if(c.progress=en(T/E*100,0,100),A||(c.reversePlayback=T<c.currentTime),n&&m(T,A),!c.began&&c.currentTime>=0&&(c.began=!0,v("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,v("loopBegin")),(c.reversed||T>=0)&&T<=M&&c.currentTime!==0&&(g(0),v("change")),(T>=C&&c.currentTime!==E+c.pingPongDelayCorrection||!E)&&(g(E),v("change")),T>M&&T<C?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,v("changeBegin")),g(T),v("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,v("change"),n&&v("timelineChangeComplete")):c.began&&T>C&&v("changeComplete"),c.currentTime=en(T,0,E+c.pingPongDelayCorrection),c.began&&v("update"),_>=E)if(y(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,v("loopComplete"),v("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{n?t+=c.duration/Gi.speed:t+=c.duration;for(let I of s)I.setStartTime(0),I.remaining=I.loop;v("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():n&&h()}}return c.reset=function(){var _=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed=_==="reverse",c.remaining=c.loop,s=c.children,n=s.length;for(var A=n;A--;)c.children[A].reset();g(c.reversed?c.duration:0)},c.setStartTime=function(_){t=_},c.set=function(_,A){return ZB(_,A),c},c.tick=function(_){r=_,t||(t=r),S((r+(i-t))*Gi.speed)},c.seek=function(_,A=!1){S(_-t,A)},c.pause=function(_){c.paused=!0,n&&(a=_??performance.now())},c.play=function(_){!c.paused||(c.completed&&c.reset(),c.paused=!1,Ts.push(c),n&&a!==void 0&&(t+=(_??performance.now())-a),p0||vue())},c.reverse=function(){u(),c.completed=!c.reversed,p()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function R4(e,t){for(var i=t.length;i--;)TC(e,t[i].animatable.target)&&t.splice(i,1)}function xue(e){for(var t=XB(e),i=Ts.length;i--;){var r=Ts[i],a=r.animations,s=r.children;R4(t,a);for(var n=s.length;n--;){var o=s[n],l=o.animations;R4(t,l),!l.length&&!o.children.length&&s.splice(n,1)}!a.length&&!s.length&&r.pause()}}function bue(e,t){t===void 0&&(t={});var i=t.direction||"normal",r=t.easing?MC(t.easing):null,a=t.grid,s=t.axis,n=t.from||0,o=n==="first",l=n==="center",c=n==="last",u=ct.arr(e),h=parseFloat(u?e[0]:e),d=u?parseFloat(e[1]):0,p=Wo(u?e[1]:e)||0,f=t.start||0+(u?h:0),m=[],g=0;return function(v,y,x){if(o&&(n=0),l&&(n=(x-1)/2),c&&(n=x-1),!m.length){for(var w=0;w<x;w++){if(!a)m.push(Math.abs(n-w));else{var S=l?(a[0]-1)/2:n%a[0],_=l?(a[1]-1)/2:Math.floor(n/a[0]),A=w%a[0],E=Math.floor(w/a[0]),M=S-A,C=_-E,T=Math.sqrt(M*M+C*C);s==="x"&&(T=-M),s==="y"&&(T=-C),m.push(T)}g=Math.max.apply(Math,m)}r&&(m=m.map(function(I){return r(I/g)*g})),i==="reverse"&&(m=m.map(function(I){return s?I<0?I*-1:-I:Math.abs(g-I)}))}var D=u?(d-h)/g:h;return f+D*(Math.round(m[y]*100)/100)+p}}function wue(e){e===void 0&&(e={});var t=Gi(e);return t.duration=0,t.add=function(i,r){var a=Ts.indexOf(t),s=t.children;a>-1&&Ts.splice(a,1);function n(d){d.passThrough=!0}for(var o=0;o<s.length;o++)n(s[o]);var l=W1(i,kS(CC,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=ct.und(r)?c:RC(r,c),n(t);var u=Gi(l);n(u),s.push(u),u.parent=t;var h=KB(s,e);return t.delay=h.delay,t.endDelay=h.endDelay,t.duration=h.duration,u.loop===!0&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t}Gi.version="3.2.0";Gi.speed=1;Gi.running=Ts;Gi.remove=xue;Gi.get=IC;Gi.set=ZB;Gi.convertPx=DC;Gi.path=oue;Gi.setDashoffset=sue;Gi.stagger=bue;Gi.timeline=wue;Gi.easing=MC;Gi.penner=jB;Gi.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var $B=Gi,L4=new P,k4=new P,z4=new ut;function _ue(e,t,i,r){if(r===0)return i.copy(e);if(r===1)return i.copy(t);let a=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(a>=1)return i.copy(e);let s=1-a*a;if(s<=Number.EPSILON){let u=1-r;return i.w=u*e.w+r*t.w,i.x=u*e.x+r*t.x,i.y=u*e.y+r*t.y,i.z=u*e.z+r*t.z,i.normalize(),i}let n=Math.sqrt(s),o=Math.atan2(n,a),l=Math.sin((1-r)*o)/n,c=Math.sin(r*o)/n;return i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c,i}function Lr(e,t,i,r,a,s){let n=i[e]?i[e]:void 0,o=r[e];if(o==null)return;let l=n!=null?typeof n=="string"?Number(a.getVariable(n)??0):n:t[e],c=typeof o=="string"?Number(a.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Ge.lerp(l,c,u);s?t[e]=Math.trunc(h):t[e]=h},start:()=>{t[e]=l},end:()=>{t[e]=c}}}function kC(e,t,i,r,a,s){let n=i[e]?i[e]:void 0,o=r[e];if(!o)return;let l=t[e],c=[...n??l].map(h=>typeof h=="string"?Number(a.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(a.getVariable(h)??0):h);if(!(c.length!==u.length||ez(c,u)))return{update:h=>{c.forEach((d,p)=>{let f=Ge.lerp(d,u[p],h);t[e][p]=s?Math.trunc(f):f})},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],u)}}}function qy(e,t,i){return t.forEach((r,a)=>{e.setComponent(a,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function N4(e,t,i,r,a){let s=i[e]?i[e]:void 0,n=r[e];if(!n)return;let o=t[e],l=s?qy(new P,s,a):o.clone(),c=qy(new P,n,a);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function B4(e,t,i){return t.forEach((r,a)=>{e.setComponent(a,typeof r=="string"?Number(i.getVariable(r)??0):r)}),e}function NS(e,t,i,r,a){let s=i[e]?i[e]:void 0,n=r[e];if(!n)return;let o=t[e],l=!(o instanceof Q),c=o instanceof Q?o:new Q().fromArray(o),u=s?B4(new Q,s,a):c.clone(),h=B4(new Q,n,a);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(t[e]=c.toArray())},start:()=>{c.copy(u),l&&(t[e]=c.toArray())},end:()=>{c.copy(h),l&&(t[e]=c.toArray())}}}function Sue(e,t,i,r){let a=i[e]?i[e]:void 0,s=r[e];if(!s)return;let n=t[e],o=a?new Se().fromArray(a):n.clone(),l=new P,c=new ut,u=new P;o.decompose(l,c,u);let h=new Se().fromArray(s),d=new P,p=new ut,f=new P;if(h.decompose(d,p,f),!o.equals(h))return{update:m=>{z4.slerpQuaternions(c,p,m),L4.lerpVectors(l,d,m),k4.lerpVectors(u,f,m),n.compose(L4,z4,k4)},start:()=>{n.compose(l,c,u)},end:()=>{n.compose(d,p,f)}}}function Aue(e,t,i,r,a){let s=i[e]?i[e]:void 0,n=r[e];if(!n)return;let o=t[e],l=s?typeof s=="string"?a.getColor(s).clone():new tt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof n=="string"?a.getColor(n).clone():new tt().setRGB(n.r,n.g,n.b);if(l.equals(c))return;let u=o.clone();return t[e]=u,{update:h=>{u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function Nv(e,t,i,r,a){let s=i[e]?i[e]:void 0,n=r[e];if(!n)return;let o=t[e],l=new Vr(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?a.getColor(s).clone():new Vr(s.r,s.g,s.b,s.a):l.clone(),u=typeof n=="string"?a.getColor(n).clone():new Vr(n.r,n.g,n.b,n.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Ge.lerp(c.a,u.a,h);l.a=d,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function fc(e,t,i,r,a){if(typeof t[e]=="number")return Lr(e,t,i??{},r,a);if(Array.isArray(t[e]))return kC(e,t,i??{},r,a)}function Eue(e,t,i,r){var o,l,c,u;let a=[],s=e.cameraType==="OrthographicCamera"?(o=t.orthographic)==null?void 0:o.zoom:(l=t.perspective)==null?void 0:l.zoom,n=e.cameraType==="OrthographicCamera"?(c=i.orthographic)==null?void 0:c.zoom:(u=i.perspective)==null?void 0:u.zoom;if(n!==void 0){let h=s??e.zoom,d=n;h!==d&&a.push({update:p=>{e.zoom=Ge.lerp(h,d,p),e.updateProjectionMatrix()},start:()=>{e.zoom=h,e.updateProjectionMatrix()},end:()=>{e.zoom=d,e.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let h=Lr("targetOffset",e,t,i,r);h&&a.push(h)}return a}function Cue(e,t,i,r){if(i.scaleBaked===void 0)return;let a=(t.scaleBaked??e.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(ih.isEqual(a,s))return;let n=[];return n.push({update:o=>{e.updateGeometryInteractions({scaleBaked:[Ge.lerp(a[0],s[0],o),Ge.lerp(a[1],s[1],o),Ge.lerp(a[2],s[2],o)]},r),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometryInteractions({scaleBaked:a},r),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},r),e.invalidateDownstreamBooleanData()}}),n}function Mue(e,t,i,r){if(!i.extrusion)return;let a=e.extrusion,s=t.extrusion??{},n=i.extrusion,o=[];return Bz.forEach(l=>{let c=fc(l,a,s,n,r);c&&o.push(c)}),o}function Tue(e,t,i,r){let a=[];if(!("geometry"in i))return a;let s=e.geometry.userData.parameters,n="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof Am){let l=Cue(e,n,o,r);l&&a.push(...l)}else{let l={};if(Object.assign(l,Go(s,dD)),dD.forEach(c=>{let u=fc(c,l,n,o,r);u&&a.push(u)}),e instanceof bC){Object.assign(l,{extrusion:{...s.extrusion}});let c=Mue(l,n,o,r);c&&a.push(...c)}a.length&&a.push({update:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded()},start:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded()},end:c=>{e.updateGeometryInteractions(l,r),e.updateGeometryGroupsIfNeeded()}})}return a}function Pue(e,t,i,r){let a=[];if(i.intensity!==void 0){let s=Lr("intensity",e,t,i,r);s&&a.push(s)}if(i.color!==void 0){let s=Aue("color",e,t,i,r);s&&a.push(s)}return a}function Due(e,t,i,r){let a=[];if(Array.isArray(e.material)){if(!("materials"in i&&i.materials))return a;let s="materials"in t&&t.materials?t.materials:[],n=i.materials;e.material.forEach((o,l)=>{if(!n[l])return;let c=s[l]??{},u=n[l];typeof c=="string"||typeof u=="string"||a.push(...j4(o,c,u,r))})}else{if(!("material"in i&&i.material))return a;let s="material"in t&&t.material?t.material:{},n=i.material;if(typeof s=="string"||typeof n=="string")return a;a.push(...j4(e.material,s,n,r))}return a}function j4(e,t,i,r){var n;let a=[],s=Hu(i,r)||!!t.layers&&Hu(t,r);a.push(jue(e,s));for(let o of e.layers){let l=(n=t.layers)==null?void 0:n.data(o.uuid),c=i.layers.data(o.uuid);if(!c||o.type!=="light"&&(!(o.visible??!0)||!(c.visible??!0)))continue;let u=o.getNames().filter(h=>!kz.some(d=>h.includes(d)));for(let h of u)try{let d=o.getValue(h),p;if(h==="colors")p=Nue(o,l,c,h);else if(Array.isArray(d))h==="steps"&&(p=zue(o,l,c,h));else if(typeof d=="number")p=Oue(o,l,c,h,r);else{if(typeof d=="boolean")continue;d instanceof Q?p=Iue(o,l,c,h):d instanceof P?p=Rue(o,l,c,h,r):d instanceof Vr?p=kue(o,l,c,h,r):d instanceof tt?p=Lue(o,l,c,h,r):"isTexture"in d&&(p=Bue(o,l,c,h))}p&&(Array.isArray(p)?a.push(...p):a.push(p))}catch(d){console.error(`lerpMaterial: unexpected material layer for ${h}`,d)}}return a}function Oue(e,t,i,r,a){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:e.getValue(r),n=i[r],o=typeof s=="string"?Number(a.getVariable(s)??0):s,l=typeof n=="string"?Number(a.getVariable(n)??0):n;if(o!==l)return{update:c=>{e.setValue(r,Ge.lerp(o,l,c))},start:()=>{e.setValue(r,o)},end:()=>{e.setValue(r,l)}}}function Iue(e,t,i,r){if(!e.hasValue(r)||!(r in i))return;let a=e.getValue(r),s=t?new Q().fromArray(t[r]):a.clone(),n=new Q().fromArray(i[r]);if(!s.equals(n))return{update:o=>{a.lerpVectors(s,n,o)},start:()=>{a.copy(s)},end:()=>{a.copy(n)}}}function Rue(e,t,i,r,a){if(!e.hasValue(r)||!(r in i))return;let s=e.getValue(r),n=t?t[r]:void 0,o=i[r],l=n?qy(new P,n,a):s.clone(),c=qy(new P,o,a);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function Lue(e,t,i,r,a){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,n=i[r],o=e.getValue(r),l=s?typeof s=="string"?a.getColor(s).clone():new tt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof n=="string"?a.getColor(n).clone():new tt().setRGB(n.r,n.g,n.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function kue(e,t,i,r,a){if(!e.hasValue(r)||!(r in i))return;let s=t?t[r]:void 0,n=i[r],o=e.getValue(r),l=s?typeof s=="string"?a.getColor(s).clone():new tt().setRGB(s.r,s.g,s.b):o.clone(),c=typeof n=="string"?a.getColor(n).clone():new Vr(n.r,n.g,n.b,n.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{e.getValue(r)!==u&&e.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function zue(e,t,i,r="steps"){if(!e.hasValue(r)||!(r in i))return;let a=[],s=e.getValue(r),n=t?t[r]:s,o=i[r];for(let l=0;l<s.length;++l){let c=n[l],u=o[l];c!==u&&a.push({update:h=>{s[l]=Ge.lerp(c,u,h)},start:()=>{s[l]=c},end:()=>{s[l]=u}})}return a.length?a:void 0}function Nue(e,t,i,r="colors"){if(!e.hasValue(r)||!(r in i))return;let a=[],s=e.getValue(r),n=t?t[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...n[l]],u=[...o[l]];xy.isEqual(c,u)||a.push({update:h=>{s[l].fromArray(xy.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return a.length?a:void 0}function Bue(e,t,i,r="texture"){if(!e.hasValue(r)||!(r in i))return;let a=e.getNode("mat");if(!a)return;let s=t?t[r]:a,n=i[r],o=[...s.repeat],l=[...s.offset],c=[...n.repeat],u=[...n.offset];if(!Nl.isEqual(o,c)||!Nl.isEqual(l,u))return{update:h=>{a.repeat=Nl.lerp(o,c,h),a.offset=Nl.lerp(l,u,h),a.updateMatrix()},start:()=>{a.repeat=[...o],a.offset=[...l],a.updateMatrix()},end:()=>{a.repeat=[...c],a.offset=[...u],a.updateMatrix()}}}function jue(e,t){return{update:()=>{e.transparent=t}}}var Aw=new P,F4=new hr;function Fue(e,t,i,r,a){var p,f,m,g,v,y;let s=[],n,o,l,c,u,h,d;if(e instanceof dr?(n=NS("position",e,t,i,a),n&&s.push(n),l=Lr("rotation",e,t,i,a),l&&s.push(l)):(d={slide:((p=t.pathSnapping)==null?void 0:p.slide)??((f=e.updatedPathSnapping)==null?void 0:f.slide)??((m=e.dataPatched.pathSnapping)==null?void 0:m.slide)??0,offset:((g=t.pathSnapping)==null?void 0:g.offset)??((v=e.updatedPathSnapping)==null?void 0:v.offset)??((y=e.dataPatched.pathSnapping)==null?void 0:y.offset)??0},u=Lr("slide",d,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,a),u&&s.push(u),h=Lr("offset",d,t.pathSnapping??e.updatedPathSnapping??e.dataPatched.pathSnapping,i.pathSnapping??e.dataPatched.pathSnapping,a),h&&s.push(h),!u&&!h&&(n=N4("position",e,t,i,a),n&&s.push(n),o=N4("scale",e,t,i,a),o&&s.push(o),l=Uue(e,t,i,r,a),l&&s.push(l),c=Sue("hiddenMatrix",e,t,i),c&&s.push(c))),n||o||l||c||u||h){let x=e instanceof dr?()=>{e.updateWorldMatrix(!0)}:()=>{var w;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),(w=e.parent)!=null&&w.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),Zs(e)&&Fo(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,d))};s.push({update:x,start:x,end:x})}return s}function Uue(e,t,i,r,a){var u;let s=t!=null&&t.rotation?t.rotation.map(h=>(typeof h=="string"?Number(a.getVariable(h)??0):h)*Ge.DEG2RAD):void 0,n=(u=i.rotation)==null?void 0:u.map(h=>(typeof h=="string"?Number(a.getVariable(h)??0):h)*Ge.DEG2RAD);if(!n)return;let o=s?new P().fromArray(s):new P().setFromEuler(e.rotation),l=new P().fromArray(n);if(o.equals(l))return;let c=Aw.subVectors(l,o);if(r&&c.toArray().every(h=>Math.abs(h)<2*Math.PI)){let h=new ut().setFromEuler(F4.setFromVector3(o)),d=new ut().setFromEuler(F4.setFromVector3(l));return{update:p=>{_ue(h,d,e.quaternion,p)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}else return{update:h=>{Aw.lerpVectors(o,l,h),e.rotation.setFromVector3(Aw)},start:()=>{e.rotation.setFromVector3(o)},end:()=>{e.rotation.setFromVector3(l)}}}function Vue(e,t,i,r){let a=[];if(!("cloner"in i)||!e.cloner)return a;let s=e.cloner,n="cloner"in t?t.cloner:{},o=i.cloner;Pz.forEach(p=>{let f;p==="count"?f=Lr("count",s.parameters,n,o,r,!0):f=fc(p,s.parameters,n??{},o,r),f&&a.push(f)});let l=Gue(s,n,o,r);l!=null&&l.length&&a.push(...l);let c=Hue(s,n,o,r);c!=null&&c.length&&a.push(...c);let u=Wue(s,n,o,r);u!=null&&u.length&&a.push(...u);let h=que(s,n,o,r);h!=null&&h.length&&a.push(...h);let d=Xue(s,n,o,r);return d!=null&&d.length&&a.push(...d),a.length&&a.push({update:()=>{s.update()}}),a}function Gue(e,t,i,r){if(e.parameters.type!=="radial")return;let a=t.radial,s=i.radial;if(!s)return;let n=e.parameters.radial,o=[];return Dz.forEach(l=>{let c=fc(l,n,a??{},s,r);c&&o.push(c)}),o}function Hue(e,t,i,r){if(e.parameters.type!=="linear")return;let a=t.linear,s=i.linear;if(!s)return;let n=[],o=e.parameters.linear;return Oz.forEach(l=>{let c=fc(l,o,a??{},s,r);c&&n.push(c)}),n}function Wue(e,t,i,r){if(e.parameters.type!=="grid")return;let a=t.grid,s=i.grid;if(!s)return;let n=[],o=e.parameters.grid;return Iz.forEach(l=>{let c;l==="count"?c=kC(l,o,a??{},s,r,!0):c=fc(l,o,a??{},s,r),c&&n.push(c)}),n}function que(e,t,i,r){if(e.parameters.type!=="toObject")return;let a=t.toObject,s=i.toObject;if(!s)return;let n=[],o=e.parameters.toObject;return Rz.forEach(l=>{let c;l==="count"?c=Lr(l,o,a??{},s,r,!0):c=fc(l,o,a??{},s,r),c&&n.push(c)}),n}function Xue(e,t,i,r){if(!e.parameters.randomness)return;let a=t.randomnessObject,s=i.randomnessObject;if(!s)return;let n=[],o=e.parameters.randomnessObject;return Lz.forEach(l=>{let c=fc(l,o,a??{},s,r);c&&n.push(c)}),n}function Yue(e,t){return{update:()=>{e instanceof _r&&(e.fill.enabled=t)}}}function Que(e,t){return{update:()=>{e instanceof _r&&(e.stroke.enabled=t)}}}function Zue(e,t){return{update:()=>{e instanceof _r&&(e.dropShadow.enabled=t)}}}function Kue(e,t){return{update:()=>{e instanceof _r&&(e.innerShadow.enabled=t)}}}function $ue(e,t){return{update:()=>{e instanceof _r&&(e.backgroundBlur.enabled=t)}}}function Jue(e,t){return{update:()=>{e instanceof _r&&(e.layerBlur.enabled=t)}}}function ede(e,t,i,r,a){let s=[],n,o,l,c,u,h,d,p,f,m,g,v,y,x,w;if("width"in e&&(n=Lr("width",e,t,i,a),n&&s.push(n)),"height"in e&&(o=Lr("height",e,t,i,a),o&&s.push(o)),e instanceof _r||e instanceof Yn){let S={...t.fill},_={...i.fill};S.enabled!==void 0&&S.enabled!==_.enabled&&(s.push(Yue(e,!0)),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),l=Nv("color",e.fill,S,_,a),l&&s.push(l)}if(e instanceof _r){let S={...t.stroke},_={...i.stroke};(S.enabled||_.enabled)&&(s.push(Que(e,!0)),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),c=Nv("color",e.stroke,S,_,a),c&&s.push(c),u=Lr("thickness",e.stroke,S,_,a),u&&s.push(u)}if(e instanceof _r){let S={...t.dropShadow},_={...i.dropShadow};(S.enabled||_.enabled)&&(s.push(Zue(e,!0)),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),h=Nv("color",e.dropShadow,S,_,a),h&&s.push(h),d=Lr("blurRadius",e.dropShadow,S,_,a),d&&s.push(d),f=Lr("spread",e.dropShadow,S,_,a),f&&s.push(f),p=NS("offset",e.dropShadow,S,_,a),p&&s.push(p)}if(e instanceof _r){let S={...t.innerShadow},_={...i.innerShadow};(S.enabled||_.enabled)&&(s.push(Kue(e,!0)),S.enabled||Object.assign(S,{enabled:!0,color:{...S.color,a:0}}),_.enabled||Object.assign(_,{enabled:!0,color:{..._.color,a:0}})),m=Nv("color",e.innerShadow,S,_,a),m&&s.push(m),g=Lr("blurRadius",e.innerShadow,S,_,a),g&&s.push(g),y=Lr("spread",e.innerShadow,S,_,a),y&&s.push(y),v=NS("offset",e.innerShadow,S,_,a),v&&s.push(v)}if(e instanceof _r||e instanceof Yn){let S={...t.backgroundBlur},_={...i.backgroundBlur};(S.enabled||_.enabled)&&(s.push($ue(e,!0)),S.enabled||Object.assign(S,{enabled:!0,radius:0}),_.enabled||Object.assign(_,{enabled:!0,radius:0})),x=Lr("radius",e.backgroundBlur,S,_,a),x&&s.push(x)}if(e instanceof _r){let S={...t.layerBlur},_={...i.layerBlur};(S.enabled||_.enabled)&&(s.push(Jue(e,!0)),S.enabled||Object.assign(S,{enabled:!0,radius:0}),_.enabled||Object.assign(_,{enabled:!0,radius:0})),w=Lr("radius",e.layerBlur,S,_,a),w&&s.push(w)}if(e instanceof Yn||e instanceof Qm){let S=kC("cornerRadius",e,t,i,a);S&&s.push(S)}return s}function U4(e,t,i,r,a){let s=[];return e.data.visible&&s.push(...Fue(e,t,i,a,r)),e instanceof dr?s.push(...ede(e,t,i,a,r)):(e.data.visible&&s.push(...Vue(e,t,i,r)),Zs(e)?(e instanceof ia&&e.data.visible&&s.push(...Tue(e,t,i,r)),e.data.visible&&s.push(...Due(e,t,i,r))):loe(e)?e.data.visible&&s.push(...Pue(e,t,i,r)):ooe(e)&&s.push(...Eue(e,t,i,r))),s.length?{update:n=>{s.forEach(o=>o.update(n))},start:n=>{s.forEach(o=>{var l;return(l=o.start)==null?void 0:l.call(o,n)})},end:n=>{s.forEach(o=>{var l;return(l=o.end)==null?void 0:l.call(o,n)})}}:void 0}var V4=new P;function zC(e,t,i=!1){var s;let r=[],a=n=>{let o=n.data;delete n.states,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let l of o.states){let c={...l.data};n.states||(n.states={}),n.states[l.id]=Wc.patch(o,c)}H4(e.scene,n,null,t,o.events.find(l=>l.data.type==="Follow"||l.data.type==="LookAt")!==void 0),G4(e)};e.scene.traverse2D(a),e.traverseChildren(n=>{var u,h,d,p,f,m;if(i&&((u=n.rigidBody)==null||u.setTranslation(n.position0,!0),(h=n.rigidBody)==null||h.setRotation(n.rotation0,!0),(d=n.rigidBody)==null||d.setLinvel(V4,!0),(p=n.rigidBody)==null||p.setAngvel(V4,!0)),!Ot.is(n))return;let o=n.uuid,l=n.data;if(delete n.states,n.uuid===np)return;let c=!1;r.some(g=>{var v;return(v=e.scene.find(o))==null?void 0:v.isDescendantOf(g)})?c=!0:((f=l.physics)==null?void 0:f.fusedBody)===!0&&l.physics.rigidBody==="dynamic"&&r.push(o),n.data=l,n.currentState=null,n.reversibleToState=null,n.currentTransitionEvent=null;for(let g of l.states){let v={...g.data};e.data.globalPhysics.usePhysics===!0&&l.physics&&(l.physics.rigidBody==="dynamic"||c)&&(g.data.position!==void 0&&delete v.position,g.data.rotation!==void 0&&delete v.rotation,g.data.hiddenMatrix!==void 0&&delete v.hiddenMatrix),n.states||(n.states={}),n.states[g.id]=Vc.patch(l,v)}H4(e.scene,n,null,t,l.events.find(g=>g.data.type==="Follow"||g.data.type==="LookAt")!==void 0),G4(e),n instanceof ea&&n.frame&&(n.frame.traverse(g=>a(g)),(m=n.uiCanvas)==null||m.applySize())}),e.frame&&(e.frame.traverse(n=>a(n)),(s=e.uiCanvas)==null||s.applySize())}function G4(e){e.traverseEntity(t=>{for(let i of t.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let a of Object.values(i.data.gameActions))r.push(...a);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let a of r)if(a.data.type==="Create"&&a.data.hideBase==="Yes"){let s=e.scene.find(a.data.object);s&&(s.visible=!1)}}})}function H4(e,t,i,r,a=!1){if(t instanceof ia&&t.removeInteractionGeometry(r),t instanceof dr?t.changeSelectedState(i,{shared:r},a):t.changeSelectedState(i,{scene:e,shared:r},a),t instanceof ia&&t.updateGeometryGroupsIfNeeded(),t instanceof aa&&t.updateCameraState(t.dataPatched,{scene:e,shared:r}),!(t instanceof dr)){if(t.cloner)for(let s of t.cloner.children)s.playModeVisible=void 0;t.updateVisible(e)}}function JB(e){let t;if(e.easing===5){let{control1:i,control2:r}=e;t=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(e.easing===6){let{mass:i,stiffness:r,damping:a,velocity:s}=e;t=`spring( ${i}, ${r}, ${a}, ${s} )`}else{let i;switch(e.easing){case 0:i=El.linear;break;case 1:i=El.ease;break;case 2:i=El.easeIn;break;case 3:i=El.easeOut;break;case 4:i=El.easeInOut;break;default:i=El.linear}let[r,a,s,n]=i;t=`cubicBezier( ${r}, ${a}, ${s}, ${n} )`}return{duration:Math.max(e.duration,1e-4),easing:t}}function BS(e){let t={delay:0,loop:e.repeat===-1?!0:e.repeat+1};if(e.repeat===0)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1;break}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay;break}return t.direction==="alternate"&&(t.delay/=2,t.endDelay/=2,e.delayDirection==="start"?(t.pingPongDelayCorrection=t.delay,typeof t.loop=="number"&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):e.delayDirection==="end"?typeof t.loop=="number"&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):e.delayDirection==="start-end"&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var tde={type:"beginState"},ide={type:"completeState",isfromEntity:!1},W4=class{constructor(e,t,i,r,a,s){if(this.object=e,this.data=r,this.sharedAssets=a,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let n=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=n,this.object.dispatchEvent({type:"beginState",state:n}),this.object instanceof dr||this.object.traverseEntity(o=>{o!==this.object&&o instanceof aa&&o.dispatchEvent(tde)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let n=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=n,this.object.dispatchEvent({type:"completeState",state:n}),this.object instanceof dr||this.object.traverseEntity(o=>{o!==this.object&&o instanceof aa&&o.dispatchEvent(ide)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=U4(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},t===void 0){let n=f0(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!n)throw new Error("Missing property");this.from=n}else{let n=f0(this.object,t);if(!n)throw new Error("Missing property");this.from=n}if(i===void 0)throw new Error("Missing property");{let n=f0(this.object,i);if(!n)throw new Error("Missing property");this.to=n}this.useCurrentState=t===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...BS(r),...JB(r),change:this.onChange},this.callback=U4(this.object,t===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},ej=class extends Hr{constructor(e,t,i,r){var s;if(super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.useToggle=!1,this.onTimelineChangeComplete=()=>{var n;this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&((n=this.timeline)==null||n.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let a=this.page.scene.find(e.object)??((s=this.page.uiCanvas)==null?void 0:s.find(e.object))??this.page.scene.find2DInUIObjects(e.object);if(!a)throw new Error("Missing property");if(!a.states)throw new Error("Missing property");if(this.object=a,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline&&this.timeline.paused===!1}init(){this.initialCurrentState=f0(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.useToggle?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:e=!0,needsRebuild:t=!1,isRebuild:i=!1}={}){var r,a,s,n;try{let o=BS(this.data.tweens[0].data);i&&typeof o.loop=="number"&&o.loop--,(r=this.timeline)==null||r.pause(),this.timeline=$B.timeline({autoplay:!1,...o,...o.loop===!0||o.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let l=this.tweens.findIndex(c=>c==null?void 0:c.changeBegan);if(t===!0&&(this.timelineNeedsRebuild=!0),e){let c=l===-1?0:l;for(let u=c;u<this.data.tweens.length-1;u++){let h=this.data.tweens[u],d=this.data.tweens[u+1],p;u===c&&(this.object.wasMovedByUser===!0||((a=this.object.previousAction)==null?void 0:a.playing)===!0)?(p=void 0,this.object instanceof aa&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new W4(this.object,p,d.data.state===void 0?this.currentState:d.data.state,d.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.delay:0))}this.timeline.duration+=o.endDelay}else{let c=l===-1?this.data.tweens.length-1:l+1;for(let u=c;u>0;u--){let h=this.data.tweens[u],d=this.data.tweens[u-1],p;u===c&&(this.object.wasMovedByUser===!0||((s=this.object.previousAction)==null?void 0:s.playing)===!0)?(p=void 0,this.object instanceof aa&&(this.object.wasMovedByUser=!1)):p=h.data.state===void 0?this.currentState:h.data.state;let f=new W4(this.object,p,d.data.state===void 0?this.currentState:d.data.state,h.data,this.shared,this.data.allowSlerp??!1);l!==-1&&u===c&&Object.assign(f.params,{startOnceDelay:0}),this.tweens[u-1]=f,this.timeline.add(f.params,this.timeline.duration+(u===c?o.endDelay:0))}this.timeline.duration+=o.delay}}catch(o){o instanceof Error&&console.error(o.message)}((n=this.object.previousAction)==null?void 0:n.playing)===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Ai(this.shared,this.condition)===!1||this.playing)return!1;clearTimeout(this.timeoutId);let e=BS(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout(()=>{try{this.buildTimeline(),this.timeline.play()}catch(t){t instanceof Error&&console.error(t.message)}},this.startOnceDelay+e)}pause(){var e;(e=this.timeline)==null||e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof dr?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;this.timeline===void 0&&this.buildTimeline(),(t=this.timeline)==null||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(Ai(this.shared,this.condition)===!1)return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward,this.playing?((t=this.timeline)==null||t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout(()=>{var i;(i=this.timeline)==null||i.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function f0(e,t){var a;let i,r;if(typeof t=="string"?(i=t,r=(a=e.states)==null?void 0:a[i]):t===null&&(i=null,r=e.data),!(i===void 0||r===void 0))return{id:i,data:r}}var rde={type:"beginState"},q4={type:"completeState",isfromEntity:!1},X4={type:"requestRender"},tj=class extends Hr{constructor(e,t,i,r){super(),this.data=e,this.page=t,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.useToggle=!1,this.posStart=new P,this.posEnd=new P,this.qStart=new ut,this.qEnd=new ut,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(e=!1){if(!this.data.animate)return;let t=this.page.scene.find(this.data.targetCamera);if(!t||!t.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=$B({targets:i,t:1,...JB(this.data),update:()=>{i.t===0&&(this.useToggle&&!this.toggleIsForward?(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(t.position),this.qEnd.copy(t.quaternion),this.zoomEnd=t.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(t.uuid)),this.page.activeCamera.dispatchEvent(rde));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(X4),i.t===1&&r.dispatchEvent(q4)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Ai(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),(e=this.animation)==null||e.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){var e;(e=this.animation)==null||e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){var t,i;if(Ai(this.shared,this.condition)===!1)return!1;this.useToggle=!0,clearTimeout(this.timeoutId),this.toggleIsForward=e??!this.toggleIsForward;try{this.playing?((t=this.animation)==null||t.pause(),this.buildAnimation(!0),(i=this.animation)==null||i.play()):this.timeoutId=window.setTimeout(()=>{var r,a;delete this.timeoutId,this.data.animate?((r=this.animation)==null||r.pause(),this.buildAnimation(),(a=this.animation)==null||a.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(q4),this.page.activeCamera.dispatchEvent(X4))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},ij=class extends Hr{constructor(e,t,i,r,a){var c,u,h;super(),this.page=t,this.animationControls=i,this.shared=r,this.condition=a,this.startOnceDelay=0,this.toggleIsForward=!1;let s=e.object,n=t.scene.find(e.object);n&&Array.isArray(n.identity)&&(s=n.identity[0]),this.data={...e,object:s};let o=this.animationControls.clipIdToAction[e.clipId+"/"+s];this.duration=((c=o==null?void 0:o.getClip())==null?void 0:c.duration)??1;let l=((h=(u=o==null?void 0:o.getClip())==null?void 0:u.tracks[0])==null?void 0:h.times.length)??1/0;this.leftFrameTime=this.data.crop[0]/l*this.duration,this.rightFrameTime=this.data.crop[1]/l*this.duration,this.startOnceDelay=e.delay}get playing(){var e;return((e=this.threeAnimAction)==null?void 0:e.isRunning())??!1}play(e=!1){if(Ai(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let t=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([r,a])=>{let s=r.split("/")[1];this.threeAnimAction!==a&&s===t&&a.isRunning()&&(e?a.fadeOut(.2):a.stop())}),e&&((i=this.threeAnimAction)==null||i.fadeIn(.2))},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;(e=this.threeAnimAction)==null||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Ge.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e,t=!1){if(Ai(this.shared,this.condition)===!1)return!1;this.toggleIsForward=e??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{var i;if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let r=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([a,s])=>{let n=a.split("/")[1];this.threeAnimAction!==s&&n===r&&s.isRunning()&&(t?s.fadeOut(.2):s.stop())}),t&&((i=this.threeAnimAction)==null||i.fadeIn(.2))}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var t;let e=(t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])==null?void 0:t.getClip();e&&(e.duration=this.duration),this.pause()}},rj=class{constructor(e,t,i,r,a){this.data=e,this.page=t,this.eventManager=i,this.shared=r,this.condition=a,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(Ai(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(t=>t.uuid!==this.data.target))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(t=>{t.type==="ParticleSystem"&&(t.sleep(),t.wakeUp(),t.data.autoPlay?t.start():t.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),zC(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},aj=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Ai(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let e=this.shared.getVariable(this.data.variableId),t=dN(this.data.expression,this.shared,$a.typeOfVariable(e));t!==void 0&&this.shared.updateVariable(this.data.variableId,typeof t=="string"?{textValue:t}:t)}dispose(){}},sj=class{constructor(e,t,i,r){this.data=e,this.page=t,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(Ai(this.shared,this.condition)===!1)return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,e==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&e!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&e!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&e!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);e==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,t===void 0?!1:!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&t==="Playing"&&(e=this.data.pauseDelay),e!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function Ai(e,t){if(t===void 0)return!0;if(t.expression.length===0)return!1;let i=dN(t.expression,e,"boolean");return t.negate?!i:!!i}function wa(e,t,i,r,a,s){let n={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"&&!(s instanceof dr)?Ca[e.type].includes("Audio")&&n.Audio.push(new IB(c,u,s,r,l)):u.type==="Video"&&!(s instanceof dr)?Ca[e.type].includes("Video")&&n.Video.push(new oj(c,u,s,r,l)):u.type==="Particles"?Ca[e.type].includes("Particles")&&n.Particles.push(new RB(u,i,r,l)):u.type==="Link"?Ca[e.type].includes("Link")&&n.Link.push(new Whe(u,a.controlsManager,r,l)):u.type==="Create"?Ca[e.type].includes("Create")&&n.Create.push(new lj(u,i,a.controlsManager,r,l)):u.type==="Destroy"?Ca[e.type].includes("Destroy")&&n.Destroy.push(new LB(u,i,a.controlsManager,r,l)):u.type==="Reset"?Ca[e.type].includes("Reset")&&n.Reset.push(new kB(u,i,r,a,l)):u.type==="Transition"?Ca[e.type].includes("Transition")&&n.Transition.push(new ej(u,i,r,l)):u.type==="SwitchCamera"?Ca[e.type].includes("SwitchCamera")&&n.SwitchCamera.push(new tj(u,i,r,l)):u.type==="SceneTransition"?Ca[e.type].includes("SceneTransition")&&n.SceneTransition.push(new rj(u,i,a,r,l)):u.type==="Animation"?Ca[e.type].includes("Animation")&&n.Animation.push(new ij(u,i,a.animationControls,r,l)):u.type==="SetVariable"?Ca[e.type].includes("SetVariable")&&n.SetVariable.push(new aj(u,i,r,l)):u.type==="DynamicVariablePlay"?Ca[e.type].includes("DynamicVariablePlay")&&n.DynamicVariablePlay.push(new sj(u,i,r,l)):u.type==="Conditional"&&Ca[e.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0})))}catch{}};return t.forEach(o()),n}function Cr(e){Object.values(e).forEach(t=>{t.forEach(i=>{(i instanceof IB||i instanceof oj||i instanceof RB||i instanceof ij||i instanceof ej||i instanceof lj||i instanceof LB||i instanceof tj||i instanceof rj||i instanceof kB||i instanceof aj||i instanceof sj)&&i.dispose()})})}function ade(e,t){let i;if("material"in e){let r=e.material;Array.isArray(r)?i=e.material[0].layers.find(a=>a.uuid===t):i=e.material.layers.find(a=>a.uuid===t)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var nj=new Map,zf=new Map,fd=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:r,loop:a,volume:s,delay:n}=t;if(this.object=i,r===void 0)throw new Error("Missing property");let o=ade(i,r);o&&(this.videoElement=o,this.videoElement.loop=a===1/0,NE&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),n!==void 0&&(this.delay=n),zf.has(i.uuid)?zf.get(i.uuid).push(this):zf.set(i.uuid,[this]),nj.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},jS=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=nj.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t[this.data.interaction](),this.disposeDelay()},this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=zf.get(e);!(t!=null&&t.length)||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):t.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let e=[...zf.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):e.forEach(t=>{t.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},oj=class{constructor(e,t,i,r,a){if(this.data=t,this.shared=r,this.condition=a,t.interaction==="play")this.interaction=new fd(e,t,i);else if(t.interaction==="pause"||t.interaction==="stop")this.interaction=new jS(t);else throw new Error("Missing property")}dispatchBasic(){if(Ai(this.shared,this.condition)===!1)return!1;this.interaction instanceof fd?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Ai(this.shared,this.condition)===!1)return!1;this.interaction instanceof fd?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},Y4=(()=>{let e,t,i,r;function a(o){!e&&!Q4()&&(t==null?void 0:t.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(s)),o&&(t=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=t.sharedGameControlGlobals.createdObjects,u=t.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let p=c[d];p.userData.createdTime===void 0&&(p.userData.createdTime=o),p.userData.lifetime===void 0&&p.userData.quantity===void 0||p.userData.lifetime&&o-p.userData.createdTime<p.userData.lifetime||p.userData.quantity&&u[p.userData.actionId]<=p.userData.quantity?(p.userData.velocity&&(p.position.addScaledVector(p.userData.velocity,l/1e3),p.updateMatrix(),r()),d++):(u[p.userData.actionId]>p.userData.quantity&&u[p.userData.actionId]--,c.splice(d,1),p.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&p.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(p.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(p.rigidBody)):(p.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter(f=>f.bvhGeometry!==void 0)),h--,r())}e=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function n(){Q4()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):a()}return typeof document<"u"&&document.addEventListener("visibilitychange",n),a})();function Q4(){return!!document&&document.hidden}var Z4=new ut,sde=new P,nde=new P,lj=class{constructor(e,t,i,r,a){this.data=e,this.page=t,this.controlsManager=i,this.shared=r,this.condition=a,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Ge.generateUUID(),this.dispatch=()=>{if(Ai(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Ai(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=ete(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let n=new ta(this.object);if(n.playModeVisible=!0,n.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),n.hiddenMatrix.copy(c.matrixWorldRigid))}n.position.fromArray(this.data.position),n.rotation.fromArray(this.data.rotation),n.updateMatrix(),this.page.add(n);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(n),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,n.updateWorldMatrix(!0,!0),n.traverseObject(this.traverseObjectCB),Y4(),this.controlsManager.requestRender()},this.traverseObjectCB=n=>{var u,h,d,p;n.hasNonUniformScale&&n.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(n instanceof Js)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;o=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof ta)o=n.object;else if(o=n,(u=o.dataPatched.cloner)==null?void 0:u.hideBase)return!0}else{if(n instanceof Js)return;n instanceof ta?o=n.object:o=n}this.data.destroy==="Time"?n.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(n.userData.quantity=this.data.destroyAfterQuantity,n.userData.actionId=this.uniqueId);let l=new P().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(n,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&((h=n.rigidBody)==null||h.collider(0).setActiveEvents(1),n.userData.hasCollisionDestroy=!0),n.matrixWorld.decompose(sde,Z4,nde),l.applyQuaternion(Z4),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&((d=n.rigidBody)==null||d.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in n.object&&this.controlsManager.addBoundsTree(n),this.data.velocity.some(f=>f!==0)&&this.data.dynamic&&(n.userData.velocity=l)),((p=o.dataPatched.physics)==null?void 0:p.fusedBody)===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");Y4(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(e=>window.clearTimeout(e)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},cj=200,Ew=.02,Cw=.3,ode=65;new P;var K4=new P,$4=new P,lde=new P,ha=new P,Ma=new P,yl=new P,Mw=new Se,J4=new Se,cde=new Se;new Se;var Vs=new ut,yo=new ut,En=new hr(0,0,0,"YXZ"),hde=new P(1,0,0),Gs=new P(0,1,0),ude=new P(0,0,1),eI=new P(1,1,1);new Fa;var dde=1,pde=.025,fde=16e-6,tI=12,mde=20,yr=new Ms,ps=new Hi,gde={type:"requestRender"},vde={type:"updateMatrix"},iI=Math.PI/6,FS=class extends Hr{constructor(e,t,i,r,a,s,n,o,l){var f;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=r,this.controlsManager=a,this.cameraFollow=s,this.camera=n,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new Se,this.target0=new P,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=cj,this.euler0=new hr(0,0,0,"YXZ"),this.position0Cam=new P,this.quat0Cam=new ut,this.scale0Cam=new P,this.hiddenMatrix0Cam=new Se,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new Ms(new P(0,-40,0),new P(0,40,0)),matrix:new Se,position:new P,rotation:new ut},this.euler=new hr(0,0,0,"YXZ"),this.eulerDelta=new P,this.lastPosition=new P,this.lastCameraQuaternion=new ut,this.lastCameraPosition=new P,this.PI_2=Math.PI/2,this.prevMouse=new Q,this.velocityTarget=new P,this.velocity=new P,this.directionXZ=new P,this.rotVelocityStick=new P,this.rotVelocityTarget=new P,this.rotVelocity=new P,this.rotDirection=new P,this.nonColliderRotOffset=new Se,this.nonColliderPosOffset=new Se,this.firstPointerId=-1,this.rot=new P,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new Se,this.objectToTarget=new P,this.objectToTarget0=new P,this.objectToCamXZ=new P,this.objectToCamXZ0=new P,this.targetToCamera=new P,this.targetToCamera0=new P,this.cameraPolarAxis0=new P,this.targetPos=new P,this.targetQuat=new ut,this.lerpFactorPos=new P().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ut,this.objXZQuatInv=new ut,this.objXZRotMat=new Se,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new P,this.pushedVelocity=new P,this.groundYRotation=0,this.objectRealQuat=new ut,this.colliderWorldQuat=new ut,this.groundNormal=new P,this.groundTilt=new ut,this.groundTiltInv=new ut,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new P,this.quaternion=new ut,this.scale=new P,this.initialAction=!0,this.onPointerDown=m=>{m.target!==this.domElement||this.firstPointerId!==-1||(this.firstPointerId=m.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!Ka&&(!zP||NP>=15.5)&&this.domElement.requestPointerLock(),this.prevMouse.set(m.clientX,m.clientY))},this.onPointerUp=m=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),m.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=m=>{if(m.pointerId!==this.firstPointerId)return;let g=m.clientX-this.prevMouse.x,v=m.clientY-this.prevMouse.y;this.prevMouse.set(m.clientX,m.clientY),m.pointerType==="mouse"&&this.rotBy!=="keys"&&(zP&&NP<15.5&&!Ka?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-v*this.mouseOrbitSensitivity):(this.eulerDelta.y=-m.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-m.movementY*this.mouseOrbitSensitivity)),m.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-v*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=m=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?FS.isLocked=!0:FS.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document!=null&&document.hidden)for(let m in this.movementState)this.movementState[m]=0},this.onKeyDown=m=>{!(m.target instanceof HTMLInputElement)&&(m.code==="ArrowLeft"||m.code==="ArrowUp"||m.code==="ArrowRight"||m.code==="ArrowDown"||m.code==="Space")&&m.preventDefault();for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=m=>{for(let g of this.keyAssignments)if(m.key.toUpperCase()===g[1]||m.key===g[1]||m.code.slice(3,m.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(m,g)=>{for(let v=2;v<4;v++){let y=m.axes[v];g===0?v===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(m.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,v===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=a.sharedGameControlGlobals,e===n&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy((f=this.camera)==null?void 0:f.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let m=new P(0,0,-1).applyQuaternion(this.camera.quaternion),g=new P().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let v,y;Math.abs(m.y)<1e-6?(g.y=0,m.y=0,y=g.projectOnVector(m)):g.y/m.y>0?y=m.multiplyScalar(g.y/m.y):y=m.multiplyScalar(g.length()),this.targetToCamera0.copy(y).negate(),v=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(v,this.position);let x=new hr().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-x.x,x.x=0,x.z=0,x.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(x)}if(this.object instanceof aa&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*dde,this.speedOrbit=(i.speedRotate??100)*pde,this.mouseOrbitSensitivity=(i.speedRotate??100)*fde,this.keyAssignments=i.keyAssignments.map(m=>{let g=[m[0],m[1]];return g[1]==="▲"?g[1]="ArrowUp":g[1]==="◀"?g[1]="ArrowLeft":g[1]==="▼"?g[1]="ArrowDown":g[1]==="▶"?g[1]="ArrowRight":g[1]==="⇧"?g[1]="Shift":g[1]==="↵"?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]==="⌘"?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),i.rotBy==="mouse"){let m;m=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),m!==-1&&(this.keyAssignments[m][1]=""),m=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),m!==-1&&(this.keyAssignments[m][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??kd.defaultData.gravity)*tI,this.usePhysics=this.gloabalPhysics.usePhysics??kd.defaultData.usePhysics,this.jumpPower=i.jumpPower*mde,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??Dy.defaultDataThirdPerson.orientWith,this.slopeThresh=ode*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*Ew/this.pixelsPerMeter,this.stepThresh=i.collider.height*Cw/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*Ew/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*Cw/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*Ew/this.pixelsPerMeter,this.stepThresh=i.collider.height*Cw/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new P().fromArray(i.collider.position),d=new ut().setFromEuler(new hr().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,eI),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.runMultiplier=i.runMultiplier??2;let p=i.navmesh.destinationHelperRadius*2;if(p>0){let m=new Je;m.push({fi:0,data:{...br.defaultData("light","phong"),alpha:0},id:"layer1"}),m.push({fi:0,data:{...br.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let g=new hC({layers:m},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new tr(Xz.create({parameters:{width:p,height:p/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(e=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let t=new hr().setFromQuaternion(this.quaternion,"YXZ"),i=t.y;this.objectRealQuat.copy(this.quaternion),t.y=0,this.quaternion.setFromEuler(t),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),t.set(0,i,0),this.quaternion.setFromEuler(t),this.rot.setFromEuler(t),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof aa?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(e=this.navMeshPathDest)!=null&&e.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;e.gameActions!==void 0&&(this.actions={},Py.list.forEach(i=>{this.actions[i]=wa({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Cr(this.actions.idle),Cr(this.actions.move),Cr(this.actions.run),Cr(this.actions.jump)}dispatchStartEvent(e){this.actions[e]!==void 0&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach(t=>{t.play()}),this.actions[e].Animation.forEach(t=>{t.play(this.initialAction===!1)}),this.actions[e].Create.forEach(t=>{t.dispatchStart()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("start")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("start")})))}dispatchStopEvent(e){this.actions[e]!==void 0&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach(t=>{t.stop(),t.object.currentState!==null&&t.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[e].Create.forEach(t=>{t.dispatchStop()}),this.actions[e].Audio.forEach(t=>{t.dispatchGameControl("stop")}),this.actions[e].Particles.forEach(t=>{t.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ha.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var o,l,c,u,h,d,p,f,m;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let a=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let g=Ma.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*tI),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,g,(o=this.object.rigidBody)==null?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(v){this.onObject=!0,this.groundNormal.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),((l=v.collider.parent())==null?void 0:l.bodyType())===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let y=v.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let x of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(x.rigidBody===y&&x.userData.isFollowingObj!==this.object.uuid){(x.hasNonUniformScale?x.matrixWorldRigid:x.matrixWorld).decompose(ha,yo,Ma),this.groundVelocity.subVectors(ha,x.prevT),this.object.getWorldPosition(Ma).add(this.collider.position).sub(ha),this.groundYRotation=En.setFromQuaternion(yo).y-x.prevR.y,yl.copy(Ma).applyAxisAngle(Gs,this.groundYRotation),this.groundVelocity.add(yl.sub(Ma)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*a),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let g=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let v=ha.subVectors(this.path[1],this.position),y=Ma.subVectors(this.path[1],this.path[0]);v.dot(y)<0?this.path.shift():(this.directionXZ.x=y.x,this.directionXZ.z=y.z),g.opacity=g.userData.opacity0}else g.opacity-=.05*g.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**a),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**a),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**a)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let n=lde.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let g=Ma.copy(n);g.y=0,n.set(0,n.y,g.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none")if(this.orientWith==="camera"&&this.path.length<=1){let g=ha;this.camera.getWorldDirection(g);let v=yl.copy(Gs).multiplyScalar(g.dot(Gs));g.sub(v);let y=Ma.copy(this.directionXZ);y.x*=-1,this.rot.y=g.angleTo(y)*(g.cross(y).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(En.setFromVector3(this.rot),this.moveMode==="walk"&&(En.x=0),n.applyEuler(En),s&&(yo.setFromUnitVectors(Gs,this.groundNormal),n.applyQuaternion(yo)),i){let g=En.set(0,this.vrEulerYOffset*iI,0);i.applyEuler(g),n.x+=i.x,n.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let g=Ma;this.pushedVelocity.set(0,0,0);for(let v of this.sharedGameControlGlobals.entitiesWithTransformAnim){let y=yl.setFromMatrixPosition(v.matrixWorld).sub(v.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),x=v.rigidBody.collider(0).castCollider(y,this.object.rigidBody.collider(0),ha.copy(n).divideScalar(this.pixelsPerMeter),r,!1);y.multiplyScalar(this.pixelsPerMeter);let w=Ot.is(v)?v:v.object;if(x!==null&&this.lastHitObj!==w){let S;v instanceof ta&&(S=v);let _=this.sharedGameControlGlobals.entityToCollisionEvents[w.uuid];if(_)for(let A of _)A.data.target==="character"&&(A.dispatch(S),w.dispatchEvent(VS));this.lastHitObj=w}if(x!==null){this.pushedVelocity.copy(y),g.copy(x.normal1).applyQuaternion(v.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let v=g.dot(n);v<0&&n.addScaledVector(g,-v),n.add(this.pushedVelocity)}else n.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**a):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**a),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(Gs,this.euler.y-this.euler0.y);let g=Ma.copy(this.objectToCamXZ).normalize(),v=yl.copy(n).multiplyScalar(r);v.y=0;let y=v.sub(ha.copy(g).multiplyScalar(v.dot(g))).cross(g).y;this.euler.y-=Math.atan2(y,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Ge.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Ge.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Ge.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(En.copy(t),En.y=0):(En.copy(this.euler),En.y=0),this.nonColliderRotOffset.makeRotationFromEuler(En)),t&&(this.moveMode==="walk"?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*iI),Vs.setFromAxisAngle(hde,this.rot.x),yo.setFromAxisAngle(Gs,this.rot.y),yo.multiply(Vs),Vs.setFromAxisAngle(ude,this.rot.z),yo.multiply(Vs),this.quaternion.copy(yo),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.objectRealQuat.multiply(this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let g=Ma.copy(n).multiplyScalar(r/this.pixelsPerMeter),v=null;this.didHit=!1;let y=new P;for(let x=0;x<5;x++){let w=g.length(),S=yl.copy(g).normalize();if(v=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),this.colliderWorldQuat,S,(c=this.object.rigidBody)==null?void 0:c.collider(0).shape,w,!1,24,void 0,void 0,this.object.rigidBody),v!==null){this.didHit=!0;let _=this.sharedGameControlGlobals.colliderToEntity.get(v.collider.handle);if(_!==this.lastHitObj&&x===0){this.lastHitObj=_;let C=this.sharedGameControlGlobals.entityToCollisionEvents[_==null?void 0:_.uuid];if(C){for(let T of C)if(T.data.target==="character"){let D=((u=this.sharedGameControlGlobals.rapierWorld)==null?void 0:u.getCollider(v.collider.handle))._parent,I;if(_.cloner){for(let O of _.cloner.children)if(O.rigidBody===D){I=O;break}}T.dispatch(I),_.dispatchEvent(VS)}}}let A=K4.set(v.normal2.x,v.normal2.y,v.normal2.z).applyQuaternion(this.colliderWorldQuat),E=$4.copy(S).multiplyScalar(v.toi).dot(A),M=v.toi;if(M===0&&(this.position.y+=this.offset*this.pixelsPerMeter),E>this.offset&&(M=v.toi*(E-this.offset)/E,y.addScaledVector(S,M)),g.copy(S).multiplyScalar(w-M),Math.acos(-A.y)>this.slopeThresh){let C=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(y),T=yl.copy(v.witness2).applyQuaternion(this.colliderWorldQuat);T.y=0;let D=C.add(T);D.y+=this.stepThresh;let I=this.sharedGameControlGlobals.rapierWorld.castShape(D,this.colliderWorldQuat,g,(h=this.object.rigidBody)==null?void 0:h.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);I!==null&&I.toi===0&&(A.y=0,A.normalize())}g.addScaledVector(A,-g.dot(A))}else{x===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),y.add(g);break}}this.position.addScaledVector(y,this.pixelsPerMeter),(d=this.object.rigidBody)==null||d.setTranslation(ha.copy(this.position).divideScalar(this.pixelsPerMeter),!0),(p=this.object.rigidBody)==null||p.setRotation(Vs.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let g=this.onObject?1:5,v=n.multiplyScalar(r/g);for(let y=0;y<g;y++)this.position.add(v),this.collisionAdjustment(r/g)}else this.position.addScaledVector(n,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let g=this.objectToTarget.add(this.position),v=this.targetToCamera.add(g);Mw.lookAt(v,g,Gs).setPosition(v),Mw.decompose(this.targetPos,this.targetQuat,ha),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**a),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**a),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Ge.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Ge.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(vde),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*((m=(f=this.navMeshPathDest)==null?void 0:f.material)==null?void 0:m.userData.opacity0))?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(gde),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e=Vs.setFromAxisAngle(Gs,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Ge.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(e);let t;this.cameraXAxis==="Limit"?t=Ge.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):t=Ge.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ha.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(e);let r=yo.setFromAxisAngle(i,t);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(e),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(e){Gs.angleTo(e)*180/Math.PI<15||Gs.angleTo(e)*180/Math.PI>85?Vs.identity():Vs.setFromUnitVectors(Gs,e),this.groundTilt.slerp(Vs,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var a;let t=$4.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=Mw.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ha,Vs,Ma).compose(ha,Vs,eI);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(s=>{if(s===this.object||s.isDescendantOf(this.object))return;ps.makeEmpty(),s.updateMatrixWorldSVD();let n=s.matrixWorldRigid,o=J4.copy(n).invert(),l=cde.copy(J4).multiply(i);yr.copy(this.collider.segment),yr.start.applyMatrix4(l),yr.end.applyMatrix4(l);let c=K4.copy(this.position).applyMatrix4(o);ps.expandByPoint(yr.start),ps.expandByPoint(yr.end),ps.min.addScalar(-this.collider.radius),ps.max.addScalar(this.collider.radius),s.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(u){return u.distanceToPoint(yr.end)},intersectsBounds:u=>u.intersectsBox(ps),intersectsTriangle:u=>{let h=ha,d=Ma,p=u.closestPointToSegment(yr,h,d);if(p<this.collider.radius){let f=this.collider.radius-p,m=d.sub(h).normalize(),g=yl.copy(c);g.addScaledVector(m,f);let v=g.applyMatrix4(n).sub(this.position);t.add(v),yr.start.addScaledVector(m,f),yr.end.addScaledVector(m,f)}}})}),ps.makeEmpty(),yr.copy(this.collider.segment),yr.start.applyMatrix4(i),yr.end.applyMatrix4(i),ps.expandByPoint(yr.start),ps.expandByPoint(yr.end),ps.min.addScalar(-this.collider.radius),ps.max.addScalar(this.collider.radius),(a=this.sharedGameControlGlobals.staticMeshBVH)==null||a.shapecast({traverseBoundsOrder(s){return s.distanceToPoint(yr.end)},intersectsBounds:s=>s.intersectsBox(ps),intersectsTriangle:s=>{let n=ha,o=Ma,l=s.closestPointToSegment(yr,n,o);if(l<this.collider.radius){let c=this.collider.radius-l,u=o.sub(n).normalize();this.alignToGround&&this.groundTiltAdjustment(u),t.addScaledVector(u,c),yr.start.addScaledVector(u,c),yr.end.addScaledVector(u,c)}}}),this.onObject=Math.abs(t.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,t.length()-1e-5);t.normalize().multiplyScalar(r),this.position.add(t)}},hj=FS;hj.isLocked=!1;var yde=ar(Ek());function Oo(e,t){let i=new Qe;if(!e.getAttribute("position"))return i.setAttribute("position",new Re([],3)),i.setIndex([]),i;let{positions:r,triIndices:a}=j1(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Re(r,3)),i.setIndex(a),t&&i.applyMatrix4(t),i}var xde=new Se,bde=new Se,Cn=[[0,0,0],[0,0,0],[0,0,0]];function uj(e){let t=e.elements;Cn[0][0]=t[0],Cn[0][1]=t[4],Cn[0][2]=t[8],Cn[1][0]=t[1],Cn[1][1]=t[5],Cn[1][2]=t[9],Cn[2][0]=t[2],Cn[2][1]=t[6],Cn[2][2]=t[10];let{u:i,v:r}=(0,yde.SVD)(Cn),a=xde.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=bde.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return a.multiply(s.transpose())}var wde=class extends v5{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e,t=!0,i=[]){return e.forEach(r=>{r.visible&&this.intersectObject(r,t,i)}),i}createRaycastLineHelper(){let e=new dc({color:65280,linewidth:10}),t=new P(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new P(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,a=new P().addVectors(t,i.multiplyScalar(r)),s=new Qe;return s.setFromPoints([t,a]),new $0(s,e)}},dj=e=>e instanceof ud||e instanceof dd;function _de(e,t){return e.distance-t.distance}function pj(e,t,i){if(!(!Do(t)||!t.visible)){Zs(t)&&t.raycast(e,i);for(let r of t.children)pj(e,r,i)}}function m0(e,t,i,r=!1){if(!r&&!i.some(s=>Xy(e,s)!==void 0))return[];let a=[];return t.children.forEach(s=>pj(e,s,a)),a.sort(_de),a}function US(e){let t=[];if(e.length){let i=e[0].object;Do(i)&&t.push(i);let r=i.parent;for(;r;)dj(r)&&t.push(r),r=r.parent}return t}function Io(e,t,i,r){let a=e.frame;if(a){let s=t[0]*a.width,n=(1-t[1])*a.height;for(let o of i){let l=o===a.uuid?a:a.find(o);if(l!=null&&l.intersects(s,n))return r(l),!0}}return!1}function Xy(e,t){if(Zs(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(dj(t))return fj(e,t)}function fj(e,t){if(!(!Do(t)||!t.visible)){if(Zs(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let r=fj(e,i);if(r)return r}}}function Sde(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-((t-(i.top+window.scrollY))/i.height)*2+1}}function Ade(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}var Ede=class{constructor(e,t,i,r,a,s,n,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=r,this.sharedAssets=a,this.requestRender=s,this.isExport=n,this.frame=o,this.raycaster=new wde,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=t.mouseEventTarget==="window",this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var r;let{pageX:t,pageY:i}=((r=e.touches)==null?void 0:r.length)>0?e.touches[0]:e;this.pointerWorld=Sde(t,i,this._domRect),this.pointerScreen=Ade(t,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},pn=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},NC=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],mj=e=>{var t;return(t=NC.find(([i,r])=>r===e))==null?void 0:t[0]},Zm=e=>{var t;return(t=NC.find(([i])=>i===e))==null?void 0:t[1]},Cde=(e,t)=>{let i=mj(e);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:t}),r}},Mde=class extends pn{constructor(e){super(e),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=i=>{var s;if(!i.eventName||!i.target||i.eventName==="Scroll")return;let r=(s=this.splineEvents[mj(i.eventName)])==null?void 0:s[i.target.uuid];if(!r)return;i.eventName==="Scroll"&&i.deltaY!==void 0&&Object.assign(r,{deltaY:i.deltaY});let{domElement:a}=this.eventContext;a.dispatchEvent(r)};let{page:t}=this.eventContext;t.traverseEntity(i=>{var r,a;if((r=i.data)!=null&&r.events.length){for(let[s,n]of NC)if(i.data.events.some(o=>o.data.type===n&&!o.data.disabled)){this.objectsPerEvents.has(s)?(a=this.objectsPerEvents.get(s))==null||a.push(i):this.objectsPerEvents.set(s,[i]);let o={id:i.uuid,name:i.name},l=Cde(n,o),c=this.splineEvents[s];c?c[i.uuid]=l:this.splineEvents[s]={[i.uuid]:l}}}})}connect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(e=>{e.forEach(t=>{t.removeEventListener("beginEvent",this.onBeginEvent)})})}},Tde=class{constructor(e,t,i,r,a,s){if(this.id=e,this.data=t,this.object=i,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,this.useToggle=t.runMode==="Toggle",(t.type==="KeyDown"||t.type==="KeyUp"||t.type==="KeyPress")&&!t.key)throw new Error("Missing property");this.actions=wa(t,t.actions,r,a,s,i)}disconnect(){Cr(this.actions)}dispatchHeld(e){this.actions.Create.forEach(t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()})}dispatch(e=!1){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(t)}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()}),this.actions.SwitchCamera.forEach(t=>{t.toggle()})):this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStart())):(this.actions.Transition.some(t=>t.playing)||this.actions.Transition.forEach(t=>{this.alreadyPlayedNonTogglingActions.has(t)===!1&&t.play()}),this.actions.SwitchCamera.some(t=>t.playing)||this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),e===!1&&this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStop()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},Pde=class extends pn{constructor(e,t,i){super(e),this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=n=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(n);let{raycaster:o,page:l}=this.eventContext,c=m0(o,l,[],!0);this.sceneInterects=c,c.length&&(this.eventContext.sharedAssets.raycastProperty={x:c[0].point.x,y:c[0].point.y,z:c[0].point.z,objX:c[0].object.matrixWorld.elements[12],objY:c[0].object.matrixWorld.elements[13],objZ:c[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(o=>{(o.data.type==="MouseDown"||o.data.type==="MousePress")&&(this.onCanvasRaycast(n),o.dispatch())})},this.onCanvasMouseUp=n=>{(n.target===this.eventContext.domElement||n.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(o=>{o.data.type==="MouseUp"?(this.onCanvasRaycast(n),o.dispatch()):o.data.type==="MousePress"&&o.dispatchRelease()})},this.onMouseDown=n=>{ot.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseDown"))},this.onMouseUp=n=>{ot.length>1||(this.eventContext.updateRaycaster(n),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=n=>{ot.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent())},this.onMousePressRelease=n=>{ot.length>1||(this.eventContext.updateRaycaster(n),this.handleMousePressEvent(!0))},this.onKeyDown=n=>{this.heldKeys[n.key]||(this.handleKeyEvent(n,"KeyDown"),this.handleKeyEventHeld(n,"KeyDown",!0)),this.heldKeys[n.key]=!0},this.onKeyUp=n=>{this.handleKeyEvent(n,"KeyUp"),this.handleKeyEventHeld(n,"KeyUp",!0)},this.onKeyPressDown=n=>{this.heldKeysPress[n.key]?this.handleKeyEventHeld(n,"KeyPress"):(this.handleKeyEvent(n,"KeyPress"),this.handleKeyEventHeld(n,"KeyPress",!0)),this.heldKeysPress[n.key]=!0},this.onKeyPressUp=n=>{this.handleKeyEvent(n,"KeyPress",!0)},this.releaseHeldKey=n=>{delete this.heldKeys[n.key]},this.releaseHeldKeyPress=n=>{delete this.heldKeysPress[n.key]},this._onUserEvent=({eventName:n,target:o,reverse:l})=>{var u,h,d,p;if(!n||!o)return;let c=Zm(n);c&&(c==="MouseDown"||c==="MouseUp"||c==="MousePress"?(o.dispatchEvent({type:"beginEvent",eventName:c}),(h=(u=this.eventsPerObjects[c])==null?void 0:u[o.uuid])==null||h.forEach(f=>{f.dispatchUserEvent(l)})):(c==="KeyDown"||c==="KeyUp"||c==="KeyPress")&&(o.dispatchEvent({type:"beginEvent",eventName:c}),(p=(d=this.eventsPerObjects[c])==null?void 0:d[o.uuid])==null||p.forEach(f=>{f.dispatchUserEvent()})))};let{page:r,sharedAssets:a}=this.eventContext,s=(n,o)=>{var c,u;if(!((c=n.data)!=null&&c.events.length))return;let l=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let h of l){let d=this.eventsPerObjects[h];n.data.events.filter(({data:p})=>p.type===h&&p.disabled!==!0).forEach(({id:p,data:f})=>{try{let m=new Tde(p,f,n,r,a,t);m.actions.Video.length&&(this.hasVideoAction=!0),(f.type==="MouseDown"||f.type==="MouseUp"||f.type==="MousePress")&&(f.mode==="Canvas"||f.mode==="Window")?this.canvasMouseEvents.push(m):d[n.uuid]?d[n.uuid].some(g=>g.id===m.id)||d[n.uuid].push(m):d[n.uuid]=[m]}catch{}}),(u=d[n.uuid])!=null&&u.length&&this.objectsPerTypes[h].push(n instanceof dr&&(h==="MouseDown"||h==="MouseUp"||h==="MousePress")?o:n)}};r.traverseEntity(n=>{var o;(n instanceof ea||n instanceof kr)&&((o=n.frame)==null||o.traverse(l=>{s(l,n)})),s(n)})}connect(){var t,i,r,a,s,n;let{domElement:e}=this.eventContext;this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),e.addEventListener("pointerdown",this.onCanvasMouseDown),e.addEventListener("pointerup",this.onCanvasMouseUp),((t=this.objectsPerTypes.MouseDown)!=null&&t.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown)),(i=this.objectsPerTypes.MouseUp)!=null&&i.length&&(this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),(r=this.objectsPerTypes.MousePress)!=null&&r.length&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMousePressRelease)),(a=this.objectsPerTypes.KeyDown)!=null&&a.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),(s=this.objectsPerTypes.KeyUp)!=null&&s.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),(n=this.objectsPerTypes.KeyPress)!=null&&n.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([o,l])=>{l.forEach(c=>{c.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(t=>{Object.values(t).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(t=>{t.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([t,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(e){var o,l,c,u;let{stopRaycast:t,raycaster:i,page:r,pointerScreen:a}=this.eventContext,s=this.objectsPerTypes[e],n=s.filter(h=>!(h instanceof dr));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&Io(r,[a.x,a.y],Object.keys(this.eventsPerObjects[e]),h=>{this.handleObjectMouseEventDispatch(h,e)}))){if(t||this.useForRaycastProperty){let h;if(this.sceneInterects===null?h=m0(i,r,n,this.useForRaycastProperty):(h=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&h.length&&(this.eventContext.sharedAssets.raycastProperty={x:h[0].point.x,y:h[0].point.y,z:h[0].point.z,objX:h[0].object.matrixWorld.elements[12],objY:h[0].object.matrixWorld.elements[13],objZ:h[0].object.matrixWorld.elements[14]}),t){let d=[((l=(o=h[0])==null?void 0:o.uv)==null?void 0:l.x)??0,((u=(c=h[0])==null?void 0:c.uv)==null?void 0:u.y)??0];US(h).forEach(p=>{p instanceof ea&&Io(p,d,Object.keys(this.eventsPerObjects[e]),f=>{this.handleObjectMouseEventDispatch(f,e)}),this.eventsPerObjects[e][p.uuid]&&this.handleObjectMouseEventDispatch(p,e)})}}t||n.forEach(h=>{var p,f;let d=Xy(i,h);d&&(this.handleObjectMouseEventDispatch(h,e),h instanceof ea&&Io(h,[((p=d==null?void 0:d.uv)==null?void 0:p.x)??0,((f=d==null?void 0:d.uv)==null?void 0:f.y)??0],Object.keys(this.eventsPerObjects[e]),m=>{this.handleObjectMouseEventDispatch(m,e)}))})}}handleMousePressEvent(e=!1){let t="MousePress",i=this.objectsPerTypes[t],r=i.filter(s=>!(s instanceof dr)),a=[];if(i.length){if(!e){let{stopRaycast:s,raycaster:n,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=Io(o,[l.x,l.y],Object.keys(this.eventsPerObjects[t]),u=>{a.push(u)})),s&&!c){let u=m0(n,o,r);a=US(u),u.forEach(h=>{var d,p;h.object instanceof ea&&Io(h.object,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{a.push(f)})})}else r.forEach(u=>{var d,p;let h=Xy(n,u);h&&(a.push(u),u instanceof ea&&Io(u,[((d=h==null?void 0:h.uv)==null?void 0:d.x)??0,((p=h==null?void 0:h.uv)==null?void 0:p.y)??0],Object.keys(this.eventsPerObjects[t]),f=>{a.push(f)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{a.includes(s)||this.handleObjectMouseEventDispatchRelease(s,t)}),a.length&&a.forEach(s=>{this.handleObjectMouseEventDispatch(s,t)}),this._prevObjects=a}}handleObjectMouseEventDispatch(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(a=>{a.dispatch()})}handleObjectMouseEventDispatchRelease(e,t){var i,r;e.dispatchEvent({type:"beginEvent",eventName:t}),(r=(i=this.eventsPerObjects[t])==null?void 0:i[e.uuid])==null||r.forEach(a=>{a.dispatchRelease()})}handleKeyEvent(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{let a=this.eventsPerObjects[t][r.uuid];a.some(({data:s})=>"key"in s&&s.key===e.key)&&r.dispatchEvent({type:"beginEvent",eventName:t}),a.forEach(s=>{"key"in s.data&&s.data.key===e.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(e,t,i=!1){this.objectsPerTypes[t].forEach(r=>{this.eventsPerObjects[t][r.uuid].forEach(a=>{"key"in a.data&&a.data.key===e.key&&a.dispatchHeld(i)})})}},Dde=new P,Ode=new P,gj=class{constructor(e,t,i,r,a){this.actionsIn=wa(e,e.inActions,i,r,a,t),this.actionsOut=wa(e,e.outActions,i,r,a,t)}disconnect(){Cr(this.actionsIn),Cr(this.actionsOut)}},Ide=class extends gj{constructor(e,t,i,r,a,s){super(t,i,r,a,s),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=Dde.setFromMatrixPosition(this.objects[0].matrixWorld),u=Ode.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(p=>p.dispatchConditional()),d.Particles.forEach(p=>p.dispatchConditional()),d.Video.forEach(p=>p.dispatchConditional()),d.Link.forEach(p=>p.dispatch()),d.Create.forEach(p=>p.dispatch()),d.Destroy.forEach(p=>p.dispatch()),d.Reset.forEach(p=>p.dispatch()),d.Transition.forEach(p=>{p.object.currentTransitionEvent!==this&&(p.object.currentTransitionEvent=this),p.init()}),d.Transition.forEach(p=>p.play()),d.Animation.forEach(p=>p.play()),d.SwitchCamera.forEach(p=>p.play()),d.SceneTransition.forEach(p=>p.dispatch()),d.SetVariable.forEach(p=>p.checkConditions()),d.SetVariable.forEach(p=>p.dispatch()),d.DynamicVariablePlay.forEach(p=>p.dispatch())}};let{distance:n,fromObject:o,toObject:l}=t.condition;this.distance=n;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},Rde=class extends gj{constructor(e,t,i,r,a,s){var l;super(t,i,r,a,s),this.id=e,this.data=t,this.object=i,this.onBegin=({target:c,state:u})=>{this.toState!==u&&(this.actionsOut.Audio.forEach(h=>h.dispatchConditional()),this.actionsOut.Particles.forEach(h=>h.dispatchConditional()),this.actionsOut.Video.forEach(h=>h.dispatchConditional()),this.actionsOut.Link.forEach(h=>h.dispatch()),this.actionsOut.Create.forEach(h=>h.dispatch()),this.actionsOut.Destroy.forEach(h=>h.dispatch()),this.actionsOut.Reset.forEach(h=>h.dispatch()),this.actionsIn.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(h=>h.play()),this.actionsOut.Animation.forEach(h=>h.play()),this.actionsIn.SwitchCamera.forEach(h=>h.pause()),this.actionsOut.SwitchCamera.forEach(h=>h.play()),this.actionsOut.SceneTransition.forEach(h=>h.dispatch()),this.actionsOut.SetVariable.forEach(h=>h.checkConditions()),this.actionsOut.SetVariable.forEach(h=>h.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(h=>h.dispatch()))},this.onComplete=({target:c,state:u})=>{this.toState===u&&(this.actionsIn.Audio.forEach(h=>h.dispatchConditional()),this.actionsIn.Particles.forEach(h=>h.dispatchConditional()),this.actionsIn.Video.forEach(h=>h.dispatchConditional()),this.actionsIn.Link.forEach(h=>h.dispatch()),this.actionsIn.Create.forEach(h=>h.dispatch()),this.actionsIn.Destroy.forEach(h=>h.dispatch()),this.actionsIn.Reset.forEach(h=>h.dispatch()),this.actionsOut.Transition.forEach(h=>h.pause()),this.actionsOut.Transition.forEach(h=>h.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(h=>h.play()),this.actionsIn.Animation.forEach(h=>h.play()),this.actionsOut.SwitchCamera.forEach(h=>h.pause()),this.actionsIn.SwitchCamera.forEach(h=>h.play()),this.actionsIn.SceneTransition.forEach(h=>h.dispatch()),this.actionsIn.SetVariable.forEach(h=>h.checkConditions()),this.actionsIn.SetVariable.forEach(h=>h.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(h=>h.dispatch()))};let{condition:n}=t;if(!n.object)throw new Error("Missing property");let o=r.find(n.object)??r.scene.find2D(n.object);if(!o)throw new Error("Missing property");if(this.toObject=o,n.state&&!((l=this.toObject.states)!=null&&l[n.state]))throw new Error("Missing property");this.toState=n.state}connect(){Uc(this.actionsOut).forEach(e=>{var t;(t=this.actionsOut[e])!=null&&t.length&&this.toObject.addEventListener("beginState",this.onBegin)}),Uc(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),Uc(this.actionsOut).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),Uc(this.actionsIn).forEach(e=>{var t;(t=this.actionsIn[e])!=null&&t.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},Lde=class extends pn{constructor(e,t){super(e),this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1;let{page:i,sharedAssets:r}=this.eventContext;i.traverseEntity(a=>{var s;if((s=a.data)!=null&&s.events.length){for(let{id:n,data:o}of a.data.events)if(!o.disabled&&o.type==="Conditional")try{let l;o.condition.type==="Comparison"||(o.condition.type==="Distance"?l=new Ide(n,o,a,i,r,t):o.condition.type==="State"&&(l=new Rde(n,o,a,i,r,t))),l&&(this.eventsPerConditions[o.condition.type].push(l),(l.actionsIn.Video.length||l.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}})}connect(){super.connect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(e=>e.forEach(t=>t.disconnect()))}},qp=new P,xl=new P,_c=new P,rI=new Ya,kde=.01,Ft=new P,lr=new P,aI=new P,Yc=new ut,Tw=new hr,zde=new Se,Pw=new Ui,su=new P,Mn=new P,nu=.2;function Dw(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var Nde=function(){let e=new Se;return(t,i,r)=>{let a=t.obj;e.copy(a.hiddenMatrix),a.parent!==null&&e.premultiply(a.parent.matrixWorld),e.invert(),a.position.copy(i),t.reference==="global"&&Dw(a.position,t.limits),a.position.applyMatrix4(e),t.reference==="parent"?Dw(a.position,t.limits):t.reference==="local"&&(Yc.copy(t.quat0).invert(),a.position.sub(t.position0),a.position.applyQuaternion(Yc),Dw(a.position,t.limits),Yc.invert(),a.position.applyQuaternion(Yc),a.position.add(t.position0)),e.multiply(r??a.matrixWorld).decompose(Ft,a.quaternion,lr),a.updateMatrix(),a.hasNonUniformScale&&(a.updateMatrixWorld(),a.updateMatrixWorldSVD()),a instanceof ba&&Fo(a.parent)&&a.invalidateDownstreamBooleanData(!0)}}(),Bde=class{constructor(e,t,i,r,a,s){this.object=e,this.data=t,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=wa(t,t.dragDropActions.drag,i,r,a,this.object),this.actionsDrop=wa(t,t.dragDropActions.drop,i,r,a,this.object);let n=[];this.data.objects.forEach(o=>{let l=i.find(o);!l||l.data.visible!==!1&&(n.push(l),s[l.uuid]&&s[l.uuid].forEach(c=>{let u=i.find(c);!u||u.data.visible!==!1&&n.push(u)}))}),this.data.dropDestinations.forEach(o=>{let l=i.find(o);!l||l.data.visible!==!1&&(this.dropDestIds.push(l.uuid),s[l.uuid]&&s[l.uuid].forEach(c=>{let u=i.find(c);!u||u.data.visible!==!1&&this.dropDestIds.push(u.uuid)}))}),this.dragItems=n.map(o=>(this.data.planeMode==="locked"&&(o.userData.lockedPlane=!0),o.userData.worldPosition0=new P().setFromMatrixPosition(o.matrixWorld),{obj:o,fromPosition:new P().setFromMatrixPosition(o.matrixWorld),pointStart:new P,pointEnd:new P,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new P().copy(o.position),quat0:new ut().copy(o.quaternion),snapped:!1,orientationMatrix:new Se,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Cr(this.actionsDrag),Cr(this.actionsDrop),this.dragItems.forEach(e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()})}},jde=class extends pn{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=r=>{var o;if(ot.length>1)return;this.eventContext.updateRaycaster(r);let{raycaster:a,page:s}=this.eventContext,n=s.raycastWithClones(a);if(this.lastDropDestination=null,n.length===0){this.activeEvent=null;return}for(let l of this.events){let c=0;for(let{obj:u,pointEnd:h,pointStart:d}of l.dragItems){if(u===n[0].object||u===n[0].object.object||Ot.is(u)&&u.isAncestorOf(n[0].object.uuid)){if(l.activeIdx=c,l.activeDragItem.reset=!1,l.activeDragItem.currentDampingFactor=l.data.dampingFactor,l.activeDragItem.snapped=!1,l.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){l.activeDragItem.obj.rigidBody&&l.activeDragItem.obj.rigidBody.setBodyType(2,!0);let p=l.activeDragItem.obj;u.hasNonUniformScale&&u.updateMatrixWorldSVD(),(p.hasNonUniformScale?p.matrixWorldRigid:p.matrixWorld).decompose(Ft,Yc,lr),Tw.setFromQuaternion(Yc),p.prevR===void 0?(p.prevR=Tw.clone(),p.prevT=Ft.clone()):(p.prevR.copy(Tw),p.prevT.copy(Ft)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(l.activeDragItem.obj)}this.calcPlaneIntersectPos(u,d,l.data.plane,l.data.referenceFrame),h.copy(d),(this.eventManager.controlsManager.usePhysics&&((o=u.data.physics)==null?void 0:o.rigidBody)==="dynamic"||l.data.drop===!1||l.data.resetOnSnapFail===!1)&&l.activeDragItem.fromPosition.setFromMatrixPosition(l.activeDragItem.obj.matrixWorld),this.activeEvent=l,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}c++}}this.activeEvent=null},this.onPointerMove=r=>{var o,l,c,u;if(ot.length>1)return;this.eventContext.updateRaycaster(r);let{raycaster:a,page:s}=this.eventContext,n=s.raycastWithClones(a);if(ot.length===0){let h=!1;for(let d of this.events){for(let{obj:p}of d.dragItems)if(p===((o=n[0])==null?void 0:o.object)||p===((c=(l=n[0])==null?void 0:l.object)==null?void 0:c.object)||Ot.is(p)&&p.isAncestorOf((u=n[0])==null?void 0:u.object.uuid)){switch(h=!0,d.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(h)break}h||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let h=this.activeEvent.activeDragItem;h.snapped=!1;let d;if(this.activeEvent.data.drop&&(d=n.filter(p=>h.obj!==p.object&&!h.obj.isAncestorOf(p.object.uuid)&&!(p.object instanceof ud)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(f=>f===p.object.uuid||s.scene.find(f).isAncestorOf(p.object.uuid))))[0]),d){let p=aI.copy(d.face.normal).applyMatrix3(Pw.getNormalMatrix(d.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")h.fromPosition.setFromMatrixPosition(d.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(h.fromPosition.copy(d.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Ft.copy(p).applyMatrix3(Pw.setFromMatrix4(h.obj.matrixWorld).transpose());let f=h.obj;Ft.x>nu?lr.x=-f.recursiveBBox.min.x:Ft.x<-nu&&(lr.x=-f.recursiveBBox.max.x),Ft.y>nu?lr.y=-f.recursiveBBox.min.y:Ft.y<-nu&&(lr.y=-f.recursiveBBox.max.y),Ft.z>nu?lr.z=-f.recursiveBBox.min.z:Ft.z<-nu&&(lr.z=-f.recursiveBBox.max.z),lr.applyMatrix3(Pw.invert())}else lr.copy(p).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);h.fromPosition.add(lr)}this.activeEvent.data.autoOrient&&(Ft.set(0,1,0).cross(p),Ft.length()<1e-4&&Ft.set(-1,0,0).cross(p),lr.crossVectors(aI,Ft),h.orientationMatrix.makeBasis(Ft,lr,p)),h.pointStart.copy(h.fromPosition),h.pointEnd.copy(h.pointStart),h.currentDampingFactor=this.activeEvent.snapDampingFactor,h.snapped=!0,this.lastDropDestination!==d.object&&(this.lastDropDestination=d.object,this.activeEvent.actionsDrop.Transition.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Animation.forEach(f=>{f.play()}),this.activeEvent.actionsDrop.Audio.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(f=>{f.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(f=>{f.dispatchThrottled()}))}else h.orientationMatrix.makeRotationFromQuaternion(h.quat0),this.lastDropDestination=null,h.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(h.obj,h.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(p=>{p.stop()}),this.activeEvent.actionsDrop.Audio.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(p=>{p.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(p=>{p.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(p=>p.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(p=>p.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(p=>p.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Animation.forEach(p=>{p.play()}),this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(p=>{p.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(p=>{p.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(p=>{p.stop(),p.object.currentState!==null&&p.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(p=>{p.stop()}))},500),this.updateDragItem(h),h.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=r=>{var a;if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let s=((a=this.activeEvent.activeDragItem.obj.data.physics)==null?void 0:a.rigidBody)==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!s)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&s&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(n=>{n.stop(),n.object.currentState!==null&&n.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(n=>{n.stop()}),this.activeEvent.actionsDrag.Audio.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(n=>n.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}};let i={};e.page.traverseEntity(r=>{r.component&&(i[r.component.uuid]?i[r.component.uuid].push(r.uuid):i[r.component.uuid]=[r.uuid])}),e.page.traverseEntity(r=>{var a;(a=r.data)==null||a.events.filter(s=>s.data.type==="DragDrop"&&!s.data.disabled).forEach(s=>{this.events.push(new Bde(r,s.data,e.page,e.sharedAssets,t,i))})})}connect(){if(!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(t=>t.dispose())}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,r){let{getCamera:a,raycaster:s}=this.eventContext;a().getWorldDirection(xl),xl.negate();let n=Yc.identity();switch(r==="parent"?zde.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(Ft,n,lr):r==="local"&&e.matrixWorld.decompose(Ft,n,lr),i){case"x":Ft.set(1,0,0).applyQuaternion(n),su.copy(xl).cross(Ft),Mn.copy(Ft).cross(su);break;case"y":Ft.set(0,1,0).applyQuaternion(n),su.copy(xl).cross(Ft),Mn.copy(Ft).cross(su);break;case"z":Ft.set(0,0,1).applyQuaternion(n),su.copy(xl).cross(Ft),Mn.copy(Ft).cross(su);break;case"xy":Mn.set(0,0,1).applyQuaternion(n);break;case"yz":Mn.set(1,0,0).applyQuaternion(n);break;case"xz":Mn.set(0,1,0).applyQuaternion(n);break;case"adaptive":xl.angleTo(lr.set(0,1,0))>Math.PI/6?(Ft.crossVectors(lr.set(0,1,0),xl),Mn.crossVectors(Ft,lr)):Mn.set(0,1,0);break;default:Mn.copy(xl);break}_c.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:_c;if(rI.setFromNormalAndCoplanarPoint(Mn,o),!!s.ray.intersectPlane(rI,t)&&(i==="x"||i==="y"||i==="z")){let l=lr.subVectors(t,o).dot(Ft);t.copy(o).addScaledVector(Ft,l)}}updateDragItem(e,t=!1){var i,r;_c.setFromMatrixPosition(e.obj.matrixWorld),e.reset==="current"?qp.subVectors(e.fromPosition,_c).divideScalar(e.currentDampingFactor):e.reset==="original"?(qp.subVectors(e.obj.userData.worldPosition0,_c).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):qp.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(_c).divideScalar(e.currentDampingFactor),e.paused=e.currentDampingFactor>1?qp.length()<kde:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||t)&&Nde(e,qp.add(_c),(i=this.activeEvent)!=null&&i.data.drop&&((r=this.activeEvent)!=null&&r.data.autoOrient)?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},ou=new P,Ow=new P,xo=new P,bo=new P,sI=new Ya,Fde=.01,Ude={type:"requestRender"},Vde=function(){let e=new P,t=new P;return(i,r,a)=>a>0?(e.subVectors(i,r),e.length()<=a?i:t.copy(r).add(e.normalize().multiplyScalar(a))):r}(),nI=function(){let e=new Se;return(t,i)=>{t.position.copy(i),t.parent!==null&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof ba&&Fo(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Gde=class{constructor(e,t,i,r,a){this.data=e,this.object=t,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new P,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...v2.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=wa(e,e.actions,i,r,a,t)}},Hde=class extends pn{constructor(e,t){super(e),this.events=[],this.pairOfEventListeners=[],this.onMouseMove=r=>{if(!(ot.length>1)){this.eventContext.updateRaycaster(r);for(let a of this.events)a.target===void 0&&this.updateSingleEvent(a)}},this.onMouseEnter=r=>{for(let a of this.events)a.target===void 0&&(a.isReset=!1,a.currentDampingFactor=a.data.dampingFactor)},this.onMouseLeave=r=>{for(let a of this.events)a.target===void 0&&(a.data.resetOnPointerLeave&&(a.isReset=!0,a.currentDampingFactor=a.resetDampingFactor),this.updateSingleEvent(a))},this.onTargetChange=r=>()=>{this.updateSingleEvent(r)};let{page:i}=this.eventContext;i.traverseEntity(r=>{var s,n;let a=(s=r.data)==null?void 0:s.events.find(o=>o.data.type==="Follow"&&!o.data.disabled);a&&(!i.data.globalPhysics.usePhysics||((n=r.dataPatched.physics)==null?void 0:n.rigidBody)!=="dynamic")&&this.events.push(new Gde(a.data,r,i,e.sharedAssets,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events)if(i.target!==void 0){let r=i.target,a=this.onTargetChange(i);this.pairOfEventListeners.push([r,a]),r.addEventListener("requestRender",a)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Ka&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Cr(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e,t=!1){var n;this.events.forEach(o=>{o.actions.Create.forEach(l=>{l.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:a}=e.data;if(e.object.getWorldPosition(xo),e.isReset)bo.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(bo);else{let{getCamera:o,raycaster:l}=this.eventContext;if(i==="custom"?(o().getWorldDirection(Ow),Ow.negate(),ou.copy(Ow)):i==="xy"?ou.set(0,0,1):i==="xz"?ou.set(0,1,0):i==="yz"&&ou.set(1,0,0),sI.setFromNormalAndCoplanarPoint(ou,xo),!l.ray.intersectPlane(sI,bo))return}if(!e.isReset){if(bo.distanceTo(e.worldPosition0)>r&&a&&e.target)if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)bo.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor;else return;else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return}e.data.enabledTranslation[0]===!1&&(bo.x=xo.x),e.data.enabledTranslation[1]===!1&&(bo.y=xo.y),e.data.enabledTranslation[2]===!1&&(bo.z=xo.z);let s=Vde(xo,bo,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let o=ou.subVectors(s,xo).divideScalar(e.currentDampingFactor);xo.add(o),t&&nI(e.object,xo),e.paused=o.length()<Fde}else nI(e.object,s),e.paused=!0;(n=e.object)==null||n.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(Ude)}},Xp=new P,Bv=new P,Yp=new Se,lu=new ut,bl=new ut,Qp=new P,Zp=new P,Sc=new P,wo=new P,Iw=new Ya,Wde=1e-6,qde={type:"requestRender"},Xde={type:"changeRotation"},oI=function(){let e=new Se;return function(t,i){t.parent!==null?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(uj(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof ba&&Fo(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Yde=class{constructor(e,t,i){this.object=t,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ut,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...y2.defaultData,...e,...e.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},e.target===void 0||e.target==="cursor"||(this.target=i.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},Qde=class extends pn{constructor(e){super(e),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=i=>{if(!(ot.length>1)){this._lastMouseEvent=i,this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onScroll=i=>{if(this._lastMouseEvent){let r=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(r)}},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)},this.createUserEventListener=i=>({eventName:r,target:a})=>{if(!r||!a)return;let s=Zm(r);s&&s==="LookAt"&&this.updateSingleEvent(i)};let{page:t}=this.eventContext;t.traverseEntity(i=>{var a,s;let r=(a=i.data)==null?void 0:a.events.find(n=>n.data.type==="LookAt"&&!n.data.disabled);r&&(!t.data.globalPhysics.usePhysics||((s=i.dataPatched.physics)==null?void 0:s.rigidBody)!=="dynamic")&&this.events.push(new Yde(r.data,i,t))})}connect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),t.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?t.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let i of this.events){if(i.target!==void 0){let s=this.onTargetChange(i),n=i.target;this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}let r=this.createUserEventListener(i),a=i.object;this.pairOfUserEventListeners.push([a,r]),a.addEventListener("userEvent",r)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),Ka&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var d;let{tilt:t,axis:i,distance:r,plane:a,limitDistance:s,enabledRotation:n,limitDistanceEnabled:o}=e.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=e;if(u.getWorldPosition(Qp),!e.isReset)if(e.target)e.target.getWorldPosition(Zp);else{if(a==="custom"?(l().getWorldDirection(Bv),Bv.negate(),Iw.setFromNormalAndCoplanarPoint(Bv,Qp)):(a==="xy"?Xp.set(0,0,1):a==="xz"?Xp.set(0,1,0):a==="yz"&&Xp.set(1,0,0),Iw.setFromNormalAndCoplanarPoint(Xp,Qp)),!c.ray.intersectPlane(Iw,Zp))return;r>0&&(a==="custom"||a===void 0)&&Zp.addScaledVector(Bv,r)}if(e.isReset||(h?t==="target"?Sc.copy(h.up).applyMatrix4(Yp.extractRotation(h.matrixWorld)).normalize():n.some(p=>p===!1)?(i==="x"?(wo.set(0,0,1),n[2]===!1&&wo.set(0,1,0)):i==="y"?(wo.set(1,0,0),n[0]===!1&&wo.set(0,0,1)):(wo.set(0,1,0),n[1]===!1&&wo.set(1,0,0)),Sc.copy(wo).applyQuaternion(e.worldQuaternion0).normalize()):Sc.set(0,1,0):a==="custom"?Sc.set(0,1,0):Sc.copy(Xp)),e.isReset)bl.copy(e.worldQuaternion0);else if(Qp.distanceTo(Zp)>s&&o&&h)if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&e.timeoutId!==null&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,e.data.resetAfterDistanceLimit)bl.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor;else return;else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout(()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)},e.data.snapDelay*1e3)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),e.delayFinished===!1)return;Zde(Yp,Zp,Qp,Sc,i,wo),bl.setFromRotationMatrix(Yp),lu.setFromUnitVectors(wo.applyQuaternion(bl),Sc),n.some(p=>p===!1)&&t!=="target"&&bl.premultiply(lu).normalize()}e.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),lu.setFromRotationMatrix(uj(u.matrixWorld)),lu.slerp(bl,1/e.currentDampingFactor),oI(u,Yp.makeRotationFromQuaternion(lu)),e.paused=8*(1-lu.dot(bl))<Wde):(oI(u,Yp.makeRotationFromQuaternion(bl)),e.paused=!0),(d=e.object)==null||d.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(qde),u.dispatchEvent(Xde)}},fs=new P,or=new P,Bi=new P;function Zde(e,t,i,r,a,s){let n=e.elements;Bi.subVectors(t,i),Bi.lengthSq()===0&&(Bi.z=1),Bi.normalize(),or.crossVectors(r,Bi),or.lengthSq()===0&&(Math.abs(r.z)===1?Bi.x+=1e-4:Bi.z+=1e-4,Bi.normalize(),or.crossVectors(r,Bi)),or.normalize(),fs.crossVectors(Bi,or),a==="x"?s.z===1?[or,fs,Bi]=[Bi,or,fs]:(or.negate(),[or,Bi]=[Bi,or]):a==="y"?s.x===1?[or,fs,Bi]=[fs,Bi,or]:(or.negate(),[fs,Bi]=[Bi,fs]):s.x===1&&(or.negate(),[or,fs]=[fs,or]),n[0]=or.x,n[4]=fs.x,n[8]=Bi.x,n[1]=or.y,n[5]=fs.y,n[9]=Bi.y,n[2]=or.z,n[6]=fs.z,n[10]=Bi.z}var Kde=class{constructor(e,t,i,r,a,s){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=wa(t,t.actions,r,a,s,i)}disconnect(){Cr(this.actions)}dispatchEnter(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.play()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.entered&&(this.entered=!1,this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent()))}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},$de=class extends pn{constructor(e,t){super(e),this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=s=>{ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseHoverEvent())},this.onMouseUp=s=>{ot.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=s=>{ot.length>1||(this.eventContext.updateRaycaster(s),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:s,target:n,reverse:o})=>{var c;if(!s||!n)return;let l=Zm(s);l&&l==="MouseHover"&&(n.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(c=this.eventsPerObjects[n.uuid])==null||c.forEach(u=>u.dispatchUserEvent(o)))};let{page:i,sharedAssets:r}=this.eventContext,a=(s,n)=>{var o,l;if(!(!s.visible||!((o=s.data)!=null&&o.events.length))){for(let{id:c,data:u}of s.data.events)if(!u.disabled&&u.type==="MouseHover")try{let h=new Kde(c,u,s,i,r,t);this.eventsPerObjects[s.uuid]?this.eventsPerObjects[s.uuid].push(h):this.eventsPerObjects[s.uuid]=[h]}catch{}(l=this.eventsPerObjects[s.uuid])!=null&&l.length&&this.objects.push(s instanceof dr?n:s)}};i.traverseEntity(s=>{var n;(s instanceof ea||s instanceof kr)&&((n=s.frame)==null||n.traverse(o=>{a(o,s)})),a(s)})}connect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),e.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),e.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(t=>{t.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),Ka&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(t=>{t.forEach(i=>{i.disconnect()})}),this.objects.forEach(t=>{t.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(e=!1){let t=[];if(!e){let{stopRaycast:i,raycaster:r,page:a,pointerScreen:s}=this.eventContext,n=!1;if(a.uiCanvas&&(n=Io(a,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{t.push(o)})),i&&!n){let o=m0(r,a,this.objects);t=US(o),o.forEach(l=>{var c,u;l.object instanceof ea&&Io(l.object,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)})})}else this.objects.forEach(o=>{var c,u;let l=Xy(r,o);l&&(t.push(o),o instanceof ea&&Io(o,[((c=l==null?void 0:l.uv)==null?void 0:c.x)??0,((u=l==null?void 0:l.uv)==null?void 0:u.y)??0],Object.keys(this.eventsPerObjects),h=>{t.push(h)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{var r;t.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(a=>a.dispatchLeave()))}),t.length&&t.forEach(i=>{var r;i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),(r=this.eventsPerObjects[i.uuid])==null||r.forEach(a=>a.dispatchEnter())}),this._prevObjects=t}},Jde=class{constructor(e,t,i,r,a,s){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=wa(t,t.actions,r,a,s,i)}connect(){this.scrollCounter=0}disconnect(){Cr(this.actions)}dispatch(e){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(t)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch())}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},epe=class{constructor(e,t,i,r,a,s,n){this.id=e,this.data=t,this.object=i,this.domElement=s,this.eventManager=n,this.scrollStart=0,this.scrollEnd=0,this.actions=wa(t,t.actions,r,a,n,i)}computeScrollBounds(){let e=this.domElement.getBoundingClientRect(),t=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||t.scrollTop,a=i.clientTop||t.clientTop||0,s=Math.round(e.top+r-a);if(this.data.startFrom==="enter"){let n=window.innerHeight,o=e.height,l=this.data.enterAnchor,c=l==="top"?n:l==="bottom"?n-o:n-o*.5;this.scrollStart=s-c}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=e,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Cr(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:e,y:t}){this.actions.Transition.forEach(a=>{a.object.currentTransitionEvent!==this&&(a.object.currentTransitionEvent=this,a.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(t-this.scrollStart)/i));this.actions.Transition.forEach(a=>a.seek(r)),this.actions.Animation.forEach(a=>a.seek(r)),this.actions.Create.forEach(a=>a.dispatchThrottled()),this.actions.SetVariable.forEach(a=>a.checkConditions()),this.actions.SetVariable.forEach(a=>a.dispatch()),this.actions.DynamicVariablePlay.forEach(a=>a.dispatch())}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>{t.playFromCurrent()}),this.actions.Animation.forEach(t=>{t.playFromCurrent()})),this.actions.Create.forEach(t=>t.dispatchThrottled()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch())}},tpe=class extends pn{constructor(e,t){super(e),this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([o,l])=>{l.forEach(c=>c.handleResize())})},this.onScroll=o=>{if(!this.isInview)return;let l={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([c,u])=>{c.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:l}),u.forEach(h=>h.dispatch(l))})},this.onWheel=o=>{!this.isInview||o.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([l,c])=>{l.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:o.deltaY}),c.forEach(u=>u.dispatch(o.deltaY))})},this.onUserEvent=({eventName:o,target:l,reverse:c})=>{var h;if(!o||!l)return;let u=Zm(o);u&&u==="Scroll"&&(l.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),(h=this.wheelEventsPerObject.get(l))==null||h.forEach(d=>{d.dispatchUserEvent(c)}))};let{page:i,sharedAssets:r,domElement:a,isExport:s}=this.eventContext,n=o=>{var l,c,u;if((l=o.data)!=null&&l.events.length){for(let{id:h,data:d}of o.data.events)if(!d.disabled&&d.type==="Scroll")if(d.trigger==="load"||!s){let p=new Jde(h,d,o,i,r,t);this.wheelEventsPerObject.has(o)?(c=this.wheelEventsPerObject.get(o))==null||c.push(p):this.wheelEventsPerObject.set(o,[p])}else{let p=new epe(h,d,o,i,r,a,t);this.scrollEventsPerObject.has(o)?(u=this.scrollEventsPerObject.get(o))==null||u.push(p):this.scrollEventsPerObject.set(o,[p])}}};i.traverseEntity(o=>{var l;(o instanceof ea||o instanceof kr)&&((l=o.frame)==null||l.traverse(c=>{n(c)})),n(o)}),this.intersectionObserver=new IntersectionObserver(o=>{let l=o[0];l&&(this.isInview=l.isIntersecting)},{root:null})}connect(){this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.connect()),e.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(e=>e.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([e,t])=>{t.forEach(i=>i.disconnect()),e.removeEventListener("userEvent",this.onUserEvent)})}},ipe=class{constructor(e,t,i,r,a,s){this.id=e,this.data=t,this.object=i,this.actions=wa(t,t.actions,r,a,s,i)}disconnect(){Cr(this.actions)}dispatch(){this.actions.Transition.forEach(e=>{e.play()}),this.actions.Animation.forEach(e=>{e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatchFromStart()}),this.actions.Destroy.forEach(e=>{e.dispatchFromStart()})}dispatchAfter(e){this.actions.Audio.forEach(t=>{(t.interaction.data.triggerAfter??"any")===e&&(t.interaction instanceof Xc?t.interaction.audioPlayer.play():t.interaction instanceof LS&&t.interaction.dispatch())}),this.actions.Video.forEach(t=>{let i=t.interaction.data.triggerAfter??"autoplay";i===e&&(t.interaction instanceof fd?t.interaction.play(i==="autoplay"):t.interaction instanceof jS&&t.interaction.dispatch())}),this.actions.Particles.forEach(t=>{(t.data.triggerAfter??"any")===e&&t.dispatchBasic()})}dispatchUserEvent(e){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),e?(this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent())):(this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.playFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent())),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch()}),this.actions.Audio.forEach(t=>{t.interaction instanceof Xc?t.interaction.audioPlayer.play():t.interaction instanceof LS&&t.interaction.dispatch()}),this.actions.Video.forEach(t=>{t.interaction instanceof fd?t.interaction.play():t.interaction instanceof jS&&t.interaction.dispatch()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()})}},rpe=class extends pn{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(a=>{a.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(a=>{a.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext;(r?document:i).removeEventListener("pointerdown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,s])=>{a.dispatchEvent({type:"beginEvent",eventName:"Start"}),s.forEach(n=>{n.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(a=>{a.actions.Audio.forEach(s=>{s.interaction instanceof Xc&&s.interaction.audioPlayer.play()}),a.actions.Video.forEach(s=>{let n=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof fd&&s.interaction.play(n==="autoplay")}),a.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(a=>{a.dispatchAfter("autoplay")})})},this.onUserEvent=({eventName:i,target:r,reverse:a})=>{var n,o;if(!i||!r)return;let s=Zm(i);s&&s==="Start"&&(r instanceof dr||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),(n=this.eventsPerObject.get(r))==null||n.forEach(l=>{l.dispatchUserEvent(a)}),(o=this.eventsAfterPerObject.get(r))==null||o.forEach(l=>{l.dispatchUserEvent(a)}))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=r=>{var a,s,n,o,l;if((a=r.data)!=null&&a.events.length)for(let{id:c,data:u}of r.data.events){if(u.disabled||u.type!=="Start")continue;let h=new ipe(c,u,r,t,e,this.eventManager);(h.actions.Transition.length||h.actions.Animation.length||h.actions.SwitchCamera.length||h.actions.Create.length||h.actions.Destroy.length||h.actions.SceneTransition.length||h.actions.Reset.length||h.actions.SetVariable.length||h.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(r)?(s=this.eventsPerObject.get(r))==null||s.push(h):this.eventsPerObject.set(r,[h])),h.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?(n=this.eventsAfterPerObject.get(r))==null||n.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?(o=this.eventsAfterPerObject.get(r))==null||o.push(h):this.eventsAfterPerObject.set(r,[h])),h.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?(l=this.eventsAfterPerObject.get(r))==null||l.push(h):this.eventsAfterPerObject.set(r,[h]))}};if(t.traverseEntity(r=>{var a;(r instanceof ea||r instanceof kr)&&((a=r.frame)==null||a.traverse(s=>{i(s)})),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:a}=this.eventContext,s=a?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([n,o])=>{n.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,a])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(e=>e.length)){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,a])=>{r.removeEventListener("userEvent",this.onUserEvent),a.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([e,t])=>{e.removeEventListener("userEvent",this.onUserEvent),t.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},ape=class{constructor(e,t,i,r,a,s){this.id=e,this.data=t,this.object=i,this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=wa(t,t.actions,r,a,s,i),this.target=t.target,this.useToggle=t.runMode==="Toggle"}disconnect(){Cr(this.actions)}dispatch(e){this.disabled||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this?(t.object.currentTransitionEvent=this,t.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(t)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.useToggle?(this.actions.Transition.forEach(t=>{t.toggle()}),this.actions.Animation.forEach(t=>{t.toggle()})):(this.actions.Transition.forEach(t=>{this.alreadyPlayedNonTogglingActions.has(t)===!1&&t.play()}),this.actions.Animation.forEach(t=>{t.play()})),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(e??!1)}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}))}},spe=class extends pn{constructor(e,t,i,r,a){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=r,this.needsRaycast=a,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.events=[],this.onFrame=s=>{this.rafId=window.requestAnimationFrame(this.onFrame);let n=new Date,o=[],l=[];for(let h=0;h<this.propertiesToWatch.length;h++){let{objectId:d,property:p,prevValue:f}=this.propertiesToWatch[h],m=this.eventContext.scene.find(d),g=b2.propertyPaths[p];if(g[0]==="width"||g[0]==="height"||g[0]==="depth")m=m.geometry.userData.parameters[g[0]];else for(let v=0;v<g.length;v++)m=m[g[v]];f===null?this.propertiesToWatch[h].prevValue=m instanceof P?m.clone():m:(m instanceof P?!m.equals(f):f!==m)&&(l.push({objId:d,property:p}),m instanceof P?this.propertiesToWatch[h].prevValue.copy(m):this.propertiesToWatch[h].prevValue=m)}for(let h=0;h<this.variablesToWatch.length;h++){let{id:d,prevValue:p}=this.variablesToWatch[h],f=this.shared.getVariable(d);f!==p&&(o.push(d),this.variablesToWatch[h].prevValue=f)}for(let h=0;h<this.dynamicVars.length;h++){let{id:d,expectedTime:p,last:f,data:m,timerSeconds:g,startValue:v}=this.dynamicVars[h],y=1e3;if((m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&m.format==="number3decimal"?y=1:m.dynamicVariableType==="counter"?y=m.updateInterval:m.dynamicVariableType==="random"&&(y=m.isStatic?1/0:m.updateInterval),p===-1){this.dynamicVars[h].last=s,this.dynamicVars[h].expectedTime=s+y;continue}if(!((this.shared.getDynamicVariablePlayState(d)==="Stopped"||this.shared.getDynamicVariablePlayState(d)==="Restarted")&&(this.dynamicVars[h].last=s,this.dynamicVars[h].expectedTime=s+y,m.dynamicVariableType==="counter"&&this.shared.getVariable(d)!==v&&(this.shared.updateVariable(d,v),this.eventManager.requestRender()),(m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&this.dynamicVars[h].timerSeconds!==v&&(this.dynamicVars[h].timerSeconds=v,this.shared.updateVariable(d,ys.getFormattedTimerTime(v,m)),this.eventManager.requestRender()),this.shared.getDynamicVariablePlayState(d)==="Restarted"&&this.shared.setDynamicVariablePlayState(d,"Playing"),this.shared.getDynamicVariablePlayState(d)==="Stopped"))){if(this.shared.getDynamicVariablePlayState(d)==="Paused"){this.dynamicVars[h].deltaToExpectedTime===void 0&&(this.dynamicVars[h].deltaToExpectedTime=Math.max(this.dynamicVars[h].expectedTime-s,0)),this.dynamicVars[h].last=s-(y-this.dynamicVars[h].deltaToExpectedTime),this.dynamicVars[h].expectedTime=s+this.dynamicVars[h].deltaToExpectedTime;continue}else this.dynamicVars[h].deltaToExpectedTime=void 0;if(s>=p)if(this.dynamicVars[h].last=s,this.dynamicVars[h].expectedTime+=y,m.dynamicVariableType==="random"){let x=m.min+Math.random()*(m.max-m.min),w=m.decimals;x=Math.round(x*Math.pow(10,w))/Math.pow(10,w),this.shared.updateVariable(d,x),o.push(d),this.eventManager.requestRender()}else if(m.dynamicVariableType==="counter"){if(m.increment===0)continue;let x=this.shared.getVariable(d),w=this.shared.getDynamicVariableToggleIsForward(d)??!0,S=this.shared.getVariable(d)+m.increment*(w?1:-1);m.hasEnd&&(S=m.increment>0?Ge.clamp(S,v,m.endValue):Ge.clamp(S,m.endValue,v),S===v&&this.shared.setDynamicVariableToggleIsForward(d,void 0),m.repeat?S===m.endValue&&(S=v):(S===v||S===m.endValue)&&this.shared.setDynamicVariablePlayState(d,"Paused")),S!==x&&(o.push(d),this.shared.updateVariable(d,S),this.eventManager.requestRender())}else if(m.dynamicVariableType==="time")this.shared.updateVariable(d,AO(n,m)),o.push(d),this.eventManager.requestRender();else{let x=$a.isTextValue(m.endValue)?lI(m.endValue.textValue):m.endValue,w=this.shared.getDynamicVariableToggleIsForward(d)??!0,S=g+(s-f)/1e3*(m.dynamicVariableType==="timer"?-1:1)*(w?1:-1);S=Math.max(S,0),m.hasEnd&&(S=m.dynamicVariableType==="stopwatch"?Ge.clamp(S,v,x):Ge.clamp(S,x,v),S===v&&this.shared.setDynamicVariableToggleIsForward(d,void 0),m.repeat?Math.abs(S-x)<(m.format==="number3decimal"?1e-4:.1)&&(S=v):(Math.abs(S-v)<(m.format==="number3decimal"?1e-4:.1)||Math.abs(S-x)<(m.format==="number3decimal"?1e-4:.1))&&this.shared.setDynamicVariablePlayState(d,"Paused")),S!==g&&(o.push(d),this.dynamicVars[h].timerSeconds=S,this.shared.updateVariable(d,ys.getFormattedTimerTime(S,m)),this.eventManager.requestRender())}}}this.needsMouse&&this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,this.events.forEach(h=>{h.data.variableId==="mouseProperty"&&(h.dispatch(),this.eventManager.requestRender())}));let c=!1;this.shared.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=this.shared.mouseProperty,c=!0);let u=!1;this.shared.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=this.shared.raycastProperty,u=!0),this.events.forEach(h=>{(o.includes(h.data.variableId)||l.find(d=>d.objId===h.data.objectId&&d.property===h.data.property)||h.data.variableId==="mouseProperty"&&c||h.data.variableId==="raycastProperty"&&u)&&(h.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()},e.page.traverseEntity(s=>{var n;(n=s.data)==null||n.events.filter(o=>o.data.type==="VariableChange"&&!o.data.disabled).forEach(o=>{this.events.push(new npe(s.uuid,o.data,s,e.page,e.sharedAssets,i))})}),this.propertiesToWatch=this.events.filter(s=>s.data.variableId==="objectProperty"&&s.data.objectId!==null).map(s=>({objectId:s.data.objectId,property:s.data.property,prevValue:null})),this.shared=e.sharedAssets,this.sharedVariables.forEach(({id:s,data:n})=>{if(!("dynamicVariableType"in n)){this.events.find(l=>l.data.variableId===s)&&this.variablesToWatch.push({id:s,prevValue:this.shared.getVariable(s)});return}let o;if(n.dynamicVariableType==="timer"||n.dynamicVariableType==="stopwatch"){let l;if($a.isTextValue(n.value)&&Array.isArray(n.value.textValue)){let c=n.value.textValue;c.length===3?l=c[2]+c[1]*60+c[0]*3600:l=c[1]+c[0]*60}else l=n.value;o=l,this.dynamicVars.push({id:s,last:-1,expectedTime:-1,data:n,timerSeconds:l,startValue:o})}else n.dynamicVariableType==="time"&&this.shared.updateVariable(s,AO(new Date,n)),n.dynamicVariableType==="counter"&&(o=$a.isTextValue(n.value)?lI(n.value.textValue):n.value),this.dynamicVars.push({id:s,last:-1,expectedTime:-1,data:n,startValue:o})})}pause(){this.pauseTime=Date.now()}resume(){let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(e=>e.dispose())}},npe=class{constructor(e,t,i,r,a,s){this.id=e,this.data=t,this.object=i,this.actions=wa(t,t.actions,r,a,s,i)}dispatch(){let e=this.actions;e.Audio.forEach(t=>t.dispatchConditional()),e.Particles.forEach(t=>t.dispatchConditional()),e.Video.forEach(t=>t.dispatchConditional()),e.Create.forEach(t=>t.dispatch()),e.Destroy.forEach(t=>t.dispatch()),e.Reset.forEach(t=>t.dispatch()),e.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this),t.init()}),e.Transition.forEach(t=>t.play()),e.Animation.forEach(t=>t.play()),e.SwitchCamera.forEach(t=>t.play()),e.SceneTransition.forEach(t=>t.dispatch()),e.SetVariable.forEach(t=>t.checkConditions()),e.SetVariable.forEach(t=>t.dispatch()),e.DynamicVariablePlay.forEach(t=>t.dispatch())}dispose(){Cr(this.actions)}};function lI(e){return e.length===3?e[2]+e[1]*60+e[0]*3600:e[1]+e[0]*60}var ope="https://unpkg.com/@splinetool/runtime@1.0.26/build/",lpe="https://unpkg.com/@splinetool/navmesh-wasm@1.0.26/build/",cpe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${ope}' + 'navmesh.js'),
		fetch('${lpe}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,hpe=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,upe=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,dpe=.001,ppe={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},vj,Tt,Or;mte.then(e=>{vj=e,Tt=new e.Vec3,Or=new e.Vec3});var fpe=new P,mpe=class{constructor(e=!1,t=!1){this.usePhysics=e,this.isExport=t,this.onPointerDown=i=>{if(ot.length!==1)return;let{raycaster:r,page:a}=this.eventContext;this.eventContext.updateRaycaster(i);let s=a.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let n=fpe.copy(this.gameControl.colliderWorldPosition);n.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(n,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>a=>{var d,p,f,m,g,v,y;let s;if(a instanceof Js)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;s=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof ta)s=a.object;else if(s=a,((d=s.dataPatched.cloner)==null?void 0:d.disabled)===!1&&((p=s.dataPatched.cloner)==null?void 0:p.hideBase)&&((f=s.dataPatched.physics)==null?void 0:f.fusedBody)!==!0)return!0;if(r&&!s.userData.navmesh)return;let n=s.dataPatched;if(!n.visible&&((m=n.physics)==null?void 0:m.enabled)!==!0)return!0;a.updateMatrixWorldSVD();let o=Yy(n),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let x of n.events)x.data.disabled!==!0&&(x.data.type==="GameControl"?u=!0:x.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&((g=n.physics)==null?void 0:g.rigidBody)==="dynamic"){if(this.usePhysics&&((v=n.physics)!=null&&v.fusedBody))return!0}else if("geometry"in a&&a.geometry&&i.push(Oo(a.geometry,a.matrixWorld)),this.usePhysics&&((y=n.physics)==null?void 0:y.fusedBody))return a.traverseObject((x,w)=>{var A,E;if(w===0)return;let S;if(x instanceof Js)if(x.objectForSample){if(x.objectForSample.dataPatched.physics.fusedBody)return;S=x.object}else return x.object.dataPatched.physics.fusedBody===!0&&x.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(x instanceof ta)S=x.object;else if(S=x,(A=x.dataPatched.cloner)==null?void 0:A.hideBase)return!0;let _=S.dataPatched;if(!_.visible&&((E=_.physics)==null?void 0:E.enabled)!==!0)return!0;"geometry"in x&&x.geometry&&i.push(Oo(x.geometry,x.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>a=>{let s;if(a instanceof Js)return;a instanceof ta?s=a.object:s=a;let n=s.dataPatched;if(n.physics.enabled==="visibility"?!n.visible:!n.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=a.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(Yy(n)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(Oo(o,a.matrixWorld))},this.navmeshWasm=vj,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?cpe:hpe)+upe])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.resolution=e.ch,this.setDefaultQueryExtent(new P().setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=!0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=!0})});let r=[],a=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,t.zones==="custom");if(e.traverseChildren(a),t.objects.forEach(l=>{var u;let c=e.scene.find(l);c.traverseEntity(h=>{h.userData.navmesh=void 0}),(u=c.cloner)==null||u.traverseObject(h=>{h.userData.navmesh=void 0})}),r.length===0)return!1;let s=qc(r),{positions:n,triIndices:o}=j1(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([n,n.length/3,o,o.length,{...ppe,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),a=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(e=0;e<r*3;e++)a[e]=e;for(e=0;e<r;e++)for(t=0;t<3;t++){let o=i.getTriangle(e).getPoint(t);s[e*9+t*3+0]=o.x,s[e*9+t*3+1]=o.y,s[e*9+t*3+2]=o.z}let n=new Qe;return n.setIndex(new ht(a,1)),n.setAttribute("position",new ht(s,3)),n}getClosestPoint(e){return Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,this.navMesh.getClosestPoint(Tt)}getClosestPointToRef(e,t){Tt.x=e.x,Tt.y=e.y,Tt.z=e.z;let i=this.navMesh.getClosestPoint(Tt);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,this.navMesh.getRandomPointAround(Tt,t)}getRandomPointAroundToRef(e,t,i){Tt.x=e.x,Tt.y=e.y,Tt.z=e.z;let r=this.navMesh.getRandomPointAround(Tt,t);i.set(r.x,r.y,r.z)}moveAlong(e,t){return Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,Or.x=t.x,Or.y=t.y,Or.z=t.z,this.navMesh.moveAlong(Tt,Or)}moveAlongToRef(e,t,i){return Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,Or.x=t.x,Or.y=t.y,Or.z=t.z,this.navMesh.moveAlong(Tt,Or)}computePath(e,t){let i=this.getClosestPoint(t);Or.x=i.x,Or.y=i.y,Or.z=i.z,this.getClosestPoint(e);let r=this.navMesh.computePath(Tt,Or),a=r.getPointCount(),s=[];for(let n=0;n<a;n++){let o=r.getPoint(n);s.push(new P(o.x,o.y,o.z))}return s}createCrowd(e,t){return new gpe(this,e,t)}setDefaultQueryExtent(e){Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,this.navMesh.setDefaultQueryExtent(Tt)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);r.set(e);let a=new this.navmeshWasm.NavmeshData;a.dataPointer=r.byteOffset,a.size=e.length,this.navMesh.buildFromNavmeshData(a),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),(e=this.eventContext)==null||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,this.navMesh.addCylinderObstacle(Tt,t,i)}addBoxObstacle(e,t,i){return Tt.x=e.x,Tt.y=e.y,Tt.z=e.z,Or.x=t.x,Or.y=t.y,Or.z=t.z,this.navMesh.addBoxObstacle(Tt,Or,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return this.navmeshWasm!==void 0}},gpe=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=t.radius,r.height=t.height,r.maxAcceleration=t.maxAcceleration,r.maxSpeed=t.maxSpeed,r.collisionQueryRange=t.collisionQueryRange,r.pathOptimizationRange=t.pathOptimizationRange,r.separationWeight=t.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let a=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),r);return this.transforms.push(i),this.agents.push(a),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new P(0,0,0)),a}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);t.radius!==void 0&&(i.radius=t.radius),t.height!==void 0&&(i.height=t.height),t.maxAcceleration!==void 0&&(i.maxAcceleration=t.maxAcceleration),t.maxSpeed!==void 0&&(i.maxSpeed=t.maxSpeed),t.collisionQueryRange!==void 0&&(i.collisionQueryRange=t.collisionQueryRange),t.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=t.pathOptimizationRange),t.separationWeight!==void 0&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=dpe)return;let t=1/60,i=10;{let r=Math.floor(e/t);r>i&&(r=i),r<1&&(r=1);let a=e/r;for(let s=0;s<r;s++)this.crowd.update(a)}for(let r=0;r<this.agents.length;r++){let a=this.agents[r],s=this.getAgentPosition(a);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let n=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=n*n+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(a,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),r=i.getPointCount(),a=[];for(t=0;t<r;t++){let s=i.getPoint(t);a.push(new P(s.x,s.y,s.z))}return a}dispose(){this.crowd.destroy()}};function vpe(e){let t=!1;return e.scene.objects.forEach(i=>{i.data.type==="Page"&&!t&&i.data.publish.gameControlObject&&gm.traverseModuleInstances(e,i.id,(r,a,s)=>{for(let n of s)n.data.type==="GameControl"&&n.data.navmesh.enabled&&(t=!0)})}),t}var ype={type:"change"},cI={type:"changeZoom"},xpe={type:"changePan"},cu={type:"start"},hu={type:"end",changed:!0},bpe={type:"end",changed:!1},Rw=new ut,hI=new Q,wpe=2*Math.PI,_pe=1e-8,Spe=.01,Lw=new P,jv=new Q,kw=new P,Fv=new ut,uI=new Se,Ape={type:"requestRender"},yj=class extends Hr{constructor(e,t,i={isPlayMode:!1,isExport:!1}){super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,ls.DOLLY_ROTATE,ls.PAN],this.offset=new P,this.eye=new P,this.lastPosition=new P,this.lastQuaternion=new ut,this.current=new Q,this.overShoot=new Q,this.overRatio=new Q,this.spherical=new YT,this.sphericalDelta=new YT,this.panOffset=new P,this.panLeftV=new P,this.panUpV=new P,this.panV=new P,this.rotateStart=new Q,this.rotateEnd=new Q,this.rotateDelta=new Q,this.panStart=new Q,this.panEnd=new Q,this.panDelta=new Q,this.dollyStart=new Q,this.dollyEnd=new Q,this.dollyDelta=new Q,this.rotationRangeFactor=new Q,this.panRangeFactor=new Q,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(kw,Fv,Lw),this.offset.copy(kw).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(Rw.copy(Fv).invert()),this.panOffset.applyQuaternion(Rw),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(Fv),this.panOffset.applyQuaternion(Fv)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),kw.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(uI.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(uI));let r=this.spherical.phi%wpe;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(Yt.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let a=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-a,this.sphericalDelta.phi*=1-a}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>Spe||8*(1-this.lastQuaternion.dot(this.object.quaternion))>_pe?(this.dispatchEvent(ype),this.object.dispatchEvent(Ape),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&Ka?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(cu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Ka||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,Lw.subVectors(this.position0,this.target0),this.spherical.setFromVector3(Lw),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?jv.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):jv.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(jv).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(hI,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(jv).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&Ka?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,ot.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),ot.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(hu):this.dispatchEvent(bpe),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Ka||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let a;switch(this.useKeyEvents?a=this.mouseButtons[r.button]:a=this.mouseButtonsPlay[r.button],a){case 0:if(r.altKey===!0&&!r.shiftKey&&!$g(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if($g(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if($g(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(ot.length>1&&r.preventDefault(),this.touches[ot.length-1]){case ls.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case ls.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case ls.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case ls.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(ot.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=zE(()=>this.dispatchEvent(hu),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(cu),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!NE)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(cu),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(hu)},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(cu))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(ot[0]),r.key===" "&&this.dispatchEvent(hu))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){e.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=e.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=t==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(Rw.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+r.y,this.maxV=e.panVerticalOffset.max+r.y,this.minH=-e.panHorizontalOffset.min+r.x,this.maxH=e.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=Tn(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=Tn(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=Tn(Tn(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=Tn(Tn(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,e.orbitTouches===1&&(this.touches[0]=ls.ROTATE),e.panTouches===1&&(this.touches[0]=ls.PAN),e.orbitTouches===2&&(this.touches[1]=ls.DOLLY_ROTATE),e.panTouches===2&&(this.touches[1]=ls.DOLLY_PAN),e.orbitTouches===3&&(this.touches[2]=ls.ROTATE),e.panTouches===3&&(this.touches[2]=ls.PAN),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=e.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,r,a,s,n,o){this.overShoot.set(0,0);let l,c,u;e instanceof P?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),u=!0):(l=e.theta,c=e.phi,this.current.set(Tn(this.spherical.theta),Tn(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(t===3||t===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<a&&this.current.x>0&&(this.overShoot.x=a-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<a&&(this.overShoot.x=a-this.current.x)),(t===3||t===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<n&&(this.overShoot.y=n-this.current.y)),u||(this.overShoot.x=Tn(this.overShoot.x),this.overShoot.y=Tn(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=dI(Math.abs(this.overRatio.x)),this.overRatio.y=dI(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof P?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=e===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let a=this.panV.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*a/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(xpe)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(cI)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(cI)}zoomOut(e=this.getZoomScale()){this.dispatchEvent(cu),this.dollyOut(e),this.dispatchEvent(hu)}zoomIn(e=this.getZoomScale()){this.dispatchEvent(cu),this.dollyIn(e),this.dispatchEvent(hu)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e,t=1){e.movementX!==void 0?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(hI,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,a=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(a),this.rotateUp(s),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e,t=1){e.movementX!==void 0?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(hte===!1&&$g(e)===!1&&ute(e)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1},30)}else{if(this.enableZoom===!1)return;e.deltaY===0?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(ot.length===2){let e=.5*(ot[0].pageX+ot[1].pageX),t=.5*(ot[0].pageY+ot[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(ot[0].pageX,ot[0].pageY)}handleTouchStartPan(){if(ot.length===2){let e=.5*(ot[0].pageX+ot[1].pageX),t=.5*(ot[0].pageY+ot[1].pageY);this.panStart.set(e,t)}else this.panStart.set(ot[0].pageX,ot[0].pageY)}handleTouchStartDolly(){let e=ot[0].pageX-ot[1].pageX,t=ot[0].pageY-ot[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(ot.length===2){let i=Eb(e),r=.5*(e.pageX+i.x),a=.5*(e.pageY+i.y);this.rotateEnd.set(r,a)}else{if(e.pointerId!==ot[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(ot.length===2){let t=Eb(e),i=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);this.panEnd.set(i,r)}else{if(e.pointerId!==ot[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=Eb(e),i=e.pageX-t.x,r=e.pageY-t.y,a=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,a),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){var e;if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=(e=this.options)==null?void 0:e.showCameraLock;return t&&t(),!0}}else return!1}};function Tn(e){let t=Math.PI*2;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function dI(e){return 1-Math.pow(1-e,4)}var pI=class{constructor(e,t,i,r,a,s){this.id=e,this.data=t,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.disabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=wa(t,t.actions,r,a,s,i),this.target=t.target,this.useToggle=t.runMode==="Toggle",this.triggeringObjects=t.triggeringObjects.map(n=>r.scene.find(n))}isValidTriggeringObject(e){return this.target==="all"?!0:this.triggeringObjects.some(t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid))}disconnect(){Cr(this.actions)}dispatch(){this.disabled||this.object.destroyedInAction||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):this.data.runMode==="Once"&&this.alreadyPlayedNonTogglingActions.add(e)}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.useToggle?(this.actions.Transition.forEach(e=>{e.toggle()}),this.actions.SwitchCamera.forEach(e=>{e.toggle()})):(this.actions.Transition.forEach(e=>{this.alreadyPlayedNonTogglingActions.has(e)===!1&&e.play()}),this.actions.SwitchCamera.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(!1)}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()))}},Lt;vte.then(e=>Lt=e);var Yi=new P,Hs=new ut,wl=new P,zw=new hr(0,0,0,"YXZ"),fI=new hr(0,0,0,"XYZ"),Ws=new P,Nw=new P,Bw=new P(1,1,1),uu=new ut,Uv=new Se,mI=new Se,Epe={type:"updateMatrix"},gI=new ut,jw=new Fa,VS={type:"beginEvent",eventName:"Collision"},Cpe={type:"beginEvent",eventName:"Trigger"};function Mpe(e){if(gm.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let a of r.events)if(a.data.disabled!==!0&&a.data.type==="GameControl"&&a.data.collisionEnabled){t=!0;break}}else for(let a of Object.values(r.events))if(a.disabled!==!0&&a.type==="GameControl"&&a.collisionEnabled){t=!0;break}}}),t}var Yy=e=>e.states.some(t=>t.data.position!==void 0||t.data.rotation!==void 0||t.data.hiddenMatrix!==void 0||t.data.cloner!==void 0||t.data.pathSnapping!==void 0),Tpe=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=t=>{if(t.bodyType()!==Lt.RigidBodyType.Dynamic)return;t.isSleeping()||this.nActiveRigidBodies++;let[i,r,a]=this.rigidBodyToMesh.get(t.handle);if(Yi.copy(t.translation()).multiplyScalar(this.pixelsPerMeter),Hs.copy(t.rotation()),i.matrixWorld.compose(Yi,Hs,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(Epe),a){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let n of s.children)n.updateMatrixWorld(!0)}for(let n of i.children)n.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(t,i,r)=>{var n,o,l,c;if(r===!1)return;let a,s;if(this.sensorToTriggerEvent[t]?(a=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(a=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(t)),a&&s&&a.isValidTriggeringObject(s)){a.dispatch();return}for(let u=this.sharedGameControlGlobals.createdObjects.length-1;u>=0;u--){let h=this.sharedGameControlGlobals.createdObjects[u];if(h.userData.hasCollisionDestroy&&(((n=h.rigidBody)==null?void 0:n.collider(0).handle)===t||((o=h.rigidBody)==null?void 0:o.collider(0).handle)===i)){this.sharedGameControlGlobals.createdObjects.splice(u,1),h.removeFromParent(),requestAnimationFrame(()=>{var d;return(d=this.sharedGameControlGlobals.rapierWorld)==null?void 0:d.removeRigidBody(h.rigidBody)});break}}if(((l=this.gameControl)==null?void 0:l.object)===this.sharedGameControlGlobals.colliderToEntity.get(t)){let u=this.sharedGameControlGlobals.colliderToEntity.get(i),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,i)}else if(((c=this.gameControl)==null?void 0:c.object)===this.sharedGameControlGlobals.colliderToEntity.get(i)){let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h===void 0)return;for(let d of h)d.data.target==="character"&&this.dispatchCollisionEvent(d,u,t)}else{let u=this.sharedGameControlGlobals.colliderToEntity.get(t),h=this.sharedGameControlGlobals.entityToCollisionEvents[u.uuid];if(h!==void 0)for(let f of h)f.data.target==="scene"&&this.dispatchCollisionEvent(f,u,t);let d=this.sharedGameControlGlobals.colliderToEntity.get(i),p=this.sharedGameControlGlobals.entityToCollisionEvents[d==null?void 0:d.uuid];if(p!==void 0)for(let f of p)f.data.target==="scene"&&this.dispatchCollisionEvent(f,d,i)}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=cj,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach(t=>{t.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(e=>{var i,r;let t=e.dataPatched;for(let a of t.events){if(a.data.disabled===!0)continue;let s=(r=(i=a.data.actions)==null?void 0:i.find(n=>n.data.type==="Destroy"))==null?void 0:r.data;if(s)for(let n of s.objects){let o=this.page.scene.find(n);o&&(o.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(e=>{let t=e.dataPatched;for(let i of t.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let a=this.page.scene.find(r);a&&(a.userData.hasDrag=!0)}})}initBVH(){let e=[];if(this.page.traverseChildren(t=>{var c,u;let i,r=t instanceof mS,a=t instanceof CS;if(t instanceof Js||r||a)return;t instanceof ta?i=t.object:i=t;let s=i.dataPatched;if(((c=s.physics)==null?void 0:c.enabled)==="visibility"?!s.visible:!((u=s.physics)!=null&&u.enabled))return!0;let n=t.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(Yy(s)||o||l||i.dataPatched.events.some(h=>h.data.disabled!==!0&&h.data.type==="GameControl"))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;n&&e.push(Oo(n,t.matrixWorld))}),e.length>0){let t=qc(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new If(t)}}addRigidBody(e,t,i){let r=[],a="geometry"in e?e.geometry:void 0,s=t.dataPatched;if((a==null?void 0:a.getAttribute("position"))!==void 0&&r.push(Oo(a,e.shearScale)),s.physics.fusedBody){let n=this.gatherChildrenGeom(e,r);e.traverseObject(n),e.children.forEach(l=>l.updateMatrixWorld(!0));let o=e.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(n),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let n,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(n=Lt.RigidBodyDesc.dynamic(),n.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(n=Lt.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):n=Lt.RigidBodyDesc.fixed();let l=qc(r);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(Yi,Hs,wl),e.position0=Yi.clone().divideScalar(this.pixelsPerMeter),e.rotation0=Hs.clone(),Yi.divideScalar(this.pixelsPerMeter),n.setTranslation(Yi.x,Yi.y,Yi.z).setRotation(Hs),a?l==null||l.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l==null||l.scale(wl.x/this.pixelsPerMeter,wl.y/this.pixelsPerMeter,wl.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(n);o&&this.rigidBodyToMesh.set(c.handle,[e,wl.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,t,u)}catch{try{this.addCollider(c,s.physics,l,t,!1)}catch(h){console.error(h)}}e.rigidBody=c}}addBoundsTree(e){var i,r;let t=[];if(((i=e.geometry)==null?void 0:i.getAttribute("position"))!==void 0&&((r=e.geometry)==null?void 0:r.getAttribute("position").count)>0&&t.push(Oo(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,t)),e.children.forEach(a=>a.updateMatrixWorld(!0)),t.length>0){let a=qc(t,!1);e.bvhGeometry=a,e.bvhGeometry.boundsTree=new If(a),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)}}addCollider(e,t,i,r,a=!0){var o,l;if((i==null?void 0:i.getAttribute("position").count)===0||((o=i==null?void 0:i.getIndex())==null?void 0:o.count)===0)return;let s;i&&(t.colliderType==="trimesh"?s=Lt.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Lt.ColliderDesc.convexMesh(i.getAttribute("position").array,a?i.getIndex().array:void 0)),s.setFrictionCombineRule(Lt.CoefficientCombineRule.Average).setRestitutionCombineRule(Lt.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let n=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(n.handle,r),(l=this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid])!=null&&l.some(c=>c.target==="scene")&&n.setActiveEvents(Lt.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,r)=>{var o;if(r===0)return;let a;if(i instanceof Js)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;a=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof ta)a=i.object;else if(a=i,(o=a.dataPatched.cloner)==null?void 0:o.hideBase)return!0;let s=a.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let n=i.geometry;(n==null?void 0:n.getAttribute("position"))!==void 0&&t.push(Oo(n,i.matrixWorld))}}activate(e){var d,p;if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,r=5,a=8,s=9,n="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let f of l.data.events){if(f.data.disabled||f.data.type!=="GameControl")break;let m=l;for(;this.usePhysics&&((d=m=m.parent)==null?void 0:d.parent)!==null&&!((p=m.data.physics)!=null&&p.fusedBody););f.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=f.data)}if(this.page.traverseEntity(f=>{for(let m of f.dataPatched.events)if(m.data.disabled===!1&&m.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c){i=i||c.camera===t.uuid||l.uuid===t.uuid;let f=new hj(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=f,r=c.joystickPosLoc,a=c.joystickRotLoc,s=c.jumpTouchButtonLoc,n=c.rotByTouch,Ka&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),n==="joystick"&&(this.joystickToGameControls[a]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let f=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new mpe(this.usePhysics,this.isExport);let m;f.collider.type==="sphere"?m=f.collider.radius*2:m=f.collider.height,m=Math.floor(m/f.navmesh.ch-1),this.navigationMeshWrapper.init({...f.navmesh,walkableHeight:m},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:f,enablePan:m,enableZoom:g,autoRotate:v,hoverRotatePanMode:y}=this.eventManager.publish.orbitControls;(f||m||g||v||y!==0)&&(this.orbitControls=new yj(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((f,m)=>{let g=document.body.appendChild(document.createElement("div")),[v,y,x]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[m],w=(u-5*v)/4+v,S={},_=f==="jmp",A=_?0:v;m<10?(m<5?S.top=A/2:S.bottom=A/2,S.left=A/2+m%5*w):m===10?(S.left=A/2,S.top=h/2):(S.right=A/2,S.top=h/2),S.top?S.top-=y[1]:S.bottom+=y[1],S.left?S.left+=y[0]:S.right-=y[0];for(let C in S)S[C]+="px";if(_){let C=g.appendChild(document.createElement("div"));Object.assign(C.style,S,{position:"absolute",width:v+"px",height:v+"px",backgroundColor:`rgba(255,255,255,${x==="show"?.4:0})`,zIndex:"9999",borderRadius:v+"px",border:x==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let T=v/16*16*.4;x==="show"&&(C.innerHTML=`
						<svg width="${T}" height="${v*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",D=>D.preventDefault()),this.joysticks[m]=[void 0,g];return}let E={zone:g,mode:"static",position:S,size:v};x==="hide"&&(E.restOpacity=0);let M=Fhe.create(E);M.on("move",(C,T)=>{let D=this.gameControl;f==="pos"?T.force<.2?D.moveForce=0:(D.movementState.movePosZ=Math.sin(-T.angle.radian),D.movementState.movePosX=Math.cos(-T.angle.radian),T.force>1.2?D.movementState.run=1:D.movementState.run=0,T.force<.3?D.moveForce=(T.force-.2)/.1:D.moveForce=1):f==="rot"&&(T.force<.2?D.rotForce=0:(D.movementState.rotPosX=T.vector.y,D.movementState.rotPosY=-T.vector.x,T.force<.3?D.rotForce=(T.force-.2)/.1:D.rotForce=1)),this.requestRender()}),M.on("end",(C,T)=>{let D=this.gameControl;f==="pos"?(D.movementState.movePosZ=0,D.movementState.movePosX=0,D.moveForce=1):f==="rot"&&(D.movementState.rotPosX=0,D.movementState.rotPosY=0,D.rotForce=1)}),this.joysticks[m]=[M,g]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(f=>f.disabled=!1)},80)}initPhysics(){var n;(n=this.sharedGameControlGlobals.rapierWorld)==null||n.free(),this.sharedGameControlGlobals.rapierWorld=new Lt.World(new Lt.Vector3(0,this.gravity,0)),this.events=new Lt.EventQueue(!0);let e=[],t=[];if(this.page.traverseChildren(o=>{var v,y,x,w;let l;if(o instanceof Js)if(o.objectForSample){if(o.objectForSample.dataPatched.physics.fusedBody)return;l=o.object}else return o.object.dataPatched.physics.fusedBody===!0&&o.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(o instanceof ta)l=o.object;else{if(o instanceof CS||o instanceof mS)return;if(l=o,((v=l.dataPatched.cloner)==null?void 0:v.disabled)===!1&&((y=l.dataPatched.cloner)==null?void 0:y.hideBase)&&((x=l.dataPatched.physics)==null?void 0:x.fusedBody)!==!0)return!0}let c=l.dataPatched,u;for(let S of c.events)S.data.disabled!==!0&&S.data.type==="GameControl"&&(u=S.data);if(!c.physics||(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled))return!0;o.updateMatrixWorldSVD();let h=Yy(c),d=!1,p=l.userData.hasDestroy,f=l.userData.hasDrag,m=!1;for(let S of c.events)if(S.data.disabled!==!0){if(S.data.type==="Collision"){d=!0;let _=new ape(S.id,S.data,l,this.page,this.sharedAssets,this.eventManager);_.disabled=!0,this.collisionEvents.push(_),this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].every(A=>A.id!==S.id)?this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid].push(_):this.sharedGameControlGlobals.entityToCollisionEvents[l.uuid]=[_]}else if(S.data.type==="Follow"){m=!0;let _=S.data.target;o.traverseVisible(A=>{A.userData.isFollowingObj=_})}}c.physics.rigidBody==="dynamic"&&c.physics.fusedBody===!1&&(o.matrixWorldFusedFalse=o.matrixWorld.clone());let g=o.geometry;if(u!==void 0){let S=Lt.RigidBodyDesc.kinematicPositionBased();(o.hasNonUniformScale?o.matrixWorldRigid:o.matrixWorld).decompose(Yi,Hs,wl),o.position0=Yi.clone().divideScalar(this.pixelsPerMeter),o.rotation0=Hs.clone(),Yi.divideScalar(this.pixelsPerMeter),S.setTranslation(Yi.x,Yi.y,Yi.z).setRotation(Hs);let _=this.sharedGameControlGlobals.rapierWorld.createRigidBody(S);o.rigidBody=_;let A;u.collider.type==="sphere"?A=Lt.ColliderDesc.ball(u.collider.radius/this.pixelsPerMeter):u.collider.type==="capsule"?A=Lt.ColliderDesc.capsule((u.collider.height/2-u.collider.radius)/this.pixelsPerMeter,u.collider.radius/this.pixelsPerMeter):A=Lt.ColliderDesc.cuboid(u.collider.width/this.pixelsPerMeter/2,u.collider.height/this.pixelsPerMeter/2,u.collider.depth/this.pixelsPerMeter/2),A.setFrictionCombineRule(Lt.CoefficientCombineRule.Average).setRestitutionCombineRule(Lt.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let E=this.sharedGameControlGlobals.rapierWorld.createCollider(A,_);this.sharedGameControlGlobals.colliderToEntity.set(E.handle,l),Yi.fromArray(u.collider.position).multiply(wl.setFromMatrixScale(l.matrixWorld)).divideScalar(this.pixelsPerMeter),E.setTranslationWrtParent(Yi);let M=new ut().setFromEuler(new hr().setFromVector3(new P().fromArray(u.collider.rotation)));E.setRotationWrtParent(M),E.setActiveEvents(Lt.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(l,!0)}else c.physics.rigidBody==="dynamic"||h||m||p||f||d?(this.addRigidBody(o,l,{hasFollow:m,hasTransformAnim:h,hasDrag:f}),this.generateSensorColliderDescs(l,c.physics.fusedBody)):(g&&e.push(Oo(g,o.matrixWorld)),c.physics.fusedBody&&o.traverseObject((S,_)=>{var C;if(_===0)return;let A;if(S instanceof Js)if(S.objectForSample){if(S.objectForSample.dataPatched.physics.fusedBody)return;A=S.object}else return S.object.dataPatched.physics.fusedBody===!0&&S.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(S instanceof ta)A=S.object;else if(A=S,(C=A.dataPatched.cloner)==null?void 0:C.hideBase)return!0;let E=A.dataPatched;if(E.physics.enabled==="visibility"?!E.visible:!E.physics.enabled)return!0;let M=S.geometry;(M==null?void 0:M.getAttribute("position"))!==void 0&&e.push(Oo(M,S.matrixWorld))}),this.generateSensorColliderDescs(l,c.physics.fusedBody,t));if(((w=c.physics)==null?void 0:w.fusedBody)===!0||u)return!0}),e.length===0)return;let i=qc(e);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Lt.RigidBodyDesc.fixed(),a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Lt.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Lt.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Lt.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,a);for(let[o,l]of t){let c=this.sharedGameControlGlobals.rapierWorld.createCollider(o,a);this.sensorToTriggerEvent[c.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(e=>{for(let t of e.dataPatched.events)if(t.data.type==="Trigger"&&t.data.disabled!==!0){let i=new pI(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),r=new Se().compose(Ws.fromArray(t.data.position),uu.setFromEuler(fI.fromArray(t.data.rotation)),Bw);if(t.data.triggerZone==="box"){let a=new Hi;a.min.fromArray(t.data.size).multiplyScalar(-.5),a.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([a,r,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,r,e,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(e=>e.disconnect()),this.sharedGameControlGlobals.triggers.forEach(e=>e[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){var e,t,i,r;if(this.isEnabled){this.isEnabled=!1,this.page.traverse(a=>{let s=a;s.matrixWorldFusedFalse&&(s.matrixWorldFusedFalse=void 0),s.rigidBody&&(s.rigidBody=void 0),s.position0&&(s.position0=void 0),s.rotation0&&(s.rotation0=void 0)}),(e=this.sharedGameControlGlobals.rapierWorld)==null||e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),(t=this.gameControl)==null||t.reset(),(i=this.gameControl)==null||i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([a,s])=>{a==null||a.destroy(),s.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),(r=this.navigationMeshWrapper)==null||r.dispose(),this.navigationMeshWrapper=void 0;for(let a of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))a.forEach(s=>s.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(r=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(e,t,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let a=.016666666666666666;if(e===0)r=this.stepPhysics()&&r;else{let s=e/1e3;s<a&&s>a*.55&&(s=a),this.accumulator+=s;let n=performance.now(),o=0,l=6;for(;this.accumulator>=a&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=a,o++,!(performance.now()-n>a*1e3)););this.accumulator=this.accumulator%a}}return r}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Yi,Hs,wl),zw.setFromQuaternion(Hs);let i=t;i.prevR===void 0?(i.prevR=zw.clone(),i.prevT=Yi.clone()):(i.prevR.copy(zw),i.prevT.copy(Yi)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(Yi.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(Hs))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),(e=this.events)==null||e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var s;let r=((s=this.sharedGameControlGlobals.rapierWorld)==null?void 0:s.getCollider(i))._parent,a;if(t.cloner){for(let n of t.cloner.children)if(n.rigidBody===r){a=n;break}}e.dispatch(a),t.dispatchEvent(VS)}updateUseWindowEvents(e){var t;(t=this.orbitControls)==null||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let r=mI.copy(e.matrixWorld).invert();e.traverseEntity((a,s)=>{if(t===!1&&s===1)return!0;for(let n of a.dataPatched.events)if(n.data.type==="Trigger"&&n.data.disabled!==!0){let o=new pI(n.id,n.data,a,this.page,this.sharedAssets,this.eventManager),l;if(n.data.triggerZone==="box"?l=Lt.ColliderDesc.cuboid(...n.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=Lt.ColliderDesc.ball(n.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Lt.ActiveEvents.COLLISION_EVENTS),Ws.fromArray(n.data.position),uu.setFromEuler(fI.fromArray(n.data.rotation)),Uv.compose(Ws,uu,Bw).premultiply(a.matrixWorld),i?(Uv.decompose(Ws,uu,Nw),l.setActiveCollisionTypes(Lt.ActiveCollisionTypes.KINEMATIC_FIXED|Lt.ActiveCollisionTypes.DYNAMIC_FIXED)):(Uv.premultiply(r).decompose(Ws,uu,Nw),e.rigidBody.bodyType()===Lt.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===Lt.RigidBodyType.Fixed?l.setActiveCollisionTypes(Lt.ActiveCollisionTypes.KINEMATIC_FIXED|Lt.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Lt.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Lt.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),Ws.divideScalar(this.pixelsPerMeter),l.setTranslation(Ws.x,Ws.y,Ws.z),l.setRotation(uu),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,e.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,r,a,s]=this.sharedGameControlGlobals.triggers[t];for(let n=0;n<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;n++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[n];if(a===o||s.isValidTriggeringObject(Ot.is(o)?o:o.object)===!1)continue;let l=mI.copy(a.matrixWorld).decompose(Ws,gI,Nw).compose(Ws,gI,Bw).multiply(r),c=Uv.copy(o.matrixWorld).invert().multiply(l);i instanceof Hi?e=o.bvhGeometry.boundsTree.intersectsBox(i,c):(jw.radius=i,jw.center.setFromMatrixPosition(c),e=o.bvhGeometry.boundsTree.intersectsSphere(jw)),e?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),a.dispatchEvent(Cpe)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function Ppe(e){let t=this._clip.duration,i=this._clip.start??0,r=this.loop,a=this.time+e,s=this._loopCount,n=r===rE;if(e===0)return s===-1?a:n&&(s&1)===1?t-(a-i):a;if(r===Rk){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=t)a=t;else if(a<0)a=0;else{this.time=a;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),a>=t||a<i){let o=Math.floor((a-i)/(t-i));a-=(t-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n||(a=e>0?t:i,this.repetitions===1&&(a=t)),this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){let c=e<0;this._setEndings(c,!c,n)}else this._setEndings(!1,!1,n);this._loopCount=s,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=a;if(n&&(s&1)===1)return t-(a-i)}return a}var vI=!1,Dpe=class{constructor(e,t,i,r){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=a=>{a.data.type==="Empty"&&a.data.animations&&a.data.animations.forEach((s,n)=>{let o=s[0]+"/";if(Array.isArray(a.identity)?o+=a.identity[0]:o+=a.uuid,this.clipIdToAction[o])return;let l=J_.parse(JSON.parse(s[2]));a.animations[n]=l;let c=this.mixer.clipAction(l,a);vI===!1&&(Object.getPrototypeOf(c)._updateTime=Ppe,vI=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new Rq(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let r=i.animations.find(s=>s.uuid===e);if(!r)return;let a=this.clipIdToAction[e];!a||(a.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[e],i.animations=i.animations.filter(s=>s.uuid!==e))}get isPlaying(){return Object.values(this.clipIdToAction).some(e=>e.isRunning())}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(e=>{e.repetitions=1/0,e.loop=Lk}),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),e.direction==="pingpong"&&e.repeat!==0&&(i.loop=rE)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||(t=this.animationInspectorState)!=null&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){var e,t;return((t=(e=this.activeClip)==null?void 0:e.tracks[0])==null?void 0:t.times.length)??0}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?e/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},Fw=new WeakMap,Ope=class extends Um{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,r){let a=new e2(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,s=>{this.decodeDracoFile(s,t).catch(r)},i,r)}decodeDracoFile(e,t,i,r){let a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,a).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(Fw.has(e)){let o=Fw.get(e);if(o.key===i)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,a=this.workerNextTaskID++,s=e.byteLength,n=this._getWorker(a,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[a]={resolve:l,reject:c},r.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return n.catch(()=>!0).then(()=>{r&&a&&this._releaseTask(r,a)}),Fw.set(e,{key:i,promise:n}),n}_createGeometry(e){let t=new Qe;e.index&&t.setIndex(new ht(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let r=e.attributes[i],a=r.name,s=r.array,n=r.itemSize;t.setAttribute(a,new ht(s,n))}return t}_loadLibrary(e,t){let i=new e2(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((r,a)=>{i.load(e,r,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{let r=i[0];e||(this.decoderConfig.wasmBinary=i[1]);let a=Ipe.toString(),s=["/* draco decoder */",r,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(a){let s=a.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,a){return r._taskLoad>a._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function Ipe(){let e,t;onmessage=function(n){let o=n.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise(function(u){e.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(e)});break;case"decode":let l=o.buffer,c=o.taskConfig;t.then(u=>{let h=u.draco,d=new h.Decoder,p=new h.DecoderBuffer;p.Init(new Int8Array(l),l.byteLength);try{let f=i(h,d,p,c),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:o.id,error:f.message})}finally{h.destroy(p),h.destroy(d)}});break}};function i(n,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,p,f=o.GetEncodedGeometryType(l);if(f===n.TRIANGULAR_MESH)d=new n.Mesh,p=o.DecodeBufferToMesh(l,d);else if(f===n.POINT_CLOUD)d=new n.PointCloud,p=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());let m={index:null,attributes:[]};for(let g in u){let v=self[h[g]],y,x;if(c.useUniqueIDs)x=u[g],y=o.GetAttributeByUniqueId(d,x);else{if(x=o.GetAttributeId(d,n[u[g]]),x===-1)continue;y=o.GetAttribute(d,x)}m.attributes.push(a(n,o,d,g,v,y))}return f===n.TRIANGULAR_MESH&&(m.index=r(n,o,d)),n.destroy(d),m}function r(n,o,l){let c=l.num_faces()*3,u=c*4,h=n._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(n.HEAPF32.buffer,h,c).slice();return n._free(h),{array:d,itemSize:1}}function a(n,o,l,c,u,h){let d=h.num_components(),p=l.num_points()*d,f=p*u.BYTES_PER_ELEMENT,m=s(n,u),g=n._malloc(f);o.GetAttributeDataArrayForAllPoints(l,h,m,f,g);let v=new u(n.HEAPF32.buffer,g,p).slice();return n._free(g),{name:c,array:v,itemSize:d}}function s(n,o){switch(o){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32}}}var Hl;function Rpe(){return Hl||(Hl=new Ope,Hl.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),Hl.decoderPending}async function Lpe(e){if(Hl){let t={attributeIDs:Hl.defaultAttributeIDs,attributeTypes:Hl.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await Hl.decodeGeometry(new Int8Array(e).buffer,t)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,a])=>({name:r,itemSize:a.itemSize,array:a.array}))}}return null}async function kpe(e,t){let[i,r]=gz(m2.deserialize(new Uint8Array(e)));Uz(i);let a=[];i.scene.objects.traverse((s,n)=>{n.type==="Mesh"&&n.geometry.type==="NonParametricGeometry"&&n.geometry.data.draco!==void 0&&a.push(n)}),a.length&&await Rpe();for(let s of a){let n=await Lpe(Vi(s.geometry.data.draco));if(n){n.index&&(s.geometry.data.index={array:n.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let o={};n.attributes.forEach(({name:l,array:c,itemSize:u})=>{o[l]={array:c,itemSize:u,type:"Float32Array",normalized:!1}}),s.geometry.data.attributes=o,s.geometry.data.draco=void 0}}return t&&t(i),r.result().data}var zpe=class{constructor(e,t,i,r,a,s,n){this.id=e,this.data=t,this.dataEvent=i,this.object=r,this.stage=!1,this.actions=wa(i,t.actions,a,s,n,r)}disconnect(){Cr(this.actions)}dispatchIn(){this.actions.Audio.forEach(e=>e.dispatchBasic()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Video.forEach(e=>e.dispatchBasic()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.Link.forEach(e=>e.dispatch()),this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.actions.Transition.forEach(e=>e.toggle()),this.actions.Animation.forEach(e=>e.play()),this.actions.SwitchCamera.forEach(e=>e.play()),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch())}dispatchOut(){this.actions.Transition.forEach(e=>{e.toggle()})}},Npe=class extends pn{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(a=>{let s=x2.deviceToSize(a.data.size),n=a.dataEvent.orientation==="horizontal"?i:r,o;switch(a.data.operator){case"<":o=n<s[0];break;case">":o=n>s[0];break;case"<>":o=n>s[0]&&n<s[1];break}a.stage!==o&&(a.stage=o,a.stage?a.dispatchIn():a.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:a,height:s}=r.contentRect;this.resize(a,s)}})}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=a=>{var s;if(!(!a.visible||!((s=a.data)!=null&&s.events.length)))for(let{data:n}of a.data.events)n.disabled||n.type==="Resize"&&n.breakpoints.forEach(({data:o,id:l})=>{try{let c=new zpe(l,o,n,a,e,t,this.eventManager);this.breakpoints.push(c)}catch{}})};e.traverseEntity(a=>{var s;(a instanceof ea||a instanceof kr)&&((s=a.frame)==null||s.traverse(n=>{r(n)})),r(a)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(e=>{e.disconnect()}),this.breakpoints=[]}},Bpe=class{constructor(e,t,i,r,a){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=r,this.sharedVariables=a,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{(s.touches.length>1||this.preventTouchScroll)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{var c;let{domRect:n}=this.eventContext,{pageX:o,pageY:l}=((c=s.touches)==null?void 0:c.length)>0?s.touches[0]:s;return{x:o-(n.left+window.scrollX),y:l-(n.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=r.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new Mde(this.eventContext),DynamicVariable:new spe(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),Conditional:new Lde(this.eventContext,this),Start:new rpe(this.eventContext,this),Basic:new Pde(this.eventContext,this,this.needsRaycast),MouseHover:new $de(this.eventContext,this),Scroll:new tpe(this.eventContext,this),Follow:new Hde(this.eventContext,this),DragDrop:new jde(this.eventContext,this),LookAt:new Qde(this.eventContext),Resize:new Npe(this.eventContext,this)};let{page:e,domElement:t}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity(i=>{i.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(i=>i.connect()),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){var i;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:t}=this.eventContext;t.style.cursor="",Object.values(this.handlers).forEach(r=>r.disconnect()),(i=this.controlsManager.gameControl)==null||i.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(r=>{r.removeEventListener("requestRender",this.requestRender),r.destroyedInAction=!1}),t.removeEventListener("touchmove",this.onTouchMovePreventScroll),t.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{var r;if((r=i.data)!=null&&r.events.length){for(let a of i.data.events)if(!a.data.disabled)if(a.data.type==="VariableChange"&&(a.data.variableId==="mouseProperty"&&(this.needsMouse=!0),a.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),a.data.type==="Conditional")for(let s of["inActions","outActions"])a.data[s].forEach(t);else if(a.data.type==="DragDrop")for(let s of["drag","drop"])a.data.dragDropActions[s].forEach(t);else if(a.data.type==="GameControl")for(let s of["idle","move","jump","run"])a.data.gameActions[s].forEach(t);else if(a.data.type==="Resize")for(let s of a.data.breakpoints)s.data.actions.forEach(t);else a.data.type==="LookAt"||a.data.actions.forEach(t)}})}},jpe=class{constructor(e,t,i,r,a){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=new Q().copy(i),this._editorSize=new Q().copy(r),this._aspect=t.aspect,this._fov=a??t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(e=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let t=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(e&&t>i){let a=Fpe(t,1080,2160,1,15)/100;r*=t/i,r*=1-a}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};function Fpe(e,t,i,r,a){return(e-t)/(i-t)*(a-r)+r}var Upe=class{get sharedAssets(){return this.shared}constructor(e,t={}){this.shared=new uC(e.shared,t),this.scene=new SC(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof kr&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(e=>{e instanceof ia&&e.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},Vpe=class{constructor({x:e=10,y:t=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${e}px`,this.element.style.top=`${t}px`}dispose(){var e;(e=this.element.parentElement)==null||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function Gpe(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function Nf(e){return e instanceof Am?"SubdivObject":e.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function Hpe(e,t){let i={};return e.traverseEntity(r=>{var l;if(!r.visible||!(r instanceof ba)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let a=r.parent;for(;a;){if(a instanceof ba&&r.states&&Object.keys(r.states).length)return;a=a.parent}let s=r.material.uuid,n=t.shared.materials[s];if(n){if(!ra.isMergable(n))return}else{let c=(l=t.scene.objects.get(r.uuid))==null?void 0:l.data;if(c&&"material"in c&&typeof c.material!="string"){if(!ra.isMergable(c.material))return;s=ra.getHash(c.material)}}i[s]||(i[s]={});let o=i[s][Nf(r)];if(o){if(o.push(r),r.cloner)for(let c of r.cloner.children)o.push(c)}else if(i[s][Nf(r)]=[r],r.cloner)for(let c of r.cloner.children)i[s][Nf(r)].push(c)}),i}function Wpe(e){let t=0;return Object.values(e).forEach(i=>{Object.values(i).forEach(r=>{let a=r.length;a>t&&(t=a)})}),t}function qpe(e,t){let i=Hpe(t,e),r=Wpe(i),a=new Array(r),s=0,n=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,p]of Object.entries(i))for(let f of Object.values(p)){if(o=0,c=0,f.forEach(g=>{g instanceof ba&&(n[o++]=g.geometry.clone(),l[c++]=g)}),c<2)continue;for(let g=0;g<c;g++)l[g].updateWorldMatrix(!0,!1),n[g].applyMatrix4(l[g].matrixWorld),l[g].matrixWorld.determinant()<0&&Gpe(n[g]);let m=qc(n.slice(0,o),!1);if(m){let g;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),g=new tr(m,l[0].material);break}default:{g=new tr(m,l[0].material);break}}g.castShadow=l[0].castShadow,g.receiveShadow=l[0].receiveShadow,t.add(g);let v=y=>{h=0;for(let x of y)x.children&&v(x.children),x instanceof ba&&(Array.isArray(x.material)||i[x.material.uuid]&&i[x.material.uuid][Nf(x)]&&i[x.material.uuid][Nf(x)].length>1||(u[h++]=x));for(let x=0;x<h;x++)t.attach(u[x])};for(let y=0;y<c;y++){let x=l[y];v(x.children),a[s++]=x}}}for(let d=0;d<s;d++)a[d].removeFromParent()}var Xpe=ar(v8(),1),Ype=new Q;function Qpe(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)}var Zpe=class{constructor(e,{renderOnDemand:t,renderMode:i="auto"}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=r=>{var a,s,n,o,l,c,u,h,d,p,f,m,g;if(this.time=r,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,(a=this._perfs)==null||a.start(),!this._renderer){(s=this._perfs)==null||s.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){(n=this._perfs)==null||n.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&((o=this._eventManager.handlers)!=null&&o.Start.hasVideoAction||(l=this._eventManager.handlers)!=null&&l.Basic.hasVideoAction||(c=this._eventManager.handlers)!=null&&c.Conditional.hasVideoAction)&&(this._skipRender=!1),(u=this._animationControls)==null||u.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,(h=this._scene)==null||h.traverseVisibleEntity(v=>{v.type==="ParticleSystem"&&(v.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),(d=this._eventManager)!=null&&d.isEnabled&&(((p=this._eventManager.handlers)==null?void 0:p.Follow).onAnimationFrameDamping(),((f=this._eventManager.handlers)==null?void 0:f.LookAt).onAnimationFrameDamping(),((m=this._eventManager.handlers)==null?void 0:m.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let v=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=v,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),(g=this._perfs)==null||g.end()},this._resize=()=>{var r,a,s,n,o,l,c,u,h,d;if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=Ype.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=(r=this._scene)==null?void 0:r.activeCamera,(c=this._scene)==null||c.updateViewPlaneSize(((s=(a=this._frameView)==null?void 0:a.frameSize)==null?void 0:s.x)??this._viewportWidth,((o=(n=this._frameView)==null?void 0:n.frameSize)==null?void 0:o.y)??this._viewportHeight,((l=this._frameView)==null?void 0:l.enableResponsive)??!1),this._camera){let p=Object.values(((u=this._data)==null?void 0:u.frames)??{})[0].preset??"fullscreen";(h=this._frameView)==null||h.setCamera(this._camera),(d=this._frameView)==null||d.updateCamera(p!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=zE(this._resize,10),this._onScroll=r=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new Vpe({x:10,y:10})),pte(e)}async load(e,t,i){Qpe(e),this.disposed=!1;let r=await(await fetch(e,i)).arrayBuffer();await this.start(r,{variables:t})}async start(e,{interactive:t=!0,variables:i}={}){var o,l,c,u;if(this.disposed)return;let r=await kpe(e);this._data=r,r.version&&(0,Xpe.default)(r.version,"1.0.26")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([HO(r)&&Zae(),Fne(r)&&qae(),gm.physicsEnabled(r.scene.objects)&&yte(),BO(r)&&Mne(),o4(r)&&Cce(),vpe(r)&&gte()].filter(Boolean)),(o=this._eventManager)==null||o.deactivate(),(l=this._controls)==null||l.deactivate(),(c=this._scene)==null||c.dispose();let a=new Upe(r);if(a.resetPersonalCameraFromDocumentData(),this._scene=a.scene,this._sharedAssetsManager=a.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let h=performance.now();qpe(r,a.scene);let d=performance.now();console.log("Merged geometries in ",d-h," ms")}HO(r)&&this._scene.traverse(h=>{Fo(h)&&h.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{var h;this._requestRenderAutoMode(),(h=this._scene)==null||h.traverse(d=>{d instanceof Js&&d.pendingMediaLoad&&d.update()})}),(u=this._scene)==null||u.traverse(h=>{h.type==="ParticleSystem"&&(h.wakeUp(),h.data.autoPlay?h.start():h.stop())});let s=Object.keys(r.shared.fonts).map(h=>this._sharedAssetsManager.getFont(h).loadingPromise);if(Promise.all(s).then(()=>{a.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),BO(r)&&Mpe(r)&&await Promise.all(s),o4(r)){let h=[];this._scene.traverseEntity(d=>{d instanceof ea&&h.push(d)}),await Promise.all(h.map(d=>d.uiCanvas.promise))}this._scene.rewriteEventsBeforeGoToPlayMode(),zC(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new yce({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),this._scene.initializeSplatViewer(this._renderer),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let n=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(n.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=n.size[0],this._viewportHeight=n.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new jpe(this._renderer,this._camera,new Q(this._viewportWidth,this._viewportHeight),new Q(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(n.allowResponsive??!1)&&n.preset==="fullscreen"),t){let h=new Ede(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,n);this._scene.updateMatrixWorld(!0),this._controls=new Tpe(h),this._animationControls=new Dpe(this._scene,this._requestRenderAutoMode),this._eventManager=new Bpe(r.scene.publish,this._controls,this._animationControls,h,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{var h;(h=this._renderer)==null||h.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(this._data!==void 0){let t=Object.entries(e);for(let[i,r]of t)this.setVariable(i,r)}}setVariable(e,t){var r;let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){let a=t;typeof i.data.value=="number"?a=typeof t=="number"?t:typeof t=="boolean"?t===!0?1:0:parseFloat(t):typeof i.data.value=="boolean"?a=typeof t=="number"?!!t:typeof t=="boolean"?t:t.toLocaleLowerCase()==="false"?!1:!!t:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(a=t.toString());let s=typeof a=="string"?{textValue:a}:a;(r=this._sharedAssetsManager)==null||r.updateVariable(i.id,s),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${e} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${e} cannot be updated from code.`)}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach(t=>{e[t.data.name]===void 0&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))}),e}getVariable(e){let t=this._getVariableByName(e);if(t){let i=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(i)}}_getVariableValue(e){return typeof e!="string"&&$a.isTextValue(e)?$a.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find(i=>i.data.name===e);return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByProperty("uuid",e);return this._createProxyObject(t)}findObjectByName(e){var i;let t=(i=this._scene)==null?void 0:i.getObjectByName(e);return this._createProxyObject(t)}getAllObjects(){var t;let e=[];return(t=this._scene)==null||t.traverseEntity(i=>{if(i.uuid!==np&&!this._scene.isInvisibleObjects(i)&&!(i instanceof kr)){let r=this._createProxyObject(i);r&&e.push(r)}}),e}getSplineEvents(){var e,t;return((t=(e=this._eventManager)==null?void 0:e.handlers)==null?void 0:t.Spline).splineEvents}emitEvent(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEvent(e)}emitEventReverse(e,t){var i;(i=this.findObjectById(t)||this.findObjectByName(t))==null||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;((t=this._controls)==null?void 0:t.orbitControls)instanceof yj&&((i=this._controls)==null||i.orbitControls.zoomOut(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var n;let{r:t,g:i,b:r,a}={r:0,g:0,b:0,a:1},s=new Vr(t,i,r,a);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}(n=this._scene)==null||n.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,r,a,s,n;this.disposed=!0,(e=this._eventManager)==null||e.deactivate(),(t=this._scene)==null||t.dispose(),(i=this._sharedAssetsManager)==null||i.dispose(),this._proxyObjectCache.forEach(o=>{aP.unsubscribe(o)}),this._variablesCache.clear(),(r=this._renderer)==null||r.setAnimationLoop(null),(a=this._renderer)==null||a.dispose(),this._renderer=void 0,(s=this._sharedAssetsManager)==null||s.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),(n=this._controls)==null||n.deactivate(),fte(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||((e=this._renderer)==null||e.setAnimationLoop(null),this._isPaused=!0,(t=this._eventManager)==null||t.pause(),(i=this._controls)!=null&&i.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,(e=this._eventManager)==null||e.resume(),(t=this._controls)!=null&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),(i=this._renderer)==null||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;(t=this._eventManager)==null||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var a;if(e==null)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let t;e.traverseAncestors(s=>{s instanceof kr&&(t=s.name)});let i={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:t,parentUuid:e.parent instanceof kr||e instanceof SC||(a=e.parent)==null?void 0:a.uuid,emitEvent(s){e.dispatchEvent({type:"userEvent",eventName:s})},emitEventReverse(s){e.dispatchEvent({type:"userEvent",eventName:s,reverse:!0})}},r=aP(i,(s,n)=>{var o;typeof e[s]!="object"&&((o=Object.getOwnPropertyDescriptor(e,s))!=null&&o.writable)&&(e[s]=n),this._requestRenderAutoMode(),e.updateMatrix()});return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){XN.skiaWasmUrl=e}},Vv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},GS={},Kpe={get exports(){return GS},set exports(e){GS=e}},Kp={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yI;function $pe(){if(yI)return Kp;yI=1;var e=zc,t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function n(o,l,c){var u,h={},d=null,p=null;c!==void 0&&(d=""+c),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(p=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(h[u]=l[u]);if(o&&o.defaultProps)for(u in l=o.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:t,type:o,key:d,ref:p,props:h,_owner:a.current}}return Kp.Fragment=i,Kp.jsx=n,Kp.jsxs=n,Kp}(function(e){e.exports=$pe()})(Kpe);const HS=GS.jsx;var Jpe="Expected a function",xI=NaN,efe="[object Symbol]",tfe=/^\s+|\s+$/g,ife=/^[-+]0x[0-9a-f]+$/i,rfe=/^0b[01]+$/i,afe=/^0o[0-7]+$/i,sfe=parseInt,nfe=typeof Vv=="object"&&Vv&&Vv.Object===Object&&Vv,ofe=typeof self=="object"&&self&&self.Object===Object&&self,lfe=nfe||ofe||Function("return this")(),cfe=Object.prototype,hfe=cfe.toString,ufe=Math.max,dfe=Math.min,Uw=function(){return lfe.Date.now()};function pfe(e,t,i){var r,a,s,n,o,l,c=0,u=!1,h=!1,d=!0;if(typeof e!="function")throw new TypeError(Jpe);t=bI(t)||0,WS(i)&&(u=!!i.leading,h="maxWait"in i,s=h?ufe(bI(i.maxWait)||0,t):s,d="trailing"in i?!!i.trailing:d);function p(_){var A=r,E=a;return r=a=void 0,c=_,n=e.apply(E,A),n}function f(_){return c=_,o=setTimeout(v,t),u?p(_):n}function m(_){var A=_-l,E=_-c,M=t-A;return h?dfe(M,s-E):M}function g(_){var A=_-l,E=_-c;return l===void 0||A>=t||A<0||h&&E>=s}function v(){var _=Uw();if(g(_))return y(_);o=setTimeout(v,m(_))}function y(_){return o=void 0,d&&r?p(_):(r=a=void 0,n)}function x(){o!==void 0&&clearTimeout(o),c=0,r=l=a=o=void 0}function w(){return o===void 0?n:y(Uw())}function S(){var _=Uw(),A=g(_);if(r=arguments,a=this,l=_,A){if(o===void 0)return f(l);if(h)return o=setTimeout(v,t),p(l)}return o===void 0&&(o=setTimeout(v,t)),n}return S.cancel=x,S.flush=w,S}function WS(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function ffe(e){return!!e&&typeof e=="object"}function mfe(e){return typeof e=="symbol"||ffe(e)&&hfe.call(e)==efe}function bI(e){if(typeof e=="number")return e;if(mfe(e))return xI;if(WS(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=WS(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(tfe,"");var i=rfe.test(e);return i||afe.test(e)?sfe(e.slice(2),i?2:8):ife.test(e)?xI:+e}var gfe=pfe;function vfe(e){return t=>{e.forEach(i=>{typeof i=="function"?i(t):i!=null&&(i.current=t)})}}const yfe=[],xfe={width:"100%",height:"100%"},bfe=xe.forwardRef(function({className:e,children:t,debounceTime:i=300,ignoreDimensions:r=yfe,parentSizeStyles:a,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:n,...o},l){const c=xe.useRef(null),u=xe.useRef(0),[h,d]=xe.useState({width:0,height:0,top:0,left:0}),p=xe.useMemo(()=>{const f=Array.isArray(r)?r:[r];return gfe(m=>{d(g=>Object.keys(g).filter(v=>g[v]!==m[v]).every(v=>f.includes(v))?g:m)},i,{leading:s})},[i,s,r]);return xe.useEffect(()=>{const f=n||window.ResizeObserver,m=new f(g=>{g.forEach(v=>{const{left:y,top:x,width:w,height:S}=(v==null?void 0:v.contentRect)??{};u.current=window.requestAnimationFrame(()=>{p({width:w,height:S,top:x,left:y})})})});return c.current&&m.observe(c.current),()=>{window.cancelAnimationFrame(u.current),m.disconnect(),p.cancel()}},[p,n]),HS("div",{style:{...xfe,...a},ref:vfe([l,c]),className:e,...o,children:t({...h,ref:c.current,resize:p})})}),qS=xe.forwardRef(({scene:e,style:t,onMouseDown:i,onMouseUp:r,onMouseHover:a,onKeyDown:s,onKeyUp:n,onStart:o,onLookAt:l,onFollow:c,onWheel:u,onLoad:h,renderOnDemand:d=!0,...p},f)=>{const m=xe.useRef(null),[g,v]=xe.useState(!0);return xe.useEffect(()=>{v(!0);let y;const x=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:a},{name:"keyDown",cb:s},{name:"keyUp",cb:n},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(m.current){y=new Zpe(m.current,{renderOnDemand:d});async function w(){await y.load(e);for(let S of x)S.cb&&y.addEventListener(S.name,S.cb);v(!1),h==null||h(y)}w()}return()=>{for(let w of x)w.cb&&y.removeEventListener(w.name,w.cb);y.dispose()}},[e]),HS(bfe,{ref:f,parentSizeStyles:t,debounceTime:50,...p,children:()=>HS("canvas",{ref:m,style:{display:g?"none":"block"}})})});var wI;(function(e){e.speed="speed",e.translateX="translateX",e.translateY="translateY",e.rotate="rotate",e.rotateX="rotateX",e.rotateY="rotateY",e.rotateZ="rotateZ",e.scale="scale",e.scaleX="scaleX",e.scaleY="scaleY",e.scaleZ="scaleZ",e.opacity="opacity"})(wI||(wI={}));var qu;(function(e){e.px="px",e["%"]="%",e.vh="vh",e.vw="vw"})(qu||(qu={}));var Bf;(function(e){e.deg="deg",e.turn="turn",e.rad="rad"})(Bf||(Bf={}));var XS;(function(e){e[""]=""})(XS||(XS={}));var _I;(function(e){e.vertical="vertical",e.horizontal="horizontal"})(_I||(_I={}));var SI;(function(e){e.ease="ease",e.easeIn="easeIn",e.easeOut="easeOut",e.easeInOut="easeInOut",e.easeInQuad="easeInQuad",e.easeInCubic="easeInCubic",e.easeInQuart="easeInQuart",e.easeInQuint="easeInQuint",e.easeInSine="easeInSine",e.easeInExpo="easeInExpo",e.easeInCirc="easeInCirc",e.easeOutQuad="easeOutQuad",e.easeOutCubic="easeOutCubic",e.easeOutQuart="easeOutQuart",e.easeOutQuint="easeOutQuint",e.easeOutSine="easeOutSine",e.easeOutExpo="easeOutExpo",e.easeOutCirc="easeOutCirc",e.easeInOutQuad="easeInOutQuad",e.easeInOutCubic="easeInOutCubic",e.easeInOutQuart="easeInOutQuart",e.easeInOutQuint="easeInOutQuint",e.easeInOutSine="easeInOutSine",e.easeInOutExpo="easeInOutExpo",e.easeInOutCirc="easeInOutCirc",e.easeInBack="easeInBack",e.easeOutBack="easeOutBack",e.easeInOutBack="easeInOutBack"})(SI||(SI={}));XS[""],qu.px,qu["%"],qu.vh,qu.vw,Bf.deg,Bf.turn,Bf.rad;const AI=()=>b.jsx("div",{className:"home_div_section1_grid_bg",children:b.jsxs("svg",{width:"102%",height:"102%",xmlns:"http://www.w3.org/2000/svg",children:[b.jsxs("defs",{children:[b.jsx("pattern",{id:"smallGrid",width:"120",height:"120",patternUnits:"userSpaceOnUse",children:b.jsx("path",{d:"M 120 0 L 0 0 0 120",fill:"none",stroke:"currentColor","stroke-width":"1"})}),b.jsx("pattern",{id:"grid",width:"240",height:"240",patternUnits:"userSpaceOnUse",children:b.jsx("rect",{width:"240",height:"240",fill:"url(#smallGrid)"})})]}),b.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]})}),md=()=>b.jsxs("svg",{"data-v-25ecef37":"",width:"330",height:"337",viewBox:"0 0 330 337",fill:"none",xmlns:"http://www.w3.org/2000/svg",cssid:"home_dev_sp","data-v-706ceafa":"",children:[b.jsx("path",{d:"M311.458 127.516C289.848 46.8654 206.95 -0.996002 126.299 20.6142C45.6491 42.2243 -2.21227 125.123 19.3979 205.773C41.0081 286.423 123.906 334.285 204.557 312.674C285.207 291.064 333.068 208.166 311.458 127.516Z",fill:"url(#paint0_radial-771657)"})," ",b.jsx("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M162.421 331.431C162.439 332.464 163.282 333.297 164.32 333.297C165.266 333.297 166.051 332.604 166.194 331.698L220.107 324.843C220.467 325.907 221.473 326.673 222.659 326.673C224.146 326.673 225.351 325.467 225.351 323.98C225.351 323.611 225.277 323.26 225.143 322.94L260.784 298.742C261.069 298.96 261.425 299.09 261.811 299.09C262.745 299.09 263.502 298.333 263.502 297.4C263.502 297.142 263.444 296.897 263.341 296.679L293.173 268.237C293.609 268.542 294.14 268.721 294.713 268.721C296.2 268.721 297.405 267.515 297.405 266.028C297.405 265.188 297.02 264.437 296.417 263.944L322.444 214.559C322.566 214.584 322.693 214.597 322.823 214.597C323.871 214.597 324.721 213.747 324.721 212.699C324.721 211.922 324.254 211.254 323.586 210.96L326.958 184.988C328.356 184.89 329.459 183.725 329.459 182.302C329.459 180.949 328.46 179.828 327.159 179.638L323.593 113.672C324.623 113.293 325.357 112.304 325.357 111.144C325.357 109.657 324.152 108.451 322.665 108.451C322.247 108.451 321.852 108.546 321.499 108.716L265.044 34.1911C265.463 33.7165 265.717 33.0933 265.717 32.4108C265.717 30.9237 264.511 29.7182 263.024 29.7182C261.993 29.7182 261.096 30.2986 260.644 31.1506L196.83 12.3176L195.048 11.1831C195.101 11.0078 195.13 10.8217 195.13 10.6289C195.13 9.58051 194.28 8.73062 193.232 8.73062C192.337 8.73062 191.587 9.34952 191.386 10.1826L189.767 10.233L168.6 3.98621C168.606 3.90903 168.61 3.83096 168.61 3.75208C168.61 2.26508 167.404 1.05957 165.917 1.05957C164.466 1.05957 163.283 2.20749 163.227 3.64474L107.947 12.554C107.641 11.9155 106.989 11.4745 106.234 11.4745C105.186 11.4745 104.336 12.3244 104.336 13.3727C104.336 13.5704 104.366 13.761 104.422 13.9402L70.0904 36.9113C69.6038 36.4287 68.934 36.1307 68.1946 36.1307C66.7076 36.1307 65.5021 37.3362 65.5021 38.8232C65.5021 39.3016 65.6269 39.7509 65.8457 40.1403L35.4022 66.3569C35.1055 66.1648 34.7517 66.0532 34.3718 66.0532C33.3234 66.0532 32.4735 66.9031 32.4735 67.9515C32.4735 68.494 32.7011 68.9834 33.0661 69.3294L7.07018 120.191C6.83901 120.126 6.59528 120.091 6.34348 120.091C4.85645 120.091 3.65098 121.297 3.65098 122.784C3.65098 123.981 4.43211 124.995 5.51245 125.346L2.13409 154.724C1.23993 154.878 0.55957 155.657 0.55957 156.595C0.55957 157.496 1.18663 158.25 2.02792 158.445L5.69534 222.369C4.53938 222.671 3.68646 223.723 3.68646 224.974C3.68646 226.461 4.89194 227.666 6.37897 227.666C6.79992 227.666 7.1983 227.569 7.55317 227.397L64.9861 302.885C64.5693 303.36 64.3165 303.981 64.3165 304.662C64.3165 306.149 65.5219 307.355 67.009 307.355C68.059 307.355 68.9687 306.754 69.4126 305.877L133.342 323.454C133.338 323.515 133.336 323.577 133.336 323.639C133.336 325.126 134.541 326.331 136.028 326.331C137.079 326.331 137.989 325.729 138.433 324.852L162.421 331.431ZM164.668 329.532C164.555 329.511 164.439 329.5 164.32 329.5C163.866 329.5 163.449 329.66 163.123 329.925L154.872 324.247L167.332 324.296L164.668 329.532ZM165.621 330.017L168.528 324.301L182.886 324.357L165.863 330.293C165.791 330.193 165.71 330.101 165.621 330.017ZM138.624 322.923C138.642 322.986 138.657 323.05 138.67 323.115L151.415 323.165L145.787 319.292L138.624 322.923ZM135.992 320.947C136.004 320.946 136.016 320.946 136.028 320.946C136.885 320.946 137.648 321.346 138.141 321.97L144.785 318.602L140.773 315.841C141.586 315.976 142.401 316.104 143.217 316.226L145.87 318.052L213.631 283.704C213.541 283.412 213.493 283.102 213.493 282.78C213.493 282.663 213.5 282.547 213.512 282.432L123.981 256.504C123.643 257.199 123.055 257.751 122.335 258.042L135.992 320.947ZM134.067 321.794C134.314 321.531 134.613 321.319 134.948 321.172L121.29 258.268C121.245 258.27 121.201 258.271 121.156 258.271C119.952 258.271 118.906 257.594 118.379 256.6L61.2192 275.313C61.231 275.416 61.2372 275.52 61.2372 275.626C61.2372 275.955 61.1781 276.27 61.0701 276.562L134.067 321.794ZM60.5067 277.47L132.599 322.141L69.6953 304.846C69.6994 304.786 69.7015 304.724 69.7015 304.662C69.7015 304.506 69.6882 304.353 69.6627 304.204L88.5959 296.849C88.2067 296.619 87.8185 296.388 87.4314 296.155L69.2754 303.208C68.7965 302.463 67.9604 301.97 67.009 301.97C66.9332 301.97 66.858 301.973 66.7838 301.979L59.797 278.01C60.063 277.87 60.3026 277.687 60.5067 277.47ZM58.7709 278.309L64.4705 297.862L51.3963 269.429L56.2792 274.17C56.009 274.59 55.8522 275.09 55.8522 275.626C55.8522 277.113 57.0576 278.318 58.5447 278.318C58.6209 278.318 58.6963 278.315 58.7709 278.309ZM57.0239 273.404L50.1588 266.738L47.8743 261.769C46.9108 260.58 45.9642 259.374 45.0351 258.153L48.0336 264.674L8.64546 226.428C8.67736 226.378 8.70769 226.327 8.73635 226.275L29.4084 232.699C29.1968 232.263 28.9872 231.824 28.7796 231.385L9.05684 225.256C9.06652 225.163 9.07147 225.069 9.07147 224.974C9.07147 224.463 8.92911 223.985 8.68188 223.578L37.377 197.598C37.9106 198.016 38.583 198.265 39.3136 198.265C39.3805 198.265 39.4469 198.263 39.5127 198.259L57.4122 273.182C57.2763 273.246 57.1465 273.32 57.0239 273.404ZM58.4519 272.935L40.5524 198.012C40.904 197.861 41.2225 197.647 41.494 197.385L118.343 253.73C118.133 254.151 118.014 254.627 118.014 255.13C118.014 255.284 118.025 255.436 118.047 255.584L60.8869 274.297C60.4239 273.483 59.5484 272.933 58.5447 272.933C58.5136 272.933 58.4827 272.934 58.4519 272.935ZM118.976 252.868L42.1265 196.524C42.3366 196.102 42.4549 195.627 42.4549 195.124C42.4549 194.819 42.4114 194.524 42.3303 194.245L117.773 157.415C118.327 158.218 119.201 158.785 120.21 158.931L120.608 252.036C119.98 252.147 119.416 252.444 118.976 252.868ZM121.676 252.032L121.279 158.927C122.078 158.804 122.79 158.418 123.324 157.86L192.1 206.337C191.857 206.821 191.72 207.367 191.72 207.946C191.72 208.464 191.829 208.956 192.027 209.4L123.48 253.017C123.016 252.507 122.386 252.15 121.676 252.032ZM124.054 253.918L192.601 210.302C193.259 211.058 194.229 211.536 195.31 211.536C195.465 211.536 195.618 211.526 195.768 211.507L215.272 279.949C214.636 280.256 214.119 280.771 213.809 281.406L124.278 255.477C124.29 255.363 124.297 255.247 124.297 255.13C124.297 254.7 124.211 254.291 124.054 253.918ZM216.3 279.657L196.796 211.215C197.999 210.667 198.846 209.475 198.897 208.08L273.445 199.707C273.593 200.217 273.867 200.674 274.231 201.042L217.996 279.949C217.584 279.75 217.122 279.639 216.634 279.639C216.522 279.639 216.41 279.645 216.3 279.657ZM218.866 280.57L275.101 201.663C275.513 201.861 275.975 201.973 276.463 201.973C276.559 201.973 276.654 201.968 276.748 201.96L291.167 255.798L282.252 268.156L219.55 281.608C219.392 281.217 219.158 280.865 218.866 280.57ZM219.773 282.653L281.319 269.449L269.859 285.333L263.183 290.702L264.393 280.979C263.993 281.325 263.592 281.67 263.188 282.013L261.986 291.665L257.121 295.578L248.249 293.172C247.848 293.434 247.446 293.694 247.043 293.953L256.091 296.406L250.768 300.687L221.297 310.964L217.612 285.767C218.868 285.356 219.776 284.174 219.776 282.78C219.776 282.738 219.775 282.696 219.773 282.653ZM216.554 285.921L220.269 311.322L185.917 323.3L169.071 323.234L171.875 317.722C171.467 317.74 171.059 317.756 170.651 317.771L167.874 323.23L153.311 323.172L146.873 318.742L214.115 284.657C214.673 285.405 215.555 285.896 216.554 285.921ZM279.571 198.372C279.593 198.522 279.604 198.675 279.604 198.831C279.604 200.096 278.857 201.185 277.78 201.684L291.974 254.68L305.502 235.929L312.95 216.628L307.458 218.482C307.615 218.055 307.769 217.627 307.922 217.198L313.45 215.331L318.001 203.538L313.963 194.993C314.077 194.395 314.188 193.796 314.296 193.196L318.532 202.161L322.307 192.38L322.315 184.328L279.571 198.372ZM277.566 195.889C278.285 196.159 278.88 196.685 279.237 197.357L322.316 183.203L322.326 172.715L295.353 105.822C295.132 105.888 294.901 105.929 294.662 105.945L277.566 195.889ZM275.054 196.023C275.478 195.81 275.956 195.69 276.463 195.69C276.481 195.69 276.498 195.69 276.516 195.69L293.596 105.831C292.689 105.572 291.95 104.916 291.579 104.063L221.404 119.856C221.407 119.908 221.408 119.962 221.408 120.015C221.408 120.859 221.075 121.624 220.534 122.189L275.054 196.023ZM273.327 198.645C273.372 197.875 273.694 197.18 274.195 196.658L219.675 122.824C219.251 123.036 218.773 123.156 218.267 123.156C218.177 123.156 218.088 123.152 218 123.145L196.723 204.645C197.726 205.075 198.493 205.948 198.779 207.018L273.327 198.645ZM192.716 205.464C193.369 204.781 194.29 204.356 195.31 204.356C195.438 204.356 195.564 204.363 195.689 204.376L216.966 122.875C216.365 122.601 215.866 122.144 215.54 121.575L124.275 154.81C124.304 154.995 124.32 155.185 124.32 155.378C124.32 155.957 124.183 156.503 123.94 156.987L192.716 205.464ZM122.285 152.142C123.007 152.49 123.596 153.072 123.95 153.791L215.175 120.571C215.142 120.391 215.125 120.205 215.125 120.015C215.125 119.494 215.252 119.004 215.476 118.571L140.679 61.8758C140.118 62.4003 139.364 62.7214 138.535 62.7214C138.526 62.7214 138.516 62.7213 138.507 62.7213L122.285 152.142ZM118.328 152.71C118.965 152.137 119.806 151.788 120.73 151.788C120.908 151.788 121.084 151.801 121.256 151.827L137.456 62.5309C136.925 62.3366 136.461 62.0031 136.108 61.5746L62.1426 103.665C62.2631 103.999 62.3288 104.358 62.3288 104.733C62.3288 105.299 62.1793 105.83 61.9177 106.288L118.328 152.71ZM117.304 156.455C117.197 156.115 117.14 155.753 117.14 155.378C117.14 154.704 117.326 154.073 117.649 153.534L61.2382 107.113C60.6879 107.588 59.9712 107.875 59.1875 107.875C59.1393 107.875 59.0913 107.873 59.0436 107.871L40.4998 192.215C41.0479 192.438 41.5186 192.812 41.8607 193.285L117.304 156.455ZM38.5155 192.085C38.7703 192.018 39.0378 191.983 39.3136 191.983C39.3613 191.983 39.4087 191.984 39.4558 191.986L57.9997 107.642C57.3293 107.368 56.7748 106.869 56.43 106.239L16.2071 119.979L11.5497 132.916L38.5155 192.085ZM36.6596 196.805C36.351 196.319 36.1723 195.743 36.1723 195.124C36.1723 194.046 36.7156 193.095 37.5432 192.529L11.0314 134.355L6.88724 145.866L6.89013 154.305L14.9996 151.166C14.9586 151.563 14.9193 151.96 14.8815 152.358L6.89052 155.451L6.89411 165.915L15.5975 186.938C15.7984 188.407 16.0215 189.878 16.2669 191.348L6.89507 168.711L6.91345 222.334C7.29728 222.411 7.65155 222.57 7.95739 222.792L36.6596 196.805ZM56.0849 105.227L16.6707 118.692L23.0253 101.041L37.1844 81.8201L38.0191 85.2626C38.2835 84.8484 38.55 84.4355 38.8184 84.0238L38.0118 80.697L49.0515 65.7105L53.6363 64.8413C54.0376 64.3998 54.4416 63.9606 54.8482 63.5237L49.9829 64.4461L62.8296 47.0069L66.9662 43.8651L59.0762 101.594C57.3929 101.653 56.0463 103.036 56.0463 104.733C56.0463 104.901 56.0595 105.066 56.0849 105.227ZM60.1353 101.738L68.1699 42.9509L71.5632 40.3737L135.415 59.2158C135.401 59.3354 135.394 59.4569 135.394 59.5801C135.394 59.9543 135.459 60.3131 135.579 60.6458L61.613 102.737C61.2317 102.274 60.7205 101.922 60.1353 101.738ZM135.717 58.1907L72.6198 39.5712L77.0353 36.2177L107.184 25.3982L107.386 27.0311C107.727 26.8898 108.069 26.7498 108.411 26.6109L108.215 25.0281L142.343 12.7805L161.183 12.1933L139.418 56.5645C139.138 56.4828 138.842 56.4388 138.535 56.4388C137.299 56.4388 136.23 57.1527 135.717 58.1907ZM140.377 57.0353L162.392 12.1555L176.296 11.7222L182.132 15.8371L181.319 16.2609C181.879 16.3203 182.44 16.3828 182.999 16.4485L221.745 43.7658C221.553 44.1701 221.444 44.6221 221.442 45.0991L141.5 58.5388C141.286 57.9301 140.89 57.4071 140.377 57.0353ZM141.676 59.5928L221.618 46.1532C221.961 47.1325 222.776 47.8901 223.79 48.1538L217.992 116.886C217.272 116.948 216.621 117.254 216.122 117.72L141.325 61.0244C141.548 60.5955 141.674 60.1088 141.676 59.5928ZM219.057 116.974L224.855 48.2432C225.532 48.1851 226.148 47.9121 226.634 47.4926L291.814 101.116C291.501 101.604 291.319 102.186 291.319 102.81C291.319 102.882 291.321 102.953 291.326 103.024L221.17 118.813C220.796 117.912 220.016 117.223 219.057 116.974ZM292.537 100.326L227.314 46.6675C227.575 46.2093 227.724 45.6788 227.724 45.1136C227.724 44.9557 227.713 44.8005 227.69 44.6489L260.686 33.7462C261.15 34.5569 262.023 35.1032 263.024 35.1032C263.073 35.1032 263.122 35.102 263.17 35.0994L268.63 56.1418C269.121 56.599 269.608 57.0596 270.093 57.5236L265.125 38.3777L292.901 100.082C292.774 100.155 292.652 100.237 292.537 100.326ZM293.908 99.7168L265.451 36.4977L317.208 104.822L282.599 71.0532C284.228 73.0471 285.808 75.0869 287.339 77.1712L320.507 109.534C320.426 109.642 320.353 109.757 320.289 109.877L297.587 103.108C297.597 103.01 297.601 102.91 297.601 102.81C297.601 101.075 296.195 99.6685 294.46 99.6685C294.272 99.6685 294.087 99.6851 293.908 99.7168ZM297.307 104.14L319.983 110.901C319.976 110.981 319.972 111.062 319.972 111.144C319.972 111.688 320.134 112.195 320.412 112.618L309.817 121.835C309.933 122.207 310.047 122.58 310.159 122.954L321.165 113.38C321.52 113.619 321.936 113.775 322.384 113.822L322.329 169.865L296.313 105.346C296.738 105.036 297.082 104.621 297.307 104.14ZM260.351 32.7313L227.355 43.6342C226.826 42.6451 225.783 41.9723 224.583 41.9723C223.715 41.9723 222.93 42.3241 222.361 42.8928L184.182 15.9746L191.873 11.9691L191.893 11.975C192.205 12.2848 192.623 12.4872 193.089 12.5219L194.327 18.2175C194.709 18.292 195.09 18.368 195.47 18.4456L194.212 12.6594L196.383 13.3L210.6 22.3507C211.984 22.7855 213.362 23.24 214.732 23.7139L200.093 14.3949L260.342 32.1758C260.335 32.2532 260.332 32.3316 260.332 32.4108C260.332 32.5192 260.338 32.6262 260.351 32.7313ZM4.34944 156.434C4.35389 156.487 4.35616 156.541 4.35616 156.595C4.35616 157.193 4.07992 157.726 3.64815 158.074L5.82449 163.331L5.82193 155.864L4.34944 156.434ZM3.57664 155.061C3.72253 155.168 3.85264 155.295 3.9628 155.438L5.82153 154.719L5.81951 148.832L3.57664 155.061ZM6.95329 125.407C6.92906 125.413 6.9047 125.418 6.88023 125.423L6.88616 142.714L10.3968 132.963L6.95329 125.407ZM9.0138 122.437C9.02844 122.55 9.03599 122.666 9.03599 122.784C9.03599 123.68 8.59844 124.473 7.92538 124.963L10.9151 131.523L14.9119 120.422L9.0138 122.437ZM8.3396 120.977C8.46396 121.114 8.57435 121.264 8.66854 121.425L15.3755 119.134L20.8036 104.057L8.3396 120.977ZM34.2813 69.8477C34.2729 69.8473 34.2646 69.8468 34.2562 69.8463L24.2942 97.5165L36.8557 80.4644L34.2813 69.8477ZM36.2613 68.1353C36.2012 68.7606 35.8379 69.2971 35.3201 69.5963L37.683 79.3412L47.5086 66.003L36.2613 68.1353ZM67.3078 41.3662C67.2229 41.3366 67.1399 41.3029 67.0591 41.2652L65.0738 43.9604L67.1709 42.3676L67.3078 41.3662ZM70.8592 38.4341C70.8776 38.5612 70.8871 38.6911 70.8871 38.8232C70.8871 38.9019 70.8837 38.9799 70.8771 39.057L71.3472 39.1957L73.6854 37.4199L70.8592 38.4341ZM105.927 15.2463C105.622 15.1967 105.342 15.0749 105.105 14.899L79.8695 34.0652L107.049 24.311L105.927 15.2463ZM108.072 13.8488C107.925 14.4192 107.519 14.8856 106.987 15.1158L108.08 23.941L138.878 12.8885L108.072 13.8488ZM164.276 5.88699C164.013 5.68387 163.787 5.43292 163.614 5.14706L145.606 11.6095L161.716 11.1074L164.276 5.88699ZM167.767 5.70889C167.284 6.16495 166.634 6.44458 165.917 6.44458C165.682 6.44458 165.454 6.41437 165.236 6.35764L162.925 11.0697L174.843 10.6982L167.767 5.70889ZM324.092 182.619C324.08 182.515 324.074 182.409 324.074 182.302C324.074 181.363 324.556 180.535 325.285 180.054L323.392 175.359L323.385 182.851L324.092 182.619ZM325.319 184.573C324.951 184.338 324.643 184.015 324.426 183.634L323.384 183.977L323.378 189.603L325.319 184.573ZM320.927 212.807C320.925 212.771 320.924 212.735 320.924 212.699C320.924 212.101 321.2 211.568 321.632 211.22L318.632 204.872L314.767 214.887L320.927 212.807ZM321.375 213.927C321.344 213.891 321.314 213.853 321.286 213.814L314.267 216.184L307.964 232.516L321.375 213.927ZM294.3 263.367C294.435 263.346 294.573 263.336 294.713 263.336C294.784 263.336 294.854 263.338 294.923 263.344L303.986 239.856L292.331 256.012L294.3 263.367ZM292.021 266.06C292.02 266.049 292.02 266.039 292.02 266.028C292.02 265.062 292.529 264.215 293.294 263.74L291.524 257.131L283.811 267.821L292.021 266.06ZM292.322 267.267C292.294 267.214 292.268 267.16 292.244 267.105L282.878 269.114L272.999 282.808L292.322 267.267ZM260.401 296.467C260.645 296.099 261.03 295.832 261.478 295.742L261.796 293.189L258.396 295.924L260.401 296.467ZM222.807 321.292C223.404 321.324 223.949 321.551 224.38 321.91L248.283 302.686L221.454 312.041L222.807 321.292ZM220.021 323.435C220.212 322.51 220.876 321.758 221.749 321.445L220.426 312.399L189.127 323.313L220.021 323.435ZM233.284 316.121L258.13 299.252L251.294 301.636L233.284 316.121ZM169.305 330.225L186.096 324.37L214.474 324.482L169.305 330.225ZM161.413 330.046L152.977 324.24L140.057 324.189L161.413 330.046ZM322.304 195.356L319.163 203.495L322.289 210.11L322.304 195.356ZM323.395 172.509L323.437 130.571L326.061 179.12L323.395 172.509ZM323.363 204.372L323.375 192.579L325.665 186.644L323.363 204.372ZM306.449 236.443L318.523 219.707L297.554 259.495L306.449 236.443ZM285.166 274.394L270.642 286.075L265.635 293.014L285.166 274.394ZM262.598 295.397L267.502 288.6L262.993 292.227L262.598 295.397ZM260.004 297.467L257.367 296.752L253.778 299.638L260.004 297.467ZM183.199 15.2816L190.396 11.5332L189.628 11.3066L178.072 11.6668L183.199 15.2816ZM176.62 10.6428L186.352 10.3395L168.873 5.18115L176.62 10.6428ZM48.44 64.7386L59.8163 49.2954L36.5028 67.0018L48.44 64.7386ZM5.83919 206.217L5.82544 166.127L3.17139 159.716L5.83919 206.217ZM5.81843 145.68L3.51388 152.081L5.81377 132.08L5.81843 145.68ZM31.0191 75.6826L22.0725 100.533L9.80921 117.18L31.0191 75.6826ZM62.0605 46.2489L47.9109 56.9954L64.9587 42.3145L62.0605 46.2489ZM91.6957 23.7411L76.5196 35.2673L72.0974 36.8543L91.6957 23.7411ZM142.141 11.7176L114.51 12.5789L160.31 5.19745L142.141 11.7176ZM11.1195 230.32L64.4964 300.477L49.2711 267.365L11.1195 230.32Z",fill:"url(#paint1_radial-513745)"})," ",b.jsxs("defs",{children:[b.jsxs("radialGradient",{id:"paint0_radial-771657",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(131.5 27) rotate(76.5554) scale(305.369)",children:[b.jsx("stop",{offset:"0.260417","stop-color":"#171717"})," ",b.jsx("stop",{offset:"0.727754","stop-color":"#0F0F0F"})," ",b.jsx("stop",{offset:"1","stop-color":"#04875E"})]})," ",b.jsxs("radialGradient",{id:"paint1_radial-513745",cx:"0",cy:"0",r:"1",gradientUnits:"userSpaceOnUse",gradientTransform:"translate(223 326.5) rotate(-108.504) scale(182.753 305.986)",children:[b.jsx("stop",{"stop-color":"#03D19F"})," ",b.jsx("stop",{offset:"0.520536","stop-color":"#696969"})," ",b.jsx("stop",{offset:"1","stop-color":"#171717"})]})]})]});var BC={},xj={exports:{}};(function(e){function t(i){return i&&i.__esModule?i:{default:i}}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports})(xj);var ao=xj.exports,Vw={};function zt(){return zt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},zt.apply(this,arguments)}function Il(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function bj(e){if(!Il(e))return e;const t={};return Object.keys(e).forEach(i=>{t[i]=bj(e[i])}),t}function sn(e,t,i={clone:!0}){const r=i.clone?zt({},e):e;return Il(e)&&Il(t)&&Object.keys(t).forEach(a=>{a!=="__proto__"&&(Il(t[a])&&a in e&&Il(e[a])?r[a]=sn(e[a],t[a],i):i.clone?r[a]=Il(t[a])?bj(t[a]):t[a]:r[a]=t[a])}),r}function Ud(e){let t="https://mui.com/production-error/?code="+e;for(let i=1;i<arguments.length;i+=1)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}function Qn(e){if(typeof e!="string")throw new Error(Ud(7));return e.charAt(0).toUpperCase()+e.slice(1)}function wfe(...e){return e.reduce((t,i)=>i==null?t:function(...a){t.apply(this,a),i.apply(this,a)},()=>{})}function _fe(e,t=166){let i;function r(...a){const s=()=>{e.apply(this,a)};clearTimeout(i),i=setTimeout(s,t)}return r.clear=()=>{clearTimeout(i)},r}function Sfe(e,t){return()=>null}function Afe(e,t){var i,r;return xe.isValidElement(e)&&t.indexOf((i=e.type.muiName)!=null?i:(r=e.type)==null||(r=r._payload)==null||(r=r.value)==null?void 0:r.muiName)!==-1}function wj(e){return e&&e.ownerDocument||document}function Efe(e){return wj(e).defaultView||window}function Cfe(e,t){return()=>null}function _j(e,t){typeof e=="function"?e(t):e&&(e.current=t)}const Mfe=typeof window<"u"?xe.useLayoutEffect:xe.useEffect,Sj=Mfe;let EI=0;function Tfe(e){const[t,i]=xe.useState(e),r=e||t;return xe.useEffect(()=>{t==null&&(EI+=1,i(`mui-${EI}`))},[t]),r}const CI=w0.useId;function Pfe(e){if(CI!==void 0){const t=CI();return e??t}return Tfe(e)}function Dfe(e,t,i,r,a){return null}function Ofe({controlled:e,default:t,name:i,state:r="value"}){const{current:a}=xe.useRef(e!==void 0),[s,n]=xe.useState(t),o=a?e:s,l=xe.useCallback(c=>{a||n(c)},[]);return[o,l]}function Ife(e){const t=xe.useRef(e);return Sj(()=>{t.current=e}),xe.useRef((...i)=>(0,t.current)(...i)).current}function Rfe(...e){return xe.useMemo(()=>e.every(t=>t==null)?null:t=>{e.forEach(i=>{_j(i,t)})},e)}let q1=!0,YS=!1,MI;const Lfe={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function kfe(e){const{type:t,tagName:i}=e;return!!(i==="INPUT"&&Lfe[t]&&!e.readOnly||i==="TEXTAREA"&&!e.readOnly||e.isContentEditable)}function zfe(e){e.metaKey||e.altKey||e.ctrlKey||(q1=!0)}function Gw(){q1=!1}function Nfe(){this.visibilityState==="hidden"&&YS&&(q1=!0)}function Bfe(e){e.addEventListener("keydown",zfe,!0),e.addEventListener("mousedown",Gw,!0),e.addEventListener("pointerdown",Gw,!0),e.addEventListener("touchstart",Gw,!0),e.addEventListener("visibilitychange",Nfe,!0)}function jfe(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch{}return q1||kfe(t)}function Ffe(){const e=xe.useCallback(a=>{a!=null&&Bfe(a.ownerDocument)},[]),t=xe.useRef(!1);function i(){return t.current?(YS=!0,window.clearTimeout(MI),MI=window.setTimeout(()=>{YS=!1},100),t.current=!1,!0):!1}function r(a){return jfe(a)?(t.current=!0,!0):!1}return{isFocusVisibleRef:t,onFocus:r,onBlur:i,ref:e}}function Aj(e,t){const i=zt({},t);return Object.keys(e).forEach(r=>{if(r.toString().match(/^(components|slots)$/))i[r]=zt({},e[r],i[r]);else if(r.toString().match(/^(componentsProps|slotProps)$/)){const a=e[r]||{},s=t[r];i[r]={},!s||!Object.keys(s)?i[r]=a:!a||!Object.keys(a)?i[r]=s:(i[r]=zt({},s),Object.keys(a).forEach(n=>{i[r][n]=Aj(a[n],s[n])}))}else i[r]===void 0&&(i[r]=e[r])}),i}function Ufe(e,t,i=void 0){const r={};return Object.keys(e).forEach(a=>{r[a]=e[a].reduce((s,n)=>{if(n){const o=t(n);o!==""&&s.push(o),i&&i[n]&&s.push(i[n])}return s},[]).join(" ")}),r}const TI=e=>e,Vfe=()=>{let e=TI;return{configure(t){e=t},generate(t){return e(t)},reset(){e=TI}}},Ej=Vfe(),Gfe={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Cj(e,t,i="Mui"){const r=Gfe[t];return r?`${i}-${r}`:`${Ej.generate(e)}-${t}`}function Hfe(e,t,i="Mui"){const r={};return t.forEach(a=>{r[a]=Cj(e,a,i)}),r}function Wfe(e,t=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER){return Math.max(t,Math.min(e,i))}function al(e,t){if(e==null)return{};var i={},r=Object.keys(e),a,s;for(s=0;s<r.length;s++)a=r[s],!(t.indexOf(a)>=0)&&(i[a]=e[a]);return i}function Mj(e){var t,i,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(i=Mj(e[t]))&&(r&&(r+=" "),r+=i)}else for(i in e)e[i]&&(r&&(r+=" "),r+=i);return r}function qfe(){for(var e,t,i=0,r="",a=arguments.length;i<a;i++)(e=arguments[i])&&(t=Mj(e))&&(r&&(r+=" "),r+=t);return r}function Tj(e){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=e(i)),t[i]}}var Xfe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Yfe=Tj(function(e){return Xfe.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91});function Qfe(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function Zfe(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Kfe=function(){function e(i){var r=this;this._insertTag=function(a){var s;r.tags.length===0?r.insertionPoint?s=r.insertionPoint.nextSibling:r.prepend?s=r.container.firstChild:s=r.before:s=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(a,s),r.tags.push(a)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(r){r.forEach(this._insertTag)},t.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Zfe(this));var a=this.tags[this.tags.length-1];if(this.isSpeedy){var s=Qfe(a);try{s.insertRule(r,s.cssRules.length)}catch{}}else a.appendChild(document.createTextNode(r));this.ctr++},t.flush=function(){this.tags.forEach(function(r){return r.parentNode&&r.parentNode.removeChild(r)}),this.tags=[],this.ctr=0},e}(),Qr="-ms-",Qy="-moz-",Ut="-webkit-",Pj="comm",jC="rule",FC="decl",$fe="@import",Dj="@keyframes",Jfe="@layer",eme=Math.abs,X1=String.fromCharCode,tme=Object.assign;function ime(e,t){return zr(e,0)^45?(((t<<2^zr(e,0))<<2^zr(e,1))<<2^zr(e,2))<<2^zr(e,3):0}function Oj(e){return e.trim()}function rme(e,t){return(e=t.exec(e))?e[0]:e}function Vt(e,t,i){return e.replace(t,i)}function QS(e,t){return e.indexOf(t)}function zr(e,t){return e.charCodeAt(t)|0}function Cm(e,t,i){return e.slice(t,i)}function kn(e){return e.length}function UC(e){return e.length}function Gv(e,t){return t.push(e),e}function ame(e,t){return e.map(t).join("")}var Y1=1,Vd=1,Ij=0,Ua=0,Ki=0,up="";function Q1(e,t,i,r,a,s,n){return{value:e,root:t,parent:i,type:r,props:a,children:s,line:Y1,column:Vd,length:n,return:""}}function $p(e,t){return tme(Q1("",null,null,"",null,null,0),e,{length:-e.length},t)}function sme(){return Ki}function nme(){return Ki=Ua>0?zr(up,--Ua):0,Vd--,Ki===10&&(Vd=1,Y1--),Ki}function is(){return Ki=Ua<Ij?zr(up,Ua++):0,Vd++,Ki===10&&(Vd=1,Y1++),Ki}function Zn(){return zr(up,Ua)}function g0(){return Ua}function Km(e,t){return Cm(up,e,t)}function Mm(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Rj(e){return Y1=Vd=1,Ij=kn(up=e),Ua=0,[]}function Lj(e){return up="",e}function v0(e){return Oj(Km(Ua-1,ZS(e===91?e+2:e===40?e+1:e)))}function ome(e){for(;(Ki=Zn())&&Ki<33;)is();return Mm(e)>2||Mm(Ki)>3?"":" "}function lme(e,t){for(;--t&&is()&&!(Ki<48||Ki>102||Ki>57&&Ki<65||Ki>70&&Ki<97););return Km(e,g0()+(t<6&&Zn()==32&&is()==32))}function ZS(e){for(;is();)switch(Ki){case e:return Ua;case 34:case 39:e!==34&&e!==39&&ZS(Ki);break;case 40:e===41&&ZS(e);break;case 92:is();break}return Ua}function cme(e,t){for(;is()&&e+Ki!==57;)if(e+Ki===84&&Zn()===47)break;return"/*"+Km(t,Ua-1)+"*"+X1(e===47?e:is())}function hme(e){for(;!Mm(Zn());)is();return Km(e,Ua)}function ume(e){return Lj(y0("",null,null,null,[""],e=Rj(e),0,[0],e))}function y0(e,t,i,r,a,s,n,o,l){for(var c=0,u=0,h=n,d=0,p=0,f=0,m=1,g=1,v=1,y=0,x="",w=a,S=s,_=r,A=x;g;)switch(f=y,y=is()){case 40:if(f!=108&&zr(A,h-1)==58){QS(A+=Vt(v0(y),"&","&\f"),"&\f")!=-1&&(v=-1);break}case 34:case 39:case 91:A+=v0(y);break;case 9:case 10:case 13:case 32:A+=ome(f);break;case 92:A+=lme(g0()-1,7);continue;case 47:switch(Zn()){case 42:case 47:Gv(dme(cme(is(),g0()),t,i),l);break;default:A+="/"}break;case 123*m:o[c++]=kn(A)*v;case 125*m:case 59:case 0:switch(y){case 0:case 125:g=0;case 59+u:v==-1&&(A=Vt(A,/\f/g,"")),p>0&&kn(A)-h&&Gv(p>32?DI(A+";",r,i,h-1):DI(Vt(A," ","")+";",r,i,h-2),l);break;case 59:A+=";";default:if(Gv(_=PI(A,t,i,c,u,a,o,x,w=[],S=[],h),s),y===123)if(u===0)y0(A,t,_,_,w,s,h,o,S);else switch(d===99&&zr(A,3)===110?100:d){case 100:case 108:case 109:case 115:y0(e,_,_,r&&Gv(PI(e,_,_,0,0,a,o,x,a,w=[],h),S),a,S,h,o,r?w:S);break;default:y0(A,_,_,_,[""],S,0,o,S)}}c=u=p=0,m=v=1,x=A="",h=n;break;case 58:h=1+kn(A),p=f;default:if(m<1){if(y==123)--m;else if(y==125&&m++==0&&nme()==125)continue}switch(A+=X1(y),y*m){case 38:v=u>0?1:(A+="\f",-1);break;case 44:o[c++]=(kn(A)-1)*v,v=1;break;case 64:Zn()===45&&(A+=v0(is())),d=Zn(),u=h=kn(x=A+=hme(g0())),y++;break;case 45:f===45&&kn(A)==2&&(m=0)}}return s}function PI(e,t,i,r,a,s,n,o,l,c,u){for(var h=a-1,d=a===0?s:[""],p=UC(d),f=0,m=0,g=0;f<r;++f)for(var v=0,y=Cm(e,h+1,h=eme(m=n[f])),x=e;v<p;++v)(x=Oj(m>0?d[v]+" "+y:Vt(y,/&\f/g,d[v])))&&(l[g++]=x);return Q1(e,t,i,a===0?jC:o,l,c,u)}function dme(e,t,i){return Q1(e,t,i,Pj,X1(sme()),Cm(e,2,-2),0)}function DI(e,t,i,r){return Q1(e,t,i,FC,Cm(e,0,r),Cm(e,r+1,-1),r)}function gd(e,t){for(var i="",r=UC(e),a=0;a<r;a++)i+=t(e[a],a,e,t)||"";return i}function pme(e,t,i,r){switch(e.type){case Jfe:if(e.children.length)break;case $fe:case FC:return e.return=e.return||e.value;case Pj:return"";case Dj:return e.return=e.value+"{"+gd(e.children,r)+"}";case jC:e.value=e.props.join(",")}return kn(i=gd(e.children,r))?e.return=e.value+"{"+i+"}":""}function fme(e){var t=UC(e);return function(i,r,a,s){for(var n="",o=0;o<t;o++)n+=e[o](i,r,a,s)||"";return n}}function mme(e){return function(t){t.root||(t=t.return)&&e(t)}}var gme=function(t,i,r){for(var a=0,s=0;a=s,s=Zn(),a===38&&s===12&&(i[r]=1),!Mm(s);)is();return Km(t,Ua)},vme=function(t,i){var r=-1,a=44;do switch(Mm(a)){case 0:a===38&&Zn()===12&&(i[r]=1),t[r]+=gme(Ua-1,i,r);break;case 2:t[r]+=v0(a);break;case 4:if(a===44){t[++r]=Zn()===58?"&\f":"",i[r]=t[r].length;break}default:t[r]+=X1(a)}while(a=is());return t},yme=function(t,i){return Lj(vme(Rj(t),i))},OI=new WeakMap,xme=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var i=t.value,r=t.parent,a=t.column===r.column&&t.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(t.props.length===1&&i.charCodeAt(0)!==58&&!OI.get(r))&&!a){OI.set(t,!0);for(var s=[],n=yme(i,s),o=r.props,l=0,c=0;l<n.length;l++)for(var u=0;u<o.length;u++,c++)t.props[c]=s[l]?n[l].replace(/&\f/g,o[u]):o[u]+" "+n[l]}}},bme=function(t){if(t.type==="decl"){var i=t.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(t.return="",t.value="")}};function kj(e,t){switch(ime(e,t)){case 5103:return Ut+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ut+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ut+e+Qy+e+Qr+e+e;case 6828:case 4268:return Ut+e+Qr+e+e;case 6165:return Ut+e+Qr+"flex-"+e+e;case 5187:return Ut+e+Vt(e,/(\w+).+(:[^]+)/,Ut+"box-$1$2"+Qr+"flex-$1$2")+e;case 5443:return Ut+e+Qr+"flex-item-"+Vt(e,/flex-|-self/,"")+e;case 4675:return Ut+e+Qr+"flex-line-pack"+Vt(e,/align-content|flex-|-self/,"")+e;case 5548:return Ut+e+Qr+Vt(e,"shrink","negative")+e;case 5292:return Ut+e+Qr+Vt(e,"basis","preferred-size")+e;case 6060:return Ut+"box-"+Vt(e,"-grow","")+Ut+e+Qr+Vt(e,"grow","positive")+e;case 4554:return Ut+Vt(e,/([^-])(transform)/g,"$1"+Ut+"$2")+e;case 6187:return Vt(Vt(Vt(e,/(zoom-|grab)/,Ut+"$1"),/(image-set)/,Ut+"$1"),e,"")+e;case 5495:case 3959:return Vt(e,/(image-set\([^]*)/,Ut+"$1$`$1");case 4968:return Vt(Vt(e,/(.+:)(flex-)?(.*)/,Ut+"box-pack:$3"+Qr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ut+e+e;case 4095:case 3583:case 4068:case 2532:return Vt(e,/(.+)-inline(.+)/,Ut+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(kn(e)-1-t>6)switch(zr(e,t+1)){case 109:if(zr(e,t+4)!==45)break;case 102:return Vt(e,/(.+:)(.+)-([^]+)/,"$1"+Ut+"$2-$3$1"+Qy+(zr(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~QS(e,"stretch")?kj(Vt(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(zr(e,t+1)!==115)break;case 6444:switch(zr(e,kn(e)-3-(~QS(e,"!important")&&10))){case 107:return Vt(e,":",":"+Ut)+e;case 101:return Vt(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Ut+(zr(e,14)===45?"inline-":"")+"box$3$1"+Ut+"$2$3$1"+Qr+"$2box$3")+e}break;case 5936:switch(zr(e,t+11)){case 114:return Ut+e+Qr+Vt(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ut+e+Qr+Vt(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ut+e+Qr+Vt(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Ut+e+Qr+e+e}return e}var wme=function(t,i,r,a){if(t.length>-1&&!t.return)switch(t.type){case FC:t.return=kj(t.value,t.length);break;case Dj:return gd([$p(t,{value:Vt(t.value,"@","@"+Ut)})],a);case jC:if(t.length)return ame(t.props,function(s){switch(rme(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return gd([$p(t,{props:[Vt(s,/:(read-\w+)/,":"+Qy+"$1")]})],a);case"::placeholder":return gd([$p(t,{props:[Vt(s,/:(plac\w+)/,":"+Ut+"input-$1")]}),$p(t,{props:[Vt(s,/:(plac\w+)/,":"+Qy+"$1")]}),$p(t,{props:[Vt(s,/:(plac\w+)/,Qr+"input-$1")]})],a)}return""})}},_me=[wme],Sme=function(t){var i=t.key;if(i==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(m){var g=m.getAttribute("data-emotion");g.indexOf(" ")!==-1&&(document.head.appendChild(m),m.setAttribute("data-s",""))})}var a=t.stylisPlugins||_me,s={},n,o=[];n=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(m){for(var g=m.getAttribute("data-emotion").split(" "),v=1;v<g.length;v++)s[g[v]]=!0;o.push(m)});var l,c=[xme,bme];{var u,h=[pme,mme(function(m){u.insert(m)})],d=fme(c.concat(a,h)),p=function(g){return gd(ume(g),d)};l=function(g,v,y,x){u=y,p(g?g+"{"+v.styles+"}":v.styles),x&&(f.inserted[v.name]=!0)}}var f={key:i,sheet:new Kfe({key:i,container:n,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:s,registered:{},insert:l};return f.sheet.hydrate(o),f},Ame=!0;function Eme(e,t,i){var r="";return i.split(" ").forEach(function(a){e[a]!==void 0?t.push(e[a]+";"):r+=a+" "}),r}var zj=function(t,i,r){var a=t.key+"-"+i.name;(r===!1||Ame===!1)&&t.registered[a]===void 0&&(t.registered[a]=i.styles)},Cme=function(t,i,r){zj(t,i,r);var a=t.key+"-"+i.name;if(t.inserted[i.name]===void 0){var s=i;do t.insert(i===s?"."+a:"",s,t.sheet,!0),s=s.next;while(s!==void 0)}};function Mme(e){for(var t=0,i,r=0,a=e.length;a>=4;++r,a-=4)i=e.charCodeAt(r)&255|(e.charCodeAt(++r)&255)<<8|(e.charCodeAt(++r)&255)<<16|(e.charCodeAt(++r)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,t=(i&65535)*1540483477+((i>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(a){case 3:t^=(e.charCodeAt(r+2)&255)<<16;case 2:t^=(e.charCodeAt(r+1)&255)<<8;case 1:t^=e.charCodeAt(r)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var Tme={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Pme=/[A-Z]|^ms/g,Dme=/_EMO_([^_]+?)_([^]*?)_EMO_/g,Nj=function(t){return t.charCodeAt(1)===45},II=function(t){return t!=null&&typeof t!="boolean"},Hw=Tj(function(e){return Nj(e)?e:e.replace(Pme,"-$&").toLowerCase()}),RI=function(t,i){switch(t){case"animation":case"animationName":if(typeof i=="string")return i.replace(Dme,function(r,a,s){return zn={name:a,styles:s,next:zn},a})}return Tme[t]!==1&&!Nj(t)&&typeof i=="number"&&i!==0?i+"px":i};function Tm(e,t,i){if(i==null)return"";if(i.__emotion_styles!==void 0)return i;switch(typeof i){case"boolean":return"";case"object":{if(i.anim===1)return zn={name:i.name,styles:i.styles,next:zn},i.name;if(i.styles!==void 0){var r=i.next;if(r!==void 0)for(;r!==void 0;)zn={name:r.name,styles:r.styles,next:zn},r=r.next;var a=i.styles+";";return a}return Ome(e,t,i)}case"function":{if(e!==void 0){var s=zn,n=i(e);return zn=s,Tm(e,t,n)}break}}if(t==null)return i;var o=t[i];return o!==void 0?o:i}function Ome(e,t,i){var r="";if(Array.isArray(i))for(var a=0;a<i.length;a++)r+=Tm(e,t,i[a])+";";else for(var s in i){var n=i[s];if(typeof n!="object")t!=null&&t[n]!==void 0?r+=s+"{"+t[n]+"}":II(n)&&(r+=Hw(s)+":"+RI(s,n)+";");else if(Array.isArray(n)&&typeof n[0]=="string"&&(t==null||t[n[0]]===void 0))for(var o=0;o<n.length;o++)II(n[o])&&(r+=Hw(s)+":"+RI(s,n[o])+";");else{var l=Tm(e,t,n);switch(s){case"animation":case"animationName":{r+=Hw(s)+":"+l+";";break}default:r+=s+"{"+l+"}"}}}return r}var LI=/label:\s*([^\s;\n{]+)\s*(;|$)/g,zn,Ime=function(t,i,r){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var a=!0,s="";zn=void 0;var n=t[0];n==null||n.raw===void 0?(a=!1,s+=Tm(r,i,n)):s+=n[0];for(var o=1;o<t.length;o++)s+=Tm(r,i,t[o]),a&&(s+=n[o]);LI.lastIndex=0;for(var l="",c;(c=LI.exec(s))!==null;)l+="-"+c[1];var u=Mme(s)+l;return{name:u,styles:s,next:zn}},Rme=function(t){return t()},Lme=w0.useInsertionEffect?w0.useInsertionEffect:!1,kme=Lme||Rme,Bj=xe.createContext(typeof HTMLElement<"u"?Sme({key:"css"}):null);Bj.Provider;var zme=function(t){return xe.forwardRef(function(i,r){var a=xe.useContext(Bj);return t(i,a,r)})},jj=xe.createContext({}),Nme=Yfe,Bme=function(t){return t!=="theme"},kI=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?Nme:Bme},zI=function(t,i,r){var a;if(i){var s=i.shouldForwardProp;a=t.__emotion_forwardProp&&s?function(n){return t.__emotion_forwardProp(n)&&s(n)}:s}return typeof a!="function"&&r&&(a=t.__emotion_forwardProp),a},jme=function(t){var i=t.cache,r=t.serialized,a=t.isStringTag;return zj(i,r,a),kme(function(){return Cme(i,r,a)}),null},Fme=function e(t,i){var r=t.__emotion_real===t,a=r&&t.__emotion_base||t,s,n;i!==void 0&&(s=i.label,n=i.target);var o=zI(t,i,r),l=o||kI(a),c=!l("as");return function(){var u=arguments,h=r&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(s!==void 0&&h.push("label:"+s+";"),u[0]==null||u[0].raw===void 0)h.push.apply(h,u);else{h.push(u[0][0]);for(var d=u.length,p=1;p<d;p++)h.push(u[p],u[0][p])}var f=zme(function(m,g,v){var y=c&&m.as||a,x="",w=[],S=m;if(m.theme==null){S={};for(var _ in m)S[_]=m[_];S.theme=xe.useContext(jj)}typeof m.className=="string"?x=Eme(g.registered,w,m.className):m.className!=null&&(x=m.className+" ");var A=Ime(h.concat(w),g.registered,S);x+=g.key+"-"+A.name,n!==void 0&&(x+=" "+n);var E=c&&o===void 0?kI(y):l,M={};for(var C in m)c&&C==="as"||E(C)&&(M[C]=m[C]);return M.className=x,M.ref=v,xe.createElement(xe.Fragment,null,xe.createElement(jme,{cache:g,serialized:A,isStringTag:typeof y=="string"}),xe.createElement(y,M))});return f.displayName=s!==void 0?s:"Styled("+(typeof a=="string"?a:a.displayName||a.name||"Component")+")",f.defaultProps=t.defaultProps,f.__emotion_real=f,f.__emotion_base=a,f.__emotion_styles=h,f.__emotion_forwardProp=o,Object.defineProperty(f,"toString",{value:function(){return"."+n}}),f.withComponent=function(m,g){return e(m,zt({},i,g,{shouldForwardProp:zI(f,g,!0)})).apply(void 0,h)},f}},Ume=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],KS=Fme.bind();Ume.forEach(function(e){KS[e]=KS(e)});function Vme(e,t){return KS(e,t)}const Gme=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))},Hme=["values","unit","step"],Wme=e=>{const t=Object.keys(e).map(i=>({key:i,val:e[i]}))||[];return t.sort((i,r)=>i.val-r.val),t.reduce((i,r)=>zt({},i,{[r.key]:r.val}),{})};function qme(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:i="px",step:r=5}=e,a=al(e,Hme),s=Wme(t),n=Object.keys(s);function o(d){return`@media (min-width:${typeof t[d]=="number"?t[d]:d}${i})`}function l(d){return`@media (max-width:${(typeof t[d]=="number"?t[d]:d)-r/100}${i})`}function c(d,p){const f=n.indexOf(p);return`@media (min-width:${typeof t[d]=="number"?t[d]:d}${i}) and (max-width:${(f!==-1&&typeof t[n[f]]=="number"?t[n[f]]:p)-r/100}${i})`}function u(d){return n.indexOf(d)+1<n.length?c(d,n[n.indexOf(d)+1]):o(d)}function h(d){const p=n.indexOf(d);return p===0?o(n[1]):p===n.length-1?l(n[p]):c(d,n[n.indexOf(d)+1]).replace("@media","@media not all and")}return zt({keys:n,values:s,up:o,down:l,between:c,only:u,not:h,unit:i},a)}const Xme={borderRadius:4},Yme=Xme;function jf(e,t){return t?sn(e,t,{clone:!1}):e}const VC={xs:0,sm:600,md:900,lg:1200,xl:1536},NI={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${VC[e]}px)`};function el(e,t,i){const r=e.theme||{};if(Array.isArray(t)){const s=r.breakpoints||NI;return t.reduce((n,o,l)=>(n[s.up(s.keys[l])]=i(t[l]),n),{})}if(typeof t=="object"){const s=r.breakpoints||NI;return Object.keys(t).reduce((n,o)=>{if(Object.keys(s.values||VC).indexOf(o)!==-1){const l=s.up(o);n[l]=i(t[o],o)}else{const l=o;n[l]=t[l]}return n},{})}return i(t)}function Qme(e={}){var t;return((t=e.keys)==null?void 0:t.reduce((r,a)=>{const s=e.up(a);return r[s]={},r},{}))||{}}function Zme(e,t){return e.reduce((i,r)=>{const a=i[r];return(!a||Object.keys(a).length===0)&&delete i[r],i},t)}function Z1(e,t,i=!0){if(!t||typeof t!="string")return null;if(e&&e.vars&&i){const r=`vars.${t}`.split(".").reduce((a,s)=>a&&a[s]?a[s]:null,e);if(r!=null)return r}return t.split(".").reduce((r,a)=>r&&r[a]!=null?r[a]:null,e)}function Zy(e,t,i,r=i){let a;return typeof e=="function"?a=e(i):Array.isArray(e)?a=e[i]||r:a=Z1(e,i)||r,t&&(a=t(a,r,e)),a}function qi(e){const{prop:t,cssProperty:i=e.prop,themeKey:r,transform:a}=e,s=n=>{if(n[t]==null)return null;const o=n[t],l=n.theme,c=Z1(l,r)||{};return el(n,o,h=>{let d=Zy(c,a,h);return h===d&&typeof h=="string"&&(d=Zy(c,a,`${t}${h==="default"?"":Qn(h)}`,h)),i===!1?d:{[i]:d}})};return s.propTypes={},s.filterProps=[t],s}function Kme(e){const t={};return i=>(t[i]===void 0&&(t[i]=e(i)),t[i])}const $me={m:"margin",p:"padding"},Jme={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},BI={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},ege=Kme(e=>{if(e.length>2)if(BI[e])e=BI[e];else return[e];const[t,i]=e.split(""),r=$me[t],a=Jme[i]||"";return Array.isArray(a)?a.map(s=>r+s):[r+a]}),GC=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],HC=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...GC,...HC];function $m(e,t,i,r){var a;const s=(a=Z1(e,t,!1))!=null?a:i;return typeof s=="number"?n=>typeof n=="string"?n:s*n:Array.isArray(s)?n=>typeof n=="string"?n:s[n]:typeof s=="function"?s:()=>{}}function Fj(e){return $m(e,"spacing",8)}function Jm(e,t){if(typeof t=="string"||t==null)return t;const i=Math.abs(t),r=e(i);return t>=0?r:typeof r=="number"?-r:`-${r}`}function tge(e,t){return i=>e.reduce((r,a)=>(r[a]=Jm(t,i),r),{})}function ige(e,t,i,r){if(t.indexOf(i)===-1)return null;const a=ege(i),s=tge(a,r),n=e[i];return el(e,n,s)}function Uj(e,t){const i=Fj(e.theme);return Object.keys(e).map(r=>ige(e,t,r,i)).reduce(jf,{})}function Mi(e){return Uj(e,GC)}Mi.propTypes={};Mi.filterProps=GC;function Ti(e){return Uj(e,HC)}Ti.propTypes={};Ti.filterProps=HC;function rge(e=8){if(e.mui)return e;const t=Fj({spacing:e}),i=(...r)=>(r.length===0?[1]:r).map(s=>{const n=t(s);return typeof n=="number"?`${n}px`:n}).join(" ");return i.mui=!0,i}function K1(...e){const t=e.reduce((r,a)=>(a.filterProps.forEach(s=>{r[s]=a}),r),{}),i=r=>Object.keys(r).reduce((a,s)=>t[s]?jf(a,t[s](r)):a,{});return i.propTypes={},i.filterProps=e.reduce((r,a)=>r.concat(a.filterProps),[]),i}function _s(e){return typeof e!="number"?e:`${e}px solid`}function Is(e,t){return qi({prop:e,themeKey:"borders",transform:t})}const age=Is("border",_s),sge=Is("borderTop",_s),nge=Is("borderRight",_s),oge=Is("borderBottom",_s),lge=Is("borderLeft",_s),cge=Is("borderColor"),hge=Is("borderTopColor"),uge=Is("borderRightColor"),dge=Is("borderBottomColor"),pge=Is("borderLeftColor"),fge=Is("outline",_s),mge=Is("outlineColor"),$1=e=>{if(e.borderRadius!==void 0&&e.borderRadius!==null){const t=$m(e.theme,"shape.borderRadius",4),i=r=>({borderRadius:Jm(t,r)});return el(e,e.borderRadius,i)}return null};$1.propTypes={};$1.filterProps=["borderRadius"];K1(age,sge,nge,oge,lge,cge,hge,uge,dge,pge,$1,fge,mge);const J1=e=>{if(e.gap!==void 0&&e.gap!==null){const t=$m(e.theme,"spacing",8),i=r=>({gap:Jm(t,r)});return el(e,e.gap,i)}return null};J1.propTypes={};J1.filterProps=["gap"];const ex=e=>{if(e.columnGap!==void 0&&e.columnGap!==null){const t=$m(e.theme,"spacing",8),i=r=>({columnGap:Jm(t,r)});return el(e,e.columnGap,i)}return null};ex.propTypes={};ex.filterProps=["columnGap"];const tx=e=>{if(e.rowGap!==void 0&&e.rowGap!==null){const t=$m(e.theme,"spacing",8),i=r=>({rowGap:Jm(t,r)});return el(e,e.rowGap,i)}return null};tx.propTypes={};tx.filterProps=["rowGap"];const gge=qi({prop:"gridColumn"}),vge=qi({prop:"gridRow"}),yge=qi({prop:"gridAutoFlow"}),xge=qi({prop:"gridAutoColumns"}),bge=qi({prop:"gridAutoRows"}),wge=qi({prop:"gridTemplateColumns"}),_ge=qi({prop:"gridTemplateRows"}),Sge=qi({prop:"gridTemplateAreas"}),Age=qi({prop:"gridArea"});K1(J1,ex,tx,gge,vge,yge,xge,bge,wge,_ge,Sge,Age);function vd(e,t){return t==="grey"?t:e}const Ege=qi({prop:"color",themeKey:"palette",transform:vd}),Cge=qi({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:vd}),Mge=qi({prop:"backgroundColor",themeKey:"palette",transform:vd});K1(Ege,Cge,Mge);function Qa(e){return e<=1&&e!==0?`${e*100}%`:e}const Tge=qi({prop:"width",transform:Qa}),WC=e=>{if(e.maxWidth!==void 0&&e.maxWidth!==null){const t=i=>{var r,a;const s=((r=e.theme)==null||(r=r.breakpoints)==null||(r=r.values)==null?void 0:r[i])||VC[i];return s?((a=e.theme)==null||(a=a.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${s}${e.theme.breakpoints.unit}`}:{maxWidth:s}:{maxWidth:Qa(i)}};return el(e,e.maxWidth,t)}return null};WC.filterProps=["maxWidth"];const Pge=qi({prop:"minWidth",transform:Qa}),Dge=qi({prop:"height",transform:Qa}),Oge=qi({prop:"maxHeight",transform:Qa}),Ige=qi({prop:"minHeight",transform:Qa});qi({prop:"size",cssProperty:"width",transform:Qa});qi({prop:"size",cssProperty:"height",transform:Qa});const Rge=qi({prop:"boxSizing"});K1(Tge,WC,Pge,Dge,Oge,Ige,Rge);const Lge={border:{themeKey:"borders",transform:_s},borderTop:{themeKey:"borders",transform:_s},borderRight:{themeKey:"borders",transform:_s},borderBottom:{themeKey:"borders",transform:_s},borderLeft:{themeKey:"borders",transform:_s},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:_s},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:$1},color:{themeKey:"palette",transform:vd},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:vd},backgroundColor:{themeKey:"palette",transform:vd},p:{style:Ti},pt:{style:Ti},pr:{style:Ti},pb:{style:Ti},pl:{style:Ti},px:{style:Ti},py:{style:Ti},padding:{style:Ti},paddingTop:{style:Ti},paddingRight:{style:Ti},paddingBottom:{style:Ti},paddingLeft:{style:Ti},paddingX:{style:Ti},paddingY:{style:Ti},paddingInline:{style:Ti},paddingInlineStart:{style:Ti},paddingInlineEnd:{style:Ti},paddingBlock:{style:Ti},paddingBlockStart:{style:Ti},paddingBlockEnd:{style:Ti},m:{style:Mi},mt:{style:Mi},mr:{style:Mi},mb:{style:Mi},ml:{style:Mi},mx:{style:Mi},my:{style:Mi},margin:{style:Mi},marginTop:{style:Mi},marginRight:{style:Mi},marginBottom:{style:Mi},marginLeft:{style:Mi},marginX:{style:Mi},marginY:{style:Mi},marginInline:{style:Mi},marginInlineStart:{style:Mi},marginInlineEnd:{style:Mi},marginBlock:{style:Mi},marginBlockStart:{style:Mi},marginBlockEnd:{style:Mi},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:J1},rowGap:{style:tx},columnGap:{style:ex},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Qa},maxWidth:{style:WC},minWidth:{transform:Qa},height:{transform:Qa},maxHeight:{transform:Qa},minHeight:{transform:Qa},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}},qC=Lge;function kge(...e){const t=e.reduce((r,a)=>r.concat(Object.keys(a)),[]),i=new Set(t);return e.every(r=>i.size===Object.keys(r).length)}function zge(e,t){return typeof e=="function"?e(t):e}function Nge(){function e(i,r,a,s){const n={[i]:r,theme:a},o=s[i];if(!o)return{[i]:r};const{cssProperty:l=i,themeKey:c,transform:u,style:h}=o;if(r==null)return null;if(c==="typography"&&r==="inherit")return{[i]:r};const d=Z1(a,c)||{};return h?h(n):el(n,r,f=>{let m=Zy(d,u,f);return f===m&&typeof f=="string"&&(m=Zy(d,u,`${i}${f==="default"?"":Qn(f)}`,f)),l===!1?m:{[l]:m}})}function t(i){var r;const{sx:a,theme:s={}}=i||{};if(!a)return null;const n=(r=s.unstable_sxConfig)!=null?r:qC;function o(l){let c=l;if(typeof l=="function")c=l(s);else if(typeof l!="object")return l;if(!c)return null;const u=Qme(s.breakpoints),h=Object.keys(u);let d=u;return Object.keys(c).forEach(p=>{const f=zge(c[p],s);if(f!=null)if(typeof f=="object")if(n[p])d=jf(d,e(p,f,s,n));else{const m=el({theme:s},f,g=>({[p]:g}));kge(m,f)?d[p]=t({sx:f,theme:s}):d=jf(d,m)}else d=jf(d,e(p,f,s,n))}),Zme(h,d)}return Array.isArray(a)?a.map(o):o(a)}return t}const ix=Nge();ix.filterProps=["sx"];const Bge=["breakpoints","palette","spacing","shape"];function XC(e={},...t){const{breakpoints:i={},palette:r={},spacing:a,shape:s={}}=e,n=al(e,Bge),o=qme(i),l=rge(a);let c=sn({breakpoints:o,direction:"ltr",components:{},palette:zt({mode:"light"},r),spacing:l,shape:zt({},Yme,s)},n);return c=t.reduce((u,h)=>sn(u,h),c),c.unstable_sxConfig=zt({},qC,n==null?void 0:n.unstable_sxConfig),c.unstable_sx=function(h){return ix({sx:h,theme:this})},c}function jge(e){return Object.keys(e).length===0}function Fge(e=null){const t=xe.useContext(jj);return!t||jge(t)?e:t}const Uge=XC();function Vge(e=Uge){return Fge(e)}const Gge=["variant"];function jI(e){return e.length===0}function Vj(e){const{variant:t}=e,i=al(e,Gge);let r=t||"";return Object.keys(i).sort().forEach(a=>{a==="color"?r+=jI(r)?e[a]:Qn(e[a]):r+=`${jI(r)?a:Qn(a)}${Qn(e[a].toString())}`}),r}const Hge=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function Wge(e){return Object.keys(e).length===0}function qge(e){return typeof e=="string"&&e.charCodeAt(0)>96}const Xge=(e,t)=>t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null,Ky=e=>{let t=0;const i={};return e&&e.forEach(r=>{let a="";typeof r.props=="function"?(a=`callback${t}`,t+=1):a=Vj(r.props),i[a]=r.style}),i},Yge=(e,t)=>{let i=[];return t&&t.components&&t.components[e]&&t.components[e].variants&&(i=t.components[e].variants),Ky(i)},$y=(e,t,i)=>{const{ownerState:r={}}=e,a=[];let s=0;return i&&i.forEach(n=>{let o=!0;if(typeof n.props=="function"){const l=zt({},e,r);o=n.props(l)}else Object.keys(n.props).forEach(l=>{r[l]!==n.props[l]&&e[l]!==n.props[l]&&(o=!1)});o&&(typeof n.props=="function"?a.push(t[`callback${s}`]):a.push(t[Vj(n.props)])),typeof n.props=="function"&&(s+=1)}),a},Qge=(e,t,i,r)=>{var a;const s=i==null||(a=i.components)==null||(a=a[r])==null?void 0:a.variants;return $y(e,t,s)};function x0(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const Zge=XC(),Kge=e=>e&&e.charAt(0).toLowerCase()+e.slice(1);function b0({defaultTheme:e,theme:t,themeId:i}){return Wge(t)?e:t[i]||t}function $ge(e){return e?(t,i)=>i[e]:null}const FI=({styledArg:e,props:t,defaultTheme:i,themeId:r})=>{const a=e(zt({},t,{theme:b0(zt({},t,{defaultTheme:i,themeId:r}))}));let s;if(a&&a.variants&&(s=a.variants,delete a.variants),s){const n=$y(t,Ky(s),s);return[a,...n]}return a};function Jge(e={}){const{themeId:t,defaultTheme:i=Zge,rootShouldForwardProp:r=x0,slotShouldForwardProp:a=x0}=e,s=n=>ix(zt({},n,{theme:b0(zt({},n,{defaultTheme:i,themeId:t}))}));return s.__mui_systemSx=!0,(n,o={})=>{Gme(n,w=>w.filter(S=>!(S!=null&&S.__mui_systemSx)));const{name:l,slot:c,skipVariantsResolver:u,skipSx:h,overridesResolver:d=$ge(Kge(c))}=o,p=al(o,Hge),f=u!==void 0?u:c&&c!=="Root"&&c!=="root"||!1,m=h||!1;let g,v=x0;c==="Root"||c==="root"?v=r:c?v=a:qge(n)&&(v=void 0);const y=Vme(n,zt({shouldForwardProp:v,label:g},p)),x=(w,...S)=>{const _=S?S.map(C=>{if(typeof C=="function"&&C.__emotion_real!==C)return T=>FI({styledArg:C,props:T,defaultTheme:i,themeId:t});if(Il(C)){let T=C,D;return C&&C.variants&&(D=C.variants,delete T.variants,T=I=>{let O=C;return $y(I,Ky(D),D).forEach(q=>{O=sn(O,q)}),O}),T}return C}):[];let A=w;if(Il(w)){let C;w&&w.variants&&(C=w.variants,delete A.variants,A=T=>{let D=w;return $y(T,Ky(C),C).forEach(O=>{D=sn(D,O)}),D})}else typeof w=="function"&&w.__emotion_real!==w&&(A=C=>FI({styledArg:w,props:C,defaultTheme:i,themeId:t}));l&&d&&_.push(C=>{const T=b0(zt({},C,{defaultTheme:i,themeId:t})),D=Xge(l,T);if(D){const I={};return Object.entries(D).forEach(([O,B])=>{I[O]=typeof B=="function"?B(zt({},C,{theme:T})):B}),d(C,I)}return null}),l&&!f&&_.push(C=>{const T=b0(zt({},C,{defaultTheme:i,themeId:t}));return Qge(C,Yge(l,T),T,l)}),m||_.push(s);const E=_.length-S.length;if(Array.isArray(w)&&E>0){const C=new Array(E).fill("");A=[...w,...C],A.raw=[...w.raw,...C]}const M=y(A,..._);return n.muiName&&(M.muiName=n.muiName),M};return y.withConfig&&(x.withConfig=y.withConfig),x}}function eve(e){const{theme:t,name:i,props:r}=e;return!t||!t.components||!t.components[i]||!t.components[i].defaultProps?r:Aj(t.components[i].defaultProps,r)}function tve({props:e,name:t,defaultTheme:i,themeId:r}){let a=Vge(i);return r&&(a=a[r]||a),eve({theme:a,name:t,props:e})}function Gj(e,t=0,i=1){return Wfe(e,t,i)}function ive(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let i=e.match(t);return i&&i[0].length===1&&(i=i.map(r=>r+r)),i?`rgb${i.length===4?"a":""}(${i.map((r,a)=>a<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3).join(", ")})`:""}function Gd(e){if(e.type)return e;if(e.charAt(0)==="#")return Gd(ive(e));const t=e.indexOf("("),i=e.substring(0,t);if(["rgb","rgba","hsl","hsla","color"].indexOf(i)===-1)throw new Error(Ud(9,e));let r=e.substring(t+1,e.length-1),a;if(i==="color"){if(r=r.split(" "),a=r.shift(),r.length===4&&r[3].charAt(0)==="/"&&(r[3]=r[3].slice(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(a)===-1)throw new Error(Ud(10,a))}else r=r.split(",");return r=r.map(s=>parseFloat(s)),{type:i,values:r,colorSpace:a}}function YC(e){const{type:t,colorSpace:i}=e;let{values:r}=e;return t.indexOf("rgb")!==-1?r=r.map((a,s)=>s<3?parseInt(a,10):a):t.indexOf("hsl")!==-1&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),t.indexOf("color")!==-1?r=`${i} ${r.join(" ")}`:r=`${r.join(", ")}`,`${t}(${r})`}function rve(e){e=Gd(e);const{values:t}=e,i=t[0],r=t[1]/100,a=t[2]/100,s=r*Math.min(a,1-a),n=(c,u=(c+i/30)%12)=>a-s*Math.max(Math.min(u-3,9-u,1),-1);let o="rgb";const l=[Math.round(n(0)*255),Math.round(n(8)*255),Math.round(n(4)*255)];return e.type==="hsla"&&(o+="a",l.push(t[3])),YC({type:o,values:l})}function UI(e){e=Gd(e);let t=e.type==="hsl"||e.type==="hsla"?Gd(rve(e)).values:e.values;return t=t.map(i=>(e.type!=="color"&&(i/=255),i<=.03928?i/12.92:((i+.055)/1.055)**2.4)),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function ave(e,t){const i=UI(e),r=UI(t);return(Math.max(i,r)+.05)/(Math.min(i,r)+.05)}function sve(e,t){if(e=Gd(e),t=Gj(t),e.type.indexOf("hsl")!==-1)e.values[2]*=1-t;else if(e.type.indexOf("rgb")!==-1||e.type.indexOf("color")!==-1)for(let i=0;i<3;i+=1)e.values[i]*=1-t;return YC(e)}function nve(e,t){if(e=Gd(e),t=Gj(t),e.type.indexOf("hsl")!==-1)e.values[2]+=(100-e.values[2])*t;else if(e.type.indexOf("rgb")!==-1)for(let i=0;i<3;i+=1)e.values[i]+=(255-e.values[i])*t;else if(e.type.indexOf("color")!==-1)for(let i=0;i<3;i+=1)e.values[i]+=(1-e.values[i])*t;return YC(e)}function ove(e,t){return zt({toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}}},t)}const lve={black:"#000",white:"#fff"},Pm=lve,cve={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},hve=cve,uve={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},du=uve,dve={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},pu=dve,pve={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Jp=pve,fve={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},fu=fve,mve={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},mu=mve,gve={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},gu=gve,vve=["mode","contrastThreshold","tonalOffset"],VI={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Pm.white,default:Pm.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Ww={text:{primary:Pm.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Pm.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function GI(e,t,i,r){const a=r.light||r,s=r.dark||r*1.5;e[t]||(e.hasOwnProperty(i)?e[t]=e[i]:t==="light"?e.light=nve(e.main,a):t==="dark"&&(e.dark=sve(e.main,s)))}function yve(e="light"){return e==="dark"?{main:fu[200],light:fu[50],dark:fu[400]}:{main:fu[700],light:fu[400],dark:fu[800]}}function xve(e="light"){return e==="dark"?{main:du[200],light:du[50],dark:du[400]}:{main:du[500],light:du[300],dark:du[700]}}function bve(e="light"){return e==="dark"?{main:pu[500],light:pu[300],dark:pu[700]}:{main:pu[700],light:pu[400],dark:pu[800]}}function wve(e="light"){return e==="dark"?{main:mu[400],light:mu[300],dark:mu[700]}:{main:mu[700],light:mu[500],dark:mu[900]}}function _ve(e="light"){return e==="dark"?{main:gu[400],light:gu[300],dark:gu[700]}:{main:gu[800],light:gu[500],dark:gu[900]}}function Sve(e="light"){return e==="dark"?{main:Jp[400],light:Jp[300],dark:Jp[700]}:{main:"#ed6c02",light:Jp[500],dark:Jp[900]}}function Ave(e){const{mode:t="light",contrastThreshold:i=3,tonalOffset:r=.2}=e,a=al(e,vve),s=e.primary||yve(t),n=e.secondary||xve(t),o=e.error||bve(t),l=e.info||wve(t),c=e.success||_ve(t),u=e.warning||Sve(t);function h(m){return ave(m,Ww.text.primary)>=i?Ww.text.primary:VI.text.primary}const d=({color:m,name:g,mainShade:v=500,lightShade:y=300,darkShade:x=700})=>{if(m=zt({},m),!m.main&&m[v]&&(m.main=m[v]),!m.hasOwnProperty("main"))throw new Error(Ud(11,g?` (${g})`:"",v));if(typeof m.main!="string")throw new Error(Ud(12,g?` (${g})`:"",JSON.stringify(m.main)));return GI(m,"light",y,r),GI(m,"dark",x,r),m.contrastText||(m.contrastText=h(m.main)),m},p={dark:Ww,light:VI};return sn(zt({common:zt({},Pm),mode:t,primary:d({color:s,name:"primary"}),secondary:d({color:n,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:d({color:o,name:"error"}),warning:d({color:u,name:"warning"}),info:d({color:l,name:"info"}),success:d({color:c,name:"success"}),grey:hve,contrastThreshold:i,getContrastText:h,augmentColor:d,tonalOffset:r},p[t]),a)}const Eve=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function Cve(e){return Math.round(e*1e5)/1e5}const HI={textTransform:"uppercase"},WI='"Roboto", "Helvetica", "Arial", sans-serif';function Mve(e,t){const i=typeof t=="function"?t(e):t,{fontFamily:r=WI,fontSize:a=14,fontWeightLight:s=300,fontWeightRegular:n=400,fontWeightMedium:o=500,fontWeightBold:l=700,htmlFontSize:c=16,allVariants:u,pxToRem:h}=i,d=al(i,Eve),p=a/14,f=h||(v=>`${v/c*p}rem`),m=(v,y,x,w,S)=>zt({fontFamily:r,fontWeight:v,fontSize:f(y),lineHeight:x},r===WI?{letterSpacing:`${Cve(w/y)}em`}:{},S,u),g={h1:m(s,96,1.167,-1.5),h2:m(s,60,1.2,-.5),h3:m(n,48,1.167,0),h4:m(n,34,1.235,.25),h5:m(n,24,1.334,0),h6:m(o,20,1.6,.15),subtitle1:m(n,16,1.75,.15),subtitle2:m(o,14,1.57,.1),body1:m(n,16,1.5,.15),body2:m(n,14,1.43,.15),button:m(o,14,1.75,.4,HI),caption:m(n,12,1.66,.4),overline:m(n,12,2.66,1,HI),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return sn(zt({htmlFontSize:c,pxToRem:f,fontFamily:r,fontSize:a,fontWeightLight:s,fontWeightRegular:n,fontWeightMedium:o,fontWeightBold:l},g),d,{clone:!1})}const Tve=.2,Pve=.14,Dve=.12;function mi(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,${Tve})`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,${Pve})`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,${Dve})`].join(",")}const Ove=["none",mi(0,2,1,-1,0,1,1,0,0,1,3,0),mi(0,3,1,-2,0,2,2,0,0,1,5,0),mi(0,3,3,-2,0,3,4,0,0,1,8,0),mi(0,2,4,-1,0,4,5,0,0,1,10,0),mi(0,3,5,-1,0,5,8,0,0,1,14,0),mi(0,3,5,-1,0,6,10,0,0,1,18,0),mi(0,4,5,-2,0,7,10,1,0,2,16,1),mi(0,5,5,-3,0,8,10,1,0,3,14,2),mi(0,5,6,-3,0,9,12,1,0,3,16,2),mi(0,6,6,-3,0,10,14,1,0,4,18,3),mi(0,6,7,-4,0,11,15,1,0,4,20,3),mi(0,7,8,-4,0,12,17,2,0,5,22,4),mi(0,7,8,-4,0,13,19,2,0,5,24,4),mi(0,7,9,-4,0,14,21,2,0,5,26,4),mi(0,8,9,-5,0,15,22,2,0,6,28,5),mi(0,8,10,-5,0,16,24,2,0,6,30,5),mi(0,8,11,-5,0,17,26,2,0,6,32,5),mi(0,9,11,-5,0,18,28,2,0,7,34,6),mi(0,9,12,-6,0,19,29,2,0,7,36,6),mi(0,10,13,-6,0,20,31,3,0,8,38,7),mi(0,10,13,-6,0,21,33,3,0,8,40,7),mi(0,10,14,-6,0,22,35,3,0,8,42,7),mi(0,11,14,-7,0,23,36,3,0,9,44,8),mi(0,11,15,-7,0,24,38,3,0,9,46,8)],Ive=["duration","easing","delay"],Rve={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Lve={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function qI(e){return`${Math.round(e)}ms`}function kve(e){if(!e)return 0;const t=e/36;return Math.round((4+15*t**.25+t/5)*10)}function zve(e){const t=zt({},Rve,e.easing),i=zt({},Lve,e.duration);return zt({getAutoHeightDuration:kve,create:(a=["all"],s={})=>{const{duration:n=i.standard,easing:o=t.easeInOut,delay:l=0}=s;return al(s,Ive),(Array.isArray(a)?a:[a]).map(c=>`${c} ${typeof n=="string"?n:qI(n)} ${o} ${typeof l=="string"?l:qI(l)}`).join(",")}},e,{easing:t,duration:i})}const Nve={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},Bve=Nve,jve=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function Fve(e={},...t){const{mixins:i={},palette:r={},transitions:a={},typography:s={}}=e,n=al(e,jve);if(e.vars)throw new Error(Ud(18));const o=Ave(r),l=XC(e);let c=sn(l,{mixins:ove(l.breakpoints,i),palette:o,shadows:Ove.slice(),typography:Mve(o,s),transitions:zve(a),zIndex:zt({},Bve)});return c=sn(c,n),c=t.reduce((u,h)=>sn(u,h),c),c.unstable_sxConfig=zt({},qC,n==null?void 0:n.unstable_sxConfig),c.unstable_sx=function(h){return ix({sx:h,theme:this})},c}const Uve=Fve(),Hj=Uve,Wj="$$material";function Vve({props:e,name:t}){return tve({props:e,name:t,defaultTheme:Hj,themeId:Wj})}const Gve=e=>x0(e)&&e!=="classes",Hve=Jge({themeId:Wj,defaultTheme:Hj,rootShouldForwardProp:Gve});function Wve(e){return Cj("MuiSvgIcon",e)}Hfe("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const qve=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],Xve=e=>{const{color:t,fontSize:i,classes:r}=e,a={root:["root",t!=="inherit"&&`color${Qn(t)}`,`fontSize${Qn(i)}`]};return Ufe(a,Wve,r)},Yve=Hve("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:i}=e;return[t.root,i.color!=="inherit"&&t[`color${Qn(i.color)}`],t[`fontSize${Qn(i.fontSize)}`]]}})(({theme:e,ownerState:t})=>{var i,r,a,s,n,o,l,c,u,h,d,p,f;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:t.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:(i=e.transitions)==null||(r=i.create)==null?void 0:r.call(i,"fill",{duration:(a=e.transitions)==null||(a=a.duration)==null?void 0:a.shorter}),fontSize:{inherit:"inherit",small:((s=e.typography)==null||(n=s.pxToRem)==null?void 0:n.call(s,20))||"1.25rem",medium:((o=e.typography)==null||(l=o.pxToRem)==null?void 0:l.call(o,24))||"1.5rem",large:((c=e.typography)==null||(u=c.pxToRem)==null?void 0:u.call(c,35))||"2.1875rem"}[t.fontSize],color:(h=(d=(e.vars||e).palette)==null||(d=d[t.color])==null?void 0:d.main)!=null?h:{action:(p=(e.vars||e).palette)==null||(p=p.action)==null?void 0:p.active,disabled:(f=(e.vars||e).palette)==null||(f=f.action)==null?void 0:f.disabled,inherit:void 0}[t.color]}}),$S=xe.forwardRef(function(t,i){const r=Vve({props:t,name:"MuiSvgIcon"}),{children:a,className:s,color:n="inherit",component:o="svg",fontSize:l="medium",htmlColor:c,inheritViewBox:u=!1,titleAccess:h,viewBox:d="0 0 24 24"}=r,p=al(r,qve),f=xe.isValidElement(a)&&a.type==="svg",m=zt({},r,{color:n,component:o,fontSize:l,instanceFontSize:t.fontSize,inheritViewBox:u,viewBox:d,hasSvgAsChild:f}),g={};u||(g.viewBox=d);const v=Xve(m);return b.jsxs(Yve,zt({as:o,className:qfe(v.root,s),focusable:"false",color:c,"aria-hidden":h?void 0:!0,role:h?"img":void 0,ref:i},g,p,f&&a.props,{ownerState:m,children:[f?a.props.children:a,h?b.jsx("title",{children:h}):null]}))});$S.muiName="SvgIcon";function Qve(e,t){function i(r,a){return b.jsx($S,zt({"data-testid":`${t}Icon`,ref:a},r,{children:e}))}return i.muiName=$S.muiName,xe.memo(xe.forwardRef(i))}const Zve={configure:e=>{Ej.configure(e)}},Kve=Object.freeze(Object.defineProperty({__proto__:null,capitalize:Qn,createChainedFunction:wfe,createSvgIcon:Qve,debounce:_fe,deprecatedPropType:Sfe,isMuiElement:Afe,ownerDocument:wj,ownerWindow:Efe,requirePropFactory:Cfe,setRef:_j,unstable_ClassNameGenerator:Zve,unstable_useEnhancedEffect:Sj,unstable_useId:Pfe,unsupportedProp:Dfe,useControlled:Ofe,useEventCallback:Ife,useForkRef:Rfe,useIsFocusVisible:Ffe},Symbol.toStringTag,{value:"Module"})),$ve=_6(Kve);var XI;function so(){return XI||(XI=1,function(e){"use client";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return t.createSvgIcon}});var t=$ve}(Vw)),Vw}var Jve=ao;Object.defineProperty(BC,"__esModule",{value:!0});var qj=BC.default=void 0,e0e=Jve(so()),t0e=b;qj=BC.default=(0,e0e.default)((0,t0e.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");var QC={},i0e=ao;Object.defineProperty(QC,"__esModule",{value:!0});var Xj=QC.default=void 0;s0e(xe);var r0e=i0e(so()),a0e=b;function Yj(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Yj=function(r){return r?i:t})(e)}function s0e(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=Yj(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}Xj=QC.default=(0,r0e.default)((0,a0e.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"}),"X");var ZC={},n0e=ao;Object.defineProperty(ZC,"__esModule",{value:!0});var KC=ZC.default=void 0;c0e(xe);var o0e=n0e(so()),l0e=b;function Qj(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Qj=function(r){return r?i:t})(e)}function c0e(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=Qj(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}KC=ZC.default=(0,o0e.default)((0,l0e.jsx)("path",{d:"M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"}),"Telegram");var $C={},h0e=ao;Object.defineProperty($C,"__esModule",{value:!0});var JC=$C.default=void 0;p0e(xe);var u0e=h0e(so()),d0e=b;function Zj(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Zj=function(r){return r?i:t})(e)}function p0e(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=Zj(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}JC=$C.default=(0,u0e.default)((0,d0e.jsx)("path",{d:"M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z"}),"YouTube");var eM={},f0e=ao;Object.defineProperty(eM,"__esModule",{value:!0});var tM=eM.default=void 0;v0e(xe);var m0e=f0e(so()),g0e=b;function Kj(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Kj=function(r){return r?i:t})(e)}function v0e(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=Kj(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}tM=eM.default=(0,m0e.default)((0,g0e.jsx)("path",{d:"M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"}),"GitHub");var iM={},y0e=ao;Object.defineProperty(iM,"__esModule",{value:!0});var $j=iM.default=void 0;w0e(xe);var x0e=y0e(so()),b0e=b;function Jj(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(Jj=function(r){return r?i:t})(e)}function w0e(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=Jj(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}$j=iM.default=(0,x0e.default)((0,b0e.jsx)("path",{d:"M22 12.14a2.19 2.19 0 0 0-3.71-1.57 10.93 10.93 0 0 0-5.86-1.87l1-4.7 3.27.71a1.56 1.56 0 1 0 .16-.76l-3.64-.77c-.11-.02-.22 0-.29.06-.09.05-.14.14-.16.26l-1.11 5.22c-2.33.07-4.43.78-5.95 1.86A2.2 2.2 0 0 0 4.19 10a2.16 2.16 0 0 0-.9 4.15 3.6 3.6 0 0 0-.05.66c0 3.37 3.92 6.12 8.76 6.12s8.76-2.73 8.76-6.12c0-.21-.01-.44-.05-.66A2.21 2.21 0 0 0 22 12.14M7 13.7c0-.86.68-1.56 1.54-1.56s1.56.7 1.56 1.56a1.56 1.56 0 0 1-1.56 1.56c-.86.02-1.54-.7-1.54-1.56m8.71 4.14C14.63 18.92 12.59 19 12 19c-.61 0-2.65-.1-3.71-1.16a.4.4 0 0 1 0-.57.4.4 0 0 1 .57 0c.68.68 2.14.91 3.14.91s2.47-.23 3.14-.91a.4.4 0 0 1 .57 0c.14.16.14.41 0 .57m-.29-2.56c-.86 0-1.56-.7-1.56-1.56a1.56 1.56 0 0 1 1.56-1.56c.86 0 1.58.7 1.58 1.56a1.6 1.6 0 0 1-1.58 1.56z"}),"Reddit");const _0e=()=>{const e=[{id:"1",title:"Coinbase",img:"/img/walletsImg/coinbase_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Coinbase is a global digital wallet functioning as a web browser extension. With Coinbase, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"2",title:"Metamask",img:"/img/walletsImg/metamask_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Metamask is a global digital wallet functioning as a web browser extension. With Metamask, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"3",title:"Trust Wallet",img:"/img/walletsImg/trust_wallet_icon.jpeg",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Trust Wallet is a global digital wallet functioning as a web browser extension. With Trust Wallet, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"4",title:"Kaikas",img:"/img/walletsImg/kaikas_wallet_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Kaikas is a global digital wallet functioning as a web browser extension. With Kaikas, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"5",title:"SafePal",img:"/img/walletsImg/safepal_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"SafePal is a global digital wallet functioning as a web browser extension. With SafePal, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"6",title:"Coin98",img:"/img/walletsImg/coin98_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Coin98 is a global digital wallet functioning as a web browser extension. With Coin98, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"7",title:"Huobi Wallet",img:"/img/walletsImg/huobi_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Huobi Wallet is a global digital wallet functioning as a web browser extension. With Huobi Wallet, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"8",title:"D'Cent",img:"/img/walletsImg/dcent_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"D'Cent is a global digital wallet functioning as a web browser extension. With D'Cent, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})},{id:"9",title:"Exodus Wallet",img:"/img/walletsImg/exodus_icon.png",body:b.jsxs("div",{className:"wallets_body",children:[b.jsx("span",{children:"Exodus Wallet is a global digital wallet functioning as a web browser extension. With Exodus Wallet, you can safely and seamlessly manage the Egochain-based tokens that you control."}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("span",{children:"As an HD wallet, Kaikas allows you to create more than one account with a single master seed phrase. Kaikas supports various types of Klaytn networks, and enables you to register your own customized tokens within the wallet. Kaikas also allows you to sign requests from Klaytn-based web BApps (Blockchain Applications)."})]})}];return b.jsxs("div",{className:"Home_div",children:[b.jsxs("section",{className:"home_div_section1",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"home_div_section1_area",children:[b.jsxs("div",{className:"home_div_section1_area_1",children:[b.jsxs("div",{className:"home_div_section1_area_1_div1",children:[b.jsxs("div",{className:"home_div_section1_area_1_div1_txt1",children:[b.jsxs("span",{className:"home_div_section1_area_1_div1_txt1_span",children:["Operating Systems",b.jsx("br",{})," For Next-Generation"]}),"Electric Vehicles."]}),b.jsx("div",{className:"home_div_section1_area_1_div1_txt2",children:"Seamlessly create decentralized applications on Egochain, a decentralized blockchain that blends the speed and interoperability of Cosmos with the developer power of Ethereum."})]}),b.jsxs("div",{className:"home_div_section1_area_1_div2",children:[b.jsx("a",{href:"/egc/coin/info",children:b.jsx("button",{className:"home_div_section1_area_1_div2_btn",children:"Explore EGC Coin"})}),b.jsx("a",{href:"/egax/coin/info",children:b.jsx("button",{className:"home_div_section1_area_1_div2_btn2",children:"Explore EGAX Coin"})})]})]}),b.jsx("div",{className:"home_div_section1_area_2",children:b.jsx(qS,{scene:"https://prod.spline.design/TVLoAomGQBQWA2NS/scene.splinecode",className:"home_div_section1_area_2_spline_scene"})})]})}),b.jsx("img",{src:"/img/hero_bg_light.svg",alt:"",className:"home_div_section1_bg_light"}),b.jsx("img",{src:"/img/test_hero_light2.svg",alt:"",className:"home_div_section1_bg_light2"}),b.jsx(AI,{}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"})]}),b.jsxs("section",{className:"home_div_section2",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"home_div_section3_area",children:[b.jsxs("div",{className:"home_div_section3_area_title",children:["Why Build on Egochain?",b.jsx("div",{className:"home_div_section3_area_para",children:"Build interoperable decentralized applications with the combined power of Ethereum's swift smart contract development and Cosmos SDK's seamless interoperability."})]}),b.jsxs("div",{className:"home_div_section3_area_body",children:[b.jsxs("div",{className:"home_div_section3_area_body_cont1",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_title",children:"Secure Network"}),b.jsxs("div",{className:"home_div_section3_area_body_cont1_body_text",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_title",children:"Powered by EGAX's Secure Network"}),b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_para",children:"Node validators actively safeguard the EGOCHAIN by securing consensus, earning EGAX tokens as their well-deserved reward."})]}),b.jsx("div",{className:"home_div_section3_area_body_cont1_icon",children:b.jsxs("svg",{"data-v-25ecef37":"","data-v-706ceafa":"",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"4.08823",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"27.9115",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"16.0003",cy:"4.97105",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M14.0242 8.49609L5.62305 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M17.9756 8.49609L26.3767 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M8.05859 27.0273H23.9409",stroke:"white","stroke-width":"1.5"})]})})]}),b.jsxs("div",{className:"home_div_section3_area_body_cont1",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_title",children:"Unleashing"}),b.jsxs("div",{className:"home_div_section3_area_body_cont1_body_text",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_title",children:"Unleashing Interoperability"}),b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_para",children:"Powered by the robust Cosmos SDK, Egochain seamlessly connects to the vibrant Cosmos ecosystem (20+ chains, $40B+) through the IBC protocol."})]}),b.jsx("div",{className:"home_div_section3_area_body_cont1_icon",children:b.jsxs("svg",{"data-v-25ecef37":"","data-v-706ceafa":"",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"4.08823",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"27.9115",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"16.0003",cy:"4.97105",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M14.0242 8.49609L5.62305 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M17.9756 8.49609L26.3767 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M8.05859 27.0273H23.9409",stroke:"white","stroke-width":"1.5"})]})})]}),b.jsxs("div",{className:"home_div_section3_area_body_cont1",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_title",children:"Unleash"}),b.jsxs("div",{className:"home_div_section3_area_body_cont1_body_text",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_title",children:"Unleash the Full Potential of Solidity"}),b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_para",children:"Egochain's EVM compatibility empowers developers to leverage the familiar Solidity language and existing dApps, while reaping the benefits of Egochain's superior scalability and security."})]}),b.jsx("div",{className:"home_div_section3_area_body_cont1_icon",children:b.jsxs("svg",{"data-v-25ecef37":"","data-v-706ceafa":"",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"4.08823",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"27.9115",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"16.0003",cy:"4.97105",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M14.0242 8.49609L5.62305 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M17.9756 8.49609L26.3767 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M8.05859 27.0273H23.9409",stroke:"white","stroke-width":"1.5"})]})})]}),b.jsxs("div",{className:"home_div_section3_area_body_cont1",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_title",children:"Transactions"}),b.jsxs("div",{className:"home_div_section3_area_body_cont1_body_text",children:[b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_title",children:"Transactions by the Millions"}),b.jsx("div",{className:"home_div_section3_area_body_cont1_body_text_para",children:"Tendermint Consensus delivers single-block finality and unmatched scalability, ensuring Egochain can handle the demands of thousands of protocols and millions of users – effortlessly."})]}),b.jsx("div",{className:"home_div_section3_area_body_cont1_icon",children:b.jsxs("svg",{"data-v-25ecef37":"","data-v-706ceafa":"",width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"4.08823",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"27.9115",cy:"27.0335",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("circle",{"data-v-25ecef37":"","data-v-706ceafa":"",cx:"16.0003",cy:"4.97105",r:"3.08824",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M14.0242 8.49609L5.62305 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M17.9756 8.49609L26.3767 23.4981",stroke:"white","stroke-width":"1.5"})," ",b.jsx("path",{"data-v-25ecef37":"","data-v-706ceafa":"",d:"M8.05859 27.0273H23.9409",stroke:"white","stroke-width":"1.5"})]})})]})]})]})}),b.jsx("img",{src:"/img/grains_bottom.png",alt:"",className:"grains_ellipse"}),b.jsx("img",{src:"/img/test_hero_light3.svg",alt:"",className:"home_div_section1_bg_light3"})]}),b.jsxs("section",{className:"home_div_section4",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"home_div_section4_area",children:[b.jsx("div",{className:"home_div_section4_area_tile",children:"The most adopted scaling technology"}),b.jsxs("div",{className:"home_div_section4_area_body",children:[b.jsxs("div",{className:"home_div_section4_area_body_cont",children:[b.jsx("div",{className:"home_div_section4_area_body_cont1_img_div",children:b.jsx(md,{})}),b.jsxs("div",{className:"home_div_section4_area_body_cont2",children:[b.jsx("div",{className:"home_div_section4_area_body_cont2_title",children:"Power the future of Web3 with next-generation dApps"}),b.jsx("div",{className:"home_div_section4_area_body_cont2_para",children:"At Egochain, we see dApps as the engine driving Web3's revolution. That's why we built Egochain OS, a streamlined 3-step program empowering developers to launch innovative dApps directly onto the next generation of electric vehicles."}),b.jsx("div",{className:"home_div_section4_area_body_cont2_button_div",children:b.jsx("button",{className:"home_div_section4_area_body_cont2_btn",children:"Open Docs"})})]})]}),b.jsxs("div",{className:"home_div_section4_area_body_cont2a",children:[b.jsxs("div",{className:"home_div_section4_area_body_cont2",children:[b.jsx("div",{className:"home_div_section4_area_body_cont2_title",children:"The Blockchain Paving the Way for Real-World Adoption"}),b.jsx("div",{className:"home_div_section4_area_body_cont2_para",children:"Built on the robust Cosmos SDK and leveraging the secure Ethermint consensus mechanism, Egochain is an EVM-compatible blockchain designed for mass adoption. Its human-readable addresses simplify user interactions, making the transition to blockchain technology seamless for millions."}),b.jsx("div",{className:"home_div_section4_area_body_cont2_button_div",children:b.jsx("button",{className:"home_div_section4_area_body_cont2_btn",children:"Open Docs"})})]}),b.jsx("div",{className:"home_div_section4_area_body_cont1_img_div2",children:b.jsx(md,{})})]}),b.jsxs("div",{className:"home_div_section4_area_body_cont3",children:[b.jsx("div",{className:"home_div_section4_area_body_cont1_img_div",children:b.jsx(md,{})}),b.jsxs("div",{className:"home_div_section4_area_body_cont2",children:[b.jsx("div",{className:"home_div_section4_area_body_cont2_title",children:"Revolutionizing Smart Contracts"}),b.jsx("div",{className:"home_div_section4_area_body_cont2_para",children:"Launch dynamic dApps with Egoras's powerful CosmWasm smart contract layer. Egoras is the first blockchain to offer auto-executing smart contracts which empower faster, more innovative and groundbreaking applications."}),b.jsx("div",{className:"home_div_section4_area_body_cont2_button_div",children:b.jsx("button",{className:"home_div_section4_area_body_cont2_btn",children:"Open Docs"})})]})]})]})]})}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"}),b.jsx("img",{src:"/img/test_hero_light4.svg",alt:"",className:"home_div_section1_bg_light4"})]}),b.jsxs("section",{className:"home_div_section2",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"ego_chain_stat_section_area",children:[b.jsx("div",{className:"home_div_section3_area_title",children:"The Blockchain Built for Real-World Businesses"}),b.jsxs("div",{className:"ego_chain_stat_section_body",children:[b.jsxs("div",{className:"ego_chain_stat_section_body_1",children:[b.jsxs("div",{className:"ego_chain_stat_section_body_1_cont1",children:["Egochain is more than just a blockchain platform;",b.jsx("br",{}),b.jsx("br",{}),"It is a powerful framework designed to empower real-world businesses to streamline operations, optimize transactions, and unlock new levels of value."]}),b.jsxs("div",{className:"ego_chain_stat_section_body_1_cont2",children:[b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_title",children:"PROOF-OF-STAKE"}),b.jsxs("div",{className:"ego_chain_stat_section_body_1_cont2_div2",children:[b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_div2_cont1",children:"99%"}),b.jsxs("div",{className:"ego_chain_stat_section_body_1_cont2_div2_cont2",children:["lower ",b.jsx("br",{}),"carbon ",b.jsx("br",{}),"footprint"]})]}),b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_last_text",children:"Blockchain tech that truly scales."})]})]}),b.jsxs("div",{className:"ego_chain_stat_section_body_2",children:[b.jsxs("div",{className:"ego_chain_stat_section_body_1_cont2",children:[b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_title",children:"LOW FEES"}),b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_txt",children:"$0.01"}),b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_last_text",children:"Enjoy the lowest fees – almost zero."})]}),b.jsxs("div",{className:"ego_chain_stat_section_body_1_cont2",children:[b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_title",children:"FAST TRANSACTIONS"}),b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_txt",children:"7 sec"}),b.jsx("div",{className:"ego_chain_stat_section_body_1_cont2_last_text",children:"Transactions confirmed in seconds."})]})]})]})]})}),b.jsx("img",{src:"/img/grains_bottom.png",alt:"",className:"grains_ellipse"}),b.jsx("img",{src:"/img/hero_bg_light.svg",alt:"",className:"home_div_section1_bg_light5"})]}),b.jsxs("section",{className:"home_div_section5",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"home_div_section5_area",children:[b.jsx("div",{className:"home_div_section5_area_title",children:"Wallets"}),b.jsx("div",{className:"home_div_section5_area_body_cont",children:e.map(t=>b.jsxs("div",{className:"home_div_section5_area_body_cont_div1",id:t.id,children:[b.jsx("div",{className:"home_div_section5_area_body_cont_div1_img_div",children:b.jsx("img",{src:t.img,alt:"",className:"home_div_section5_area_body_cont_div1_img_div_img"})}),b.jsx("div",{className:"home_div_section5_area_body_cont_div1_title",children:t.title}),b.jsx("div",{className:"home_div_section5_area_body_cont_div1_title_para",children:t.body}),b.jsx("div",{className:"home_div_section5_area_body_cont_div1_last_txt",children:"WALLETS"})]}))})]})}),b.jsx("img",{src:"/img/grains_bottom.png",alt:"",className:"grains_ellipse"}),b.jsx("img",{src:"/img/test_hero_light2.svg",alt:"",className:"home_div_section1_bg_light2"})]}),b.jsxs("section",{className:"home_div_section6",children:[b.jsxs("div",{className:"container",children:[b.jsx("div",{className:"home_div_section6_area_community",children:b.jsxs("div",{className:"home_div_section6_area_community_2",children:[b.jsxs("div",{className:"home_div_section6_area_community_2_title",children:["Join the Egochain commnity",b.jsx("div",{className:"home_div_section6_area_community_2_title_para",children:"Take part in the conversation! Stay in the know & be the first to hear about any new updates"})]}),b.jsxs("div",{className:"home_div_section6_area_community_2_links",children:[b.jsxs("a",{target:"_blank",href:"https://twitter.com/egorasHQ?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor",className:"home_div_section6_area_community_2_links_cont1",children:[b.jsx(Xj,{className:"home_div_section6_area_community_2_links_cont1_icon",style:{background:"#000"}}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1_text",children:[b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_title",children:"X"}),b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_para",children:"Read the latest"})]})]}),b.jsxs("a",{target:"_blank",href:"https://t.me/s/egorasmarket?before=480",className:"home_div_section6_area_community_2_links_cont1",children:[b.jsx(KC,{className:"home_div_section6_area_community_2_links_cont1_icon"}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1_text",children:[b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_title",children:"Telegram"}),b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_para",children:"Join Discussion"})]})]}),b.jsxs("a",{href:"https://www.youtube.com/channel/UCHfi5EwXig46xp5Dx8hVBHQ",className:"home_div_section6_area_community_2_links_cont1",children:[b.jsx(JC,{className:"home_div_section6_area_community_2_links_cont1_icon",style:{background:"red"}}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1_text",children:[b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_title",children:"Youtube"}),b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_para",children:"Watch the latest"})]})]}),b.jsxs("a",{target:"_blank",href:"https://github.com/EgorasMarket",className:"home_div_section6_area_community_2_links_cont1",children:[b.jsx(tM,{className:"home_div_section6_area_community_2_links_cont1_icon",style:{background:"#fff",color:"#000"}}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1_text",children:[b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_title",children:"Github"}),b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_para",children:"Build with us"})]})]}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1",children:[b.jsx($j,{className:"home_div_section6_area_community_2_links_cont1_icon",style:{background:"#ff4500"}}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1_text",children:[b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_title",children:"Reddit"}),b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_para",children:"Get Involved"})]})]}),b.jsxs("a",{target:"_blank",href:"https://egoras.medium.com/",className:"home_div_section6_area_community_2_links_cont1",children:[b.jsx("img",{src:"/img/medium_icon.jpeg",alt:"",className:"home_div_section6_area_community_2_links_cont1_img"}),b.jsxs("div",{className:"home_div_section6_area_community_2_links_cont1_text",children:[b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_title",children:"Medium"}),b.jsx("div",{className:"home_div_section6_area_community_2_links_cont1_text_para",children:"Read the latest"})]})]})]})]})}),b.jsxs("div",{className:"home_div_section6_area",children:[b.jsxs("div",{className:"home_div_section6_area_1",children:[b.jsx("div",{className:"home_div_section6_area_1_title",children:"Stay up to date"}),b.jsx("div",{className:"home_div_section6_area_1_text",children:"Be the first to know about the latest updates and launches."}),b.jsxs("div",{className:"home_div_section6_area_1_input_div",children:[b.jsx("input",{type:"email",name:"",id:"",placeholder:"Email",className:"home_div_section6_area_1_input_div_input"}),b.jsx("button",{className:"home_div_section6_area_1_input_div_btn",children:b.jsx(qj,{})})]})]}),b.jsxs("div",{className:"home_div_section6_area_2",children:[" ",b.jsx(qS,{scene:"https://prod.spline.design/TVLoAomGQBQWA2NS/scene.splinecode",className:"home_div_section1_area_2_spline_scene2"})]})]})]}),b.jsx("img",{src:"/img/test_hero_light3.svg",alt:"",className:"home_div_section1_bg_light3"}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"}),b.jsx(AI,{})]})]})};/**
 * @remix-run/router v1.14.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jy(){return Jy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Jy.apply(this,arguments)}var Wl;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Wl||(Wl={}));const YI="popstate";function S0e(e){e===void 0&&(e={});function t(r,a){let{pathname:s,search:n,hash:o}=r.location;return JS("",{pathname:s,search:n,hash:o},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function i(r,a){return typeof a=="string"?a:e6(a)}return E0e(t,i,null,e)}function Va(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function rM(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function A0e(){return Math.random().toString(36).substr(2,8)}function QI(e,t){return{usr:e.state,key:e.key,idx:t}}function JS(e,t,i,r){return i===void 0&&(i=null),Jy({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?rx(t):t,{state:i,key:t&&t.key||r||A0e()})}function e6(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&i!=="?"&&(t+=i.charAt(0)==="?"?i:"?"+i),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function rx(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function E0e(e,t,i,r){r===void 0&&(r={});let{window:a=document.defaultView,v5Compat:s=!1}=r,n=a.history,o=Wl.Pop,l=null,c=u();c==null&&(c=0,n.replaceState(Jy({},n.state,{idx:c}),""));function u(){return(n.state||{idx:null}).idx}function h(){o=Wl.Pop;let g=u(),v=g==null?null:g-c;c=g,l&&l({action:o,location:m.location,delta:v})}function d(g,v){o=Wl.Push;let y=JS(m.location,g,v);i&&i(y,g),c=u()+1;let x=QI(y,c),w=m.createHref(y);try{n.pushState(x,"",w)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;a.location.assign(w)}s&&l&&l({action:o,location:m.location,delta:1})}function p(g,v){o=Wl.Replace;let y=JS(m.location,g,v);i&&i(y,g),c=u();let x=QI(y,c),w=m.createHref(y);n.replaceState(x,"",w),s&&l&&l({action:o,location:m.location,delta:0})}function f(g){let v=a.location.origin!=="null"?a.location.origin:a.location.href,y=typeof g=="string"?g:e6(g);return Va(v,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,v)}let m={get action(){return o},get location(){return e(a,n)},listen(g){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(YI,h),l=g,()=>{a.removeEventListener(YI,h),l=null}},createHref(g){return t(a,g)},createURL:f,encodeLocation(g){let v=f(g);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:d,replace:p,go(g){return n.go(g)}};return m}var ZI;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ZI||(ZI={}));function C0e(e,t,i){i===void 0&&(i="/");let r=typeof t=="string"?rx(t):t,a=r6(r.pathname||"/",i);if(a==null)return null;let s=t6(e);M0e(s);let n=null;for(let o=0;n==null&&o<s.length;++o)n=z0e(s[o],j0e(a));return n}function t6(e,t,i,r){t===void 0&&(t=[]),i===void 0&&(i=[]),r===void 0&&(r="");let a=(s,n,o)=>{let l={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:n,route:s};l.relativePath.startsWith("/")&&(Va(l.relativePath.startsWith(r),'Absolute route path "'+l.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),l.relativePath=l.relativePath.slice(r.length));let c=yd([r,l.relativePath]),u=i.concat(l);s.children&&s.children.length>0&&(Va(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+c+'".')),t6(s.children,t,u,c)),!(s.path==null&&!s.index)&&t.push({path:c,score:L0e(c,s.index),routesMeta:u})};return e.forEach((s,n)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))a(s,n);else for(let l of i6(s.path))a(s,n,l)}),t}function i6(e){let t=e.split("/");if(t.length===0)return[];let[i,...r]=t,a=i.endsWith("?"),s=i.replace(/\?$/,"");if(r.length===0)return a?[s,""]:[s];let n=i6(r.join("/")),o=[];return o.push(...n.map(l=>l===""?s:[s,l].join("/"))),a&&o.push(...n),o.map(l=>e.startsWith("/")&&l===""?"/":l)}function M0e(e){e.sort((t,i)=>t.score!==i.score?i.score-t.score:k0e(t.routesMeta.map(r=>r.childrenIndex),i.routesMeta.map(r=>r.childrenIndex)))}const T0e=/^:[\w-]+$/,P0e=3,D0e=2,O0e=1,I0e=10,R0e=-2,KI=e=>e==="*";function L0e(e,t){let i=e.split("/"),r=i.length;return i.some(KI)&&(r+=R0e),t&&(r+=D0e),i.filter(a=>!KI(a)).reduce((a,s)=>a+(T0e.test(s)?P0e:s===""?O0e:I0e),r)}function k0e(e,t){return e.length===t.length&&e.slice(0,-1).every((r,a)=>r===t[a])?e[e.length-1]-t[t.length-1]:0}function z0e(e,t){let{routesMeta:i}=e,r={},a="/",s=[];for(let n=0;n<i.length;++n){let o=i[n],l=n===i.length-1,c=a==="/"?t:t.slice(a.length)||"/",u=N0e({path:o.relativePath,caseSensitive:o.caseSensitive,end:l},c);if(!u)return null;Object.assign(r,u.params);let h=o.route;s.push({params:r,pathname:yd([a,u.pathname]),pathnameBase:U0e(yd([a,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(a=yd([a,u.pathnameBase]))}return s}function N0e(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=B0e(e.path,e.caseSensitive,e.end),a=t.match(i);if(!a)return null;let s=a[0],n=s.replace(/(.)\/+$/,"$1"),o=a.slice(1);return{params:r.reduce((c,u,h)=>{let{paramName:d,isOptional:p}=u;if(d==="*"){let m=o[h]||"";n=s.slice(0,s.length-m.length).replace(/(.)\/+$/,"$1")}const f=o[h];return p&&!f?c[d]=void 0:c[d]=F0e(f||"",d),c},{}),pathname:s,pathnameBase:n,pattern:e}}function B0e(e,t,i){t===void 0&&(t=!1),i===void 0&&(i=!0),rM(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(n,o,l)=>(r.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,t?void 0:"i"),r]}function j0e(e){try{return decodeURI(e)}catch(t){return rM(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function F0e(e,t){try{return decodeURIComponent(e)}catch(i){return rM(!1,'The value for the URL param "'+t+'" will not be decoded because'+(' the string "'+e+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+i+").")),e}}function r6(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&r!=="/"?null:e.slice(i)||"/"}const yd=e=>e.join("/").replace(/\/\/+/g,"/"),U0e=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");function V0e(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const a6=["post","put","patch","delete"];new Set(a6);const G0e=["get",...a6];new Set(G0e);/**
 * React Router v6.21.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function e1(){return e1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},e1.apply(this,arguments)}const H0e=xe.createContext(null),W0e=xe.createContext(null),s6=xe.createContext(null),ax=xe.createContext(null),sx=xe.createContext({outlet:null,matches:[],isDataRoute:!1}),n6=xe.createContext(null);function aM(){return xe.useContext(ax)!=null}function q0e(){return aM()||Va(!1),xe.useContext(ax).location}function X0e(e,t){return Y0e(e,t)}function Y0e(e,t,i,r){aM()||Va(!1);let{navigator:a}=xe.useContext(s6),{matches:s}=xe.useContext(sx),n=s[s.length-1],o=n?n.params:{};n&&n.pathname;let l=n?n.pathnameBase:"/";n&&n.route;let c=q0e(),u;if(t){var h;let g=typeof t=="string"?rx(t):t;l==="/"||(h=g.pathname)!=null&&h.startsWith(l)||Va(!1),u=g}else u=c;let d=u.pathname||"/",p=l==="/"?d:d.slice(l.length)||"/",f=C0e(e,{pathname:p}),m=J0e(f&&f.map(g=>Object.assign({},g,{params:Object.assign({},o,g.params),pathname:yd([l,a.encodeLocation?a.encodeLocation(g.pathname).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?l:yd([l,a.encodeLocation?a.encodeLocation(g.pathnameBase).pathname:g.pathnameBase])})),s,i,r);return t&&m?xe.createElement(ax.Provider,{value:{location:e1({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Wl.Pop}},m):m}function Q0e(){let e=rye(),t=V0e(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return xe.createElement(xe.Fragment,null,xe.createElement("h2",null,"Unexpected Application Error!"),xe.createElement("h3",{style:{fontStyle:"italic"}},t),i?xe.createElement("pre",{style:a},i):null,null)}const Z0e=xe.createElement(Q0e,null);class K0e extends xe.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,i){return i.location!==t.location||i.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:i.error,location:i.location,revalidation:t.revalidation||i.revalidation}}componentDidCatch(t,i){console.error("React Router caught the following error during render",t,i)}render(){return this.state.error!==void 0?xe.createElement(sx.Provider,{value:this.props.routeContext},xe.createElement(n6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function $0e(e){let{routeContext:t,match:i,children:r}=e,a=xe.useContext(H0e);return a&&a.static&&a.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=i.route.id),xe.createElement(sx.Provider,{value:t},r)}function J0e(e,t,i,r){var a;if(t===void 0&&(t=[]),i===void 0&&(i=null),r===void 0&&(r=null),e==null){var s;if((s=i)!=null&&s.errors)e=i.matches;else return null}let n=e,o=(a=i)==null?void 0:a.errors;if(o!=null){let u=n.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id]));u>=0||Va(!1),n=n.slice(0,Math.min(n.length,u+1))}let l=!1,c=-1;if(i&&r&&r.v7_partialHydration)for(let u=0;u<n.length;u++){let h=n[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=u),h.route.id){let{loaderData:d,errors:p}=i,f=h.route.loader&&d[h.route.id]===void 0&&(!p||p[h.route.id]===void 0);if(h.route.lazy||f){l=!0,c>=0?n=n.slice(0,c+1):n=[n[0]];break}}}return n.reduceRight((u,h,d)=>{let p,f=!1,m=null,g=null;i&&(p=o&&h.route.id?o[h.route.id]:void 0,m=h.route.errorElement||Z0e,l&&(c<0&&d===0?(aye("route-fallback",!1),f=!0,g=null):c===d&&(f=!0,g=h.route.hydrateFallbackElement||null)));let v=t.concat(n.slice(0,d+1)),y=()=>{let x;return p?x=m:f?x=g:h.route.Component?x=xe.createElement(h.route.Component,null):h.route.element?x=h.route.element:x=u,xe.createElement($0e,{match:h,routeContext:{outlet:u,matches:v,isDataRoute:i!=null},children:x})};return i&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?xe.createElement(K0e,{location:i.location,revalidation:i.revalidation,component:m,error:p,children:y(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):y()},null)}var eA=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(eA||{});function eye(e){let t=xe.useContext(W0e);return t||Va(!1),t}function tye(e){let t=xe.useContext(sx);return t||Va(!1),t}function iye(e){let t=tye(),i=t.matches[t.matches.length-1];return i.route.id||Va(!1),i.route.id}function rye(){var e;let t=xe.useContext(n6),i=eye(eA.UseRouteError),r=iye(eA.UseRouteError);return t!==void 0?t:(e=i.errors)==null?void 0:e[r]}const $I={};function aye(e,t,i){!t&&!$I[e]&&($I[e]=!0)}function _l(e){Va(!1)}function sye(e){let{basename:t="/",children:i=null,location:r,navigationType:a=Wl.Pop,navigator:s,static:n=!1,future:o}=e;aM()&&Va(!1);let l=t.replace(/^\/*/,"/"),c=xe.useMemo(()=>({basename:l,navigator:s,static:n,future:e1({v7_relativeSplatPath:!1},o)}),[l,o,s,n]);typeof r=="string"&&(r=rx(r));let{pathname:u="/",search:h="",hash:d="",state:p=null,key:f="default"}=r,m=xe.useMemo(()=>{let g=r6(u,l);return g==null?null:{location:{pathname:g,search:h,hash:d,state:p,key:f},navigationType:a}},[l,u,h,d,p,f,a]);return m==null?null:xe.createElement(s6.Provider,{value:c},xe.createElement(ax.Provider,{children:i,value:m}))}function nye(e){let{children:t,location:i}=e;return X0e(tA(t),i)}new Promise(()=>{});function tA(e,t){t===void 0&&(t=[]);let i=[];return xe.Children.forEach(e,(r,a)=>{if(!xe.isValidElement(r))return;let s=[...t,a];if(r.type===xe.Fragment){i.push.apply(i,tA(r.props.children,s));return}r.type!==_l&&Va(!1),!r.props.index||!r.props.children||Va(!1);let n={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(n.children=tA(r.props.children,s)),i.push(n)}),i}/**
 * React Router DOM v6.21.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const oye="startTransition",JI=w0[oye];function lye(e){let{basename:t,children:i,future:r,window:a}=e,s=xe.useRef();s.current==null&&(s.current=S0e({window:a,v5Compat:!0}));let n=s.current,[o,l]=xe.useState({action:n.action,location:n.location}),{v7_startTransition:c}=r||{},u=xe.useCallback(h=>{c&&JI?JI(()=>l(h)):l(h)},[l,c]);return xe.useLayoutEffect(()=>n.listen(u),[n,u]),xe.createElement(sye,{basename:t,children:i,location:o.location,navigationType:o.action,navigator:n,future:r})}var eR;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(eR||(eR={}));var tR;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(tR||(tR={}));function vu(){}function cye(){return!0}function ef(e){return!!(e||"").match(/\d/)}function iR(e){return e==null}function rR(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function hye(e){switch(e){case"lakh":return/(\d+?)(?=(\d\d)+(\d)(?!\d))(\.\d+)?/g;case"wan":return/(\d)(?=(\d{4})+(?!\d))/g;case"thousand":default:return/(\d)(?=(\d{3})+(?!\d))/g}}function uye(e,t,i){var r=hye(i),a=e.search(/[1-9]/);return a=a===-1?e.length:a,e.substring(0,a)+e.substring(a,e.length).replace(r,"$1"+t)}function iA(e,t){t===void 0&&(t=!0);var i=e[0]==="-",r=i&&t;e=e.replace("-","");var a=e.split("."),s=a[0],n=a[1]||"";return{beforeDecimal:s,afterDecimal:n,hasNagation:i,addNegation:r}}function dye(e){if(!e)return e;var t=e[0]==="-";t&&(e=e.substring(1,e.length));var i=e.split("."),r=i[0].replace(/^0+/,"")||"0",a=i[1]||"";return(t?"-":"")+r+(a?"."+a:"")}function o6(e,t,i){for(var r="",a=i?"0":"",s=0;s<=t-1;s++)r+=e[s]||a;return r}function aR(e,t){return Array(t+1).join(e)}function pye(e){e+="";var t=e[0]==="-"?"-":"";t&&(e=e.substring(1));var i=e.split(/[eE]/g),r=i[0],a=i[1];if(a=Number(a),!a)return t+r;r=r.replace(".","");var s=1+a,n=r.length;return s<0?r="0."+aR("0",Math.abs(s))+r:s>=n?r=r+aR("0",s-n):r=(r.substring(0,s)||"0")+"."+r.substring(s),t+r}function fye(e,t,i){if(["","-"].indexOf(e)!==-1)return e;var r=e.indexOf(".")!==-1&&t,a=iA(e),s=a.beforeDecimal,n=a.afterDecimal,o=a.hasNagation,l=parseFloat("0."+(n||"0")),c=n.length<=t?"0."+n:l.toFixed(t),u=c.split("."),h=s.split("").reverse().reduce(function(m,g,v){return m.length>v?(Number(m[0])+Number(g)).toString()+m.substring(1,m.length):g+m},u[0]),d=o6(u[1]||"",Math.min(t,n.length),i),p=o?"-":"",f=r?".":"";return""+p+h+f+d}function sR(e,t){if(e.value=e.value,e!==null){if(e.createTextRange){var i=e.createTextRange();return i.move("character",t),i.select(),!0}return e.selectionStart||e.selectionStart===0?(e.focus(),e.setSelectionRange(t,t),!0):(e.focus(),!1)}}function mye(e,t){for(var i=0,r=0,a=e.length,s=t.length;e[i]===t[i]&&i<a;)i++;for(;e[a-1-r]===t[s-1-r]&&s-r>i&&a-r>i;)r++;return{start:i,end:a-r}}function qw(e,t,i){return Math.min(Math.max(e,t),i)}function nR(e){return Math.max(e.selectionStart,e.selectionEnd)}function gye(e){return e||typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function vye(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)===-1&&(i[r]=e[r]);return i}var yye={displayType:"input",decimalSeparator:".",thousandsGroupStyle:"thousand",fixedDecimalScale:!1,prefix:"",suffix:"",allowNegative:!0,allowEmptyFormatting:!1,allowLeadingZeros:!1,isNumericString:!1,type:"text",onValueChange:vu,onChange:vu,onKeyDown:vu,onMouseUp:vu,onFocus:vu,onBlur:vu,isAllowed:cye},l6=function(e){function t(i){e.call(this,i);var r=i.defaultValue;this.validateProps();var a=this.formatValueProp(r);this.state={value:a,numAsString:this.removeFormatting(a),mounted:!1},this.selectionBeforeInput={selectionStart:0,selectionEnd:0},this.onChange=this.onChange.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){this.setState({mounted:!0})},t.prototype.componentDidUpdate=function(r){this.updateValueIfRequired(r)},t.prototype.componentWillUnmount=function(){clearTimeout(this.focusTimeout),clearTimeout(this.caretPositionTimeout)},t.prototype.updateValueIfRequired=function(r){var a=this,s=a.props,n=a.state,o=a.focusedElm,l=n.value,c=n.numAsString;if(c===void 0&&(c=""),r!==s){this.validateProps();var u=this.formatNumString(c),h=iR(s.value)?u:this.formatValueProp(),d=this.removeFormatting(h),p=parseFloat(d),f=parseFloat(c);((!isNaN(p)||!isNaN(f))&&p!==f||u!==l||o===null&&h!==l)&&this.updateValue({formattedValue:h,numAsString:d,input:o,source:"prop",event:null})}},t.prototype.getFloatString=function(r){r===void 0&&(r="");var a=this.props,s=a.decimalScale,n=this.getSeparators(),o=n.decimalSeparator,l=this.getNumberRegex(!0),c=r[0]==="-";c&&(r=r.replace("-","")),o&&s===0&&(r=r.split(o)[0]),r=(r.match(l)||[]).join("").replace(o,".");var u=r.indexOf(".");return u!==-1&&(r=r.substring(0,u)+"."+r.substring(u+1,r.length).replace(new RegExp(rR(o),"g"),"")),c&&(r="-"+r),r},t.prototype.getNumberRegex=function(r,a){var s=this.props,n=s.format,o=s.decimalScale,l=s.customNumerals,c=this.getSeparators(),u=c.decimalSeparator;return new RegExp("[0-9"+(l?l.join(""):"")+"]"+(u&&o!==0&&!a&&!n?"|"+rR(u):""),r?"g":void 0)},t.prototype.getSeparators=function(){var r=this.props,a=r.decimalSeparator,s=this.props,n=s.thousandSeparator,o=s.allowedDecimalSeparators;return n===!0&&(n=","),o||(o=[a,"."]),{decimalSeparator:a,thousandSeparator:n,allowedDecimalSeparators:o}},t.prototype.getMaskAtIndex=function(r){var a=this.props,s=a.mask;return s===void 0&&(s=" "),typeof s=="string"?s:s[r]||" "},t.prototype.getValueObject=function(r,a){var s=parseFloat(a);return{formattedValue:r,value:a,floatValue:isNaN(s)?void 0:s}},t.prototype.validateProps=function(){var r=this.props,a=r.mask,s=this.getSeparators(),n=s.decimalSeparator,o=s.thousandSeparator;if(n===o)throw new Error(`
          Decimal separator can't be same as thousand separator.
          thousandSeparator: `+o+` (thousandSeparator = {true} is same as thousandSeparator = ",")
          decimalSeparator: `+n+` (default value for decimalSeparator is .)
       `);if(a){var l=a==="string"?a:a.toString();if(l.match(/\d/g))throw new Error(`
          Mask `+a+` should not contain numeric character;
        `)}},t.prototype.setPatchedCaretPosition=function(r,a,s){sR(r,a),this.caretPositionTimeout=setTimeout(function(){r.value===s&&sR(r,a)},0)},t.prototype.correctCaretPosition=function(r,a,s){var n=this.props,o=n.prefix,l=n.suffix,c=n.format;if(r==="")return 0;if(a=qw(a,0,r.length),!c){var u=r[0]==="-";return qw(a,o.length+(u?1:0),r.length-l.length)}if(typeof c=="function"||c[a]==="#"&&ef(r[a])||c[a-1]==="#"&&ef(r[a-1]))return a;var h=c.indexOf("#"),d=c.lastIndexOf("#");a=qw(a,h,d+1);for(var p=c.substring(a,c.length).indexOf("#"),f=a,m=a+(p===-1?0:p);f>h&&(c[f]!=="#"||!ef(r[f]));)f-=1;var g=!ef(r[m])||s==="left"&&a!==h||a-f<m-a;return g?ef(r[f])?f+1:f:m},t.prototype.getCaretPosition=function(r,a,s){var n=this.props,o=n.format,l=this.state.value,c=this.getNumberRegex(!0),u=(r.match(c)||[]).join(""),h=(a.match(c)||[]).join(""),d,p;for(d=0,p=0;p<s;p++){var f=r[p]||"",m=a[d]||"";if(!(!f.match(c)&&f!==m)&&!(f==="0"&&m.match(c)&&m!=="0"&&u.length!==h.length)){for(;f!==a[d]&&d<a.length;)d++;d++}}return typeof o=="string"&&!l&&(d=a.length),d=this.correctCaretPosition(a,d),d},t.prototype.removePrefixAndSuffix=function(r){var a=this.props,s=a.format,n=a.prefix,o=a.suffix;if(!s&&r){var l=r[0]==="-";l&&(r=r.substring(1,r.length)),r=n&&r.indexOf(n)===0?r.substring(n.length,r.length):r;var c=r.lastIndexOf(o);r=o&&c!==-1&&c===r.length-o.length?r.substring(0,c):r,l&&(r="-"+r)}return r},t.prototype.removePatternFormatting=function(r){for(var a=this.props,s=a.format,n=s.split("#").filter(function(p){return p!==""}),o=0,l="",c=0,u=n.length;c<=u;c++){var h=n[c]||"",d=c===u?r.length:r.indexOf(h,o);if(d===-1){l=r;break}else l+=r.substring(o,d),o=d+h.length}return(l.match(this.getNumberRegex(!0))||[]).join("")},t.prototype.removeFormatting=function(r){var a=this.props,s=a.format,n=a.removeFormatting;return r&&(s?typeof s=="string"?r=this.removePatternFormatting(r):typeof n=="function"?r=n(r):r=(r.match(this.getNumberRegex(!0))||[]).join(""):(r=this.removePrefixAndSuffix(r),r=this.getFloatString(r)),r)},t.prototype.formatWithPattern=function(r){for(var a=this.props,s=a.format,n=0,o=s.split(""),l=0,c=s.length;l<c;l++)s[l]==="#"&&(o[l]=r[n]||this.getMaskAtIndex(n),n+=1);return o.join("")},t.prototype.formatAsNumber=function(r){var a=this.props,s=a.decimalScale,n=a.fixedDecimalScale,o=a.prefix,l=a.suffix,c=a.allowNegative,u=a.thousandsGroupStyle,h=this.getSeparators(),d=h.thousandSeparator,p=h.decimalSeparator,f=r.indexOf(".")!==-1||s&&n,m=iA(r,c),g=m.beforeDecimal,v=m.afterDecimal,y=m.addNegation;return s!==void 0&&(v=o6(v,s,n)),d&&(g=uye(g,d,u)),o&&(g=o+g),l&&(v=v+l),y&&(g="-"+g),r=g+(f&&p||"")+v,r},t.prototype.formatNumString=function(r){r===void 0&&(r="");var a=this.props,s=a.format,n=a.allowEmptyFormatting,o=a.customNumerals,l=r;if(o&&o.length===10){var c=new RegExp("["+o.join("")+"]","g");l=r.replace(c,function(u){return o.indexOf(u).toString()})}return r===""&&!n?l="":r==="-"&&!s?l="-":typeof s=="string"?l=this.formatWithPattern(l):typeof s=="function"?l=s(l):l=this.formatAsNumber(l),l},t.prototype.formatValueProp=function(r){var a=this.props,s=a.format,n=a.decimalScale,o=a.fixedDecimalScale,l=a.allowEmptyFormatting,c=this.props,u=c.value,h=c.isNumericString;u=iR(u)?r:u;var d=!u&&u!==0;if(d&&l&&(u=""),d&&!l)return"";typeof u=="number"&&(u=pye(u),h=!0),u==="Infinity"&&h&&(u=""),h&&!s&&typeof n=="number"&&(u=fye(u,n,o));var p=h?this.formatNumString(u):this.formatInput(u);return p},t.prototype.formatNegation=function(r){r===void 0&&(r="");var a=this.props,s=a.allowNegative,n=new RegExp("(-)"),o=new RegExp("(-)(.)*(-)"),l=n.test(r),c=o.test(r);return r=r.replace(/-/g,""),l&&!c&&s&&(r="-"+r),r},t.prototype.formatInput=function(r){r===void 0&&(r="");var a=this.props,s=a.format;return s||(r=this.removePrefixAndSuffix(r),r=this.formatNegation(r)),r=this.removeFormatting(r),this.formatNumString(r)},t.prototype.isCharacterAFormat=function(r,a){var s=this.props,n=s.format,o=s.prefix,l=s.suffix,c=s.decimalScale,u=s.fixedDecimalScale,h=this.getSeparators(),d=h.decimalSeparator;return!!(typeof n=="string"&&n[r]!=="#"||!n&&(r<o.length||r>=a.length-l.length||c&&u&&a[r]===d))},t.prototype.correctInputValue=function(r,a,s){var n=this,o=this.props,l=o.format,c=o.allowNegative,u=o.prefix,h=o.suffix,d=o.decimalScale,p=this.getSeparators(),f=p.allowedDecimalSeparators,m=p.decimalSeparator,g=this.state.numAsString||"",v=this.selectionBeforeInput,y=v.selectionStart,x=v.selectionEnd,w=mye(a,s),S=w.start,_=w.end;if(!l&&S===_&&f.indexOf(s[y])!==-1){var A=d===0?"":m;return s.substr(0,y)+A+s.substr(y+1,s.length)}var E=l?0:u.length,M=a.length-(l?0:h.length);if(s.length>a.length||!s.length||S===_||y===0&&x===a.length||S===0&&_===a.length||y===E&&x===M)return s;var C=a.substr(S,_-S),T=!![].concat(C).find(function(U,H){return n.isCharacterAFormat(H+S,a)});if(T){var D=a.substr(S),I={},O=[];[].concat(D).forEach(function(U,H){n.isCharacterAFormat(H+S,a)?I[H]=U:H>C.length-1&&O.push(U)}),Object.keys(I).forEach(function(U){O.length>U?O.splice(U,0,I[U]):O.push(I[U])}),s=a.substr(0,S)+O.join("")}if(!l){var B=this.removeFormatting(s),q=iA(B,c),F=q.beforeDecimal,L=q.afterDecimal,X=q.addNegation,G=r<s.indexOf(m)+1;if(B.length<g.length&&G&&F===""&&!parseFloat(L))return X?"-":""}return s},t.prototype.updateValue=function(r){var a=r.formattedValue,s=r.input,n=r.setCaretPosition;n===void 0&&(n=!0);var o=r.source,l=r.event,c=r.numAsString,u=r.caretPos,h=this.props,d=h.onValueChange,p=this.state,f=p.value;if(s){if(u===void 0&&n){var m=r.inputValue||s.value,g=nR(s);s.value=a,u=this.getCaretPosition(m,a,g)}s.value=a,n&&this.setPatchedCaretPosition(s,u,a)}c===void 0&&(c=this.removeFormatting(a)),a!==f&&(this.setState({value:a,numAsString:c}),d(this.getValueObject(a,c),{event:l,source:o}))},t.prototype.onChange=function(r){var a=r.target,s=a.value,n=this,o=n.state,l=n.props,c=l.isAllowed,u=o.value||"",h=nR(a);s=this.correctInputValue(h,u,s);var d=this.formatInput(s)||"",p=this.removeFormatting(d),f=this.getValueObject(d,p),m=c(f);m||(d=u),this.updateValue({formattedValue:d,numAsString:p,inputValue:s,input:a,event:r,source:"event"}),m&&l.onChange(r)},t.prototype.onBlur=function(r){var a=this,s=a.props,n=a.state,o=s.format,l=s.onBlur,c=s.allowLeadingZeros,u=n.numAsString,h=n.value;if(this.focusedElm=null,clearTimeout(this.focusTimeout),clearTimeout(this.caretPositionTimeout),!o){isNaN(parseFloat(u))&&(u=""),c||(u=dye(u));var d=this.formatNumString(u);if(d!==h){this.updateValue({formattedValue:d,numAsString:u,input:r.target,setCaretPosition:!1,event:r,source:"event"}),l(r);return}}l(r)},t.prototype.onKeyDown=function(r){var a=r.target,s=r.key,n=a.selectionStart,o=a.selectionEnd,l=a.value;l===void 0&&(l="");var c,u=this.props,h=u.decimalScale,d=u.fixedDecimalScale,p=u.prefix,f=u.suffix,m=u.format,g=u.onKeyDown,v=h!==void 0&&d,y=this.getNumberRegex(!1,v),x=new RegExp("-"),w=typeof m=="string";if(this.selectionBeforeInput={selectionStart:n,selectionEnd:o},s==="ArrowLeft"||s==="Backspace"?c=n-1:s==="ArrowRight"?c=n+1:s==="Delete"&&(c=n),c===void 0||n!==o){g(r);return}var S=c,_=w?m.indexOf("#"):p.length,A=w?m.lastIndexOf("#")+1:l.length-f.length;if(s==="ArrowLeft"||s==="ArrowRight"){var E=s==="ArrowLeft"?"left":"right";S=this.correctCaretPosition(l,c,E)}else if(s==="Delete"&&!y.test(l[c])&&!x.test(l[c]))for(;!y.test(l[S])&&S<A;)S++;else if(s==="Backspace"&&!y.test(l[c])){if(n<=_+1&&l[0]==="-"&&typeof m>"u"){var M=l.substring(1);this.updateValue({formattedValue:M,caretPos:S,input:a,event:r,source:"event"})}else if(!x.test(l[c])){for(;!y.test(l[S-1])&&S>_;)S--;S=this.correctCaretPosition(l,S,"left")}}(S!==c||c<_||c>A)&&(r.preventDefault(),this.setPatchedCaretPosition(a,S,l)),r.isUnitTestRun&&this.setPatchedCaretPosition(a,S,l),g(r)},t.prototype.onMouseUp=function(r){var a=r.target,s=a.selectionStart,n=a.selectionEnd,o=a.value;if(o===void 0&&(o=""),s===n){var l=this.correctCaretPosition(o,s);l!==s&&this.setPatchedCaretPosition(a,l,o)}this.props.onMouseUp(r)},t.prototype.onFocus=function(r){var a=this;r.persist(),this.focusedElm=r.target,this.focusTimeout=setTimeout(function(){var s=r.target,n=s.selectionStart,o=s.selectionEnd,l=s.value;l===void 0&&(l="");var c=a.correctCaretPosition(l,n);c!==n&&!(n===0&&o===l.length)&&a.setPatchedCaretPosition(s,c,l),a.props.onFocus(r)},0)},t.prototype.render=function(){var r=this.props,a=r.type,s=r.displayType,n=r.customInput,o=r.renderText,l=r.getInputRef,c=r.format;r.thousandSeparator,r.decimalSeparator,r.allowedDecimalSeparators,r.thousandsGroupStyle,r.decimalScale,r.fixedDecimalScale,r.prefix,r.suffix,r.removeFormatting,r.mask,r.defaultValue,r.isNumericString,r.allowNegative,r.allowEmptyFormatting,r.allowLeadingZeros,r.onValueChange,r.isAllowed,r.customNumerals,r.onChange,r.onKeyDown,r.onMouseUp,r.onFocus,r.onBlur,r.value;var u=vye(r,["type","displayType","customInput","renderText","getInputRef","format","thousandSeparator","decimalSeparator","allowedDecimalSeparators","thousandsGroupStyle","decimalScale","fixedDecimalScale","prefix","suffix","removeFormatting","mask","defaultValue","isNumericString","allowNegative","allowEmptyFormatting","allowLeadingZeros","onValueChange","isAllowed","customNumerals","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value"]),h=u,d=this.state,p=d.value,f=d.mounted,m=f&&gye(c)?"numeric":void 0,g=Object.assign({inputMode:m},h,{type:a,value:p,onChange:this.onChange,onKeyDown:this.onKeyDown,onMouseUp:this.onMouseUp,onFocus:this.onFocus,onBlur:this.onBlur});if(s==="text")return o?o(p,h)||null:zc.createElement("span",Object.assign({},h,{ref:l}),p);if(n){var v=n;return zc.createElement(v,Object.assign({},g,{ref:l}))}return zc.createElement("input",Object.assign({},g,{ref:l}))},t}(zc.Component);l6.defaultProps=yye;const xye=e=>b.jsx(l6,{value:e,displayType:"text",thousandSeparator:!0}),bye=()=>{const[e,t]=xe.useState(0);return xe.useEffect(async i=>{await fetch("https://api.coingecko.com/api/v3/simple/price?ids=egoras-credit&vs_currencies=usd&include_market_cap=false&include_24hr_vol=false&include_24hr_change=true&include_last_updated_at=true").then(a=>a.json()).then(a=>{const s=a["egoras-credit"].usd;console.log(s),t(s==="0"?"0":s)})},[]),b.jsxs("div",{className:"egox_token_div",children:[b.jsxs("section",{className:"egox_token_div_section1",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"egox_token_div_section1area",children:[b.jsxs("div",{className:"egox_token_div_section1area_cont1",children:[b.jsxs("div",{className:"egox_token_div_section1area1",children:[b.jsx("div",{className:"egox_token_div_section1area1_title",children:"Egochain (EGC) coin"}),b.jsx("div",{className:"egox_token_div_section1area1_para",children:"A Powerhouse for Innovation."})]}),b.jsx("div",{className:"egox_token_div_section1area2",children:b.jsx("img",{src:"/img/1_inch_token_image_dummy.png",alt:"",className:"egox_token_div_section1area2_img"})})]}),b.jsxs("div",{className:"egox_token_div_section1area_cont2",children:[b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsxs("div",{className:"home_div_section1_area_stats_div1_title",children:["$",e]}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Current Price"})]}),b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsx("div",{className:"home_div_section1_area_stats_div1_title",children:"74k"}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Circulating Supply"})]}),b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsxs("div",{className:"home_div_section1_area_stats_div1_title",children:["$",xye((e*74467.35244).toFixed(2))]}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Market Cap"})]}),b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsx("div",{className:"home_div_section1_area_stats_div1_title",children:"35k"}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Holders"})]})]})]})}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"})]}),b.jsxs("section",{className:"egox_token_div_section2",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"egox_token_div_section2_area",children:[b.jsx("div",{className:"egox_token_div_section2_area_title",children:"EGC Utility"}),b.jsx("div",{className:"home_div_section3_area_body_paragraph",children:"Egochain offers a compelling blend of democratic governance and token scarcity. EGC holders directly influence the platform's trajectory through their votes for the Egochain Committee, a community-driven body responsible for the blockchain's stability and performance. Composed of elected members and consensus nodes, this committee ensures network liveliness and optimizes critical parameters. Additionally, EGC's indivisible units and limited total supply (74,467.35244 EGC) contribute to its distinct scarcity, enhancing its value proposition within the blockchain ecosystem."})]})}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"})]})]})};var sM={},wye=ao;Object.defineProperty(sM,"__esModule",{value:!0});var c6=sM.default=void 0,_ye=wye(so()),Sye=b;c6=sM.default=(0,_ye.default)((0,Sye.jsx)("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu");var nM={},Aye=ao;Object.defineProperty(nM,"__esModule",{value:!0});var h6=nM.default=void 0,Eye=Aye(so()),Cye=b;h6=nM.default=(0,Eye.default)((0,Cye.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");var oM={},Mye=ao;Object.defineProperty(oM,"__esModule",{value:!0});var Qc=oM.default=void 0,Tye=Mye(so()),Pye=b;Qc=oM.default=(0,Tye.default)((0,Pye.jsx)("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"CallMade");const Dye=()=>{const[e,t]=xe.useState(!1),i=()=>{t(!e)};return b.jsxs("div",{className:"header_div",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"header_div_area",children:[b.jsxs("a",{href:"/",className:"header_div_area_1",children:[b.jsx("img",{src:"/img/egax_logo.png",alt:"",className:"header_div_area_1_img"}),"Egochain"]}),b.jsxs("div",{className:"header_div_area_2",children:[b.jsxs("a",{href:"https://github.com/EgorasMarket",className:"header_div_area_2_link1",target:"_blank",children:["Developer",b.jsx(Qc,{className:"header_div_area_2_link1_icon"})]}),b.jsx("a",{href:"/egax/coin/info",className:"header_div_area_2_link1",children:"EGAX Coin"}),b.jsx("a",{href:"/egc/coin/info",className:"header_div_area_2_link1",children:"EGC Coin"}),b.jsx("a",{href:"/about",className:"header_div_area_2_link1",children:"About"}),b.jsx("a",{href:"/whitepaper",className:"header_div_area_2_link1",children:"Whitepaper"}),b.jsxs("a",{href:"https://egodao.org/",className:"header_div_area_2_link1",target:"_blank",children:["Stake",b.jsx(Qc,{className:"header_div_area_2_link1_icon"})]}),b.jsx(c6,{className:"header_div_area_2_menu_icon",onClick:i})]})]})}),e?b.jsx("div",{className:"headerMenuDiv",children:b.jsxs("div",{className:"headerMenuDiv_cont",children:[b.jsx("div",{className:"headerMenuDiv_cont_1",children:b.jsx(h6,{className:"headerMenuDiv_cont_1_icon",onClick:i})}),b.jsxs("div",{className:"headerMenuDiv_cont_body",children:[b.jsxs("a",{href:"https://github.com/EgorasMarket",target:"_blank",className:"headerMenuDiv_cont_body_link1",children:[" ","Developer",b.jsx(Qc,{className:"header_div_area_2_link1_icon"})]}),b.jsx("a",{href:"/egax/coin/info",className:"headerMenuDiv_cont_body_link1",children:"EGAX Coin"}),b.jsx("a",{href:"/egc/coin/info",className:"headerMenuDiv_cont_body_link1",children:"EGC Coin"}),b.jsx("a",{href:"/about",className:"headerMenuDiv_cont_body_link1",children:"About"}),b.jsx("a",{href:"/whitepaper",className:"headerMenuDiv_cont_body_link1",children:"White paper"}),b.jsxs("a",{href:"https://egodao.org/",className:"headerMenuDiv_cont_body_link1",target:"_blank",children:[" ","Stake",b.jsx(Qc,{className:"header_div_area_2_link1_icon"})]})]})]})}):null]})};var lM={},Oye=ao;Object.defineProperty(lM,"__esModule",{value:!0});var u6=lM.default=void 0;Lye(xe);var Iye=Oye(so()),Rye=b;function d6(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(d6=function(r){return r?i:t})(e)}function Lye(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||typeof e!="object"&&typeof e!="function")return{default:e};var i=d6(t);if(i&&i.has(e))return i.get(e);var r={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(s!=="default"&&Object.prototype.hasOwnProperty.call(e,s)){var n=a?Object.getOwnPropertyDescriptor(e,s):null;n&&(n.get||n.set)?Object.defineProperty(r,s,n):r[s]=e[s]}return r.default=e,i&&i.set(e,r),r}u6=lM.default=(0,Iye.default)((0,Rye.jsx)("path",{d:"M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"}),"Twitter");const kye=()=>{const[e,t]=xe.useState(new Date().getFullYear());return xe.useEffect(()=>{const i=setInterval(()=>{t(new Date().getFullYear())},1e3);return()=>clearInterval(i)},[]),b.jsx("div",{className:"footerDiv",id:"footer",children:b.jsx("div",{className:"container",children:b.jsxs("div",{className:"footerDivArea",children:[b.jsxs("div",{className:"footerDiv1",children:[b.jsxs("div",{className:"footerDiv1_area1",children:[b.jsxs("div",{className:"footerDiv1_area1_cont1",children:[b.jsx("img",{src:"/img/egax_logo.png",alt:"",className:"footerDiv1_img2"}),"Egochain"]}),b.jsx("div",{className:"footerDiv1_area1_cont2",children:b.jsxs("div",{className:"footerDiv1_area1_cont2_links",children:[b.jsxs("a",{href:"https://twitter.com/egorasHQ?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor",className:"footerDiv1_area1_cont2_links_link_tel",target:"_blank",children:[b.jsx(u6,{className:"footerDiv1_area1_cont2_links_link1"})," "]}),b.jsxs("a",{href:"https://t.me/s/egorasmarket?before=480",className:"footerDiv1_area1_cont2_links_link_tel",target:"_blank",children:[b.jsx(KC,{className:"footerDiv1_area1_cont2_links_link1"})," "]}),b.jsxs("a",{href:"https://github.com/EgorasMarket",className:"footerDiv1_area1_cont2_links_link_tel",target:"_blank",children:[b.jsx(tM,{className:"footerDiv1_area1_cont2_links_link1"})," "]}),b.jsxs("a",{href:"https://www.youtube.com/channel/UCHfi5EwXig46xp5Dx8hVBHQ",className:"footerDiv1_area1_cont2_links_link_tel",target:"_blank",children:[b.jsx(JC,{className:"footerDiv1_area1_cont2_links_link1"})," "]})]})})]}),b.jsxs("div",{className:"footerDiv1_area2",children:[b.jsxs("div",{className:"footerDiv1_area2_cont1",children:[b.jsx("div",{className:"footerDiv1_area2_title",children:"Eco-System"}),b.jsxs("div",{className:"footerDiv1_area2_title_subLinks_div",children:[b.jsx("a",{href:"/egax/coin/info",className:"footerDiv1_area2_title_subLinks_div_link1",children:"EGAX Coin"}),b.jsx("a",{href:"/egc/coin/info",className:"footerDiv1_area2_title_subLinks_div_link1",children:"EGC Coin"}),b.jsxs("a",{href:"https://github.com/EgorasMarket",className:"footerDiv1_area2_title_subLinks_div_link1",target:"_blank",children:["Developer",b.jsx(Qc,{className:"header_div_area_2_link1_icon"})]}),b.jsxs("a",{href:"https://egodao.org/",className:"footerDiv1_area2_title_subLinks_div_link1",target:"_blank",children:["Stake",b.jsx(Qc,{className:"header_div_area_2_link1_icon"})]})]})]}),b.jsxs("div",{className:"footerDiv1_area2_cont1",children:[b.jsx("div",{className:"footerDiv1_area2_title",children:"Docs"}),b.jsxs("div",{className:"footerDiv1_area2_title_subLinks_div",children:[b.jsx("a",{href:"/about",className:"footerDiv1_area2_title_subLinks_div_link1",children:"About"}),b.jsx("a",{href:"/whitepaper",className:"footerDiv1_area2_title_subLinks_div_link1",children:"White paper"}),b.jsx("a",{href:"/privacy",className:"footerDiv1_area2_title_subLinks_div_link1",children:"Privacy Policy"}),b.jsx("a",{href:"/terms",className:"footerDiv1_area2_title_subLinks_div_link1",children:"Terms & conditions"})]})]}),b.jsxs("div",{className:"footerDiv1_area2_cont1",children:[b.jsx("div",{className:"footerDiv1_area2_title",children:"Need Help?"}),b.jsx("div",{className:"footerDiv1_area2_title_subLinks_div",children:b.jsx("a",{href:"mailto:support@egoras.com",className:"footerDiv1_area2_title_subLinks_div_link1",target:"_blank",children:"support@egochain.com"})})]})]})]}),b.jsx("hr",{className:"footer_hr"}),b.jsxs("div",{className:"footer_lastDiv",children:["© ",e," Egochain.org"]})]})})})},zye=()=>b.jsxs("div",{className:"roadMapDiv",children:[" ",b.jsx("section",{className:"roadmap",children:b.jsx("div",{className:"section-timeline-4",children:b.jsx("div",{className:"containercool-2",children:b.jsxs("div",{className:"timeline_wrappercool-2",children:[b.jsx("div",{className:"timeline_progresscool",children:b.jsx("div",{className:"timeline_progress-barcool"})}),b.jsxs("div",{"data-w-id":"046baf0c-9b4c-ea28-05a2-50fd0f70aa61",className:"timeline_item-2",children:[b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa62-718776cd",className:"timeline_left",children:b.jsx("div",{className:"timeline_date-text",children:"Q1 2024"})}),b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa65-718776cd",className:"timeline_centre",children:b.jsx("div",{className:"timeline_circle"})}),b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa67-718776cd",className:"timeline_right",children:b.jsx("div",{className:"margin-bottom-xlarge",children:b.jsxs("div",{className:"timeline_text-2",children:["* Onboard 5,000 stakers to EgoDAO.",b.jsx("br",{}),b.jsx("br",{}),"* Launch of the Egoras Electric Vehicle (APEX).",b.jsx("br",{}),b.jsx("br",{}),"* Distribute EGAX block rewards to EgoDAO stakers.",b.jsx("br",{}),b.jsx("br",{}),"* Secure listing on a Tier 2 exchange.",b.jsx("br",{}),b.jsx("br",{}),"* Sell 250 tricycles through EgoPay using EGAX"]})})})]}),b.jsxs("div",{"data-w-id":"046baf0c-9b4c-ea28-05a2-50fd0f70aa89",className:"timeline_item-2",children:[b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa8a-718776cd",className:"timeline_left",children:b.jsx("div",{className:"timeline_date-text",children:"Q2 2024"})}),b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa8d-718776cd",className:"timeline_centre",children:b.jsx("div",{className:"timeline_circle"})}),b.jsx("div",{className:"timeline_right",children:b.jsx("div",{className:"margin-bottom-medium-2",children:b.jsxs("div",{className:"timeline_text-2",children:["* Accumulate 50,000 Twitter followers.",b.jsx("br",{}),b.jsx("br",{}),"* Reach 30,000 Telegram followers.",b.jsx("br",{}),b.jsx("br",{}),"* Achieve 25,000 downloads of the EgoPay app.",b.jsx("br",{}),b.jsx("br",{}),"* Increase EGC & EGAX daily volume to 500,000 USD.",b.jsx("br",{}),b.jsx("br",{}),"* Begin mass production of the Egoras Electric Vehicle (APEX).",b.jsx("br",{}),b.jsx("br",{}),"* Sell 300 tricycles through EgoPay using EGC & EGAX."]})})})]}),b.jsxs("div",{"data-w-id":"046baf0c-9b4c-ea28-05a2-50fd0f70aa97",className:"timeline_item-2",children:[b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa98-718776cd",className:"timeline_left",children:b.jsx("div",{className:"timeline_date-text",children:"Q3 2024"})}),b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aa9b-718776cd",className:"timeline_centre",children:b.jsx("div",{className:"timeline_circle"})}),b.jsx("div",{className:"timeline_right",children:b.jsx("div",{className:"margin-bottom-medium-2",children:b.jsxs("div",{className:"timeline_text-2",children:["* Sell 100 Egoras Electric Vehicles (APEX) using EGC & EGAX through EgoPay.",b.jsx("br",{}),b.jsx("br",{}),"* Secure listings for EGC & EGAX on multiple Tier 2 exchanges.",b.jsx("br",{}),b.jsx("br",{}),"* Open 20 electric vehicle charging stations (charging fees payable with EGC & EGAX through EgoPay).",b.jsx("br",{}),b.jsx("br",{}),"* Grow Twitter following to 70,000.",b.jsx("br",{}),b.jsx("br",{}),"* Sell 500 tricycles using EGC & EGAX through EgoPay."]})})})]}),b.jsxs("div",{"data-w-id":"046baf0c-9b4c-ea28-05a2-50fd0f70aaa4",className:"timeline_item-2",children:[b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aaa5-718776cd",className:"timeline_left",children:b.jsx("div",{className:"timeline_date-text",children:"Q4 2024"})}),b.jsx("div",{id:"w-node-_046baf0c-9b4c-ea28-05a2-50fd0f70aaa8-718776cd",className:"timeline_centre",children:b.jsx("div",{className:"timeline_circle"})}),b.jsx("div",{className:"timeline_right",children:b.jsx("div",{className:"margin-bottom-medium-2",children:b.jsx("div",{className:"margin-bottom-medium-2",children:b.jsxs("div",{className:"timeline_text-2",children:["* Open 40 additional electric vehicle charging stations (charging fees payable with EGC & EGAX through EgoPay).",b.jsx("br",{}),b.jsx("br",{}),"* Sell 500 tricycles using EGC & EGAX through EgoPay.",b.jsx("br",{}),b.jsx("br",{}),"* Achieve 100,000 downloads of the EgoPay app.",b.jsx("br",{}),b.jsx("br",{}),"* Sell 400 Egoras Electric Vehicles (APEX) using EGC & EGAX through EgoPay.",b.jsx("br",{}),b.jsx("br",{}),"* Secure a listing on a Tier 1 exchange."]})})})})]}),b.jsx("div",{className:"overlay-fade-bottom-2"}),b.jsx("div",{className:"overlay-fade-top-2"})]})})})})]}),Nye=()=>b.jsxs(b.Fragment,{children:[b.jsxs("section",{className:"egox_token_div_section1",children:[b.jsx("div",{className:"container",children:b.jsx("div",{className:"egox_token_div_section1area",children:b.jsxs("div",{className:"egox_token_div_section1area_cont1",children:[b.jsxs("div",{className:"egox_token_div_section1area1",children:[b.jsx("div",{className:"egox_token_div_section1area1_title",children:"About"}),b.jsxs("div",{className:"egox_token_div_section1area1_para",children:["Egochain spearheads the revolution in next-generation electric vehicle technology through its pioneering decentralized operating system.",b.jsx("br",{}),b.jsx("br",{}),"Leveraging the world's fastest blockchain specifically designed for real-world applications and readily deployable Web3 modules, Egochain fosters a robust ecosystem primed for mass adoption.",b.jsx("br",{}),b.jsx("br",{})," Its dApps boast unrivaled interoperability, scalability, and true decentralization, empowering millions to seamlessly integrate into the future of EV mobility."]})]}),b.jsx("div",{className:"home_div_section1_area_2",children:b.jsx(qS,{scene:"https://prod.spline.design/TVLoAomGQBQWA2NS/scene.splinecode",className:"home_div_section1_area_2_spline_scene"})})]})})}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"})]}),b.jsxs("section",{className:"egox_token_div_section3",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"egox_token_div_section3_area",children:[b.jsx("div",{className:"egox_token_div_section3_area_title",children:"Road Map"}),b.jsx("div",{className:"egox_token_div_section3_area_body",children:b.jsx(zye,{})})]})}),b.jsx("img",{src:"/img/grains_bottom.png",alt:"",className:"grains_ellipse_roadmap"})]})]}),Bye=()=>b.jsxs("div",{className:"egox_token_div",children:[b.jsxs("section",{className:"egox_token_div_section1",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"egox_token_div_section1area",children:[b.jsxs("div",{className:"egox_token_div_section1area_cont1",children:[b.jsxs("div",{className:"egox_token_div_section1area1",children:[b.jsx("div",{className:"egox_token_div_section1area1_title",children:"Egochain (EGAX) coin"}),b.jsx("div",{className:"egox_token_div_section1area1_para",children:"Egochain's robust fee structure ensures network sustainability and incentivizes participation through token distribution."})]}),b.jsx("div",{className:"egox_token_div_section1area2",children:b.jsx("img",{src:"/img/1_inch_token_image_dummy.png",alt:"",className:"egox_token_div_section1area2_img"})})]}),b.jsxs("div",{className:"egox_token_div_section1area_cont2",children:[b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsx("div",{className:"home_div_section1_area_stats_div1_title",children:"$0.00"}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Current Price"})]}),b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsx("div",{className:"home_div_section1_area_stats_div1_title",children:"0.00"}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Circulating Supply"})]}),b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsx("div",{className:"home_div_section1_area_stats_div1_title",children:"0.00"}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Total Supply"})]}),b.jsxs("div",{className:"home_div_section1_area_stats_div1",children:[b.jsx("div",{className:"home_div_section1_area_stats_div1_title",children:"0"}),b.jsx("div",{className:"home_div_section1_area_stats_div1_para",children:"Holders"})]})]})]})}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"})]}),b.jsxs("section",{className:"home_div_section4",children:[b.jsx("div",{className:"container",children:b.jsx("div",{className:"home_div_section4_area",children:b.jsxs("div",{className:"home_div_section4_area_body",children:[b.jsxs("div",{className:"home_div_section4_area_body_cont",children:[b.jsx("div",{className:"home_div_section4_area_body_cont1_img_div",children:b.jsx(md,{})}),b.jsxs("div",{className:"home_div_section4_area_body_cont2",children:[b.jsx("div",{className:"home_div_section4_area_body_cont2_title",children:"Transaction fees (EGAX)"}),b.jsx("div",{className:"home_div_section4_area_body_cont2_para",children:"Cover operational costs and prevent resource abuse. System fees are burned, while network fees reward consensus nodes, driving their commitment."})]})]}),b.jsxs("div",{className:"home_div_section4_area_body_cont2a",children:[b.jsxs("div",{className:"home_div_section4_area_body_cont2",children:[b.jsx("div",{className:"home_div_section4_area_body_cont2_title",children:"Token Generation"}),b.jsxs("div",{className:"home_div_section4_area_body_cont2_para",children:["5 EGAX tokens are minted per block, allocated as follows:",b.jsx("br",{}),b.jsx("br",{}),"* 10%: EGC stakers (incentivizing network security)",b.jsx("br",{}),b.jsx("br",{}),"* 70%: Apex EV riders (promoting adoption and engagement)",b.jsx("br",{}),b.jsx("br",{}),"* 20%: Validators (rewarding block validation)"]})]}),b.jsx("div",{className:"home_div_section4_area_body_cont1_img_div2",children:b.jsx(md,{})})]}),b.jsxs("div",{className:"home_div_section4_area_body_cont3",children:[b.jsx("div",{className:"home_div_section4_area_body_cont1_img_div",children:b.jsx(md,{})}),b.jsxs("div",{className:"home_div_section4_area_body_cont2",children:[b.jsx("div",{className:"home_div_section4_area_body_cont2_title",children:"Accessibility and Ease of Use"}),b.jsxs("div",{className:"home_div_section4_area_body_cont2_para",children:["* Minimal EGaX Unit: 0.00 000001 EGAX, enabling microtransactions and fostering affordability.",b.jsx("br",{}),b.jsx("br",{}),"* Staking-Free Token Claiming: No EGAX staking required to receive earned tokens.",b.jsx("br",{}),b.jsx("br",{})," * Seamless EGAX Claiming : Apex EVs integrate a built-in claim function for effortless token acquisition."]})]})]})]})})}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"}),b.jsx("img",{src:"/img/test_hero_light4.svg",alt:"",className:"home_div_section1_bg_light4"})]})]}),jye=()=>b.jsx("div",{children:b.jsxs("section",{className:"heroSection4",children:[b.jsxs("div",{className:"container",children:[b.jsxs("div",{className:"heroArea4",children:[b.jsxs("div",{className:"heroTxts4",children:[b.jsx("h1",{className:"heroTitle4","data-aos":"fade-up","data-aos-easing":"ease-in-out","data-aos-once":"false",children:"Privacy Policy"}),b.jsxs("p",{className:"hero4para","data-aos":"fade-up","data-aos-easing":"ease-in-out","data-aos-once":"false",children:["NEED SUPPORT:"," ",b.jsx("a",{href:"#",className:"egrEmailLink",children:"support@egochain.org"})]})]}),b.jsx("div",{className:"hero-images4","data-aos":"fade-left",children:b.jsx("img",{src:"/img/privacy-image.svg",alt:"",className:"privacy"})})]}),b.jsxs("div",{className:"privacyTextList",children:[b.jsx("span",{className:`privacyTextList_span\r
            `,children:"Last Date Updated 10 January 2024."}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsxs("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:["1. ",b.jsx("span",{className:"titleName",children:"About this Notice"})]})}),b.jsx("p",{className:"AboutUsPara","data-aos":"fade-right",children:"This Privacy and Cookie Notice provides information on how egochain collects and processes your personal data when you visit our website or mobile applications."})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsxs("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:["2."," ",b.jsx("span",{className:"titleName",children:"The Data We Collect About You?"})]})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:["We collect your personal data in order to provide and continually improve our products and services. We may collect, use, store and transfer the following different kinds of personal data about you: Here for marketing and personal data optimization purposes. egochain also uses Google Digital Marketing to propose targeted offers. To find out more:",b.jsx("br",{}),b.jsx("br",{})," Information you provide to us: We receive and store the information you provide to us including your identity data, contact data, delivery address and financial data.",b.jsx("br",{}),b.jsx("br",{})," Information on your use of our website and/or mobile applications: We automatically collect and store certain types of information regarding your use of the egochain including information about your searches, views, downloads and transactions.",b.jsx("br",{}),b.jsx("br",{})," Information from third parties and publicly available sources: We may receive information about you from third parties including our carriers; payment service providers; merchants/brands; and advertising service providers."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsxs("h1",{className:"PrivacyTitle ","data-aos":"fade-right",children:["3."," ",b.jsx("span",{className:"titleName",children:"Cookies and How We Use Them"})]})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:["A cookie is a small file of letters and numbers that we put on your computer if you agree.",b.jsx("br",{}),b.jsx("br",{})," Cookies allow us to distinguish you from other users of our website and mobile applications, which helps us to provide you with an enhanced browsing experience. For example we use cookies for the following purposes: Recognising and counting the number of visitors and to see how visitors move around the site when they are using it (this helps us to improve the way our website works, for example by ensuring that users can find what they are looking for). ",b.jsx("br",{}),b.jsx("br",{}),"Identifying your preferences and subscriptions e.g. language settings and Sending you newsletters and commercial/advertising messages tailored to your interests.",b.jsx("br",{}),b.jsx("br",{})," Our approved third parties may also set cookies when you use our website. Third parties include search engines, providers of measurement and analytics services, social media networks and advertising companies."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsxs("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:["4."," ",b.jsx("span",{className:"titleName",children:"How We Use Your Personal Data"})]})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:["We use your personal data to operate, provide, develop and improve the products and services that we offer, including the following: Managing your relationship with us. ",b.jsx("br",{}),b.jsx("br",{}),"Enabling you to participate in promotions, competitions and surveys. Improving our website, applications, products and services Recommending/advertising products or services which may be of interest to you.",b.jsx("br",{}),b.jsx("br",{})," Complying with our legal obligations, including verifying your identity where necessary."]})]})]})]}),b.jsx("img",{src:"/img/projects-blurbg.png",alt:"",className:"privacyBlurBg"}),b.jsx("img",{src:"/img/privacy-rightbg.png",alt:"",className:"privacyrightBlurBg"})]})}),Fye=()=>b.jsx("div",{children:b.jsxs("section",{className:"heroSection4",children:[b.jsxs("div",{className:"container",children:[b.jsxs("div",{className:"heroArea4",children:[b.jsxs("div",{className:"heroTxts4",children:[b.jsx("h1",{className:"heroTitle4","data-aos":"fade-up","data-aos-easing":"ease-in-out","data-aos-once":"false",children:"Terms & Conditions"}),b.jsxs("p",{className:"hero4para","data-aos":"fade-up","data-aos-easing":"ease-in-out","data-aos-once":"false",children:["NEED SUPPORT:"," ",b.jsx("a",{href:"#",className:"egrEmailLink",children:"support@egochain.org"})]})]}),b.jsx("div",{className:"hero-images4","data-aos":"fade-left",children:b.jsx("img",{src:"/img/privacy-image.svg",alt:"",className:"privacy"})})]}),b.jsxs("div",{className:"privacyTextList",children:[b.jsx("span",{className:`privacyTextList_span
            `,children:"Last Date Updated 10 January 2024."}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Introduction"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 1. "})," Please read these terms of use carefully before you start to use the Website, these will apply to your use of the Website. We recommend that you print a copy of the Terms for future reference."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 2. "}),"The website",b.jsxs("a",{href:"https://egochain.org",style:{color:"#229e54"},children:[" ","https://egochain.org"]})," ","is operated by egochain Technologies Limited (“egochain” “we” “our” or “us”) a limited liability company incorporated under the Nigerian Companies and Allied Matters Act with registration Number 1832671."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 3. "}),'"you" and "your" means a user of the website at'," ",b.jsxs("a",{href:"https://egochain.org",style:{color:"#229e54"},children:[" ","https://egochain.org"]})," ",'(the "Website").']})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Acceptance of Terms and Conditions"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 4. "}),"By accessing or using www.egochain.org or any other website operated by us where these terms and conditions are posted, you acknowledge that you agree to and are subject to the following terms and conditions, as well as the Privacy Policy (collectively called “Terms”/“Agreement”). The Privacy Policy is available at",b.jsxs("a",{href:"https://egochain.org/privacy",style:{color:"#229e54"},children:[" ","https://egochain.org/privacy"]})]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 5. "}),"If you do not fully agree to these Terms, you are not authorized to access or otherwise use the website. Under these Terms, “use” or “access” of the website specifically includes any direct or indirect access or use of the website or any cached version of the website and any direct or indirect access or use of any information or content on the website, regardless of how it is obtained."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:"6. "}),"You are not authorized to use this website unless you are able to enter into legally binding contracts. We do not knowingly collect the information of anyone who cannot validly enter into a legally binding contract. In essence, by using our website, you represent and warrant that:",b.jsx("br",{}),b.jsx("span",{className:"subordinate",children:" a."}),"You are at least 18 years old.",b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" b."}),"You have the right, authority and capacity to enter into this agreement and to abide by the terms and conditions of these Terms, and that you will so abide. Where you enter into this agreement on behalf of a company or other organization, you represent and warrant that you have authority to act on behalf of that entity and to bind that entity to this agreement."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle ","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Disclaimer"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 7. "}),"We do not guarantee that our Website, or any content on them, will always be available or be uninterrupted. Access to our Website is permitted on a temporary basis. We may suspend, withdraw, discontinue or change all or any part of our Website without notice. We will not be liable to you if for any reason our Website is unavailable at any time or for any period. You are responsible for making all arrangements necessary for you to have access to our Website."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 8. "}),"It is your responsibility to ensure that the Website is suitable for your intended purposes. We accept no liability as to the suitability or fitness of the Website in meeting your needs."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 9. "}),"We do not guarantee that the Website or the computer server from which the Website are made available, are free of viruses or other harmful components;"]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 10. "}),"We do not guarantee the accuracy, content, timeliness, completeness, reliability, quality or suitability of any content contained in the Website or otherwise made available in connection with the Website."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 11. "}),"We will not be responsible to you or any third party for any business loss (including loss of profits, revenue, contracts, anticipated savings, data, goodwill or wasted expenditure) or any indirect or consequential loss in connection with your use of the Website."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 12. "}),"You acknowledge and agree that the operation of the Website is dependent upon the proper and effective functioning of the internet and other third party equipment and services, and that we do not guarantee and will not be liable for these in any way."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Obligations of Users"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 13. "}),"You must not",b.jsx("br",{})," ",b.jsx("br",{}),b.jsx("span",{className:"subordinate",children:" a."})," provide any false information relating to you or your property.",b.jsx("br",{})," ",b.jsx("br",{}),b.jsx("span",{className:"subordinate",children:" b."})," Use the website in any unlawful manner, for any unlawful purpose, or in any manner inconsistent with this Agreement, or act fraudulently or maliciously, for example, by hacking into or inserting malicious code, including viruses, or harmful data, into the website.",b.jsx("br",{}),b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" c."}),"infringe our intellectual property rights or those of any third party in relation to your use of the website.",b.jsx("br",{})," ",b.jsx("br",{}),b.jsx("span",{className:"subordinate",children:" d."}),"Attempt any unauthorised access to any part or component of the Website.",b.jsx("br",{})," ",b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" e."}),"use the website in a way that could damage, disable, overburden, impair or compromise our System or security or interfere with other users;",b.jsx("br",{})," ",b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" f."}),"Collect or harvest any information or data from our systems or attempt to decipher any transmissions to or from the servers running any system.",b.jsx("br",{})," ",b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" g."}),"Use the Website or access to it to impersonate any person or entity, or to falsely state or otherwise misrepresent its affiliation with any person or entity;",b.jsx("br",{})," ",b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" h."}),"Restrict or inhibit the ability of any other person to access or use the Website; and",b.jsx("br",{}),b.jsx("br",{})," ",b.jsx("span",{className:"subordinate",children:" i."}),"Modify, adapt or translate any portion of the Website"]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 14. "}),"You are also responsible for ensuring that any persons with access to our Website through your internet connection are aware of these terms of use and the other applicable terms and conditions listed above, and that they comply with them. Our Website are made available free of charge."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Personal Information"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 15. "}),'To meet our Know Your Customer (“KYC”) and Anti-Money Laundering (“AML”) obligations, we may require you to provide any or all the following: your full name; your date of birth; your Bank Verification Number ("BVN"); your current residential address; your picture; Copy of a valid Government issued ID (national ID, international passport, permanent voter’s card or driver’s license); copy of recent utility bill, bank statement, affidavit, or another bill, dated within three months of our request, which carries your name and address; any other information or document as we may require for our internal risk assessment.']}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 16. "}),"You warrant that all information and documentation provided to us are true, correct, and accurate. You also undertake to notify us of any changes to the information or documentation which you have provided."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 17. "}),"You hereby agree and authorise egochain to verify information provided by you against the information held by any third party (including official databases) such as, banks, Payment System Providers any other information bank available to egochain."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 18. "}),"The information that egochain may verify against the information which you have provided to us include (without limitation): your name, phone number, date of birth, address, age, Identification Number (“ID”) or Passport Number and such other information that will enable egochain to identify you and comply with the regulatory “Know Your Customer” requirements (together the “Personal Information”)."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 19. "}),"You hereby consent to egochain verifying the Personal Information and the Relevant Information and using the Personal Information and the Relevant Information to the extent necessary in egochain’s opinion for the provision of its Services."]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 20. "}),"You agree to indentify and hold egochain and the Third Party Partners harmless with respect to any claims, losses, liabilities and expenses (including legal fees and expenses) that may arise as a result of the disclosure and reliance on such Personal Information and/or Relevant Information."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Consent to Data Collection"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 21. "}),"By using our Services, you consent to us collecting and using technical information about the Equipment and related software, hardware and peripherals for Services that are internet-based or wireless to improve our products and to provide any Services to you. If you use these Services, you consent to us and our affiliates' and partners’ transmission, collection, retention, maintenance, processing and use of your data to improve our Services and/or your experience while using egochain."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Intellectual Property Rights."})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 22. "}),"The intellectual property rights in the Website and copyright in all material stored, displayed and accessible on the Website is either owned us or duly licensed by third parties. All such rights are reserved."]})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Governing Law and Dispute Resolution"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 23. "}),"This website is subject to the laws and regulations of Nigeria. You irrevocably agree that any dispute between you and egochain will be governed by the laws of Nigeria and any cause of action you may have hereunder or with respect to your use of the website must be commenced by resort to an arbitration in accordance with Arbitration and Conciliation Act Cap A18 Laws of the Federation of Nigeria 2004"]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 24. "}),"You also agree and consent that any cause of action you may submit in connection with your use of the website or pursuant to these terms will be filed within six months after the incident upon which the claim or cause of action is based first occurred"]}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 25. "}),'You and egochain agree to bring any Dispute in arbitration on an individual basis only, and not as a class or collective action. There will be no right or authority for any Dispute to be brought, heard or arbitrated as a class or collective action ("Class Action Waiver"). Regardless of anything else in this Arbitration Agreement and/or the applicable Arbitration Rules, the interpretation, applicability, enforceability or formation of the Class Action Waiver may only be determined by a court and not an arbitrator.']})]}),b.jsxs("div",{className:"privacyTxts",children:[b.jsx("div",{className:"privacyLine","data-aos":"fade-right"}),b.jsx("div",{className:"loanDetailsTitle",children:b.jsx("h1",{className:"PrivacyTitle","data-aos":"fade-right",children:b.jsx("span",{className:"titleName",children:"Amendment to the Terms"})})}),b.jsxs("p",{className:"AboutUsPara","data-aos":"fade-right",children:[b.jsx("span",{className:"PrivacyTitle",children:" 26. "}),"We reserve the right, at our sole and absolutes discretion, to change, modify, add to, supplement or delete any of the terms and conditions of this Agreement at any time, effective with or without prior notice. If any future changes to this Agreement are unacceptable to you or cause you to no longer be in compliance with this Agreement, you must terminate, and immediately stop using, the website. Your continued use of the website following any revision to this Agreement constitutes your complete and irrevocable acceptance of any and all such changes. Please check this page from time to time to take notice of any changes we made, as they are binding on you."]})]})]})]}),b.jsx("img",{src:"/img/projects-blurbg.png",alt:"",className:"privacyBlurBg"}),b.jsx("img",{src:"/img/privacy-rightbg.png",alt:"",className:"privacyrightBlurBg"})]})});function Kr(){return Kr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},Kr.apply(this,arguments)}function eg(e,t){if(e==null)return{};var i={},r=Object.keys(e),a,s;for(s=0;s<r.length;s++)a=r[s],!(t.indexOf(a)>=0)&&(i[a]=e[a]);return i}const rA=0,aA=1,t1=2,i1=3,r1=4,Uye=5,p6=6,Vye=["preEnter","entering","entered","preExit","exiting","exited","unmounted"],Gye=e=>({_s:e,status:Vye[e],isEnter:e<i1,isMounted:e!==p6,isResolved:e===t1||e>r1}),sA=e=>e?p6:Uye,Hye=(e,t)=>{switch(e){case aA:case rA:return t1;case r1:case i1:return sA(t)}},Wye=e=>typeof e=="object"?[e.enter,e.exit]:[e,e],qye=(e,t)=>setTimeout(()=>{isNaN(document.body.offsetTop)||e(t+1)},0),Xye=new Map,Yye=new Map,Xw=(e,t,i,r,a,s)=>{clearTimeout(a);const n=Gye(t),o=new Map(r.current);o.set(e,n),i(o),r.current=o,s&&s({key:e,current:n})},Qye=({allowMultiple:e,enter:t=!0,exit:i=!0,preEnter:r,preExit:a,timeout:s,initialEntered:n,mountOnEnter:o,unmountOnExit:l,onStateChange:c}={})=>{const[u,h]=xe.useState(Xye),d=xe.useRef(u),p=xe.useRef(Yye),[f,m]=Wye(s),g=xe.useCallback((S,_)=>{const{initialEntered:A=n}=_||{},E=A?t1:sA(o);Xw(S,E,h,d),p.current.set(S,{})},[n,o]),v=xe.useCallback(S=>{const _=new Map(d.current);return _.delete(S)?(h(_),d.current=_,p.current.delete(S),!0):!1},[]),y=xe.useCallback(S=>{const _=d.current.get(S);if(!_)return;const{timeoutId:A}=p.current.get(S),E=Hye(_._s,l);E&&Xw(S,E,h,d,A,c)},[c,l]),x=xe.useCallback((S,_)=>{const A=d.current.get(S);if(!A)return;const E=p.current.get(S),M=T=>{switch(Xw(S,T,h,d,E.timeoutId,c),T){case aA:f>=0&&(E.timeoutId=setTimeout(()=>y(S),f));break;case r1:m>=0&&(E.timeoutId=setTimeout(()=>y(S),m));break;case rA:case i1:E.timeoutId=qye(M,T);break}},C=A.isEnter;typeof _!="boolean"&&(_=!C),_?C||(M(t?r?rA:aA:t1),!e&&d.current.forEach((T,D)=>D!==S&&x(D,!1))):C&&M(i?a?i1:r1:sA(l))},[c,y,e,t,i,r,a,f,m,l]),w=xe.useCallback(S=>{if(!(!e&&S!==!1))for(const _ of d.current.keys())x(_,S)},[e,x]);return{stateMap:u,toggle:x,toggleAll:w,endTransition:y,setItem:g,deleteItem:v}},Zye=["transition","transitionTimeout"],Hv=(e,t)=>e===!0||!!(e&&e[t]),Kye=(e={})=>{let{transition:t,transitionTimeout:i}=e,r=eg(e,Zye);const a=Qye(Kr({timeout:i,enter:Hv(t,"enter"),exit:Hv(t,"exit"),preEnter:Hv(t,"preEnter"),preExit:Hv(t,"preExit")},r));return Kr({mountOnEnter:!!r.mountOnEnter,initialEntered:!!r.initialEntered},a)},Eu="szh-accordion",cM="szh-adn",f6=`data-${cM}`,nA=`data-${cM}-btn`,m6=xe.createContext({}),Cu=(e,t,i)=>(r,a)=>{const s=t?`${e}__${t}`:e;let n=s;i&&Object.keys(i).forEach(l=>{const c=i[l];c&&(n+=` ${s}--${c===!0?l:`${l}-${c}`}`)});let o=typeof r=="function"?r(a):r;return typeof o=="string"&&(o=o.trim(),o&&(n+=` ${o}`)),n},oA=(e,t)=>{if(!t)return e;const i=Kr({},e);return Object.keys(t).forEach(r=>{const a=e[r],s=t[r];typeof s=="function"&&a?i[r]=(...n)=>{a(...n),s(...n)}:i[r]=s}),i},$ye=e=>b.jsx(m6.Provider,Kr({},e)),Yw=e=>{do e=e.parentElement;while(e&&!e.hasAttribute(f6));return e},oR=(e,t,i)=>e?t>0?t-1:i-1:(t+1)%i,lR=(e,t)=>{const{activeElement:i}=document;if(!i||!i.hasAttribute(nA)||Yw(i)!==t.currentTarget)return;const r=t.currentTarget.querySelectorAll(`[${nA}]`),{length:a}=r;for(let s=0;s<a;s++)if(r[s]===i){let n=oR(e,s,a);for(;Yw(r[s])!==Yw(r[n]);)n=oR(e,n,a);s!==n&&(t.preventDefault(),r[n].focus());break}},Jye=()=>({accordionProps:{[f6]:"",onKeyDown:t=>t.key==="ArrowUp"?lR(!0,t):t.key==="ArrowDown"&&lR(!1,t)}}),e1e=["providerValue","className"],g6=xe.forwardRef((e,t)=>{let{providerValue:i,className:r}=e,a=eg(e,e1e);const{accordionProps:s}=Jye();return b.jsx($ye,{value:i,children:b.jsx("div",Kr({},oA(s,a),{ref:t,className:Cu(Eu)(r)}))})});g6.displayName="ControlledAccordion";const t1e=["allowMultiple","initialEntered","mountOnEnter","unmountOnExit","transition","transitionTimeout","onStateChange"],v6=xe.forwardRef((e,t)=>{let{allowMultiple:i,initialEntered:r,mountOnEnter:a,unmountOnExit:s,transition:n,transitionTimeout:o,onStateChange:l}=e,c=eg(e,t1e);const u=Kye({allowMultiple:i,initialEntered:r,mountOnEnter:a,unmountOnExit:s,transition:n,transitionTimeout:o,onStateChange:l});return b.jsx(g6,Kr({},c,{ref:t,providerValue:u}))});v6.displayName="Accordion";let i1e=0;const r1e=()=>{const[e,t]=xe.useState();return xe.useEffect(()=>t(++i1e),[]),e&&`${cM}-${e}`},a1e=zc.useId||r1e,s1e=({state:e,toggle:t,disabled:i})=>{const r=a1e(),a=r&&r+"-",s={id:r,"aria-controls":a,"aria-expanded":e.isEnter,onClick:t};return i?s.disabled=!0:s[nA]="",{buttonProps:s,panelProps:{id:a,"aria-labelledby":r,role:"region"}}},n1e=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?xe.useLayoutEffect:xe.useEffect,o1e=({status:e,isResolved:t})=>{const[i,r]=xe.useState(),a=xe.useRef(null);return n1e(()=>{(e==="preEnter"||e==="preExit")&&r(a.current.getBoundingClientRect().height)},[e]),[{height:e==="preEnter"||e==="exiting"?0:e==="entering"||e==="preExit"?i:void 0,overflow:t?void 0:"hidden"},a]};function cR(e,t){typeof e=="function"?e(t):e.current=t}function hR(e,t){return xe.useMemo(()=>e?t?i=>{cR(e,i),cR(t,i)}:e:t,[e,t])}const l1e=(e,t,i)=>{const{stateMap:r,mountOnEnter:a,initialEntered:s}=e,n=i??s;return r.get(t)||{status:n?"entered":a?"unmounted":"exited",isMounted:!a,isEnter:n,isResolved:!0}},c1e=()=>xe.useContext(m6),h1e=({itemKey:e,initialEntered:t,disabled:i}={})=>{const r=xe.useRef(null),a=c1e(),s=e??r.current,n=l1e(a,s,t),{setItem:o,deleteItem:l,toggle:c}=a;return xe.useEffect(()=>{if(i)return;const u=e??r.current;return o(u,{initialEntered:t}),()=>void l(u)},[o,l,e,t,i]),{itemRef:r,state:n,toggle:xe.useCallback(u=>c(s,u),[c,s])}},u1e=["itemKey","initialEntered"],d1e=e=>{const t=xe.forwardRef((i,r)=>{let{itemKey:a,initialEntered:s}=i,n=eg(i,u1e);return b.jsx(e,Kr({forwardedRef:r},n,h1e({itemKey:a,initialEntered:s,disabled:n.disabled})))});return t.displayName="WithAccordionItem",t},p1e=["forwardedRef","itemRef","state","toggle","className","disabled","header","headingTag","headingProps","buttonProps","contentProps","panelProps","children"],uR=(e,t)=>typeof e=="function"?e(t):e,y6=xe.memo(e=>{let{forwardedRef:t,itemRef:i,state:r,toggle:a,className:s,disabled:n,header:o,headingTag:l="h3",headingProps:c,buttonProps:u,contentProps:h,panelProps:d,children:p}=e,f=eg(e,p1e);const m={state:r,toggle:a,disabled:n},{buttonProps:g,panelProps:v}=s1e(m),[y,x]=o1e(r),w=hR(d&&d.ref,x),{status:S,isMounted:_,isEnter:A}=r;return b.jsxs("div",Kr({},f,{ref:hR(t,i),className:Cu(Eu,"item",{status:S,expanded:A})(s,r),children:[b.jsx(l,Kr({},c,{style:Kr({margin:0},c&&c.style),className:Cu(Eu,"item-heading")(c&&c.className,r),children:b.jsx("button",Kr({},oA(g,u),{type:"button",className:Cu(Eu,"item-btn")(u&&u.className,r),children:uR(o,m)}))})),_&&b.jsx("div",Kr({},h,{style:Kr({display:S==="exited"?"none":void 0},y,h&&h.style),className:Cu(Eu,"item-content")(h&&h.className,r),children:b.jsx("div",Kr({},oA(v,d),{ref:w,className:Cu(Eu,"item-panel")(d&&d.className,r),children:uR(p,m)}))}))]}))});y6.displayName="AccordionItem";const f1e=d1e(y6),m1e="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20class='icon%20icon-tabler%20icon-tabler-chevron-down'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20stroke-width='2'%20stroke='%23fff'%20fill='none'%20stroke-linecap='round'%20stroke-linejoin='round'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpolyline%20points='6%209%2012%2015%2018%209'%20/%3e%3c/svg%3e",g1e="_list_afula_5",v1e="_info_afula_9",y1e="_accordion_afula_16",x1e="_item_afula_21",b1e="_itemBtn_afula_25",w1e="_itemBtnExpanded_afula_43",_1e="_itemContent_afula_47",S1e="_itemPanel_afula_51",A1e="_chevron_afula_55",yu={list:g1e,info:v1e,accordion:y1e,item:x1e,itemBtn:b1e,itemBtnExpanded:w1e,itemContent:_1e,itemPanel:S1e,chevron:A1e},E1e=({header:e,...t})=>b.jsx(f1e,{...t,header:b.jsxs(b.Fragment,{children:[e,b.jsx("img",{className:yu.chevron,src:m1e,alt:"Chevron Down"})]}),className:yu.item,buttonProps:{className:({isEnter:i})=>`${yu.itemBtn} ${i&&yu.itemBtnExpanded}`},contentProps:{className:yu.itemContent},panelProps:{className:yu.itemPanel}}),C1e=()=>{const[e,t]=xe.useState(null);return xe.useEffect(()=>{const i=document.getElementById("content"),r=()=>{const a=i.scrollTop;document.querySelectorAll(".whitePaper_div_area_body_area_section").forEach(n=>{const o=n.getAttribute("id"),l=n.offsetTop-50;a>=l&&t(o)})};return i.addEventListener("scroll",r),()=>{i.removeEventListener("scroll",r)}},[]),b.jsxs("div",{className:"whitepaper_div",children:[b.jsx("div",{className:"container",children:b.jsxs("div",{className:"whitePaper_div_area_body",children:[b.jsxs("div",{className:"whitePaper_div_area_body_side",id:"sidebar",children:[b.jsx("div",{className:e==="abstract"?"active":" whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#abstract",children:"Abstract"})}),b.jsx("div",{className:e==="introduction"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#introduction",children:"Introduction"})}),b.jsx("div",{className:e==="Production of affordable EVs"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Production of affordable EVs",children:"Production of affordable EVs"})}),b.jsx("div",{className:e==="Streamlining Manufacturing and Boosting Accessibility"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Streamlining Manufacturing and Boosting Accessibility",children:"Streamlining Manufacturing and Boosting Accessibility"})}),b.jsx("div",{className:e==="Benefits Beyond Cost Savings"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#in-mcd-we-trust",children:"Benefits Beyond Cost Savings"})}),b.jsx("div",{className:e==="Charging costs & Improved charging infrastructure"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Charging costs & Improved charging infrastructure",children:"Charging costs & Improved charging infrastructure"})}),b.jsx("div",{className:e==="Transparency, Efficiency, and Incentives"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Transparency, Efficiency, and Incentives",children:"Transparency, Efficiency, and Incentives"})}),b.jsx("div",{className:e==="Earning Rewards in the Egochain Ecosystem: Pathways to Participation"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Earning Rewards in the Egochain Ecosystem: Pathways to Participation",children:"Earning Rewards in the Egochain Ecosystem: Pathways to Participation"})}),b.jsx("div",{className:e==="Fueling Growth Through Rewards"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Fueling Growth Through Rewards",children:"Fueling Growth Through Rewards"})}),b.jsx("div",{className:e==="Earning with Vesting and Liquid Ownership"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Earning with Vesting and Liquid Ownership",children:"Earning with Vesting and Liquid Ownership"})}),b.jsx("div",{className:e==="The Egochain Coin (EGAX)"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#The Egochain Coin (EGAX)",children:"The Egochain Coin (EGAX)"})}),b.jsx("div",{className:e==="The EGC Coin (EGC)"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#The EGC Coin (EGC)",children:"The EGC Coin (EGC)"})}),b.jsx("div",{className:e==="Smart Electric Vehicles"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Smart Electric Vehicles",children:"Smart Electric Vehicles"})}),b.jsx("div",{className:e==="Tokenization"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Tokenization",children:"Tokenization"})}),b.jsx("div",{className:e==="Unlocking Value Through Collateralization"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Unlocking Value Through Collateralization",children:"Unlocking Value Through Collateralization"})}),b.jsx("div",{className:e==="Enhancing Transparency, Empowering Lending"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Enhancing Transparency, Empowering Lending",children:"Enhancing Transparency, Empowering Lending"})}),b.jsx("div",{className:e==="Beyond Redefining Ownership"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Beyond Redefining Ownership",children:"Beyond Redefining Ownership"})}),b.jsx("div",{className:e==="Distributing Egax Coin"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Distributing Egax Coin",children:"Distributing Egax Coin"})}),b.jsx("div",{className:e==="Electric Vehicle Smart Charging System"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Electric Vehicle Smart Charging System",children:"Electric Vehicle Smart Charging System"})}),b.jsx("div",{className:e==="Smart Charging Architecture"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Smart Charging Architecture",children:"Smart Charging Architecture"})}),b.jsx("div",{className:e==="Charging Algorithm and Flexibility Offers"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Charging Algorithm and Flexibility Offers",children:"Charging Algorithm and Flexibility Offers"})}),b.jsx("div",{className:e==="Determining Electric Vehicle (EV) Flexibility for Next Time Step"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Determining Electric Vehicle (EV) Flexibility for Next Time Step",children:"Determining Electric Vehicle (EV) Flexibility for Next Time Step"})}),b.jsx("div",{className:e==="Decentralized Secure Charging with Egochain"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Decentralized Secure Charging with Egochain",children:"Decentralized Secure Charging with Egochain"})}),b.jsx("div",{className:e==="Simulation Parameters"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Simulation Parameters",children:"Simulation Parameters"})}),b.jsx("div",{className:e==="Dynamic Charging Model Based on User Activity"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Dynamic Charging Model Based on User Activity",children:"Dynamic Charging Model Based on User Activity"})}),b.jsx("div",{className:e==="Simulation Scenarios and Methodology"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Simulation Scenarios and Methodology",children:"Simulation Scenarios and Methodology"})}),b.jsx("div",{className:e==="Results and Discussion"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Results and Discussion",children:"Results and Discussion"})}),b.jsx("div",{className:e==="Conclusion"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Conclusion",children:"Conclusion"})})]}),b.jsx("div",{className:"mobile_header",children:b.jsx("div",{className:"mobile_header_area",children:b.jsx(v6,{children:b.jsxs(E1e,{header:"Menu ",children:[b.jsxs("div",{className:"mobile_header_links_area",children:[b.jsx("div",{className:e==="abstract"?"active":" whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#abstract",children:"Abstract"})}),b.jsx("div",{className:e==="introduction"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#introduction",children:"Introduction"})}),b.jsx("div",{className:e==="Production of affordable EVs"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Production of affordable EVs",children:"Production of affordable EVs"})}),b.jsx("div",{className:e==="Streamlining Manufacturing and Boosting Accessibility"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Streamlining Manufacturing and Boosting Accessibility",children:"Streamlining Manufacturing and Boosting Accessibility"})}),b.jsx("div",{className:e==="Benefits Beyond Cost Savings"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#in-mcd-we-trust",children:"Benefits Beyond Cost Savings"})}),b.jsx("div",{className:e==="Charging costs & Improved charging infrastructure"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Charging costs & Improved charging infrastructure",children:"Charging costs & Improved charging infrastructure"})}),b.jsx("div",{className:e==="Transparency, Efficiency, and Incentives"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Transparency, Efficiency, and Incentives",children:"Transparency, Efficiency, and Incentives"})}),b.jsx("div",{className:e==="Earning Rewards in the Egochain Ecosystem: Pathways to Participation"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Earning Rewards in the Egochain Ecosystem: Pathways to Participation",children:"Earning Rewards in the Egochain Ecosystem: Pathways to Participation"})}),b.jsx("div",{className:e==="Fueling Growth Through Rewards"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Fueling Growth Through Rewards",children:"Fueling Growth Through Rewards"})}),b.jsx("div",{className:e==="Earning with Vesting and Liquid Ownership"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Earning with Vesting and Liquid Ownership",children:"Earning with Vesting and Liquid Ownership"})}),b.jsx("div",{className:e==="The Egochain Coin (EGAX)"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#The Egochain Coin (EGAX)",children:"The Egochain Coin (EGAX)"})}),b.jsx("div",{className:e==="The EGC Coin (EGC)"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#The EGC Coin (EGC)",children:"The EGC Coin (EGC)"})}),b.jsx("div",{className:e==="Smart Electric Vehicles"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Smart Electric Vehicles",children:"Smart Electric Vehicles"})}),b.jsx("div",{className:e==="Tokenization"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Tokenization",children:"Tokenization"})}),b.jsx("div",{className:e==="Unlocking Value Through Collateralization"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Unlocking Value Through Collateralization",children:"Unlocking Value Through Collateralization"})}),b.jsx("div",{className:e==="Enhancing Transparency, Empowering Lending"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Enhancing Transparency, Empowering Lending",children:"Enhancing Transparency, Empowering Lending"})}),b.jsx("div",{className:e==="Beyond Redefining Ownership"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Beyond Redefining Ownership",children:"Beyond Redefining Ownership"})}),b.jsx("div",{className:e==="Distributing Egax Coin"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Distributing Egax Coin",children:"Distributing Egax Coin"})}),b.jsx("div",{className:e==="Electric Vehicle Smart Charging System"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Electric Vehicle Smart Charging System",children:"Electric Vehicle Smart Charging System"})}),b.jsx("div",{className:e==="Smart Charging Architecture"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Smart Charging Architecture",children:"Smart Charging Architecture"})}),b.jsx("div",{className:e==="Charging Algorithm and Flexibility Offers"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Charging Algorithm and Flexibility Offers",children:"Charging Algorithm and Flexibility Offers"})}),b.jsx("div",{className:e==="Determining Electric Vehicle (EV) Flexibility for Next Time Step"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Determining Electric Vehicle (EV) Flexibility for Next Time Step",children:"Determining Electric Vehicle (EV) Flexibility for Next Time Step"})}),b.jsx("div",{className:e==="Decentralized Secure Charging with Egochain"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Decentralized Secure Charging with Egochain",children:"Decentralized Secure Charging with Egochain"})}),b.jsx("div",{className:e==="Simulation Parameters"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Simulation Parameters",children:"Simulation Parameters"})}),b.jsx("div",{className:e==="Dynamic Charging Model Based on User Activity"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Dynamic Charging Model Based on User Activity",children:"Dynamic Charging Model Based on User Activity"})}),b.jsx("div",{className:e==="Simulation Scenarios and Methodology"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Simulation Scenarios and Methodology",children:"Simulation Scenarios and Methodology"})}),b.jsx("div",{className:e==="Results and Discussion"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Results and Discussion",children:"Results and Discussion"})}),b.jsx("div",{className:e==="Conclusion"?"active":"whitePaper_div_area_body_side_list",children:b.jsx("a",{href:"#Conclusion",children:"Conclusion"})})]})," "]})})})}),b.jsxs("div",{className:"whitePaper_div_area_body_area",id:"content",children:[b.jsx("div",{className:"whitePaper_div_area_title",children:"Egochain: Incentivized Operating System for Electric Vehicles Powered by Blockchain Technology."}),b.jsxs("section",{id:"abstract",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Abstract"})," ","Electric vehicles (EVs) offer a promising path towards sustainable transportation, widespread adoption remains hindered by high price points, underdeveloped charging infrastructure, and prohibitive charging costs. This whitepaper proposes Egochain, a blockchain-based solution designed to ignite a global EV revolution by overcoming these key barriers."]}),b.jsxs("section",{id:"introduction",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Introduction"})," ","The undeniable force of transportation in our daily lives confronts us with a stark reality: change, however necessary, often faces an uphill battle against established social norms. Despite growing awareness of Electric Vehicles (EVs), only a fraction of the global population (less than 30%) has firsthand experience with this burgeoning technology. Yet, EVs are poised to redefine our relationship with transportation, with their global market share projected to leap from 16% in 2022 to 20% by 2023 (considering only battery electric and plug-in hybrid EVs).",b.jsx("br",{}),b.jsx("br",{}),"While EV adoption is accelerating, cost remains a crucial obstacle. Soaring gasoline prices provide a compelling incentive, but high vehicle costs, underdeveloped charging infrastructure, and prohibitively expensive charging fees act as roadblocks to widespread adoption.",b.jsx("br",{}),b.jsx("br",{}),"This is where Egochain steps in, armed with the transformative power of blockchain technology.",b.jsx("br",{}),b.jsx("br",{}),"Egochain envisions a future where EVs are not just a novelty, but a readily accessible and affordable transportation option for all. Our blockchain platform unlocks these possibilities through:",b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"Production of affordable EVs: By enhancing transparency and efficiency, Egochain can optimize EV manufacturing processes, driving down costs and fostering wider production of affordable electric vehicles."}),b.jsx("li",{children:"Reduced charging costs: The secure and decentralized nature of the blockchain enables more efficient development and management of charging stations, resulting in lower charging fees for drivers."}),b.jsx("li",{children:"Profitable charging infrastructure: Egochain offers attractive rewards and simplifies operations for those wishing to invest in charging stations, rapidly expanding access to vital charging points."})]}),b.jsx("br",{}),b.jsx("br",{}),"Egochain goes beyond merely acknowledging the barriers to EV adoption. It provides a comprehensive solution, leveraging the power of blockchain to break down these hurdles and pave the way for a more sustainable and accessible transportation future."]}),b.jsxs("section",{id:"Production of affordable EVs",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Production of affordable EVs"})," ","The electric vehicle (EV) industry faces a significant hurdle: cost. EVs generally carry a higher price tag than their gasoline-powered counterparts, primarily due to battery technology. These batteries require costly raw materials and substantial capacity to meet range expectations, driving up overall costs. Even excluding battery expenses, the sheer abundance of existing gas-powered vehicles pushes their prices down further, widening the affordability gap. While EVs often boast lower operating costs in the long run, the initial purchase barrier remains a formidable obstacle, particularly for budget-conscious consumers in developing economies.",b.jsx("br",{}),b.jsx("br",{}),"Chart",b.jsx("img",{src:"/img/ev_purchase_chart_reason.svg",alt:""})," "]}),b.jsxs("section",{id:"Streamlining Manufacturing and Boosting Accessibility",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Streamlining Manufacturing and Boosting Accessibility"})," ","Egochain's transparent and efficient blockchain technology offers a solution to streamline EV manufacturing, ultimately making them more accessible.",b.jsx("br",{}),b.jsx("br",{}),"Here is how:",b.jsxs("span",{children:[b.jsxs("li",{children:[b.jsx("b",{children:" Cost Reduction Through Transparent Supply Chains:"})," ","Egochain's track-and- trace capabilities enable manufacturers to eliminate counterfeit parts and diversion within their supply chains. This not only safeguards quality but also minimizes waste and cost overruns associated with managing fraudulent components."]}),b.jsxs("li",{children:[b.jsx("b",{children:" Enhanced Profitability with Efficient Recalls:"})," ","Traditional recalls often involve entire model years due to uncertainties regarding the origin of problematic parts. Egochain's precise tracking allows targeted recalls, focusing only on vehicles equipped with components from the affected supplier. This significantly reduces the recall's scope and associated expenses."]})]})]}),b.jsxs("section",{id:"Benefits Beyond Cost Savings",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Benefits Beyond Cost Savings"})," ","The benefits of Egochain extend beyond mere cost reduction:",b.jsx("br",{}),b.jsxs("span",{children:[b.jsxs("li",{children:[b.jsx("b",{children:" Increased Consumer Confidence:"})," Enhanced transparency fosters trust by assuring consumers of the provenance and quality of their EVs."]}),b.jsxs("li",{children:[b.jsx("b",{children:" Sustainability Advancement: "})," Eliminating waste and optimizing resource use within the supply chain contributes to a more sustainable automotive industry."]})]}),b.jsx("br",{}),b.jsx("br",{}),"Egochain's blockchain technology positions itself as a key facilitator in overcoming the cost barrier hindering wider EV adoption, opening doors for a greener future."]}),b.jsxs("section",{id:"Charging costs & Improved charging infrastructure",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Charging costs & Improved charging infrastructure"})," ",`Despite the surging popularity of electric vehicles (EVs) in countries like Norway, Sweden, and the UK, a lack of readily available public charging stations remains a major obstacle to wider adoption. Euromonitor International's 2023 Voice of the Consumer: Mobility Survey identified poor charging infrastructure as the second most common reason for hesitation towards EVs, fueling "range anxiety" – the fear of running out of power before finding a charger.`,b.jsx("br",{}),b.jsx("br",{}),"The European Union's 2014 Alternative Fuel Infrastructure Directive (AFID) recommends a ratio of 10 EVs per charging station for member states. However, significant gaps persist. In 2022, countries like Norway (31 EVs per charger), Germany (23), the UK (19), and Denmark (18) fell short of this target.",b.jsx("br",{}),b.jsx("br",{}),"Chart2",b.jsx("img",{src:"/img/whitepaper_img2.svg",alt:""})," ",b.jsx("br",{}),b.jsx("br",{}),"Expanding public charging networks is crucial, particularly for urban dwellers living in apartments, where home charging is often infeasible. However, challenges exist. Public EV charging stations can be expensive to install, with Level 2 and DC fast chargers costing between $2,500 and $36,000, excluding installation and permits.",b.jsx("br",{}),b.jsx("br",{}),"Adding to the complexity, unlike the consistent gallon-based pricing of gasoline, EV charging employs various structures, sometimes leading to confusing and potentially inflated costs. This inconsistency can disincentivize EV adoption due to consumer frustration and negative experiences."]}),b.jsxs("section",{id:"Transparency, Efficiency, and Incentives",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Transparency, Efficiency, and Incentives"})," ","Egochain's blockchain technology offers a solution by enabling an open-source network of charging stations. The decentralized nature allows ownership by anyone, including local businesses like grocery stores. Transactions are securely recorded on the blockchain, reducing fraud and improving operational efficiency.",b.jsx("br",{}),b.jsx("br",{}),"Beyond convenience, Egochain incentivizes green transportation by rewarding EV owners with tokens for using less popular stations. This balances grid load and promotes energy efficiency, contributing to a cleaner transportation ecosystem.",b.jsx("br",{}),b.jsx("br",{}),"Tackling range anxiety through wider public EV charging infrastructure access is crucial for a successful transition to sustainable mobility. Egochain's blockchain- based approach delivers transparency, efficiency, and incentives, offering a promising path towards overcoming current obstacles and accelerating EV adoption."]}),b.jsxs("section",{id:"Earning Rewards in the Egochain Ecosystem: Pathways to Participation",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Earning Rewards in the Egochain Ecosystem: Pathways to Participation"})," ","This section explores the fundamental concepts powering Egochain and the rewarding landscape for those who actively contribute to its success, ultimately accelerating the adoption of electric vehicles."]}),b.jsxs("section",{id:"Fueling Growth Through Rewards",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Fueling Growth Through Rewards"})," ","Egochain welcomes contributions through two primary channels: debt and ownership. Both play crucial roles in propelling the expansion of electric vehicle adoption and boosting the value of its native currency. Within the ownership category, two distinct options exist: liquid and vesting. Vesting ownership implies a long-term commitment, locking tokens for a predetermined period, while liquid ownership grants immediate transferability."]}),b.jsxs("section",{id:"Earning with Vesting and Liquid Ownership",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Earning with Vesting and Liquid Ownership"})," ",b.jsx("b",{children:"Vesting Ownership:"})," Earn rewards continuously over time while demonstrating a long-term dedication to Egochain's mission. Tokens become gradually accessible, fostering deeper alignment between contributor interests and the ecosystem's long- term vision.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Liquid Ownership:"})," Earn rewards continuously over time while demonstrating a long-term dedication to Egochain's mission. Tokens become gradually accessible, fostering deeper alignment between contributor interests and the ecosystem's long- term vision.",b.jsx("br",{}),b.jsx("br",{}),"By recognizing the diverse motivations of potential contributors, Egochain empowers individuals to choose the reward-earning path that best aligns with their goals and risk tolerance. This inclusive approach paves the way for a robust and diverse participation landscape, propelling the ecosystem towards its ambitious goals of widespread electric vehicle adoption."]}),b.jsx("div",{className:"break_line_txt",children:"The Egochain blockchain interacts with two kinds of coins"}),b.jsxs("section",{id:"The Egochain Coin (EGAX)",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"The Egochain Coin (EGAX)"})," ",b.jsx("br",{}),b.jsx("b",{children:"EGAX"})," is the native token of Egochain, a blockchain platform specifically designed for the electric vehicle (EV) ecosystem. It serves as the lifeblood of this innovative network, powering transactions, incentivizing participation, and unlocking a new era of mobility.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Fueling Adoption and Infrastructure"}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:["➔ 80% of EGAX distribution rewards directly contribute to the heart of the EV ecosystem:",b.jsx("br",{}),"◆ ",b.jsx("b",{children:"EV drivers:"})," Incentivized through rebates, loyalty programs, and pay- per-use charging, encouraging widespread EV adoption.",b.jsx("br",{})," ◆ ",b.jsx("b",{children:" Charging station operators:"}),"Earning rewards for providing essential infrastructure and promoting a sustainable future.",b.jsx("br",{}),"➔ This targeted distribution fosters a symbiotic relationship, fueling both demand and supply within the EV market."]}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Secure and Staking-Free Rewards"}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"19% of EGAX is allocated to validators who secure the Egochain network through robust consensus mechanisms. This ensures the platform's stability and transparency, building trust and attracting further investment."}),b.jsx("li",{children:"Uniquely, Egochain eliminates the complexities of staking by offering automatic claiming of earned EGAX for all users. This user-friendly approach maximizes accessibility and participation, making EGAX truly inclusive."}),b.jsx("li",{children:"1%: EGC holders, providing passive income for supporting the ecosystem."})]}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Frictionless Payments and Seamless Integration"}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsxs("li",{children:[b.jsx("b",{children:"Microtransactions:"})," EGAX boasts a minimal unit value, enabling smooth and efficient payments for even the smallest purchases, like individual charging sessions. This seamless experience encourages frequent engagement and fosters broader adoption."]}),b.jsxs("li",{children:[b.jsx("b",{children:"Built-in claiming: "})," Imagine claiming your earned EGAX directly through your EV! With APEX EVs, this futuristic vision becomes reality. Claiming rewards becomes an effortless part of your driving experience, further reinforcing the integration of EGAX into the everyday lives of EV users."]})]}),b.jsx("br",{}),"EGAX represents more than just a coin; it's the key to unlocking a future where electric mobility thrives. Its unique design incentivizes participation, simplifies interaction, and fuels continuous growth within the EV ecosystem."]}),b.jsxs("section",{id:"The EGC Coin (EGC)",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"The EGC Coin (EGC)"})," ",b.jsx("br",{}),"Start-ups thrive on patient capital commitment. Investors recognize the years-long journey before reaping returns from their stakes. Short-term exits pose a significant challenge. New capital raised to fuel growth competes with existing shareholders seeking to cash out. Savvy investors prioritize capital contributions that propel company expansion, not appease those aiming for a quick escape.",b.jsx("br",{}),b.jsx("br",{}),"Long-term commitment unlocks immense value. It empowers communities to chart future-focused plans. Stakeholder dedication aligns voting and decision-making with sustainable growth, rather than fleeting spikes. Conversely, the cryptocurrency landscape often witnesses speculators flitting between digital assets based on anticipated short-term gains.",b.jsx("br",{}),b.jsx("br",{}),"Egochain envisions a community deeply invested in its long-term vision. Its unique model empowers users to commit their EGC COIN to lockup periods – one month, six months, or even a year – garnering platform benefits in return. Staked EGC balances remain non-transferable and non-divisible, effectively taking them off the open market. This deliberate design discourages short-term trading and fosters commitment. Stakers reap daily rewards, with EGC holders receiving 15% of the annual returns directly proportional to their locked stakes."]}),b.jsxs("section",{id:"Smart Electric Vehicles",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Smart Electric Vehicles"})," ",b.jsx("br",{}),'The seeds of smart vehicles were sown in the fertile ground of early Bitcoin projects. In 2013, Colored Coins emerged as a pioneering concept, offering a way to represent assets on the Bitcoin blockchain. This groundbreaking initiative laid the groundwork for the evolution of "smart property" within the nascent blockchain ecosystem.',b.jsx("br",{}),b.jsx("br",{}),"The year 2014 witnessed another pivotal moment with the advent of Counterparty. This platform empowered users to create their own tokens within the Bitcoin blockchain, representing a diverse range of assets from digital goods to tangible real estate and stocks. This versatility paved the way for the next milestone – the introduction of the Ethereum blockchain in 2015. Ethereum's revolutionary smart contracts enabled intricate, automated transactions on the blockchain, fostering the creation and management of intelligent property.",b.jsx("br",{}),b.jsx("br",{}),"Fast forward to today, and we see tangible expressions of smart vehicle evolution in systems like car immobilizers. These devices enhance traditional keys with secure protocol exchanges, ensuring only authorized individuals with the correct cryptographic tokens can activate the engine. Their impact is undeniable; in Africa, cars equipped with immobilizers represent just 2% of stolen vehicles despite constituting 28% of the car population. This success extends beyond vehicles, with cryptographic measures safeguarding modern possessions like smartphones, rendering stolen devices inoperable and protecting sensitive information.",b.jsx("br",{}),b.jsx("br",{}),"While these advancements are noteworthy, the full potential of crypto-activated property remains largely unexplored. Traditionally, private keys reside within physical objects like keys or SIM cards, restricting their transfer and manipulation.",b.jsx("br",{}),b.jsx("br",{}),"Smart vehicles challenge this paradigm by enabling ownership to be mediated through smart contracts.",b.jsx("br",{}),b.jsx("br",{}),"Integrating smart property into blockchain ecosystems unlocks a plethora of benefits – reduced transaction costs, enhanced transparency, robust security, and perhaps most importantly, the democratization of asset ownership previously accessible only to a select few."]}),b.jsxs("section",{id:"Tokenization",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Tokenization"})," ",b.jsx("br",{}),"The burgeoning realm of smart electric vehicles (EVs) is poised for a paradigm shift with the emergence of tokenization. This innovative approach involves fragmenting ownership into digital tokens, each representing a stake in a specific vehicle. These tokens unlock a plethora of possibilities, fundamentally redefining automobile ownership and reshaping the landscape of automotive finance."]}),b.jsxs("section",{id:"Unlocking Value Through Collateralization",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Unlocking Value Through Collateralization"})," ",b.jsx("br",{}),"Imagine a world where owning a smart EV empowers you to tap into its value as a source of readily available credit. Tokenization makes this a reality. By leveraging your EV's inherent worth as collateral, you gain access to a wider range of loan options, potentially securing favorable terms and unlocking valuable financial flexibility. This benefit extends beyond individual owners, offering manufacturers a novel channel for asset-backed financing, diversifying their financial instruments and unlocking untapped potential."]}),b.jsxs("section",{id:"Enhancing Transparency, Empowering Lending",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Enhancing Transparency, Empowering Lending"})," ",b.jsx("br",{}),"The magic of tokenization lies in its inherent transparency. Built upon the immutable foundations of blockchain technology, ownership records and transaction history become readily accessible and tamper-proof. This creates a secure and transparent ecosystem, fostering trust and enabling lenders to make informed credit decisions based on the complete and accurate picture of an EV's value. This data-driven approach mitigates risk, fosters responsible lending practices, and creates a more robust financial infrastructure for all stakeholders."]}),b.jsxs("section",{id:"Beyond Redefining Ownership",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Beyond Redefining Ownership"})," ",b.jsx("br",{}),"The implications of smart EV tokenization extend far beyond ownership structures. It fosters a more inclusive financial ecosystem by empowering individuals and businesses to leverage their assets effectively. This fosters economic growth, stimulates innovation, and paves the way for a future where mobility and financial opportunity are intertwined.",b.jsx("br",{}),b.jsx("br",{}),"The burgeoning world of smart EV tokenization represents a watershed moment in the automotive and financial landscape. By unlocking the hidden value of vehicles, streamlining ownership transparency, and creating new avenues for financial inclusion, this technology holds the potential to revolutionize the way we own, finance, and experience mobility in the years to come."]}),b.jsxs("section",{id:"Distributing Egax Coin",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Distributing Egax Coin"})," ",b.jsx("br",{}),"The path to involvement in a cryptocurrency community offers two main avenues: ownership and contribution. Both approaches hold merit, with each user adding value to the currency's ecosystem. Mutual exchange facilitated by a transparent and reliable accounting system serves as the bedrock for value creation within these communities, where individuals earn rewards through the contributions they make to one another.",b.jsx("br",{}),b.jsx("br",{}),"However, achieving equitable distribution of a cryptocurrency presents a significant challenge. While computation-based mining methods like those employed by Bitcoin and Egochain offer specific functionalities, their scope tends to be limited. Activities like solving cryptographic puzzles or performing computations for rewards often yield benefits of marginal societal impact and offer limited direct advantages to the currency's community. Additionally, economies of scale and market forces often lead to centralization, restricting participation in such distribution mechanisms to specialized entities with extensive resources.",b.jsx("br",{}),b.jsx("br",{}),"Therefore, it's crucial to recognize that computation-based mining ultimately resembles purchase, as it necessitates capital outlay for equipment or energy costs. Recognizing this inherent exchange dynamic highlights the need for alternative, more inclusive distribution models. Egochain's mileage-based approach, while innovative in its attempt to incentivize electric vehicle adoption, still relies on a pre-existing investment (vehicle ownership) and limits participant access.",b.jsx("br",{}),b.jsx("br",{}),"Moving forward, exploring alternative distribution methods that prioritize accessibility, transparency, and genuine contribution to the community's goals will be crucial. By focusing on these principles, we can foster truly inclusive and sustainable cryptocurrency ecosystems where value creation is shared among all participants, not just a select few."]}),b.jsxs("section",{id:"Electric Vehicle Smart Charging System",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Electric Vehicle Smart Charging System"})," ",b.jsx("br",{}),"The burgeoning growth of electric vehicles (EVs) presents a significant challenge to power distribution grids. Unmanaged, the high-demand energy requirements of EV charging could overwhelm existing infrastructure. To address this, a robust platform is needed to optimize EV charging, balancing user needs with grid capacity. Failure to act will lead to charging station scarcity and grid congestion in the near future.",b.jsx("br",{}),b.jsx("br",{}),'This paper proposes a novel smart EV charging infrastructure built on a Egochain blockchain platform. By capturing user-defined charging parameters (kWh & duration), the system leverages "smart charging" techniques to achieve grid stability. This innovative platform streamlines the ecosystem, connecting EV owners directly with charging stations, eliminating intermediaries. Egochain, a dedicated blockchain, facilitates flexible charging arrangements (power & time) through its native token rewards. This incentivizes off-peak charging, attracting investments to expand the charging network.',b.jsx("br",{}),b.jsx("br",{}),"Our simulations demonstrate a remarkable 50% increase in user acceptance with this smart charging system, compared to traditional methods. This paves the way for a sustainable and efficient future of EV charging, ensuring grid stability and user satisfaction.",b.jsx("br",{}),b.jsx("br",{}),"While electric vehicle (EV) technology is still in its early stages, the future of transportation points towards widespread adoption. This rapid growth, however, poses a significant challenge to power grids. Charging an EV requires almost twenty times the power of a typical North American household. While current low EV penetration and strategically installed charging points prevent grid congestion for now, stricter emission regulations and ambitious carbon neutrality goals in Europe and elsewhere promise a surge in EV ownership. The International Energy Agency projects that EVs will capture over 30% of the global market share by 2030. Therefore, developing optimal methods for integrating a large number of EVs into the grid is crucial.",b.jsx("br",{}),b.jsx("br",{}),"Nour et al. (2019) categorize EV charging into three types: uncontrolled, delayed, and smart. Uncontrolled charging, akin to manual on-off switching, occurs when an EV is plugged in and charges to full capacity. Delayed charging utilizes time-varying electricity tariffs to incentivize EV users to shift their charging to off-peak hours.",b.jsx("br",{}),b.jsx("br",{}),"Smart charging emerges as the most promising solution for the future. It utilizes algorithms to intelligently control charging points, potentially implemented by distribution system operators (DSOs) via communication channels to the stations. Two control architectures exist: centralized and decentralized. Centralized control involves aggregators purchasing power from multiple EV owners and acting as intermediaries between them and ancillary service markets (Daina et al., 2017). This contrasts with decentralized control, where EV owners directly influence charging flexibility based on market information and incentives offered by the charging point operator (CPO). Creating effective incentives for flexible charging preferences is therefore key to optimizing operation, minimizing grid congestion, and even allowing more EVs to be charged at a single station.",b.jsx("br",{}),b.jsx("br",{}),"Egochain has designed incentive mechanisms for charging preferences. We aim to demonstrate how these incentives can significantly reduce grid congestion while enabling more efficient charging at multi-point stations, paving the way for a seamless transition to a future dominated by electric vehicles.",b.jsx("br",{}),b.jsx("br",{}),"Figure1",b.jsx("img",{src:"/img/whitepaper_img3.jpeg",alt:""}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Figure 1"})," presents the architectural blueprint of the EV charging market, outlining the participating actors and their interwoven flows of information and electricity. At the core of this ecosystem lie several key players:",b.jsxs("span",{children:[b.jsxs("li",{children:[b.jsx("b",{children:" EV User:"})," The individual or entity owning and operating an electric vehicle."]}),b.jsxs("li",{children:[b.jsx("b",{children:" Charge Point Operator (CPO):"})," The entity responsible for managing and operating a charging station."]}),b.jsxs("li",{children:[b.jsx("b",{children:" eMobility Service Provider (eMSP):"})," A digital bridge between EV users and CPOs, providing real-time information on charging station availability, facilitating reservations, and enabling payment functionalities."]}),b.jsxs("li",{children:[b.jsx("b",{children:"E-Mobility Clearing House:"})," The trusted entity that handles the financial transactions between EV users and CPOs, facilitated by eMSPs."]}),b.jsxs("li",{children:[b.jsx("b",{children:"Distribution System Operator (DSO):"})," The utility company responsible for operating the low and medium voltage grids and delivering electricity to end users."]}),b.jsxs("li",{children:[b.jsx("b",{children:"Electricity Supply Retailer:"})," The company selling electricity to consumers, possessing grid access contracts to purchase power from DSOs."]})]}),b.jsx("br",{}),b.jsx("br",{}),"Beyond the traditional network, Egochain emerges as a game-changer. This distributed blockchain platform leverages cryptographic signatures and consensus mechanisms to secure data transactions and computations within the Internet of Things (IoT). With its inherent transparency and trust, Egochain fuels smart contract functionality, automating agreements among participants and executing actions only when predefined conditions are met.",b.jsx("br",{}),b.jsx("br",{}),"This paper introduces a novel model that leverages Egochain's smart contracts to incentivize EV users for aligning their charging preferences with grid priorities. These incentives, issued in the form of EGAX tokens, act as a digital currency within the network, enabling users to offset future charging costs."]}),b.jsx("div",{className:"break_line_txt",children:"APPROACH AND SIMULATIONS"}),b.jsxs("section",{id:"Smart Charging Architecture",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Smart Charging Architecture"})," ",b.jsx("br",{}),b.jsx("b",{children:"Figure 2"})," illustrates the Egochain smart EV charging system. Moving beyond traditional models, Egochain leverages its blockchain technology to streamline billing and payment processes. Instead of relying on intermediaries like eMSPs and clearing houses, dedicated smart contract charge stations (cssc) deployed on the Egochain blockchain handle these functions. These csscs not only manage payments but also trigger smart charging for individual charge points (CPs), ensuring efficient energy distribution. Additionally, the system incentivizes EV users to participate in smart charging by rewarding them through csscs for offering flexible charging schedules.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("img",{src:"/img/whitepaper_img4.jpeg",alt:""})]}),b.jsxs("section",{id:"Charging Algorithm and Flexibility Offers",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Charging Algorithm and Flexibility Offers"})," ",b.jsx("br",{}),b.jsx("b",{children:"Figure 3"})," outlines the decision-making process whenever a new charging request arrives. EV users specify their desired energy amount (E) and maximum charging time (T) through the system. To facilitate efficient evaluation, a time step of 15 minutes is employed, ensuring each request within a given period is analyzed individually on a first-come-first-serve basis. Accepted requests initiate charging during the subsequent time interval.",b.jsx("br",{}),b.jsx("br",{}),"Upon receiving a new request, the system first assesses potential grid congestion. If accepting the request at full power, alongside existing ones, would overload the grid, the model explores alternative solutions. It investigates whether the user has designated any flexibility preferences, allowing for smart charging adjustments and potential congestion alleviation. In the absence of flexibility (fast charge demand), the request is accepted regardless. Otherwise, a fulfillment check determines if the proposed flexibility accommodates congestion mitigation while fulfilling the user's energy demand within the specified timeframe. Successful checks translate to acceptance, while failures result in request rejection, with the option to re-evaluate in the next interval if the user remains available.",b.jsx("br",{}),b.jsx("br",{}),"Therefore, flexibility refers to the charging time or power an EV user is willing to adjust in exchange for monetary rewards. As such, fair and transparent allocation mechanisms are crucial for managing these exchanges. The system utilizes a proportionate allocation mechanism to guarantee equitable distribution of incentives among participating users.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("img",{src:"/img/whitepaper_img5.jpeg",alt:""})]}),b.jsxs("section",{id:"Determining Electric Vehicle (EV) Flexibility for Next Time Step",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Determining Electric Vehicle (EV) Flexibility for Next Time Step"})," ",b.jsx("br",{}),"This algorithm estimates the potential of an EV user to offer charging flexibility during the next time step.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Key parameters:"}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsxs("li",{children:[b.jsx("span",{children:"Es(i,n):"})," Energy supplied to EV (i) at time step (n)"]}),b.jsxs("li",{children:[b.jsx("span",{children:"Ts(i,n):"})," Charging time for EV (i) at time step (n)"]}),b.jsxs("li",{children:[b.jsx("span",{children:"P_N(i):"})," Nominal power of charging point (CP) serving EV (i)"]}),b.jsxs("li",{children:[b.jsx("span",{children:"TF(i,n):"})," Flexible time available for charging EV (i) at time step (n)"]}),b.jsxs("li",{children:[b.jsx("span",{children:"Fl(i,n+1):"})," Flexible offer by EV (i) for next time step (n+1)"]})]}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Algorithm:"}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("span",{children:"1. Calculate flexible time: TF(i,n) = Ts(i,n) - Es(i,n) / P_N(i)"}),b.jsx("br",{}),b.jsxs("span",{children:["2. Determine flexible offer:"," ","Fl(i,n+1) = { P_N(i) if TF(i,n) >= 15 minutes P_N(i) * TF(i,n) / 15 minutes otherwise }"]})]}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Explanation:"}),b.jsx("br",{}),b.jsx("br",{}),'The algorithm first calculates the "flexible time" available for charging the EV (i) at the current time step (n). This is the difference between the scheduled charging time (Ts(i,n)) and the required time to reach the desired amount of energy with the nominal power of the CP (Es(i,n) / P_N(i)).',b.jsx("br",{}),b.jsx("br",{}),"Next, the algorithm estimates the flexible offer (Fl(i,n+1)) that the EV user is willing to provide for the next time step (n+1). This offer is equal to the full nominal power of the CP (P_N(i)) if the available flexible time is at least 15 minutes. Otherwise, the offer is proportionally reduced based on the remaining flexible time.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Benefits:"}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"This algorithm provides a simple and efficient way to estimate EV flexibility potential."}),b.jsx("li",{children:"The use of a minimum flexible time threshold ensures practical feasibility and reduces the impact of short-term fluctuations."}),b.jsx("li",{children:"The dynamic offer based on remaining time incentivizes users to participate and ensures efficient grid resource allocation."})]})]}),b.jsxs("section",{id:"Decentralized Secure Charging with Egochain",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Decentralized Secure Charging with Egochain:"})," ",b.jsx("br",{}),"For enhanced security and trust, we implemented Egochain, a blockchain platform, into the charging infrastructure. Each charging point (CP) houses a Raspberry Pi (RPi) running an Egochain node (Fig. 2).",b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Smart Contract Orchestrates Flexibility:"}),b.jsxs("span",{children:[b.jsxs("span",{children:[" ",b.jsx("span",{children:"1. "})," Cloud Deployment: The smart charging algorithm and flexibility offers reside in the cloud."]}),b.jsxs("span",{children:[" ",b.jsx("span",{children:"2. "})," Smart Contract Development and Deployment: A dedicated smart contract (SC) manages energy transactions on the Egochain network. Its Application Binary Interface (ABI) is integrated into a Python script facilitating blockchain interaction."]}),b.jsxs("span",{children:[" ",b.jsx("span",{children:"3. "}),"Regular Communication: Every 15 minutes, the Python script retrieves EV user charging requests (E, T) and calculates flexibility offers for the next slot. Accepted offers are encrypted and stored on the Egochain blockchain."]}),b.jsxs("span",{children:[" ",b.jsx("span",{children:"4. "}),"Parallel Backup: Each CPO's backend system connects to the cloud and its local blockchain node. This redundancy ensures data accessibility and direct interaction with the cloud database and Python script."]}),b.jsxs("span",{children:[" ",b.jsx("span",{children:"5. "}),"Rewarding Flexibility: Upon confirmed delivery of the agreed-upon flexibility offer, the Egochain node triggers EGAX token payout to the EV user, compensating them for their energy and time flexibility."]})]}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Benefits:"}),b.jsxs("span",{children:[b.jsx("li",{children:"Enhanced Security: Blockchain technology guarantees tamper-proof and transparent transaction records."}),b.jsx("li",{children:"Decentralized Trust: Secure peer-to-peer interactions eliminate the need for a central authority."}),b.jsx("li",{children:"Automated Flexibility Rewards: Smart contracts automate reward distribution based on agreed-upon flexibility offers."})]}),b.jsx("br",{}),b.jsx("br",{}),"This approach fosters a secure, transparent, and rewarding charging ecosystem for both EV users and CPOs."]}),b.jsxs("section",{id:"Simulation Parameters",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Simulation Parameters"})," ",b.jsx("br",{}),"This section outlines the key parameters governing our EV charging demand model.",b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"Average Daily Travel Distance: Based on data from BMVi (2019), the average German travels 39km daily."}),b.jsx("li",{children:"Weekly Driving Range: Translating daily travel to a weekly basis, an individual accumulates approximately 280km of weekly driving."}),b.jsx("li",{children:"EV Battery Efficiency: Studies by AUTOBEST (2018) indicate an average driving range of 7km per kWh for electric vehicles."}),b.jsx("li",{children:"Weekly Energy Demand: Combining weekly travel distance with battery efficiency, an average EV user requires 40kWh of energy to fulfill their weekly mobility needs."})]})]}),b.jsxs("section",{id:"Dynamic Charging Model Based on User Activity",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Dynamic Charging Model Based on User Activity:"})," ",b.jsx("br",{}),"To accommodate diverse user behavior and charging needs, we've implemented a time-based charging system categorized by typical dwell times. This flexible approach helps us accurately model and predict charging demand across various locations and throughout the week.",b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"Category 1 (1-2 hours): High-frequency charging for short stops, commonly found in shopping malls, restaurants, and public parking areas."}),b.jsx("li",{children:"Category 2 (2-4 hours): Moderate-duration charging for extended stays, such as workplaces, street parking, and airport terminals."}),b.jsx("li",{children:"Category 3 (4-8 hours): Long-term charging for overnight or extended parking, typically occurring in residential areas and hotels."})]}),b.jsx("br",{}),b.jsx("br",{}),"By leveraging this data-driven categorization, we can efficiently allocate resources, optimize charging infrastructure deployment, and ultimately, deliver a seamless and cost-effective experience for our users."]}),b.jsxs("section",{id:"Simulation Scenarios and Methodology",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Simulation Scenarios and Methodology"})," ",b.jsx("br",{}),"The performance of the model was evaluated through simulations under two distinct charging scenarios, each focusing on the arrival rate of charging requests at the pool:",b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"Scenario 1: Low Arrival Rate: A single charging request arrives every time step (15 minutes), representing a moderate demand on the charging pool."}),b.jsx("li",{children:"Scenario 2: High Arrival Rate: Two charging requests arrive every time step, simulating a peak demand situation."})]}),b.jsx("br",{}),b.jsx("br",{}),b.jsx("b",{children:"Both scenarios assumed the following conditions: "}),b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"Charging Power: Each charging point (CP) offers a maximum of 11 kW."}),b.jsx("li",{children:"EV Demand: User demand for charging power is randomly generated, ranging from 10 to 40 kWh (equivalent to 50-200 km) with charging times between 1 and 4 hours."}),b.jsx("li",{children:"Plug Availability: All charging requests are accepted as long as sufficient power is available from the grid and no plug limitations exist."})]}),b.jsx("br",{}),b.jsx("br",{}),"Grid power availability serves as a key variable in the analysis. It starts at 33 kW and is progressively increased by 11 kW increments. Through repeated simulations (100 iterations per scenario), the model's performance is assessed by comparing the total electricity sold and charging request acceptance rate for both uncontrolled and smart charging strategies under varying grid power limits, EV energy demands, and available charging times."]}),b.jsxs("section",{id:"Results and Discussion",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Results and Discussion"})," ",b.jsx("br",{}),"Scenario 1: Figure 4 presents the results for a ten-hour charging period under varying grid power limits. The blue, orange, and yellow bars represent:",b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsxs("li",{children:["Total electricity sold:"," ",b.jsxs("span",{children:[b.jsx("li",{children:"Blue: Uncontrolled charging."}),b.jsx("li",{children:"Orange: Smart charging."})]})]}),b.jsx("li",{children:"Utilized flexibility: Electricity supplied to EVs through smart charging (difference between orange and blue bars)."})]}),b.jsx("br",{}),b.jsx("br",{}),"The dotted lines depict the average acceptance rate of uncontrolled (blue) and smart (green) charging.",b.jsx("br",{}),b.jsx("br",{}),"At a 33 kW power limit, uncontrolled charging achieves an average acceptance rate of 38%, while smart charging reaches 70%. This represents a 1.84 times higher acceptance rate for smart charging. As the power limit increases, the difference in acceptance rates diminishes, reaching zero by 120 kW. This indicates that beyond 120 kW, all EVs could be accommodated, demonstrating the effectiveness of smart charging in accommodating demand within existing grid constraints.",b.jsx("br",{}),b.jsx("br",{}),"Scenario 2: Figure 5 shows the results for double the charging requests per time step. Acceptance rates decrease to 23% (uncontrolled) and 43% (smart) at a 33 kW power limit. Similar to Scenario 1, the acceptance rate gap diminishes with increasing power limits, vanishing at 143 kW.",b.jsx("br",{}),b.jsx("br",{}),"Interestingly, at the 33 kW power limit, uncontrolled charging only supplies 309 kWh to EVs, while smart charging provides 603 kWh, equaling the uncontrolled scenario at a 66 kW power limit. This implies that smart charging, by utilizing flexibility, effectively expands the grid capacity by 33 kW.",b.jsx("br",{}),b.jsx("br",{}),"The yellow bars highlight the utilized flexibility, starting at its peak of 364 kWh at 88 kW and gradually decreasing to zero at 220 kW. This phenomenon reveals that as the grid capacity increases, relying on flexibility decreases. Flexibility contributions are most significant under limited grid capacity, enabling additional EV charging.",b.jsx("br",{}),b.jsx("br",{}),"In conclusion, these simulations demonstrate the remarkable capabilities of smart charging in:",b.jsx("br",{}),b.jsx("br",{}),b.jsxs("span",{children:[b.jsx("li",{children:"Increasing EV charging acceptance rates, especially during peak demand."}),b.jsx("li",{children:"Effectively expanding grid capacity by utilizing flexibility under limited power availability."}),b.jsx("li",{children:"Optimizing resource utilization by prioritizing grid electricity when sufficient capacity exists."})]}),b.jsx("br",{}),b.jsx("br",{}),"These findings offer compelling evidence for the widespread adoption of smart charging solutions as a key strategy for integrating high EV penetration into future energy grids.",b.jsx("br",{}),b.jsx("br",{}),b.jsx("img",{src:"/img/whitepaper_img6.jpeg",alt:""})]}),b.jsxs("section",{id:"Conclusion",className:"whitePaper_div_area_body_area_section",children:[b.jsx("div",{className:"whitePaper_div_area_body_area_section_title",children:"Conclusion"})," ",b.jsx("br",{}),"The Egochain blockchain, as detailed in this whitepaper, serves as a catalyst for the widespread acceptance of electric vehicles. By fostering the establishment of intelligent charging stations, the blockchain introduces incentives that encourage electric vehicle (EV) ownership. The associated rewards, denoted as EGAX, can be employed to cover EV charging expenses, transaction fees within the Egochain blockchain, and even contribute to EV acquisitions. Additionally, the ecosystem employs EGC, the debt token, to facilitate accessible credit for EV manufacturing, with interest payments settled in EGAX. This integrated approach not only promotes sustainable transportation but also establishes a comprehensive and self-sustaining ecosystem for the electric vehicle industry."]})]})]})}),b.jsx("img",{src:"/img/hero_bg_light.svg",alt:"",className:"home_div_section1_bg_light"}),b.jsx("img",{src:"/img/test_hero_light2.svg",alt:"",className:"home_div_section1_bg_light2"}),b.jsx("img",{src:"/img/grains_ellipse.png",alt:"",className:"grains_ellipse"})]})};function M1e(){return b.jsxs("div",{className:"App",children:[b.jsx(Dye,{}),b.jsxs(nye,{children:[b.jsx(_l,{path:"/",element:b.jsx(_0e,{})}),b.jsx(_l,{path:"/privacy",element:b.jsx(jye,{})}),b.jsx(_l,{path:"/whitepaper",element:b.jsx(C1e,{})}),b.jsx(_l,{path:"/terms",element:b.jsx(Fye,{})}),b.jsx(_l,{path:"/egc/coin/info",element:b.jsx(bye,{})}),b.jsx(_l,{path:"/egax/coin/info",element:b.jsx(Bye,{})}),b.jsx(_l,{path:"/about",element:b.jsx(Nye,{})})]}),b.jsx(kye,{})]})}Qw.createRoot(document.getElementById("root")).render(b.jsx(lye,{children:b.jsx(M1e,{})}))});export default T1e();
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
